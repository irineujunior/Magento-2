require.config({"config": {
        "jsbuild":{"Magento_Tinymce3/tiny_mce/tiny_mce_prototype.js":"(function(d){var a=/^\\s*|\\s*$/g,e,c=\"B\".replace(/A(.)|B/,\"$1\")===\"$1\";var b={majorVersion:\"3\",minorVersion:\"4.7\",releaseDate:\"2011-11-03\",_init:function(){var s=this,q=document,o=navigator,g=o.userAgent,m,f,l,k,j,r;s.isOpera=d.opera&&opera.buildNumber;s.isWebKit=/WebKit/.test(g);s.isIE=!s.isWebKit&&!s.isOpera&&(/MSIE/gi).test(g)&&(/Explorer/gi).test(o.appName);s.isIE6=s.isIE&&/MSIE [56]/.test(g);s.isIE7=s.isIE&&/MSIE [7]/.test(g);s.isIE8=s.isIE&&/MSIE [8]/.test(g);s.isIE9=s.isIE&&/MSIE [9]/.test(g);s.isGecko=!s.isWebKit&&/Gecko/.test(g);s.isMac=g.indexOf(\"Mac\")!=-1;s.isAir=/adobeair/i.test(g);s.isIDevice=/(iPad|iPhone)/.test(g);s.isIOS5=s.isIDevice&&g.match(/AppleWebKit\\/(\\d*)/)[1]>=534;if(d.tinyMCEPreInit){s.suffix=tinyMCEPreInit.suffix;s.baseURL=tinyMCEPreInit.base;s.query=tinyMCEPreInit.query;return}s.suffix=\"\";f=q.getElementsByTagName(\"base\");for(m=0;m<f.length;m++){if(r=f[m].href){if(/^https?:\\/\\/[^\\/]+$/.test(r)){r+=\"/\"}k=r?r.match(/.*\\//)[0]:\"\"}}function h(i){if(i.src&&/tiny_mce(|_gzip|_jquery|_prototype|_full)(_dev|_src)?.js/.test(i.src)){if(/_(src|dev)\\.js/g.test(i.src)){s.suffix=\"_src\"}if((j=i.src.indexOf(\"?\"))!=-1){s.query=i.src.substring(j+1)}s.baseURL=i.src.substring(0,i.src.lastIndexOf(\"/\"));if(k&&s.baseURL.indexOf(\"://\")==-1&&s.baseURL.indexOf(\"/\")!==0){s.baseURL=k+s.baseURL}return s.baseURL}return null}f=q.getElementsByTagName(\"script\");for(m=0;m<f.length;m++){if(h(f[m])){return}}l=q.getElementsByTagName(\"head\")[0];if(l){f=l.getElementsByTagName(\"script\");for(m=0;m<f.length;m++){if(h(f[m])){return}}}return},is:function(g,f){if(!f){return g!==e}if(f==\"array\"&&(g.hasOwnProperty&&g instanceof Array)){return true}return typeof(g)==f},makeMap:function(f,j,h){var g;f=f||[];j=j||\",\";if(typeof(f)==\"string\"){f=f.split(j)}h=h||{};g=f.length;while(g--){h[f[g]]={}}return h},each:function(i,f,h){var j,g;if(!i){return 0}h=h||i;if(i.length!==e){for(j=0,g=i.length;j<g;j++){if(f.call(h,i[j],j,i)===false){return 0}}}else{for(j in i){if(i.hasOwnProperty(j)){if(f.call(h,i[j],j,i)===false){return 0}}}}return 1},map:function(g,h){var i=[];b.each(g,function(f){i.push(h(f))});return i},grep:function(g,h){var i=[];b.each(g,function(f){if(!h||h(f)){i.push(f)}});return i},inArray:function(g,h){var j,f;if(g){for(j=0,f=g.length;j<f;j++){if(g[j]===h){return j}}}return -1},extend:function(k,j){var h,g,f=arguments;for(h=1,g=f.length;h<g;h++){j=f[h];b.each(j,function(i,l){if(i!==e){k[l]=i}})}return k},trim:function(f){return(f?\"\"+f:\"\").replace(a,\"\")},create:function(o,f,j){var n=this,g,i,k,l,h,m=0;o=/^((static) )?([\\w.]+)(:([\\w.]+))?/.exec(o);k=o[3].match(/(^|\\.)(\\w+)$/i)[2];i=n.createNS(o[3].replace(/\\.\\w+$/,\"\"),j);if(i[k]){return}if(o[2]==\"static\"){i[k]=f;if(this.onCreate){this.onCreate(o[2],o[3],i[k])}return}if(!f[k]){f[k]=function(){};m=1}i[k]=f[k];n.extend(i[k].prototype,f);if(o[5]){g=n.resolve(o[5]).prototype;l=o[5].match(/\\.(\\w+)$/i)[1];h=i[k];if(m){i[k]=function(){return g[l].apply(this,arguments)}}else{i[k]=function(){this.parent=g[l];return h.apply(this,arguments)}}i[k].prototype[k]=i[k];n.each(g,function(p,q){i[k].prototype[q]=g[q]});n.each(f,function(p,q){if(g[q]){i[k].prototype[q]=function(){this.parent=g[q];return p.apply(this,arguments)}}else{if(q!=k){i[k].prototype[q]=p}}})}n.each(f[\"static\"],function(p,q){i[k][q]=p});if(this.onCreate){this.onCreate(o[2],o[3],i[k].prototype)}},walk:function(i,h,j,g){g=g||this;if(i){if(j){i=i[j]}b.each(i,function(k,f){if(h.call(g,k,f,j)===false){return false}b.walk(k,h,j,g)})}},createNS:function(j,h){var g,f;h=h||d;j=j.split(\".\");for(g=0;g<j.length;g++){f=j[g];if(!h[f]){h[f]={}}h=h[f]}return h},resolve:function(j,h){var g,f;h=h||d;j=j.split(\".\");for(g=0,f=j.length;g<f;g++){h=h[j[g]];if(!h){break}}return h},addUnload:function(j,i){var h=this;j={func:j,scope:i||this};if(!h.unloads){function g(){var f=h.unloads,l,m;if(f){for(m in f){l=f[m];if(l&&l.func){l.func.call(l.scope,1)}}if(d.detachEvent){d.detachEvent(\"onbeforeunload\",k);d.detachEvent(\"onunload\",g)}else{if(d.removeEventListener){d.removeEventListener(\"unload\",g,false)}}h.unloads=l=f=w=g=0;if(d.CollectGarbage){CollectGarbage()}}}function k(){var l=document;if(l.readyState==\"interactive\"){function f(){l.detachEvent(\"onstop\",f);if(g){g()}l=0}if(l){l.attachEvent(\"onstop\",f)}d.setTimeout(function(){if(l){l.detachEvent(\"onstop\",f)}},0)}}if(d.attachEvent){d.attachEvent(\"onunload\",g);d.attachEvent(\"onbeforeunload\",k)}else{if(d.addEventListener){d.addEventListener(\"unload\",g,false)}}h.unloads=[j]}else{h.unloads.push(j)}return j},removeUnload:function(i){var g=this.unloads,h=null;b.each(g,function(j,f){if(j&&j.func==i){g.splice(f,1);h=i;return false}});return h},explode:function(f,g){return f?b.map(f.split(g||\",\"),b.trim):f},_addVer:function(g){var f;if(!this.query){return g}f=(g.indexOf(\"?\")==-1?\"?\":\"&\")+this.query;if(g.indexOf(\"#\")==-1){return g+f}return g.replace(\"#\",f+\"#\")},_replace:function(h,f,g){if(c){return g.replace(h,function(){var l=f,j=arguments,k;for(k=0;k<j.length-2;k++){if(j[k]===e){l=l.replace(new RegExp(\"\\\\$\"+k,\"g\"),\"\")}else{l=l.replace(new RegExp(\"\\\\$\"+k,\"g\"),j[k])}}return l})}return g.replace(h,f)}};b._init();d.tinymce=d.tinyMCE=b})(window);(function(){if(!window.Prototype){return alert(\"Load prototype first!\")}tinymce.extend(tinymce,{trim:function(b){return b?b.strip():\"\"},inArray:function(b,c){return b&&b.indexOf?b.indexOf(c):-1}});var a={\"tinymce.util.JSON\":{},};tinymce.onCreate=function(b,e,d){tinymce.extend(d,a[e])}})();tinymce.create(\"tinymce.util.Dispatcher\",{scope:null,listeners:null,Dispatcher:function(a){this.scope=a||this;this.listeners=[]},add:function(a,b){this.listeners.push({cb:a,scope:b||this.scope});return a},addToTop:function(a,b){this.listeners.unshift({cb:a,scope:b||this.scope});return a},remove:function(a){var b=this.listeners,c=null;tinymce.each(b,function(e,d){if(a==e.cb){c=a;b.splice(d,1);return false}});return c},dispatch:function(){var f,d=arguments,e,b=this.listeners,g;for(e=0;e<b.length;e++){g=b[e];f=g.cb.apply(g.scope,d);if(f===false){break}}return f}});(function(){var a=tinymce.each;tinymce.create(\"tinymce.util.URI\",{URI:function(e,g){var f=this,i,d,c,h;e=tinymce.trim(e);g=f.settings=g||{};if(/^([\\w\\-]+):([^\\/]{2})/i.test(e)||/^\\s*#/.test(e)){f.source=e;return}if(e.indexOf(\"/\")===0&&e.indexOf(\"//\")!==0){e=(g.base_uri?g.base_uri.protocol||\"http\":\"http\")+\"://mce_host\"+e}if(!/^[\\w-]*:?\\/\\//.test(e)){h=g.base_uri?g.base_uri.path:new tinymce.util.URI(location.href).directory;e=((g.base_uri&&g.base_uri.protocol)||\"http\")+\"://mce_host\"+f.toAbsPath(h,e)}e=e.replace(/@@/g,\"(mce_at)\");e=/^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(e);a([\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"],function(b,j){var k=e[j];if(k){k=k.replace(/\\(mce_at\\)/g,\"@@\")}f[b]=k});if(c=g.base_uri){if(!f.protocol){f.protocol=c.protocol}if(!f.userInfo){f.userInfo=c.userInfo}if(!f.port&&f.host==\"mce_host\"){f.port=c.port}if(!f.host||f.host==\"mce_host\"){f.host=c.host}f.source=\"\"}},setPath:function(c){var b=this;c=/^(.*?)\\/?(\\w+)?$/.exec(c);b.path=c[0];b.directory=c[1];b.file=c[2];b.source=\"\";b.getURI()},toRelative:function(b){var c=this,d;if(b===\"./\"){return b}b=new tinymce.util.URI(b,{base_uri:c});if((b.host!=\"mce_host\"&&c.host!=b.host&&b.host)||c.port!=b.port||c.protocol!=b.protocol){return b.getURI()}d=c.toRelPath(c.path,b.path);if(b.query){d+=\"?\"+b.query}if(b.anchor){d+=\"#\"+b.anchor}return d},toAbsolute:function(b,c){var b=new tinymce.util.URI(b,{base_uri:this});return b.getURI(this.host==b.host&&this.protocol==b.protocol?c:0)},toRelPath:function(g,h){var c,f=0,d=\"\",e,b;g=g.substring(0,g.lastIndexOf(\"/\"));g=g.split(\"/\");c=h.split(\"/\");if(g.length>=c.length){for(e=0,b=g.length;e<b;e++){if(e>=c.length||g[e]!=c[e]){f=e+1;break}}}if(g.length<c.length){for(e=0,b=c.length;e<b;e++){if(e>=g.length||g[e]!=c[e]){f=e+1;break}}}if(f==1){return h}for(e=0,b=g.length-(f-1);e<b;e++){d+=\"../\"}for(e=f-1,b=c.length;e<b;e++){if(e!=f-1){d+=\"/\"+c[e]}else{d+=c[e]}}return d},toAbsPath:function(e,f){var c,b=0,h=[],d,g;d=/\\/$/.test(f)?\"/\":\"\";e=e.split(\"/\");f=f.split(\"/\");a(e,function(i){if(i){h.push(i)}});e=h;for(c=f.length-1,h=[];c>=0;c--){if(f[c].length==0||f[c]==\".\"){continue}if(f[c]==\"..\"){b++;continue}if(b>0){b--;continue}h.push(f[c])}c=e.length-b;if(c<=0){g=h.reverse().join(\"/\")}else{g=e.slice(0,c).join(\"/\")+\"/\"+h.reverse().join(\"/\")}if(g.indexOf(\"/\")!==0){g=\"/\"+g}if(d&&g.lastIndexOf(\"/\")!==g.length-1){g+=d}return g},getURI:function(d){var c,b=this;if(!b.source||d){c=\"\";if(!d){if(b.protocol){c+=b.protocol+\"://\"}if(b.userInfo){c+=b.userInfo+\"@\"}if(b.host){c+=b.host}if(b.port){c+=\":\"+b.port}}if(b.path){c+=b.path}if(b.query){c+=\"?\"+b.query}if(b.anchor){c+=\"#\"+b.anchor}b.source=c}return b.source}})})();(function(){var a=tinymce.each;tinymce.create(\"static tinymce.util.Cookie\",{getHash:function(d){var b=this.get(d),c;if(b){a(b.split(\"&\"),function(e){e=e.split(\"=\");c=c||{};c[unescape(e[0])]=unescape(e[1])})}return c},setHash:function(j,b,g,f,i,c){var h=\"\";a(b,function(e,d){h+=(!h?\"\":\"&\")+escape(d)+\"=\"+escape(e)});this.set(j,h,g,f,i,c)},get:function(i){var h=document.cookie,g,f=i+\"=\",d;if(!h){return}d=h.indexOf(\"; \"+f);if(d==-1){d=h.indexOf(f);if(d!=0){return null}}else{d+=2}g=h.indexOf(\";\",d);if(g==-1){g=h.length}return unescape(h.substring(d+f.length,g))},set:function(i,b,g,f,h,c){document.cookie=i+\"=\"+escape(b)+((g)?\"; expires=\"+g.toUTCString():\"\")+((f)?\"; path=\"+escape(f):\"\")+((h)?\"; domain=\"+h:\"\")+((c)?\"; secure\":\"\")},remove:function(e,b){var c=new Date();c.setTime(c.getTime()-1000);this.set(e,\"\",c,b,c)}})})();(function(){function serialize(o,quote){var i,v,t;quote=quote||'\"';if(o==null){return\"null\"}t=typeof o;if(t==\"string\"){v=\"\\bb\\tt\\nn\\ff\\rr\\\"\\\"''\\\\\\\\\";return quote+o.replace(/([\\u0080-\\uFFFF\\x00-\\x1f\\\"\\'\\\\])/g,function(a,b){if(quote==='\"'&&a===\"'\"){return a}i=v.indexOf(b);if(i+1){return\"\\\\\"+v.charAt(i+1)}a=b.charCodeAt().toString(16);return\"\\\\u\"+\"0000\".substring(a.length)+a})+quote}if(t==\"object\"){if(o.hasOwnProperty&&o instanceof Array){for(i=0,v=\"[\";i<o.length;i++){v+=(i>0?\",\":\"\")+serialize(o[i],quote)}return v+\"]\"}v=\"{\";for(i in o){if(o.hasOwnProperty(i)){v+=typeof o[i]!=\"function\"?(v.length>1?\",\"+quote:quote)+i+quote+\":\"+serialize(o[i],quote):\"\"}}return v+\"}\"}return\"\"+o}tinymce.util.JSON={serialize:serialize,parse:function(s){try{return eval(\"(\"+s+\")\")}catch(ex){}}}})();tinymce.create(\"static tinymce.util.XHR\",{send:function(g){var a,e,b=window,h=0;g.scope=g.scope||this;g.success_scope=g.success_scope||g.scope;g.error_scope=g.error_scope||g.scope;g.async=g.async===false?false:true;g.data=g.data||\"\";function d(i){a=0;try{a=new ActiveXObject(i)}catch(c){}return a}a=b.XMLHttpRequest?new XMLHttpRequest():d(\"Microsoft.XMLHTTP\")||d(\"Msxml2.XMLHTTP\");if(a){if(a.overrideMimeType){a.overrideMimeType(g.content_type)}a.open(g.type||(g.data?\"POST\":\"GET\"),g.url,g.async);if(g.content_type){a.setRequestHeader(\"Content-Type\",g.content_type)}a.setRequestHeader(\"X-Requested-With\",\"XMLHttpRequest\");a.send(g.data);function f(){if(!g.async||a.readyState==4||h++>10000){if(g.success&&h<10000&&a.status==200){g.success.call(g.success_scope,\"\"+a.responseText,a,g)}else{if(g.error){g.error.call(g.error_scope,h>10000?\"TIMED_OUT\":\"GENERAL\",a,g)}}a=null}else{b.setTimeout(f,10)}}if(!g.async){return f()}e=b.setTimeout(f,10)}}});(function(){var c=tinymce.extend,b=tinymce.util.JSON,a=tinymce.util.XHR;tinymce.create(\"tinymce.util.JSONRequest\",{JSONRequest:function(d){this.settings=c({},d);this.count=0},send:function(f){var e=f.error,d=f.success;f=c(this.settings,f);f.success=function(h,g){h=b.parse(h);if(typeof(h)==\"undefined\"){h={error:\"JSON Parse error.\"}}if(h.error){e.call(f.error_scope||f.scope,h.error,g)}else{d.call(f.success_scope||f.scope,h.result)}};f.error=function(h,g){if(e){e.call(f.error_scope||f.scope,h,g)}};f.data=b.serialize({id:f.id||\"c\"+(this.count++),method:f.method,params:f.params});f.content_type=\"application/json\";a.send(f)},\"static\":{sendRPC:function(d){return new tinymce.util.JSONRequest().send(d)}}})}());(function(a){a.VK={DELETE:46,BACKSPACE:8,ENTER:13,TAB:9,SPACEBAR:32,UP:38,DOWN:40}})(tinymce);(function(k){var i=k.VK,j=i.BACKSPACE,h=i.DELETE;function c(m){var o=m.dom,n=m.selection;m.onKeyDown.add(function(q,u){var p,v,s,t,r;r=u.keyCode==h;if(r||u.keyCode==j){u.preventDefault();p=n.getRng();v=o.getParent(p.startContainer,o.isBlock);if(r){v=o.getNext(v,o.isBlock)}if(v){s=v.firstChild;while(s&&s.nodeType==3&&s.nodeValue.length==0){s=s.nextSibling}if(s&&s.nodeName===\"SPAN\"){t=s.cloneNode(false)}}q.getDoc().execCommand(r?\"ForwardDelete\":\"Delete\",false,null);v=o.getParent(p.startContainer,o.isBlock);k.each(o.select(\"span.Apple-style-span,font.Apple-style-span\",v),function(x){var y=n.getBookmark();if(t){o.replace(t.cloneNode(false),x,true)}else{o.remove(x,true)}n.moveToBookmark(y)})}})}function d(m){m.onKeyUp.add(function(n,p){var o=p.keyCode;if(o==h||o==j){if(n.dom.isEmpty(n.getBody())){n.setContent(\"\",{format:\"raw\"});n.nodeChanged();return}}})}function b(m){m.dom.bind(m.getDoc(),\"focusin\",function(){m.selection.setRng(m.selection.getRng())})}function e(m){m.onKeyDown.add(function(n,q){if(q.keyCode===j){if(n.selection.isCollapsed()&&n.selection.getRng(true).startOffset===0){var p=n.selection.getNode();var o=p.previousSibling;if(o&&o.nodeName&&o.nodeName.toLowerCase()===\"hr\"){n.dom.remove(o);k.dom.Event.cancel(q)}}}})}function g(m){if(!Range.prototype.getClientRects){m.onMouseDown.add(function(o,p){if(p.target.nodeName===\"HTML\"){var n=o.getBody();n.blur();setTimeout(function(){n.focus()},0)}})}}function f(m){m.onClick.add(function(n,o){o=o.target;if(/^(IMG|HR)$/.test(o.nodeName)){n.selection.select(o)}if(o.nodeName==\"A\"&&n.dom.hasClass(o,\"mceItemAnchor\")){n.selection.select(o)}n.nodeChanged()})}function l(m){var o,n;m.dom.bind(m.getDoc(),\"selectionchange\",function(){if(n){clearTimeout(n);n=0}n=window.setTimeout(function(){var p=m.selection.getRng();if(!o||!k.dom.RangeUtils.compareRanges(p,o)){m.nodeChanged();o=p}},50)})}function a(m){document.body.setAttribute(\"role\",\"application\")}k.create(\"tinymce.util.Quirks\",{Quirks:function(m){if(k.isWebKit){c(m);d(m);b(m);f(m);if(k.isIDevice){l(m)}}if(k.isIE){e(m);d(m);a(m)}if(k.isGecko){e(m);g(m)}}})})(tinymce);(function(j){var a,g,d,k=/[&<>\\\"\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g,b=/[<>&\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g,f=/[<>&\\\"\\']/g,c=/&(#x|#)?([\\w]+);/g,i={128:\"\\u20AC\",130:\"\\u201A\",131:\"\\u0192\",132:\"\\u201E\",133:\"\\u2026\",134:\"\\u2020\",135:\"\\u2021\",136:\"\\u02C6\",137:\"\\u2030\",138:\"\\u0160\",139:\"\\u2039\",140:\"\\u0152\",142:\"\\u017D\",145:\"\\u2018\",146:\"\\u2019\",147:\"\\u201C\",148:\"\\u201D\",149:\"\\u2022\",150:\"\\u2013\",151:\"\\u2014\",152:\"\\u02DC\",153:\"\\u2122\",154:\"\\u0161\",155:\"\\u203A\",156:\"\\u0153\",158:\"\\u017E\",159:\"\\u0178\"};g={'\"':\"&quot;\",\"'\":\"&#39;\",\"<\":\"&lt;\",\">\":\"&gt;\",\"&\":\"&amp;\"};d={\"&lt;\":\"<\",\"&gt;\":\">\",\"&amp;\":\"&\",\"&quot;\":'\"',\"&apos;\":\"'\"};function h(l){var m;m=document.createElement(\"div\");m.innerHTML=l;return m.textContent||m.innerText||l}function e(m,p){var n,o,l,q={};if(m){m=m.split(\",\");p=p||10;for(n=0;n<m.length;n+=2){o=String.fromCharCode(parseInt(m[n],p));if(!g[o]){l=\"&\"+m[n+1]+\";\";q[o]=l;q[l]=o}}return q}}a=e(\"50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro\",32);j.html=j.html||{};j.html.Entities={encodeRaw:function(m,l){return m.replace(l?k:b,function(n){return g[n]||n})},encodeAllRaw:function(l){return(\"\"+l).replace(f,function(m){return g[m]||m})},encodeNumeric:function(m,l){return m.replace(l?k:b,function(n){if(n.length>1){return\"&#\"+(((n.charCodeAt(0)-55296)*1024)+(n.charCodeAt(1)-56320)+65536)+\";\"}return g[n]||\"&#\"+n.charCodeAt(0)+\";\"})},encodeNamed:function(n,l,m){m=m||a;return n.replace(l?k:b,function(o){return g[o]||m[o]||o})},getEncodeFunc:function(l,o){var p=j.html.Entities;o=e(o)||a;function m(r,q){return r.replace(q?k:b,function(s){return g[s]||o[s]||\"&#\"+s.charCodeAt(0)+\";\"||s})}function n(r,q){return p.encodeNamed(r,q,o)}l=j.makeMap(l.replace(/\\+/g,\",\"));if(l.named&&l.numeric){return m}if(l.named){if(o){return n}return p.encodeNamed}if(l.numeric){return p.encodeNumeric}return p.encodeRaw},decode:function(l){return l.replace(c,function(n,m,o){if(m){o=parseInt(o,m.length===2?16:10);if(o>65535){o-=65536;return String.fromCharCode(55296+(o>>10),56320+(o&1023))}else{return i[o]||String.fromCharCode(o)}}return d[n]||a[n]||h(n)})}}})(tinymce);tinymce.html.Styles=function(d,f){var k=/rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*\\)/gi,h=/(?:url(?:(?:\\(\\s*\\\"([^\\\"]+)\\\"\\s*\\))|(?:\\(\\s*\\'([^\\']+)\\'\\s*\\))|(?:\\(\\s*([^)\\s]+)\\s*\\))))|(?:\\'([^\\']+)\\')|(?:\\\"([^\\\"]+)\\\")/gi,b=/\\s*([^:]+):\\s*([^;]+);?/g,l=/\\s+$/,m=/rgb/,e,g,a={},j;d=d||{};j=\"\\\\\\\" \\\\' \\\\; \\\\: ; : \\uFEFF\".split(\" \");for(g=0;g<j.length;g++){a[j[g]]=\"\\uFEFF\"+g;a[\"\\uFEFF\"+g]=j[g]}function c(n,q,p,i){function o(r){r=parseInt(r).toString(16);return r.length>1?r:\"0\"+r}return\"#\"+o(q)+o(p)+o(i)}return{toHex:function(i){return i.replace(k,c)},parse:function(r){var y={},p,n,v,q,u=d.url_converter,x=d.url_converter_scope||this;function o(C,F){var E,B,A,D;E=y[C+\"-top\"+F];if(!E){return}B=y[C+\"-right\"+F];if(E!=B){return}A=y[C+\"-bottom\"+F];if(B!=A){return}D=y[C+\"-left\"+F];if(A!=D){return}y[C+F]=D;delete y[C+\"-top\"+F];delete y[C+\"-right\"+F];delete y[C+\"-bottom\"+F];delete y[C+\"-left\"+F]}function t(B){var C=y[B],A;if(!C||C.indexOf(\" \")<0){return}C=C.split(\" \");A=C.length;while(A--){if(C[A]!==C[0]){return false}}y[B]=C[0];return true}function z(C,B,A,D){if(!t(B)){return}if(!t(A)){return}if(!t(D)){return}y[C]=y[B]+\" \"+y[A]+\" \"+y[D];delete y[B];delete y[A];delete y[D]}function s(A){q=true;return a[A]}function i(B,A){if(q){B=B.replace(/\\uFEFF[0-9]/g,function(C){return a[C]})}if(!A){B=B.replace(/\\\\([\\'\\\";:])/g,\"$1\")}return B}if(r){r=r.replace(/\\\\[\\\"\\';:\\uFEFF]/g,s).replace(/\\\"[^\\\"]+\\\"|\\'[^\\']+\\'/g,function(A){return A.replace(/[;:]/g,s)});while(p=b.exec(r)){n=p[1].replace(l,\"\").toLowerCase();v=p[2].replace(l,\"\");if(n&&v.length>0){if(n===\"font-weight\"&&v===\"700\"){v=\"bold\"}else{if(n===\"color\"||n===\"background-color\"){v=v.toLowerCase()}}v=v.replace(k,c);v=v.replace(h,function(B,A,E,D,F,C){F=F||C;if(F){F=i(F);return\"'\"+F.replace(/\\'/g,\"\\\\'\")+\"'\"}A=i(A||E||D);if(u){A=u.call(x,A,\"style\")}return\"url('\"+A.replace(/\\'/g,\"\\\\'\")+\"')\"});y[n]=q?i(v,true):v}b.lastIndex=p.index+p[0].length}o(\"border\",\"\");o(\"border\",\"-width\");o(\"border\",\"-color\");o(\"border\",\"-style\");o(\"padding\",\"\");o(\"margin\",\"\");z(\"border\",\"border-width\",\"border-style\",\"border-color\");if(y.border===\"medium none\"){delete y.border}}return y},serialize:function(p,r){var o=\"\",n,q;function i(t){var x,u,s,v;x=f.styles[t];if(x){for(u=0,s=x.length;u<s;u++){t=x[u];v=p[t];if(v!==e&&v.length>0){o+=(o.length>0?\" \":\"\")+t+\": \"+v+\";\"}}}}if(r&&f&&f.styles){i(\"*\");i(r)}else{for(n in p){q=p[n];if(q!==e&&q.length>0){o+=(o.length>0?\" \":\"\")+n+\": \"+q+\";\"}}}return o}}};(function(m){var h={},j,l,g,f,c={},b,e,d=m.makeMap,k=m.each;function i(o,n){return o.split(n||\",\")}function a(r,q){var o,p={};function n(s){return s.replace(/[A-Z]+/g,function(t){return n(r[t])})}for(o in r){if(r.hasOwnProperty(o)){r[o]=n(r[o])}}n(q).replace(/#/g,\"#text\").replace(/(\\w+)\\[([^\\]]+)\\]\\[([^\\]]*)\\]/g,function(v,t,s,u){s=i(s,\"|\");p[t]={attributes:d(s),attributesOrder:s,children:d(u,\"|\",{\"#comment\":{}})}});return p}l=\"h1,h2,h3,h4,h5,h6,hr,p,div,address,pre,form,table,tbody,thead,tfoot,th,tr,td,li,ol,ul,caption,blockquote,center,dl,dt,dd,dir,fieldset,noscript,menu,isindex,samp,header,footer,article,section,hgroup\";l=d(l,\",\",d(l.toUpperCase()));h=a({Z:\"H|K|N|O|P\",Y:\"X|form|R|Q\",ZG:\"E|span|width|align|char|charoff|valign\",X:\"p|T|div|U|W|isindex|fieldset|table\",ZF:\"E|align|char|charoff|valign\",W:\"pre|hr|blockquote|address|center|noframes\",ZE:\"abbr|axis|headers|scope|rowspan|colspan|align|char|charoff|valign|nowrap|bgcolor|width|height\",ZD:\"[E][S]\",U:\"ul|ol|dl|menu|dir\",ZC:\"p|Y|div|U|W|table|br|span|bdo|object|applet|img|map|K|N|Q\",T:\"h1|h2|h3|h4|h5|h6\",ZB:\"X|S|Q\",S:\"R|P\",ZA:\"a|G|J|M|O|P\",R:\"a|H|K|N|O\",Q:\"noscript|P\",P:\"ins|del|script\",O:\"input|select|textarea|label|button\",N:\"M|L\",M:\"em|strong|dfn|code|q|samp|kbd|var|cite|abbr|acronym\",L:\"sub|sup\",K:\"J|I\",J:\"tt|i|b|u|s|strike\",I:\"big|small|font|basefont\",H:\"G|F\",G:\"br|span|bdo\",F:\"object|applet|img|map|iframe\",E:\"A|B|C\",D:\"accesskey|tabindex|onfocus|onblur\",C:\"onclick|ondblclick|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup\",B:\"lang|xml:lang|dir\",A:\"id|class|style|title\"},\"script[id|charset|type|language|src|defer|xml:space][]style[B|id|type|media|title|xml:space][]object[E|declare|classid|codebase|data|type|codetype|archive|standby|width|height|usemap|name|tabindex|align|border|hspace|vspace][#|param|Y]param[id|name|value|valuetype|type][]p[E|align][#|S]a[E|D|charset|type|name|href|hreflang|rel|rev|shape|coords|target][#|Z]br[A|clear][]span[E][#|S]bdo[A|C|B][#|S]applet[A|codebase|archive|code|object|alt|name|width|height|align|hspace|vspace][#|param|Y]h1[E|align][#|S]img[E|src|alt|name|longdesc|width|height|usemap|ismap|align|border|hspace|vspace][]map[B|C|A|name][X|form|Q|area]h2[E|align][#|S]iframe[A|longdesc|name|src|frameborder|marginwidth|marginheight|scrolling|align|width|height][#|Y]h3[E|align][#|S]tt[E][#|S]i[E][#|S]b[E][#|S]u[E][#|S]s[E][#|S]strike[E][#|S]big[E][#|S]small[E][#|S]font[A|B|size|color|face][#|S]basefont[id|size|color|face][]em[E][#|S]strong[E][#|S]dfn[E][#|S]code[E][#|S]q[E|cite][#|S]samp[E][#|S]kbd[E][#|S]var[E][#|S]cite[E][#|S]abbr[E][#|S]acronym[E][#|S]sub[E][#|S]sup[E][#|S]input[E|D|type|name|value|checked|disabled|readonly|size|maxlength|src|alt|usemap|onselect|onchange|accept|align][]select[E|name|size|multiple|disabled|tabindex|onfocus|onblur|onchange][optgroup|option]optgroup[E|disabled|label][option]option[E|selected|disabled|label|value][]textarea[E|D|name|rows|cols|disabled|readonly|onselect|onchange][]label[E|for|accesskey|onfocus|onblur][#|S]button[E|D|name|value|type|disabled][#|p|T|div|U|W|table|G|object|applet|img|map|K|N|Q]h4[E|align][#|S]ins[E|cite|datetime][#|Y]h5[E|align][#|S]del[E|cite|datetime][#|Y]h6[E|align][#|S]div[E|align][#|Y]ul[E|type|compact][li]li[E|type|value][#|Y]ol[E|type|compact|start][li]dl[E|compact][dt|dd]dt[E][#|S]dd[E][#|Y]menu[E|compact][li]dir[E|compact][li]pre[E|width|xml:space][#|ZA]hr[E|align|noshade|size|width][]blockquote[E|cite][#|Y]address[E][#|S|p]center[E][#|Y]noframes[E][#|Y]isindex[A|B|prompt][]fieldset[E][#|legend|Y]legend[E|accesskey|align][#|S]table[E|summary|width|border|frame|rules|cellspacing|cellpadding|align|bgcolor][caption|col|colgroup|thead|tfoot|tbody|tr]caption[E|align][#|S]col[ZG][]colgroup[ZG][col]thead[ZF][tr]tr[ZF|bgcolor][th|td]th[E|ZE][#|Y]form[E|action|method|name|enctype|onsubmit|onreset|accept|accept-charset|target][#|X|R|Q]noscript[E][#|Y]td[E|ZE][#|Y]tfoot[ZF][tr]tbody[ZF][tr]area[E|D|shape|coords|href|nohref|alt|target][]base[id|href|target][]body[E|onload|onunload|background|bgcolor|text|link|vlink|alink][#|Y]\");j=d(\"checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected,autoplay,loop,controls\");g=d(\"area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed,source\");f=m.extend(d(\"td,th,iframe,video,audio,object\"),g);b=d(\"pre,script,style,textarea\");e=d(\"colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr\");m.html.Schema=function(r){var A=this,n={},o={},y=[],q,p;r=r||{};if(r.verify_html===false){r.valid_elements=\"*[*]\"}if(r.valid_styles){q={};k(r.valid_styles,function(C,B){q[B]=m.explode(C)})}p=r.whitespace_elements?d(r.whitespace_elements):b;function z(B){return new RegExp(\"^\"+B.replace(/([?+*])/g,\".$1\")+\"$\")}function t(I){var H,D,W,S,X,C,F,R,U,N,V,Z,L,G,T,B,P,E,Y,aa,M,Q,K=/^([#+-])?([^\\[\\/]+)(?:\\/([^\\[]+))?(?:\\[([^\\]]+)\\])?$/,O=/^([!\\-])?(\\w+::\\w+|[^=:<]+)?(?:([=:<])(.*))?$/,J=/[*?+]/;if(I){I=i(I);if(n[\"@\"]){P=n[\"@\"].attributes;E=n[\"@\"].attributesOrder}for(H=0,D=I.length;H<D;H++){C=K.exec(I[H]);if(C){T=C[1];N=C[2];B=C[3];U=C[4];L={};G=[];F={attributes:L,attributesOrder:G};if(T===\"#\"){F.paddEmpty=true}if(T===\"-\"){F.removeEmpty=true}if(P){for(aa in P){L[aa]=P[aa]}G.push.apply(G,E)}if(U){U=i(U,\"|\");for(W=0,S=U.length;W<S;W++){C=O.exec(U[W]);if(C){R={};Z=C[1];V=C[2].replace(/::/g,\":\");T=C[3];Q=C[4];if(Z===\"!\"){F.attributesRequired=F.attributesRequired||[];F.attributesRequired.push(V);R.required=true}if(Z===\"-\"){delete L[V];G.splice(m.inArray(G,V),1);continue}if(T){if(T===\"=\"){F.attributesDefault=F.attributesDefault||[];F.attributesDefault.push({name:V,value:Q});R.defaultValue=Q}if(T===\":\"){F.attributesForced=F.attributesForced||[];F.attributesForced.push({name:V,value:Q});R.forcedValue=Q}if(T===\"<\"){R.validValues=d(Q,\"?\")}}if(J.test(V)){F.attributePatterns=F.attributePatterns||[];R.pattern=z(V);F.attributePatterns.push(R)}else{if(!L[V]){G.push(V)}L[V]=R}}}}if(!P&&N==\"@\"){P=L;E=G}if(B){F.outputName=N;n[B]=F}if(J.test(N)){F.pattern=z(N);y.push(F)}else{n[N]=F}}}}}function v(B){n={};y=[];t(B);k(h,function(D,C){o[C]=D.children})}function s(C){var B=/^(~)?(.+)$/;if(C){k(i(C),function(G){var E=B.exec(G),F=E[1]===\"~\",H=F?\"span\":\"div\",D=E[2];o[D]=o[H];c[D]=H;if(!F){l[D]={}}k(o,function(I,J){if(I[H]){I[D]=I[H]}})})}}function u(C){var B=/^([+\\-]?)(\\w+)\\[([^\\]]+)\\]$/;if(C){k(i(C),function(G){var F=B.exec(G),D,E;if(F){E=F[1];if(E){D=o[F[2]]}else{D=o[F[2]]={\"#comment\":{}}}D=o[F[2]];k(i(F[3],\"|\"),function(H){if(E===\"-\"){delete D[H]}else{D[H]={}}})}})}}function x(B){var D=n[B],C;if(D){return D}C=y.length;while(C--){D=y[C];if(D.pattern.test(B)){return D}}}if(!r.valid_elements){k(h,function(C,B){n[B]={attributes:C.attributes,attributesOrder:C.attributesOrder};o[B]=C.children});k(i(\"strong/b,em/i\"),function(B){B=i(B,\"/\");n[B[1]].outputName=B[0]});n.img.attributesDefault=[{name:\"alt\",value:\"\"}];k(i(\"ol,ul,sub,sup,blockquote,span,font,a,table,tbody,tr\"),function(B){n[B].removeEmpty=true});k(i(\"p,h1,h2,h3,h4,h5,h6,th,td,pre,div,address,caption\"),function(B){n[B].paddEmpty=true})}else{v(r.valid_elements)}s(r.custom_elements);u(r.valid_children);t(r.extended_valid_elements);u(\"+ol[ul|ol],+ul[ul|ol]\");if(!x(\"span\")){t(\"span[!data-mce-type|*]\")}if(r.invalid_elements){m.each(m.explode(r.invalid_elements),function(B){if(n[B]){delete n[B]}})}A.children=o;A.styles=q;A.getBoolAttrs=function(){return j};A.getBlockElements=function(){return l};A.getShortEndedElements=function(){return g};A.getSelfClosingElements=function(){return e};A.getNonEmptyElements=function(){return f};A.getWhiteSpaceElements=function(){return p};A.isValidChild=function(B,D){var C=o[B];return !!(C&&C[D])};A.getElementRule=x;A.getCustomElements=function(){return c};A.addValidElements=t;A.setValidElements=v;A.addCustomElements=s;A.addValidChildren=u};m.html.Schema.boolAttrMap=j;m.html.Schema.blockElementsMap=l})(tinymce);(function(a){a.html.SaxParser=function(c,e){var b=this,d=function(){};c=c||{};b.schema=e=e||new a.html.Schema();if(c.fix_self_closing!==false){c.fix_self_closing=true}a.each(\"comment cdata text start end pi doctype\".split(\" \"),function(f){if(f){b[f]=c[f]||d}});b.parse=function(D){var n=this,g,F=0,H,A,z=[],M,P,B,q,y,r,L,G,N,u,m,k,s,Q,o,O,E,R,K,f,I,l,C,J,h,v=0,j=a.html.Entities.decode,x,p;function t(S){var U,T;U=z.length;while(U--){if(z[U].name===S){break}}if(U>=0){for(T=z.length-1;T>=U;T--){S=z[T];if(S.valid){n.end(S.name)}}z.length=U}}l=new RegExp(\"<(?:(?:!--([\\\\w\\\\W]*?)-->)|(?:!\\\\[CDATA\\\\[([\\\\w\\\\W]*?)\\\\]\\\\]>)|(?:!DOCTYPE([\\\\w\\\\W]*?)>)|(?:\\\\?([^\\\\s\\\\/<>]+) ?([\\\\w\\\\W]*?)[?/]>)|(?:\\\\/([^>]+)>)|(?:([^\\\\s\\\\/<>]+)((?:\\\\s+[^\\\"'>]+(?:(?:\\\"[^\\\"]*\\\")|(?:'[^']*')|[^>]*))*|\\\\/)>))\",\"g\");C=/([\\w:\\-]+)(?:\\s*=\\s*(?:(?:\\\"((?:\\\\.|[^\\\"])*)\\\")|(?:\\'((?:\\\\.|[^\\'])*)\\')|([^>\\s]+)))?/g;J={script:/<\\/script[^>]*>/gi,style:/<\\/style[^>]*>/gi,noscript:/<\\/noscript[^>]*>/gi};L=e.getShortEndedElements();I=e.getSelfClosingElements();G=e.getBoolAttrs();u=c.validate;r=c.remove_internals;x=c.fix_self_closing;p=a.isIE;o=/^:/;while(g=l.exec(D)){if(F<g.index){n.text(j(D.substr(F,g.index-F)))}if(H=g[6]){H=H.toLowerCase();if(p&&o.test(H)){H=H.substr(1)}t(H)}else{if(H=g[7]){H=H.toLowerCase();if(p&&o.test(H)){H=H.substr(1)}N=H in L;if(x&&I[H]&&z.length>0&&z[z.length-1].name===H){t(H)}if(!u||(m=e.getElementRule(H))){k=true;if(u){O=m.attributes;E=m.attributePatterns}if(Q=g[8]){y=Q.indexOf(\"data-mce-type\")!==-1;if(y&&r){k=false}M=[];M.map={};Q.replace(C,function(T,S,X,W,V){var Y,U;S=S.toLowerCase();X=S in G?S:j(X||W||V||\"\");if(u&&!y&&S.indexOf(\"data-\")!==0){Y=O[S];if(!Y&&E){U=E.length;while(U--){Y=E[U];if(Y.pattern.test(S)){break}}if(U===-1){Y=null}}if(!Y){return}if(Y.validValues&&!(X in Y.validValues)){return}}M.map[S]=X;M.push({name:S,value:X})})}else{M=[];M.map={}}if(u&&!y){R=m.attributesRequired;K=m.attributesDefault;f=m.attributesForced;if(f){P=f.length;while(P--){s=f[P];q=s.name;h=s.value;if(h===\"{$uid}\"){h=\"mce_\"+v++}M.map[q]=h;M.push({name:q,value:h})}}if(K){P=K.length;while(P--){s=K[P];q=s.name;if(!(q in M.map)){h=s.value;if(h===\"{$uid}\"){h=\"mce_\"+v++}M.map[q]=h;M.push({name:q,value:h})}}}if(R){P=R.length;while(P--){if(R[P] in M.map){break}}if(P===-1){k=false}}if(M.map[\"data-mce-bogus\"]){k=false}}if(k){n.start(H,M,N)}}else{k=false}if(A=J[H]){A.lastIndex=F=g.index+g[0].length;if(g=A.exec(D)){if(k){B=D.substr(F,g.index-F)}F=g.index+g[0].length}else{B=D.substr(F);F=D.length}if(k&&B.length>0){n.text(B,true)}if(k){n.end(H)}l.lastIndex=F;continue}if(!N){if(!Q||Q.indexOf(\"/\")!=Q.length-1){z.push({name:H,valid:k})}else{if(k){n.end(H)}}}}else{if(H=g[1]){n.comment(H)}else{if(H=g[2]){n.cdata(H)}else{if(H=g[3]){n.doctype(H)}else{if(H=g[4]){n.pi(H,g[5])}}}}}}F=g.index+g[0].length}if(F<D.length){n.text(j(D.substr(F)))}for(P=z.length-1;P>=0;P--){H=z[P];if(H.valid){n.end(H.name)}}}}})(tinymce);(function(d){var c=/^[ \\t\\r\\n]*$/,e={\"#text\":3,\"#comment\":8,\"#cdata\":4,\"#pi\":7,\"#doctype\":10,\"#document-fragment\":11};function a(k,l,j){var i,h,f=j?\"lastChild\":\"firstChild\",g=j?\"prev\":\"next\";if(k[f]){return k[f]}if(k!==l){i=k[g];if(i){return i}for(h=k.parent;h&&h!==l;h=h.parent){i=h[g];if(i){return i}}}}function b(f,g){this.name=f;this.type=g;if(g===1){this.attributes=[];this.attributes.map={}}}d.extend(b.prototype,{replace:function(g){var f=this;if(g.parent){g.remove()}f.insert(g,f);f.remove();return f},attr:function(h,l){var f=this,g,j,k;if(typeof h!==\"string\"){for(j in h){f.attr(j,h[j])}return f}if(g=f.attributes){if(l!==k){if(l===null){if(h in g.map){delete g.map[h];j=g.length;while(j--){if(g[j].name===h){g=g.splice(j,1);return f}}}return f}if(h in g.map){j=g.length;while(j--){if(g[j].name===h){g[j].value=l;break}}}else{g.push({name:h,value:l})}g.map[h]=l;return f}else{return g.map[h]}}},clone:function(){var g=this,n=new b(g.name,g.type),h,f,m,j,k;if(m=g.attributes){k=[];k.map={};for(h=0,f=m.length;h<f;h++){j=m[h];if(j.name!==\"id\"){k[k.length]={name:j.name,value:j.value};k.map[j.name]=j.value}}n.attributes=k}n.value=g.value;n.shortEnded=g.shortEnded;return n},wrap:function(g){var f=this;f.parent.insert(g,f);g.append(f);return f},unwrap:function(){var f=this,h,g;for(h=f.firstChild;h;){g=h.next;f.insert(h,f,true);h=g}f.remove()},remove:function(){var f=this,h=f.parent,g=f.next,i=f.prev;if(h){if(h.firstChild===f){h.firstChild=g;if(g){g.prev=null}}else{i.next=g}if(h.lastChild===f){h.lastChild=i;if(i){i.next=null}}else{g.prev=i}f.parent=f.next=f.prev=null}return f},append:function(h){var f=this,g;if(h.parent){h.remove()}g=f.lastChild;if(g){g.next=h;h.prev=g;f.lastChild=h}else{f.lastChild=f.firstChild=h}h.parent=f;return h},insert:function(h,f,i){var g;if(h.parent){h.remove()}g=f.parent||this;if(i){if(f===g.firstChild){g.firstChild=h}else{f.prev.next=h}h.prev=f.prev;h.next=f;f.prev=h}else{if(f===g.lastChild){g.lastChild=h}else{f.next.prev=h}h.next=f.next;h.prev=f;f.next=h}h.parent=g;return h},getAll:function(g){var f=this,h,i=[];for(h=f.firstChild;h;h=a(h,f)){if(h.name===g){i.push(h)}}return i},empty:function(){var g=this,f,h,j;if(g.firstChild){f=[];for(j=g.firstChild;j;j=a(j,g)){f.push(j)}h=f.length;while(h--){j=f[h];j.parent=j.firstChild=j.lastChild=j.next=j.prev=null}}g.firstChild=g.lastChild=null;return g},isEmpty:function(k){var f=this,j=f.firstChild,h,g;if(j){do{if(j.type===1){if(j.attributes.map[\"data-mce-bogus\"]){continue}if(k[j.name]){return false}h=j.attributes.length;while(h--){g=j.attributes[h].name;if(g===\"name\"||g.indexOf(\"data-\")===0){return false}}}if((j.type===3&&!c.test(j.value))){return false}}while(j=a(j,f))}return true},walk:function(f){return a(this,null,f)}});d.extend(b,{create:function(g,f){var i,h;i=new b(g,e[g]||1);if(f){for(h in f){i.attr(h,f[h])}}return i}});d.html.Node=b})(tinymce);(function(b){var a=b.html.Node;b.html.DomParser=function(g,h){var f=this,e={},d=[],i={},c={};g=g||{};g.validate=\"validate\" in g?g.validate:true;g.root_name=g.root_name||\"body\";f.schema=h=h||new b.html.Schema();function j(m){var o,p,x,v,z,n,q,l,t,u,k,s,y,r;s=b.makeMap(\"tr,td,th,tbody,thead,tfoot,table\");k=h.getNonEmptyElements();for(o=0;o<m.length;o++){p=m[o];if(!p.parent){continue}v=[p];for(x=p.parent;x&&!h.isValidChild(x.name,p.name)&&!s[x.name];x=x.parent){v.push(x)}if(x&&v.length>1){v.reverse();z=n=f.filterNode(v[0].clone());for(t=0;t<v.length-1;t++){if(h.isValidChild(n.name,v[t].name)){q=f.filterNode(v[t].clone());n.append(q)}else{q=n}for(l=v[t].firstChild;l&&l!=v[t+1];){r=l.next;q.append(l);l=r}n=q}if(!z.isEmpty(k)){x.insert(z,v[0],true);x.insert(p,z)}else{x.insert(p,v[0],true)}x=v[0];if(x.isEmpty(k)||x.firstChild===x.lastChild&&x.firstChild.name===\"br\"){x.empty().remove()}}else{if(p.parent){if(p.name===\"li\"){y=p.prev;if(y&&(y.name===\"ul\"||y.name===\"ul\")){y.append(p);continue}y=p.next;if(y&&(y.name===\"ul\"||y.name===\"ul\")){y.insert(p,y.firstChild,true);continue}p.wrap(f.filterNode(new a(\"ul\",1)));continue}if(h.isValidChild(p.parent.name,\"div\")&&h.isValidChild(\"div\",p.name)){p.wrap(f.filterNode(new a(\"div\",1)))}else{if(p.name===\"style\"||p.name===\"script\"){p.empty().remove()}else{p.unwrap()}}}}}}f.filterNode=function(m){var l,k,n;if(k in e){n=i[k];if(n){n.push(m)}else{i[k]=[m]}}l=d.length;while(l--){k=d[l].name;if(k in m.attributes.map){n=c[k];if(n){n.push(m)}else{c[k]=[m]}}}return m};f.addNodeFilter=function(k,l){b.each(b.explode(k),function(m){var n=e[m];if(!n){e[m]=n=[]}n.push(l)})};f.addAttributeFilter=function(k,l){b.each(b.explode(k),function(m){var n;for(n=0;n<d.length;n++){if(d[n].name===m){d[n].callbacks.push(l);return}}d.push({name:m,callbacks:[l]})})};f.parse=function(v,m){var n,H,A,z,C,B,x,r,E,K,y,o,D,J=[],t,k,s,p,u,q;m=m||{};i={};c={};o=b.extend(b.makeMap(\"script,style,head,html,body,title,meta,param\"),h.getBlockElements());u=h.getNonEmptyElements();p=h.children;y=g.validate;q=\"forced_root_block\" in m?m.forced_root_block:g.forced_root_block;s=h.getWhiteSpaceElements();D=/^[ \\t\\r\\n]+/;t=/[ \\t\\r\\n]+$/;k=/[ \\t\\r\\n]+/g;function F(){var L=H.firstChild,l,M;while(L){l=L.next;if(L.type==3||(L.type==1&&L.name!==\"p\"&&!o[L.name]&&!L.attr(\"data-mce-type\"))){if(!M){M=I(q,1);H.insert(M,L);M.append(L)}else{M.append(L)}}else{M=null}L=l}}function I(l,L){var M=new a(l,L),N;if(l in e){N=i[l];if(N){N.push(M)}else{i[l]=[M]}}return M}function G(M){var N,l,L;for(N=M.prev;N&&N.type===3;){l=N.value.replace(t,\"\");if(l.length>0){N.value=l;N=N.prev}else{L=N.prev;N.remove();N=L}}}n=new b.html.SaxParser({validate:y,fix_self_closing:!y,cdata:function(l){A.append(I(\"#cdata\",4)).value=l},text:function(M,l){var L;if(!s[A.name]){M=M.replace(k,\" \");if(A.lastChild&&o[A.lastChild.name]){M=M.replace(D,\"\")}}if(M.length!==0){L=I(\"#text\",3);L.raw=!!l;A.append(L).value=M}},comment:function(l){A.append(I(\"#comment\",8)).value=l},pi:function(l,L){A.append(I(l,7)).value=L;G(A)},doctype:function(L){var l;l=A.append(I(\"#doctype\",10));l.value=L;G(A)},start:function(l,T,M){var R,O,N,L,P,U,S,Q;N=y?h.getElementRule(l):{};if(N){R=I(N.outputName||l,1);R.attributes=T;R.shortEnded=M;A.append(R);Q=p[A.name];if(Q&&p[R.name]&&!Q[R.name]){J.push(R)}O=d.length;while(O--){P=d[O].name;if(P in T.map){E=c[P];if(E){E.push(R)}else{c[P]=[R]}}}if(o[l]){G(R)}if(!M){A=R}}},end:function(l){var P,M,O,L,N;M=y?h.getElementRule(l):{};if(M){if(o[l]){if(!s[A.name]){for(P=A.firstChild;P&&P.type===3;){O=P.value.replace(D,\"\");if(O.length>0){P.value=O;P=P.next}else{L=P.next;P.remove();P=L}}for(P=A.lastChild;P&&P.type===3;){O=P.value.replace(t,\"\");if(O.length>0){P.value=O;P=P.prev}else{L=P.prev;P.remove();P=L}}}P=A.prev;if(P&&P.type===3){O=P.value.replace(D,\"\");if(O.length>0){P.value=O}else{P.remove()}}}if(M.removeEmpty||M.paddEmpty){if(A.isEmpty(u)){if(M.paddEmpty){A.empty().append(new a(\"#text\",\"3\")).value=\"\\u00a0\"}else{if(!A.attributes.map.name){N=A.parent;A.empty().remove();A=N;return}}}}A=A.parent}}},h);H=A=new a(m.context||g.root_name,11);n.parse(v);if(y&&J.length){if(!m.context){j(J)}else{m.invalid=true}}if(q&&H.name==\"body\"){F()}if(!m.invalid){for(K in i){E=e[K];z=i[K];x=z.length;while(x--){if(!z[x].parent){z.splice(x,1)}}for(C=0,B=E.length;C<B;C++){E[C](z,K,m)}}for(C=0,B=d.length;C<B;C++){E=d[C];if(E.name in c){z=c[E.name];x=z.length;while(x--){if(!z[x].parent){z.splice(x,1)}}for(x=0,r=E.callbacks.length;x<r;x++){E.callbacks[x](z,E.name,m)}}}}return H};if(g.remove_trailing_brs){f.addNodeFilter(\"br\",function(n,m){var r,q=n.length,o,u=h.getBlockElements(),k=h.getNonEmptyElements(),s,p,t;u.body=1;for(r=0;r<q;r++){o=n[r];s=o.parent;if(u[o.parent.name]&&o===s.lastChild){p=o.prev;while(p){t=p.name;if(t!==\"span\"||p.attr(\"data-mce-type\")!==\"bookmark\"){if(t!==\"br\"){break}if(t===\"br\"){o=null;break}}p=p.prev}if(o){o.remove();if(s.isEmpty(k)){elementRule=h.getElementRule(s.name);if(elementRule){if(elementRule.removeEmpty){s.remove()}else{if(elementRule.paddEmpty){s.empty().append(new b.html.Node(\"#text\",3)).value=\"\\u00a0\"}}}}}}}})}}})(tinymce);tinymce.html.Writer=function(e){var c=[],a,b,d,f,g;e=e||{};a=e.indent;b=tinymce.makeMap(e.indent_before||\"\");d=tinymce.makeMap(e.indent_after||\"\");f=tinymce.html.Entities.getEncodeFunc(e.entity_encoding||\"raw\",e.entities);g=e.element_format==\"html\";return{start:function(m,k,p){var n,j,h,o;if(a&&b[m]&&c.length>0){o=c[c.length-1];if(o.length>0&&o!==\"\\n\"){c.push(\"\\n\")}}c.push(\"<\",m);if(k){for(n=0,j=k.length;n<j;n++){h=k[n];c.push(\" \",h.name,'=\"',f(h.value,true),'\"')}}if(!p||g){c[c.length]=\">\"}else{c[c.length]=\" />\"}if(p&&a&&d[m]&&c.length>0){o=c[c.length-1];if(o.length>0&&o!==\"\\n\"){c.push(\"\\n\")}}},end:function(h){var i;c.push(\"</\",h,\">\");if(a&&d[h]&&c.length>0){i=c[c.length-1];if(i.length>0&&i!==\"\\n\"){c.push(\"\\n\")}}},text:function(i,h){if(i.length>0){c[c.length]=h?i:f(i)}},cdata:function(h){c.push(\"<![CDATA[\",h,\"]]>\")},comment:function(h){c.push(\"<!--\",h,\"-->\")},pi:function(h,i){if(i){c.push(\"<?\",h,\" \",i,\"?>\")}else{c.push(\"<?\",h,\"?>\")}if(a){c.push(\"\\n\")}},doctype:function(h){c.push(\"<!DOCTYPE\",h,\">\",a?\"\\n\":\"\")},reset:function(){c.length=0},getContent:function(){return c.join(\"\").replace(/\\n$/,\"\")}}};(function(a){a.html.Serializer=function(c,d){var b=this,e=new a.html.Writer(c);c=c||{};c.validate=\"validate\" in c?c.validate:true;b.schema=d=d||new a.html.Schema();b.writer=e;b.serialize=function(h){var g,i;i=c.validate;g={3:function(k,j){e.text(k.value,k.raw)},8:function(j){e.comment(j.value)},7:function(j){e.pi(j.name,j.value)},10:function(j){e.doctype(j.value)},4:function(j){e.cdata(j.value)},11:function(j){if((j=j.firstChild)){do{f(j)}while(j=j.next)}}};e.reset();function f(k){var t=g[k.type],j,o,s,r,p,u,n,m,q;if(!t){j=k.name;o=k.shortEnded;s=k.attributes;if(i&&s&&s.length>1){u=[];u.map={};q=d.getElementRule(k.name);for(n=0,m=q.attributesOrder.length;n<m;n++){r=q.attributesOrder[n];if(r in s.map){p=s.map[r];u.map[r]=p;u.push({name:r,value:p})}}for(n=0,m=s.length;n<m;n++){r=s[n].name;if(!(r in u.map)){p=s.map[r];u.map[r]=p;u.push({name:r,value:p})}}s=u}e.start(k.name,s,o);if(!o){if((k=k.firstChild)){do{f(k)}while(k=k.next)}e.end(j)}}else{t(k)}}if(h.type==1&&!c.inner){f(h)}else{g[11](h)}return e.getContent()}}})(tinymce);(function(h){var f=h.each,e=h.is,d=h.isWebKit,b=h.isIE,c=h.html.Entities,a=/^([a-z0-9],?)+$/i,g=h.html.Schema.blockElementsMap,i=/^[ \\t\\r\\n]*$/;h.create(\"tinymce.dom.DOMUtils\",{doc:null,root:null,files:null,pixelStyles:/^(top|left|bottom|right|width|height|borderWidth)$/,props:{\"for\":\"htmlFor\",\"class\":\"className\",className:\"className\",checked:\"checked\",disabled:\"disabled\",maxlength:\"maxLength\",readonly:\"readOnly\",selected:\"selected\",value:\"value\",id:\"id\",name:\"name\",type:\"type\"},DOMUtils:function(o,m){var l=this,j,k;l.doc=o;l.win=window;l.files={};l.cssFlicker=false;l.counter=0;l.stdMode=!h.isIE||o.documentMode>=8;l.boxModel=!h.isIE||o.compatMode==\"CSS1Compat\"||l.stdMode;l.hasOuterHTML=\"outerHTML\" in o.createElement(\"a\");l.settings=m=h.extend({keep_values:false,hex_colors:1},m);l.schema=m.schema;l.styles=new h.html.Styles({url_converter:m.url_converter,url_converter_scope:m.url_converter_scope},m.schema);if(h.isIE6){try{o.execCommand(\"BackgroundImageCache\",false,true)}catch(n){l.cssFlicker=true}}if(b&&m.schema){(\"abbr article aside audio canvas details figcaption figure footer header hgroup mark menu meter nav output progress section summary time video\").replace(/\\w+/g,function(p){o.createElement(p)});for(k in m.schema.getCustomElements()){o.createElement(k)}}h.addUnload(l.destroy,l)},getRoot:function(){var j=this,k=j.settings;return(k&&j.get(k.root_element))||j.doc.body},getViewPort:function(k){var l,j;k=!k?this.win:k;l=k.document;j=this.boxModel?l.documentElement:l.body;return{x:k.pageXOffset||j.scrollLeft,y:k.pageYOffset||j.scrollTop,w:k.innerWidth||j.clientWidth,h:k.innerHeight||j.clientHeight}},getRect:function(m){var l,j=this,k;m=j.get(m);l=j.getPos(m);k=j.getSize(m);return{x:l.x,y:l.y,w:k.w,h:k.h}},getSize:function(m){var k=this,j,l;m=k.get(m);j=k.getStyle(m,\"width\");l=k.getStyle(m,\"height\");if(j.indexOf(\"px\")===-1){j=0}if(l.indexOf(\"px\")===-1){l=0}return{w:parseInt(j)||m.offsetWidth||m.clientWidth,h:parseInt(l)||m.offsetHeight||m.clientHeight}},getParent:function(l,k,j){return this.getParents(l,k,j,false)},getParents:function(u,p,l,s){var k=this,j,m=k.settings,q=[];u=k.get(u);s=s===undefined;if(m.strict_root){l=l||k.getRoot()}if(e(p,\"string\")){j=p;if(p===\"*\"){p=function(o){return o.nodeType==1}}else{p=function(o){return k.is(o,j)}}}while(u){if(u==l||!u.nodeType||u.nodeType===9){break}if(!p||p(u)){if(s){q.push(u)}else{return u}}u=u.parentNode}return s?q:null},get:function(j){var k;if(j&&this.doc&&typeof(j)==\"string\"){k=j;j=this.doc.getElementById(j);if(j&&j.id!==k){return this.doc.getElementsByName(k)[1]}}return j},getNext:function(k,j){return this._findSib(k,j,\"nextSibling\")},getPrev:function(k,j){return this._findSib(k,j,\"previousSibling\")},select:function(l,k){var j=this;return h.dom.Sizzle(l,j.get(k)||j.get(j.settings.root_element)||j.doc,[])},is:function(l,j){var k;if(l.length===undefined){if(j===\"*\"){return l.nodeType==1}if(a.test(j)){j=j.toLowerCase().split(/,/);l=l.nodeName.toLowerCase();for(k=j.length-1;k>=0;k--){if(j[k]==l){return true}}return false}}return h.dom.Sizzle.matches(j,l.nodeType?[l]:l).length>0},add:function(m,q,j,l,o){var k=this;return this.run(m,function(s){var r,n;r=e(q,\"string\")?k.doc.createElement(q):q;k.setAttribs(r,j);if(l){if(l.nodeType){r.appendChild(l)}else{k.setHTML(r,l)}}return !o?s.appendChild(r):r})},create:function(l,j,k){return this.add(this.doc.createElement(l),l,j,k,1)},createHTML:function(r,j,p){var q=\"\",m=this,l;q+=\"<\"+r;for(l in j){if(j.hasOwnProperty(l)){q+=\" \"+l+'=\"'+m.encode(j[l])+'\"'}}if(typeof(p)!=\"undefined\"){return q+\">\"+p+\"</\"+r+\">\"}return q+\" />\"},remove:function(j,k){return this.run(j,function(m){var n,l=m.parentNode;if(!l){return null}if(k){while(n=m.firstChild){if(!h.isIE||n.nodeType!==3||n.nodeValue){l.insertBefore(n,m)}else{m.removeChild(n)}}}return l.removeChild(m)})},setStyle:function(m,j,k){var l=this;return l.run(m,function(p){var o,n;o=p.style;j=j.replace(/-(\\D)/g,function(r,q){return q.toUpperCase()});if(l.pixelStyles.test(j)&&(h.is(k,\"number\")||/^[\\-0-9\\.]+$/.test(k))){k+=\"px\"}switch(j){case\"opacity\":if(b){o.filter=k===\"\"?\"\":\"alpha(opacity=\"+(k*100)+\")\";if(!m.currentStyle||!m.currentStyle.hasLayout){o.display=\"inline-block\"}}o[j]=o[\"-moz-opacity\"]=o[\"-khtml-opacity\"]=k||\"\";break;case\"float\":b?o.styleFloat=k:o.cssFloat=k;break;default:o[j]=k||\"\"}if(l.settings.update_styles){l.setAttrib(p,\"data-mce-style\")}})},getStyle:function(m,j,l){m=this.get(m);if(!m){return}if(this.doc.defaultView&&l){j=j.replace(/[A-Z]/g,function(n){return\"-\"+n});try{return this.doc.defaultView.getComputedStyle(m,null).getPropertyValue(j)}catch(k){return null}}j=j.replace(/-(\\D)/g,function(o,n){return n.toUpperCase()});if(j==\"float\"){j=b?\"styleFloat\":\"cssFloat\"}if(m.currentStyle&&l){return m.currentStyle[j]}return m.style?m.style[j]:undefined},setStyles:function(m,n){var k=this,l=k.settings,j;j=l.update_styles;l.update_styles=0;f(n,function(o,p){k.setStyle(m,p,o)});l.update_styles=j;if(l.update_styles){k.setAttrib(m,l.cssText)}},removeAllAttribs:function(j){return this.run(j,function(m){var l,k=m.attributes;for(l=k.length-1;l>=0;l--){m.removeAttributeNode(k.item(l))}})},setAttrib:function(l,m,j){var k=this;if(!l||!m){return}if(k.settings.strict){m=m.toLowerCase()}return this.run(l,function(o){var n=k.settings;if(j!==null){switch(m){case\"style\":if(!e(j,\"string\")){f(j,function(p,q){k.setStyle(o,q,p)});return}if(n.keep_values){if(j&&!k._isRes(j)){o.setAttribute(\"data-mce-style\",j,2)}else{o.removeAttribute(\"data-mce-style\",2)}}o.style.cssText=j;break;case\"class\":o.className=j||\"\";break;case\"src\":case\"href\":if(n.keep_values){if(n.url_converter){j=n.url_converter.call(n.url_converter_scope||k,j,m,o)}k.setAttrib(o,\"data-mce-\"+m,j,2)}break;case\"shape\":o.setAttribute(\"data-mce-style\",j);break}}if(e(j)&&j!==null&&j.length!==0){o.setAttribute(m,\"\"+j,2)}else{o.removeAttribute(m,2)}})},setAttribs:function(k,l){var j=this;return this.run(k,function(m){f(l,function(o,p){j.setAttrib(m,p,o)})})},getAttrib:function(o,p,l){var j,k=this,m;o=k.get(o);if(!o||o.nodeType!==1){return l===m?false:l}if(!e(l)){l=\"\"}if(/^(src|href|style|coords|shape)$/.test(p)){j=o.getAttribute(\"data-mce-\"+p);if(j){return j}}if(b&&k.props[p]){j=o[k.props[p]];j=j&&j.nodeValue?j.nodeValue:j}if(!j){j=o.getAttribute(p,2)}if(/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noshade|nowrap|readonly|selected)$/.test(p)){if(o[k.props[p]]===true&&j===\"\"){return p}return j?p:\"\"}if(o.nodeName===\"FORM\"&&o.getAttributeNode(p)){return o.getAttributeNode(p).nodeValue}if(p===\"style\"){j=j||o.style.cssText;if(j){j=k.serializeStyle(k.parseStyle(j),o.nodeName);if(k.settings.keep_values&&!k._isRes(j)){o.setAttribute(\"data-mce-style\",j)}}}if(d&&p===\"class\"&&j){j=j.replace(/(apple|webkit)\\-[a-z\\-]+/gi,\"\")}if(b){switch(p){case\"rowspan\":case\"colspan\":if(j===1){j=\"\"}break;case\"size\":if(j===\"+0\"||j===20||j===0){j=\"\"}break;case\"width\":case\"height\":case\"vspace\":case\"checked\":case\"disabled\":case\"readonly\":if(j===0){j=\"\"}break;case\"hspace\":if(j===-1){j=\"\"}break;case\"maxlength\":case\"tabindex\":if(j===32768||j===2147483647||j===\"32768\"){j=\"\"}break;case\"multiple\":case\"compact\":case\"noshade\":case\"nowrap\":if(j===65535){return p}return l;case\"shape\":j=j.toLowerCase();break;default:if(p.indexOf(\"on\")===0&&j){j=h._replace(/^function\\s+\\w+\\(\\)\\s+\\{\\s+(.*)\\s+\\}$/,\"$1\",\"\"+j)}}}return(j!==m&&j!==null&&j!==\"\")?\"\"+j:l},getPos:function(s,m){var k=this,j=0,q=0,o,p=k.doc,l;s=k.get(s);m=m||p.body;if(s){if(s.getBoundingClientRect){s=s.getBoundingClientRect();o=k.boxModel?p.documentElement:p.body;j=s.left+(p.documentElement.scrollLeft||p.body.scrollLeft)-o.clientTop;q=s.top+(p.documentElement.scrollTop||p.body.scrollTop)-o.clientLeft;return{x:j,y:q}}l=s;while(l&&l!=m&&l.nodeType){j+=l.offsetLeft||0;q+=l.offsetTop||0;l=l.offsetParent}l=s.parentNode;while(l&&l!=m&&l.nodeType){j-=l.scrollLeft||0;q-=l.scrollTop||0;l=l.parentNode}}return{x:j,y:q}},parseStyle:function(j){return this.styles.parse(j)},serializeStyle:function(k,j){return this.styles.serialize(k,j)},loadCSS:function(j){var l=this,m=l.doc,k;if(!j){j=\"\"}k=l.select(\"head\")[0];f(j.split(\",\"),function(n){var o;if(l.files[n]){return}l.files[n]=true;o=l.create(\"link\",{rel:\"stylesheet\",href:h._addVer(n)});if(b&&m.documentMode&&m.recalc){o.onload=function(){if(m.recalc){m.recalc()}o.onload=null}}k.appendChild(o)})},addClass:function(j,k){return this.run(j,function(l){var m;if(!k){return 0}if(this.hasClass(l,k)){return l.className}m=this.removeClass(l,k);return l.className=(m!=\"\"?(m+\" \"):\"\")+k})},removeClass:function(l,m){var j=this,k;return j.run(l,function(o){var n;if(j.hasClass(o,m)){if(!k){k=new RegExp(\"(^|\\\\s+)\"+m+\"(\\\\s+|$)\",\"g\")}n=o.className.replace(k,\" \");n=h.trim(n!=\" \"?n:\"\");o.className=n;if(!n){o.removeAttribute(\"class\");o.removeAttribute(\"className\")}return n}return o.className})},hasClass:function(k,j){k=this.get(k);if(!k||!j){return false}return(\" \"+k.className+\" \").indexOf(\" \"+j+\" \")!==-1},show:function(j){return this.setStyle(j,\"display\",\"block\")},hide:function(j){return this.setStyle(j,\"display\",\"none\")},isHidden:function(j){j=this.get(j);return !j||j.style.display==\"none\"||this.getStyle(j,\"display\")==\"none\"},uniqueId:function(j){return(!j?\"mce_\":j)+(this.counter++)},setHTML:function(l,k){var j=this;return j.run(l,function(n){if(b){while(n.firstChild){n.removeChild(n.firstChild)}try{n.innerHTML=\"<br />\"+k;n.removeChild(n.firstChild)}catch(m){n=j.create(\"div\");n.innerHTML=\"<br />\"+k;f(n.childNodes,function(p,o){if(o){n.appendChild(p)}})}}else{n.innerHTML=k}return k})},getOuterHTML:function(l){var k,j=this;l=j.get(l);if(!l){return null}if(l.nodeType===1&&j.hasOuterHTML){return l.outerHTML}k=(l.ownerDocument||j.doc).createElement(\"body\");k.appendChild(l.cloneNode(true));return k.innerHTML},setOuterHTML:function(m,k,n){var j=this;function l(p,o,r){var s,q;q=r.createElement(\"body\");q.innerHTML=o;s=q.lastChild;while(s){j.insertAfter(s.cloneNode(true),p);s=s.previousSibling}j.remove(p)}return this.run(m,function(p){p=j.get(p);if(p.nodeType==1){n=n||p.ownerDocument||j.doc;if(b){try{if(b&&p.nodeType==1){p.outerHTML=k}else{l(p,k,n)}}catch(o){l(p,k,n)}}else{l(p,k,n)}}})},decode:c.decode,encode:c.encodeAllRaw,insertAfter:function(j,k){k=this.get(k);return this.run(j,function(m){var l,n;l=k.parentNode;n=k.nextSibling;if(n){l.insertBefore(m,n)}else{l.appendChild(m)}return m})},isBlock:function(k){var j=k.nodeType;if(j){return !!(j===1&&g[k.nodeName])}return !!g[k]},replace:function(p,m,j){var l=this;if(e(m,\"array\")){p=p.cloneNode(true)}return l.run(m,function(k){if(j){f(h.grep(k.childNodes),function(n){p.appendChild(n)})}return k.parentNode.replaceChild(p,k)})},rename:function(m,j){var l=this,k;if(m.nodeName!=j.toUpperCase()){k=l.create(j);f(l.getAttribs(m),function(n){l.setAttrib(k,n.nodeName,l.getAttrib(m,n.nodeName))});l.replace(k,m,1)}return k||m},findCommonAncestor:function(l,j){var m=l,k;while(m){k=j;while(k&&m!=k){k=k.parentNode}if(m==k){break}m=m.parentNode}if(!m&&l.ownerDocument){return l.ownerDocument.documentElement}return m},toHex:function(j){var l=/^\\s*rgb\\s*?\\(\\s*?([0-9]+)\\s*?,\\s*?([0-9]+)\\s*?,\\s*?([0-9]+)\\s*?\\)\\s*$/i.exec(j);function k(m){m=parseInt(m).toString(16);return m.length>1?m:\"0\"+m}if(l){j=\"#\"+k(l[1])+k(l[2])+k(l[3]);return j}return j},getClasses:function(){var n=this,j=[],m,o={},p=n.settings.class_filter,l;if(n.classes){return n.classes}function q(r){f(r.imports,function(s){q(s)});f(r.cssRules||r.rules,function(s){switch(s.type||1){case 1:if(s.selectorText){f(s.selectorText.split(\",\"),function(t){t=t.replace(/^\\s*|\\s*$|^\\s\\./g,\"\");if(/\\.mce/.test(t)||!/\\.[\\w\\-]+$/.test(t)){return}l=t;t=h._replace(/.*\\.([a-z0-9_\\-]+).*/i,\"$1\",t);if(p&&!(t=p(t,l))){return}if(!o[t]){j.push({\"class\":t});o[t]=1}})}break;case 3:q(s.styleSheet);break}})}try{f(n.doc.styleSheets,q)}catch(k){}if(j.length>0){n.classes=j}return j},run:function(m,l,k){var j=this,n;if(j.doc&&typeof(m)===\"string\"){m=j.get(m)}if(!m){return false}k=k||this;if(!m.nodeType&&(m.length||m.length===0)){n=[];f(m,function(p,o){if(p){if(typeof(p)==\"string\"){p=j.doc.getElementById(p)}n.push(l.call(k,p,o))}});return n}return l.call(k,m)},getAttribs:function(k){var j;k=this.get(k);if(!k){return[]}if(b){j=[];if(k.nodeName==\"OBJECT\"){return k.attributes}if(k.nodeName===\"OPTION\"&&this.getAttrib(k,\"selected\")){j.push({specified:1,nodeName:\"selected\"})}k.cloneNode(false).outerHTML.replace(/<\\/?[\\w:\\-]+ ?|=[\\\"][^\\\"]+\\\"|=\\'[^\\']+\\'|=[\\w\\-]+|>/gi,\"\").replace(/[\\w:\\-]+/gi,function(l){j.push({specified:1,nodeName:l})});return j}return k.attributes},isEmpty:function(m,k){var r=this,o,n,q,j,l,p;m=m.firstChild;if(m){j=new h.dom.TreeWalker(m);k=k||r.schema?r.schema.getNonEmptyElements():null;do{q=m.nodeType;if(q===1){if(m.getAttribute(\"data-mce-bogus\")){continue}l=m.nodeName.toLowerCase();if(k&&k[l]){p=m.parentNode;if(l===\"br\"&&r.isBlock(p)&&p.firstChild===m&&p.lastChild===m){continue}return false}n=r.getAttribs(m);o=m.attributes.length;while(o--){l=m.attributes[o].nodeName;if(l===\"name\"||l===\"data-mce-bookmark\"){return false}}}if((q===3&&!i.test(m.nodeValue))){return false}}while(m=j.next())}return true},destroy:function(k){var j=this;if(j.events){j.events.destroy()}j.win=j.doc=j.root=j.events=null;if(!k){h.removeUnload(j.destroy)}},createRng:function(){var j=this.doc;return j.createRange?j.createRange():new h.dom.Range(this)},nodeIndex:function(n,o){var j=0,l,m,k;if(n){for(l=n.nodeType,n=n.previousSibling,m=n;n;n=n.previousSibling){k=n.nodeType;if(o&&k==3){if(k==l||!n.nodeValue.length){continue}}j++;l=k}}return j},split:function(n,m,q){var s=this,j=s.createRng(),o,l,p;function k(v){var t,r=v.childNodes,u=v.nodeType;if(u==1&&v.getAttribute(\"data-mce-type\")==\"bookmark\"){return}for(t=r.length-1;t>=0;t--){k(r[t])}if(u!=9){if(u==3&&v.nodeValue.length>0){if(!s.isBlock(v.parentNode)||h.trim(v.nodeValue).length>0){return}}else{if(u==1){r=v.childNodes;if(r.length==1&&r[0]&&r[0].nodeType==1&&r[0].getAttribute(\"data-mce-type\")==\"bookmark\"){v.parentNode.insertBefore(r[0],v)}if(r.length||/^(br|hr|input|img)$/i.test(v.nodeName)){return}}}s.remove(v)}return v}if(n&&m){j.setStart(n.parentNode,s.nodeIndex(n));j.setEnd(m.parentNode,s.nodeIndex(m));o=j.extractContents();j=s.createRng();j.setStart(m.parentNode,s.nodeIndex(m)+1);j.setEnd(n.parentNode,s.nodeIndex(n)+1);l=j.extractContents();p=n.parentNode;p.insertBefore(k(o),n);if(q){p.replaceChild(q,m)}else{p.insertBefore(m,n)}p.insertBefore(k(l),n);s.remove(n);return q||m}},bind:function(n,j,m,l){var k=this;if(!k.events){k.events=new h.dom.EventUtils()}return k.events.add(n,j,m,l||this)},unbind:function(m,j,l){var k=this;if(!k.events){k.events=new h.dom.EventUtils()}return k.events.remove(m,j,l)},_findSib:function(m,j,k){var l=this,n=j;if(m){if(e(n,\"string\")){n=function(o){return l.is(o,j)}}for(m=m[k];m;m=m[k]){if(n(m)){return m}}}return null},_isRes:function(j){return/^(top|left|bottom|right|width|height)/i.test(j)||/;\\s*(top|left|bottom|right|width|height)/i.test(j)}});h.DOM=new h.dom.DOMUtils(document,{process_html:0})})(tinymce);(function(a){function b(c){var N=this,e=c.doc,S=0,E=1,j=2,D=true,R=false,U=\"startOffset\",h=\"startContainer\",P=\"endContainer\",z=\"endOffset\",k=tinymce.extend,n=c.nodeIndex;k(N,{startContainer:e,startOffset:0,endContainer:e,endOffset:0,collapsed:D,commonAncestorContainer:e,START_TO_START:0,START_TO_END:1,END_TO_END:2,END_TO_START:3,setStart:q,setEnd:s,setStartBefore:g,setStartAfter:I,setEndBefore:J,setEndAfter:u,collapse:A,selectNode:x,selectNodeContents:F,compareBoundaryPoints:v,deleteContents:p,extractContents:H,cloneContents:d,insertNode:C,surroundContents:M,cloneRange:K});function q(V,t){B(D,V,t)}function s(V,t){B(R,V,t)}function g(t){q(t.parentNode,n(t))}function I(t){q(t.parentNode,n(t)+1)}function J(t){s(t.parentNode,n(t))}function u(t){s(t.parentNode,n(t)+1)}function A(t){if(t){N[P]=N[h];N[z]=N[U]}else{N[h]=N[P];N[U]=N[z]}N.collapsed=D}function x(t){g(t);u(t)}function F(t){q(t,0);s(t,t.nodeType===1?t.childNodes.length:t.nodeValue.length)}function v(Y,t){var ab=N[h],W=N[U],aa=N[P],V=N[z],Z=t.startContainer,ad=t.startOffset,X=t.endContainer,ac=t.endOffset;if(Y===0){return G(ab,W,Z,ad)}if(Y===1){return G(aa,V,Z,ad)}if(Y===2){return G(aa,V,X,ac)}if(Y===3){return G(ab,W,X,ac)}}function p(){m(j)}function H(){return m(S)}function d(){return m(E)}function C(Y){var V=this[h],t=this[U],X,W;if((V.nodeType===3||V.nodeType===4)&&V.nodeValue){if(!t){V.parentNode.insertBefore(Y,V)}else{if(t>=V.nodeValue.length){c.insertAfter(Y,V)}else{X=V.splitText(t);V.parentNode.insertBefore(Y,X)}}}else{if(V.childNodes.length>0){W=V.childNodes[t]}if(W){V.insertBefore(Y,W)}else{V.appendChild(Y)}}}function M(V){var t=N.extractContents();N.insertNode(V);V.appendChild(t);N.selectNode(V)}function K(){return k(new b(c),{startContainer:N[h],startOffset:N[U],endContainer:N[P],endOffset:N[z],collapsed:N.collapsed,commonAncestorContainer:N.commonAncestorContainer})}function O(t,V){var W;if(t.nodeType==3){return t}if(V<0){return t}W=t.firstChild;while(W&&V>0){--V;W=W.nextSibling}if(W){return W}return t}function l(){return(N[h]==N[P]&&N[U]==N[z])}function G(X,Z,V,Y){var aa,W,t,ab,ad,ac;if(X==V){if(Z==Y){return 0}if(Z<Y){return -1}return 1}aa=V;while(aa&&aa.parentNode!=X){aa=aa.parentNode}if(aa){W=0;t=X.firstChild;while(t!=aa&&W<Z){W++;t=t.nextSibling}if(Z<=W){return -1}return 1}aa=X;while(aa&&aa.parentNode!=V){aa=aa.parentNode}if(aa){W=0;t=V.firstChild;while(t!=aa&&W<Y){W++;t=t.nextSibling}if(W<Y){return -1}return 1}ab=c.findCommonAncestor(X,V);ad=X;while(ad&&ad.parentNode!=ab){ad=ad.parentNode}if(!ad){ad=ab}ac=V;while(ac&&ac.parentNode!=ab){ac=ac.parentNode}if(!ac){ac=ab}if(ad==ac){return 0}t=ab.firstChild;while(t){if(t==ad){return -1}if(t==ac){return 1}t=t.nextSibling}}function B(V,Y,X){var t,W;if(V){N[h]=Y;N[U]=X}else{N[P]=Y;N[z]=X}t=N[P];while(t.parentNode){t=t.parentNode}W=N[h];while(W.parentNode){W=W.parentNode}if(W==t){if(G(N[h],N[U],N[P],N[z])>0){N.collapse(V)}}else{N.collapse(V)}N.collapsed=l();N.commonAncestorContainer=c.findCommonAncestor(N[h],N[P])}function m(ab){var aa,X=0,ad=0,V,Z,W,Y,t,ac;if(N[h]==N[P]){return f(ab)}for(aa=N[P],V=aa.parentNode;V;aa=V,V=V.parentNode){if(V==N[h]){return r(aa,ab)}++X}for(aa=N[h],V=aa.parentNode;V;aa=V,V=V.parentNode){if(V==N[P]){return T(aa,ab)}++ad}Z=ad-X;W=N[h];while(Z>0){W=W.parentNode;Z--}Y=N[P];while(Z<0){Y=Y.parentNode;Z++}for(t=W.parentNode,ac=Y.parentNode;t!=ac;t=t.parentNode,ac=ac.parentNode){W=t;Y=ac}return o(W,Y,ab)}function f(Z){var ab,Y,X,aa,t,W,V;if(Z!=j){ab=e.createDocumentFragment()}if(N[U]==N[z]){return ab}if(N[h].nodeType==3){Y=N[h].nodeValue;X=Y.substring(N[U],N[z]);if(Z!=E){N[h].deleteData(N[U],N[z]-N[U]);N.collapse(D)}if(Z==j){return}ab.appendChild(e.createTextNode(X));return ab}aa=O(N[h],N[U]);t=N[z]-N[U];while(t>0){W=aa.nextSibling;V=y(aa,Z);if(ab){ab.appendChild(V)}--t;aa=W}if(Z!=E){N.collapse(D)}return ab}function r(ab,Y){var aa,Z,V,t,X,W;if(Y!=j){aa=e.createDocumentFragment()}Z=i(ab,Y);if(aa){aa.appendChild(Z)}V=n(ab);t=V-N[U];if(t<=0){if(Y!=E){N.setEndBefore(ab);N.collapse(R)}return aa}Z=ab.previousSibling;while(t>0){X=Z.previousSibling;W=y(Z,Y);if(aa){aa.insertBefore(W,aa.firstChild)}--t;Z=X}if(Y!=E){N.setEndBefore(ab);N.collapse(R)}return aa}function T(Z,Y){var ab,V,aa,t,X,W;if(Y!=j){ab=e.createDocumentFragment()}aa=Q(Z,Y);if(ab){ab.appendChild(aa)}V=n(Z);++V;t=N[z]-V;aa=Z.nextSibling;while(t>0){X=aa.nextSibling;W=y(aa,Y);if(ab){ab.appendChild(W)}--t;aa=X}if(Y!=E){N.setStartAfter(Z);N.collapse(D)}return ab}function o(Z,t,ac){var W,ae,Y,aa,ab,V,ad,X;if(ac!=j){ae=e.createDocumentFragment()}W=Q(Z,ac);if(ae){ae.appendChild(W)}Y=Z.parentNode;aa=n(Z);ab=n(t);++aa;V=ab-aa;ad=Z.nextSibling;while(V>0){X=ad.nextSibling;W=y(ad,ac);if(ae){ae.appendChild(W)}ad=X;--V}W=i(t,ac);if(ae){ae.appendChild(W)}if(ac!=E){N.setStartAfter(Z);N.collapse(D)}return ae}function i(aa,ab){var W=O(N[P],N[z]-1),ac,Z,Y,t,V,X=W!=N[P];if(W==aa){return L(W,X,R,ab)}ac=W.parentNode;Z=L(ac,R,R,ab);while(ac){while(W){Y=W.previousSibling;t=L(W,X,R,ab);if(ab!=j){Z.insertBefore(t,Z.firstChild)}X=D;W=Y}if(ac==aa){return Z}W=ac.previousSibling;ac=ac.parentNode;V=L(ac,R,R,ab);if(ab!=j){V.appendChild(Z)}Z=V}}function Q(aa,ab){var X=O(N[h],N[U]),Y=X!=N[h],ac,Z,W,t,V;if(X==aa){return L(X,Y,D,ab)}ac=X.parentNode;Z=L(ac,R,D,ab);while(ac){while(X){W=X.nextSibling;t=L(X,Y,D,ab);if(ab!=j){Z.appendChild(t)}Y=D;X=W}if(ac==aa){return Z}X=ac.nextSibling;ac=ac.parentNode;V=L(ac,R,D,ab);if(ab!=j){V.appendChild(Z)}Z=V}}function L(t,Y,ab,ac){var X,W,Z,V,aa;if(Y){return y(t,ac)}if(t.nodeType==3){X=t.nodeValue;if(ab){V=N[U];W=X.substring(V);Z=X.substring(0,V)}else{V=N[z];W=X.substring(0,V);Z=X.substring(V)}if(ac!=E){t.nodeValue=Z}if(ac==j){return}aa=t.cloneNode(R);aa.nodeValue=W;return aa}if(ac==j){return}return t.cloneNode(R)}function y(V,t){if(t!=j){return t==E?V.cloneNode(D):V}V.parentNode.removeChild(V)}}a.Range=b})(tinymce.dom);(function(){function a(d){var b=this,h=d.dom,c=true,f=false;function e(i,j){var k,t=0,q,n,m,l,o,r,p=-1,s;k=i.duplicate();k.collapse(j);s=k.parentElement();if(s.ownerDocument!==d.dom.doc){return}while(s.contentEditable===\"false\"){s=s.parentNode}if(!s.hasChildNodes()){return{node:s,inside:1}}m=s.children;q=m.length-1;while(t<=q){r=Math.floor((t+q)/2);l=m[r];k.moveToElementText(l);p=k.compareEndPoints(j?\"StartToStart\":\"EndToEnd\",i);if(p>0){q=r-1}else{if(p<0){t=r+1}else{return{node:l}}}}if(p<0){if(!l){k.moveToElementText(s);k.collapse(true);l=s;n=true}else{k.collapse(false)}k.setEndPoint(j?\"EndToStart\":\"EndToEnd\",i);if(k.compareEndPoints(j?\"StartToStart\":\"StartToEnd\",i)>0){k=i.duplicate();k.collapse(j);o=-1;while(s==k.parentElement()){if(k.move(\"character\",-1)==0){break}o++}}o=o||k.text.replace(\"\\r\\n\",\" \").length}else{k.collapse(true);k.setEndPoint(j?\"StartToStart\":\"StartToEnd\",i);o=k.text.replace(\"\\r\\n\",\" \").length}return{node:l,position:p,offset:o,inside:n}}function g(){var i=d.getRng(),r=h.createRng(),l,k,p,q,m,j;l=i.item?i.item(0):i.parentElement();if(l.ownerDocument!=h.doc){return r}k=d.isCollapsed();if(i.item){r.setStart(l.parentNode,h.nodeIndex(l));r.setEnd(r.startContainer,r.startOffset+1);return r}function o(A){var u=e(i,A),s,y,z=0,x,v,t;s=u.node;y=u.offset;if(u.inside&&!s.hasChildNodes()){r[A?\"setStart\":\"setEnd\"](s,0);return}if(y===v){r[A?\"setStartBefore\":\"setEndAfter\"](s);return}if(u.position<0){x=u.inside?s.firstChild:s.nextSibling;if(!x){r[A?\"setStartAfter\":\"setEndAfter\"](s);return}if(!y){if(x.nodeType==3){r[A?\"setStart\":\"setEnd\"](x,0)}else{r[A?\"setStartBefore\":\"setEndBefore\"](x)}return}while(x){t=x.nodeValue;z+=t.length;if(z>=y){s=x;z-=y;z=t.length-z;break}x=x.nextSibling}}else{x=s.previousSibling;if(!x){return r[A?\"setStartBefore\":\"setEndBefore\"](s)}if(!y){if(s.nodeType==3){r[A?\"setStart\":\"setEnd\"](x,s.nodeValue.length)}else{r[A?\"setStartAfter\":\"setEndAfter\"](x)}return}while(x){z+=x.nodeValue.length;if(z>=y){s=x;z-=y;break}x=x.previousSibling}}r[A?\"setStart\":\"setEnd\"](s,z)}try{o(true);if(!k){o()}}catch(n){if(n.number==-2147024809){m=b.getBookmark(2);p=i.duplicate();p.collapse(true);l=p.parentElement();if(!k){p=i.duplicate();p.collapse(false);q=p.parentElement();q.innerHTML=q.innerHTML}l.innerHTML=l.innerHTML;b.moveToBookmark(m);i=d.getRng();o(true);if(!k){o()}}else{throw n}}return r}this.getBookmark=function(m){var j=d.getRng(),o,i,l={};function n(u){var u,t,p,s,r,q=[];t=u.parentNode;p=h.getRoot().parentNode;while(t!=p&&t.nodeType!==9){s=t.children;r=s.length;while(r--){if(u===s[r]){q.push(r);break}}u=t;t=t.parentNode}return q}function k(q){var p;p=e(j,q);if(p){return{position:p.position,offset:p.offset,indexes:n(p.node),inside:p.inside}}}if(m===2){if(!j.item){l.start=k(true);if(!d.isCollapsed()){l.end=k()}}else{l.start={ctrl:true,indexes:n(j.item(0))}}}return l};this.moveToBookmark=function(k){var j,i=h.doc.body;function m(o){var r,q,n,p;r=h.getRoot();for(q=o.length-1;q>=0;q--){p=r.children;n=o[q];if(n<=p.length-1){r=p[n]}}return r}function l(r){var n=k[r?\"start\":\"end\"],q,p,o;if(n){q=n.position>0;p=i.createTextRange();p.moveToElementText(m(n.indexes));offset=n.offset;if(offset!==o){p.collapse(n.inside||q);p.moveStart(\"character\",q?-offset:offset)}else{p.collapse(r)}j.setEndPoint(r?\"StartToStart\":\"EndToStart\",p);if(r){j.collapse(true)}}}if(k.start){if(k.start.ctrl){j=i.createControlRange();j.addElement(m(k.start.indexes));j.select()}else{j=i.createTextRange();l(true);l();j.select()}}};this.addRange=function(i){var n,l,k,p,s,q,r=d.dom.doc,m=r.body;function j(z){var u,y,t,x,v;t=h.create(\"a\");u=z?k:s;y=z?p:q;x=n.duplicate();if(u==r||u==r.documentElement){u=m;y=0}if(u.nodeType==3){u.parentNode.insertBefore(t,u);x.moveToElementText(t);x.moveStart(\"character\",y);h.remove(t);n.setEndPoint(z?\"StartToStart\":\"EndToEnd\",x)}else{v=u.childNodes;if(v.length){if(y>=v.length){h.insertAfter(t,v[v.length-1])}else{u.insertBefore(t,v[y])}x.moveToElementText(t)}else{t=r.createTextNode(\"\\uFEFF\");u.appendChild(t);x.moveToElementText(t.parentNode);x.collapse(c)}n.setEndPoint(z?\"StartToStart\":\"EndToEnd\",x);h.remove(t)}}k=i.startContainer;p=i.startOffset;s=i.endContainer;q=i.endOffset;n=m.createTextRange();if(k==s&&k.nodeType==1&&p==q-1){if(p==q-1){try{l=m.createControlRange();l.addElement(k.childNodes[p]);l.select();return}catch(o){}}}j(true);j();n.select()};this.getRangeAt=g}tinymce.dom.TridentSelection=a})();(function(){var p=/((?:\\((?:\\([^()]+\\)|[^()]+)+\\)|\\[(?:\\[[^\\[\\]]*\\]|['\"][^'\"]*['\"]|[^\\[\\]'\"]+)+\\]|\\\\.|[^ >+~,(\\[\\\\]+)+|[>+~])(\\s*,\\s*)?((?:.|\\r|\\n)*)/g,j=0,d=Object.prototype.toString,o=false,i=true;[0,0].sort(function(){i=false;return 0});var b=function(v,e,z,A){z=z||[];e=e||document;var C=e;if(e.nodeType!==1&&e.nodeType!==9){return[]}if(!v||typeof v!==\"string\"){return z}var x=[],s,E,H,r,u=true,t=b.isXML(e),B=v,D,G,F,y;do{p.exec(\"\");s=p.exec(B);if(s){B=s[3];x.push(s[1]);if(s[2]){r=s[3];break}}}while(s);if(x.length>1&&k.exec(v)){if(x.length===2&&f.relative[x[0]]){E=h(x[0]+x[1],e)}else{E=f.relative[x[0]]?[e]:b(x.shift(),e);while(x.length){v=x.shift();if(f.relative[v]){v+=x.shift()}E=h(v,E)}}}else{if(!A&&x.length>1&&e.nodeType===9&&!t&&f.match.ID.test(x[0])&&!f.match.ID.test(x[x.length-1])){D=b.find(x.shift(),e,t);e=D.expr?b.filter(D.expr,D.set)[0]:D.set[0]}if(e){D=A?{expr:x.pop(),set:a(A)}:b.find(x.pop(),x.length===1&&(x[0]===\"~\"||x[0]===\"+\")&&e.parentNode?e.parentNode:e,t);E=D.expr?b.filter(D.expr,D.set):D.set;if(x.length>0){H=a(E)}else{u=false}while(x.length){G=x.pop();F=G;if(!f.relative[G]){G=\"\"}else{F=x.pop()}if(F==null){F=e}f.relative[G](H,F,t)}}else{H=x=[]}}if(!H){H=E}if(!H){b.error(G||v)}if(d.call(H)===\"[object Array]\"){if(!u){z.push.apply(z,H)}else{if(e&&e.nodeType===1){for(y=0;H[y]!=null;y++){if(H[y]&&(H[y]===true||H[y].nodeType===1&&b.contains(e,H[y]))){z.push(E[y])}}}else{for(y=0;H[y]!=null;y++){if(H[y]&&H[y].nodeType===1){z.push(E[y])}}}}}else{a(H,z)}if(r){b(r,C,z,A);b.uniqueSort(z)}return z};b.uniqueSort=function(r){if(c){o=i;r.sort(c);if(o){for(var e=1;e<r.length;e++){if(r[e]===r[e-1]){r.splice(e--,1)}}}}return r};b.matches=function(e,r){return b(e,null,null,r)};b.find=function(y,e,z){var x;if(!y){return[]}for(var t=0,s=f.order.length;t<s;t++){var v=f.order[t],u;if((u=f.leftMatch[v].exec(y))){var r=u[1];u.splice(1,1);if(r.substr(r.length-1)!==\"\\\\\"){u[1]=(u[1]||\"\").replace(/\\\\/g,\"\");x=f.find[v](u,e,z);if(x!=null){y=y.replace(f.match[v],\"\");break}}}}if(!x){x=e.getElementsByTagName(\"*\")}return{set:x,expr:y}};b.filter=function(C,B,F,u){var s=C,H=[],z=B,x,e,y=B&&B[0]&&b.isXML(B[0]);while(C&&B.length){for(var A in f.filter){if((x=f.leftMatch[A].exec(C))!=null&&x[2]){var r=f.filter[A],G,E,t=x[1];e=false;x.splice(1,1);if(t.substr(t.length-1)===\"\\\\\"){continue}if(z===H){H=[]}if(f.preFilter[A]){x=f.preFilter[A](x,z,F,H,u,y);if(!x){e=G=true}else{if(x===true){continue}}}if(x){for(var v=0;(E=z[v])!=null;v++){if(E){G=r(E,x,v,z);var D=u^!!G;if(F&&G!=null){if(D){e=true}else{z[v]=false}}else{if(D){H.push(E);e=true}}}}}if(G!==undefined){if(!F){z=H}C=C.replace(f.match[A],\"\");if(!e){return[]}break}}}if(C===s){if(e==null){b.error(C)}else{break}}s=C}return z};b.error=function(e){throw\"Syntax error, unrecognized expression: \"+e};var f=b.selectors={order:[\"ID\",\"NAME\",\"TAG\"],match:{ID:/#((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)/,CLASS:/\\.((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)/,NAME:/\\[name=['\"]*((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)['\"]*\\]/,ATTR:/\\[\\s*((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)\\s*(?:(\\S?=)\\s*(['\"]*)(.*?)\\3|)\\s*\\]/,TAG:/^((?:[\\w\\u00c0-\\uFFFF\\*\\-]|\\\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\\((even|odd|[\\dn+\\-]*)\\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\))?(?=[^\\-]|$)/,PSEUDO:/:((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)(?:\\((['\"]?)((?:\\([^\\)]+\\)|[^\\(\\)]*)+)\\2\\))?/},leftMatch:{},attrMap:{\"class\":\"className\",\"for\":\"htmlFor\"},attrHandle:{href:function(e){return e.getAttribute(\"href\")}},relative:{\"+\":function(x,r){var t=typeof r===\"string\",v=t&&!/\\W/.test(r),y=t&&!v;if(v){r=r.toLowerCase()}for(var s=0,e=x.length,u;s<e;s++){if((u=x[s])){while((u=u.previousSibling)&&u.nodeType!==1){}x[s]=y||u&&u.nodeName.toLowerCase()===r?u||false:u===r}}if(y){b.filter(r,x,true)}},\">\":function(x,r){var u=typeof r===\"string\",v,s=0,e=x.length;if(u&&!/\\W/.test(r)){r=r.toLowerCase();for(;s<e;s++){v=x[s];if(v){var t=v.parentNode;x[s]=t.nodeName.toLowerCase()===r?t:false}}}else{for(;s<e;s++){v=x[s];if(v){x[s]=u?v.parentNode:v.parentNode===r}}if(u){b.filter(r,x,true)}}},\"\":function(t,r,v){var s=j++,e=q,u;if(typeof r===\"string\"&&!/\\W/.test(r)){r=r.toLowerCase();u=r;e=n}e(\"parentNode\",r,s,t,u,v)},\"~\":function(t,r,v){var s=j++,e=q,u;if(typeof r===\"string\"&&!/\\W/.test(r)){r=r.toLowerCase();u=r;e=n}e(\"previousSibling\",r,s,t,u,v)}},find:{ID:function(r,s,t){if(typeof s.getElementById!==\"undefined\"&&!t){var e=s.getElementById(r[1]);return e?[e]:[]}},NAME:function(s,v){if(typeof v.getElementsByName!==\"undefined\"){var r=[],u=v.getElementsByName(s[1]);for(var t=0,e=u.length;t<e;t++){if(u[t].getAttribute(\"name\")===s[1]){r.push(u[t])}}return r.length===0?null:r}},TAG:function(e,r){return r.getElementsByTagName(e[1])}},preFilter:{CLASS:function(t,r,s,e,x,y){t=\" \"+t[1].replace(/\\\\/g,\"\")+\" \";if(y){return t}for(var u=0,v;(v=r[u])!=null;u++){if(v){if(x^(v.className&&(\" \"+v.className+\" \").replace(/[\\t\\n]/g,\" \").indexOf(t)>=0)){if(!s){e.push(v)}}else{if(s){r[u]=false}}}}return false},ID:function(e){return e[1].replace(/\\\\/g,\"\")},TAG:function(r,e){return r[1].toLowerCase()},CHILD:function(e){if(e[1]===\"nth\"){var r=/(-?)(\\d*)n((?:\\+|-)?\\d*)/.exec(e[2]===\"even\"&&\"2n\"||e[2]===\"odd\"&&\"2n+1\"||!/\\D/.test(e[2])&&\"0n+\"+e[2]||e[2]);e[2]=(r[1]+(r[2]||1))-0;e[3]=r[3]-0}e[0]=j++;return e},ATTR:function(u,r,s,e,v,x){var t=u[1].replace(/\\\\/g,\"\");if(!x&&f.attrMap[t]){u[1]=f.attrMap[t]}if(u[2]===\"~=\"){u[4]=\" \"+u[4]+\" \"}return u},PSEUDO:function(u,r,s,e,v){if(u[1]===\"not\"){if((p.exec(u[3])||\"\").length>1||/^\\w/.test(u[3])){u[3]=b(u[3],null,null,r)}else{var t=b.filter(u[3],r,s,true^v);if(!s){e.push.apply(e,t)}return false}}else{if(f.match.POS.test(u[0])||f.match.CHILD.test(u[0])){return true}}return u},POS:function(e){e.unshift(true);return e}},filters:{enabled:function(e){return e.disabled===false&&e.type!==\"hidden\"},disabled:function(e){return e.disabled===true},checked:function(e){return e.checked===true},selected:function(e){e.parentNode.selectedIndex;return e.selected===true},parent:function(e){return !!e.firstChild},empty:function(e){return !e.firstChild},has:function(s,r,e){return !!b(e[3],s).length},header:function(e){return(/h\\d/i).test(e.nodeName)},text:function(e){return\"text\"===e.type},radio:function(e){return\"radio\"===e.type},checkbox:function(e){return\"checkbox\"===e.type},file:function(e){return\"file\"===e.type},password:function(e){return\"password\"===e.type},submit:function(e){return\"submit\"===e.type},image:function(e){return\"image\"===e.type},reset:function(e){return\"reset\"===e.type},button:function(e){return\"button\"===e.type||e.nodeName.toLowerCase()===\"button\"},input:function(e){return(/input|select|textarea|button/i).test(e.nodeName)}},setFilters:{first:function(r,e){return e===0},last:function(s,r,e,t){return r===t.length-1},even:function(r,e){return e%2===0},odd:function(r,e){return e%2===1},lt:function(s,r,e){return r<e[3]-0},gt:function(s,r,e){return r>e[3]-0},nth:function(s,r,e){return e[3]-0===r},eq:function(s,r,e){return e[3]-0===r}},filter:{PSEUDO:function(s,y,x,z){var e=y[1],r=f.filters[e];if(r){return r(s,x,y,z)}else{if(e===\"contains\"){return(s.textContent||s.innerText||b.getText([s])||\"\").indexOf(y[3])>=0}else{if(e===\"not\"){var t=y[3];for(var v=0,u=t.length;v<u;v++){if(t[v]===s){return false}}return true}else{b.error(\"Syntax error, unrecognized expression: \"+e)}}}},CHILD:function(e,t){var x=t[1],r=e;switch(x){case\"only\":case\"first\":while((r=r.previousSibling)){if(r.nodeType===1){return false}}if(x===\"first\"){return true}r=e;case\"last\":while((r=r.nextSibling)){if(r.nodeType===1){return false}}return true;case\"nth\":var s=t[2],A=t[3];if(s===1&&A===0){return true}var v=t[0],z=e.parentNode;if(z&&(z.sizcache!==v||!e.nodeIndex)){var u=0;for(r=z.firstChild;r;r=r.nextSibling){if(r.nodeType===1){r.nodeIndex=++u}}z.sizcache=v}var y=e.nodeIndex-A;if(s===0){return y===0}else{return(y%s===0&&y/s>=0)}}},ID:function(r,e){return r.nodeType===1&&r.getAttribute(\"id\")===e},TAG:function(r,e){return(e===\"*\"&&r.nodeType===1)||r.nodeName.toLowerCase()===e},CLASS:function(r,e){return(\" \"+(r.className||r.getAttribute(\"class\"))+\" \").indexOf(e)>-1},ATTR:function(v,t){var s=t[1],e=f.attrHandle[s]?f.attrHandle[s](v):v[s]!=null?v[s]:v.getAttribute(s),x=e+\"\",u=t[2],r=t[4];return e==null?u===\"!=\":u===\"=\"?x===r:u===\"*=\"?x.indexOf(r)>=0:u===\"~=\"?(\" \"+x+\" \").indexOf(r)>=0:!r?x&&e!==false:u===\"!=\"?x!==r:u===\"^=\"?x.indexOf(r)===0:u===\"$=\"?x.substr(x.length-r.length)===r:u===\"|=\"?x===r||x.substr(0,r.length+1)===r+\"-\":false},POS:function(u,r,s,v){var e=r[2],t=f.setFilters[e];if(t){return t(u,s,r,v)}}}};var k=f.match.POS,g=function(r,e){return\"\\\\\"+(e-0+1)};for(var m in f.match){f.match[m]=new RegExp(f.match[m].source+(/(?![^\\[]*\\])(?![^\\(]*\\))/.source));f.leftMatch[m]=new RegExp(/(^(?:.|\\r|\\n)*?)/.source+f.match[m].source.replace(/\\\\(\\d+)/g,g))}var a=function(r,e){r=Array.prototype.slice.call(r,0);if(e){e.push.apply(e,r);return e}return r};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType}catch(l){a=function(u,t){var r=t||[],s=0;if(d.call(u)===\"[object Array]\"){Array.prototype.push.apply(r,u)}else{if(typeof u.length===\"number\"){for(var e=u.length;s<e;s++){r.push(u[s])}}else{for(;u[s];s++){r.push(u[s])}}}return r}}var c;if(document.documentElement.compareDocumentPosition){c=function(r,e){if(!r.compareDocumentPosition||!e.compareDocumentPosition){if(r==e){o=true}return r.compareDocumentPosition?-1:1}var s=r.compareDocumentPosition(e)&4?-1:r===e?0:1;if(s===0){o=true}return s}}else{if(\"sourceIndex\" in document.documentElement){c=function(r,e){if(!r.sourceIndex||!e.sourceIndex){if(r==e){o=true}return r.sourceIndex?-1:1}var s=r.sourceIndex-e.sourceIndex;if(s===0){o=true}return s}}else{if(document.createRange){c=function(t,r){if(!t.ownerDocument||!r.ownerDocument){if(t==r){o=true}return t.ownerDocument?-1:1}var s=t.ownerDocument.createRange(),e=r.ownerDocument.createRange();s.setStart(t,0);s.setEnd(t,0);e.setStart(r,0);e.setEnd(r,0);var u=s.compareBoundaryPoints(Range.START_TO_END,e);if(u===0){o=true}return u}}}}b.getText=function(e){var r=\"\",t;for(var s=0;e[s];s++){t=e[s];if(t.nodeType===3||t.nodeType===4){r+=t.nodeValue}else{if(t.nodeType!==8){r+=b.getText(t.childNodes)}}}return r};(function(){var r=document.createElement(\"div\"),s=\"script\"+(new Date()).getTime();r.innerHTML=\"<a name='\"+s+\"'/>\";var e=document.documentElement;e.insertBefore(r,e.firstChild);if(document.getElementById(s)){f.find.ID=function(u,v,x){if(typeof v.getElementById!==\"undefined\"&&!x){var t=v.getElementById(u[1]);return t?t.id===u[1]||typeof t.getAttributeNode!==\"undefined\"&&t.getAttributeNode(\"id\").nodeValue===u[1]?[t]:undefined:[]}};f.filter.ID=function(v,t){var u=typeof v.getAttributeNode!==\"undefined\"&&v.getAttributeNode(\"id\");return v.nodeType===1&&u&&u.nodeValue===t}}e.removeChild(r);e=r=null})();(function(){var e=document.createElement(\"div\");e.appendChild(document.createComment(\"\"));if(e.getElementsByTagName(\"*\").length>0){f.find.TAG=function(r,v){var u=v.getElementsByTagName(r[1]);if(r[1]===\"*\"){var t=[];for(var s=0;u[s];s++){if(u[s].nodeType===1){t.push(u[s])}}u=t}return u}}e.innerHTML=\"<a href='#'></a>\";if(e.firstChild&&typeof e.firstChild.getAttribute!==\"undefined\"&&e.firstChild.getAttribute(\"href\")!==\"#\"){f.attrHandle.href=function(r){return r.getAttribute(\"href\",2)}}e=null})();if(document.querySelectorAll){(function(){var e=b,s=document.createElement(\"div\");s.innerHTML=\"<p class='TEST'></p>\";if(s.querySelectorAll&&s.querySelectorAll(\".TEST\").length===0){return}b=function(x,v,t,u){v=v||document;if(!u&&v.nodeType===9&&!b.isXML(v)){try{return a(v.querySelectorAll(x),t)}catch(y){}}return e(x,v,t,u)};for(var r in e){b[r]=e[r]}s=null})()}(function(){var e=document.createElement(\"div\");e.innerHTML=\"<div class='test e'></div><div class='test'></div>\";if(!e.getElementsByClassName||e.getElementsByClassName(\"e\").length===0){return}e.lastChild.className=\"e\";if(e.getElementsByClassName(\"e\").length===1){return}f.order.splice(1,0,\"CLASS\");f.find.CLASS=function(r,s,t){if(typeof s.getElementsByClassName!==\"undefined\"&&!t){return s.getElementsByClassName(r[1])}};e=null})();function n(r,x,v,A,y,z){for(var t=0,s=A.length;t<s;t++){var e=A[t];if(e){e=e[r];var u=false;while(e){if(e.sizcache===v){u=A[e.sizset];break}if(e.nodeType===1&&!z){e.sizcache=v;e.sizset=t}if(e.nodeName.toLowerCase()===x){u=e;break}e=e[r]}A[t]=u}}}function q(r,x,v,A,y,z){for(var t=0,s=A.length;t<s;t++){var e=A[t];if(e){e=e[r];var u=false;while(e){if(e.sizcache===v){u=A[e.sizset];break}if(e.nodeType===1){if(!z){e.sizcache=v;e.sizset=t}if(typeof x!==\"string\"){if(e===x){u=true;break}}else{if(b.filter(x,[e]).length>0){u=e;break}}}e=e[r]}A[t]=u}}}b.contains=document.compareDocumentPosition?function(r,e){return !!(r.compareDocumentPosition(e)&16)}:function(r,e){return r!==e&&(r.contains?r.contains(e):true)};b.isXML=function(e){var r=(e?e.ownerDocument||e:0).documentElement;return r?r.nodeName!==\"HTML\":false};var h=function(e,y){var t=[],u=\"\",v,s=y.nodeType?[y]:y;while((v=f.match.PSEUDO.exec(e))){u+=v[0];e=e.replace(f.match.PSEUDO,\"\")}e=f.relative[e]?e+\"*\":e;for(var x=0,r=s.length;x<r;x++){b(e,s[x],t)}return b.filter(u,t)};window.tinymce.dom.Sizzle=b})();(function(d){var f=d.each,c=d.DOM,b=d.isIE,e=d.isWebKit,a;d.create(\"tinymce.dom.EventUtils\",{EventUtils:function(){this.inits=[];this.events=[]},add:function(m,p,l,j){var g,h=this,i=h.events,k;if(p instanceof Array){k=[];f(p,function(o){k.push(h.add(m,o,l,j))});return k}if(m&&m.hasOwnProperty&&m instanceof Array){k=[];f(m,function(n){n=c.get(n);k.push(h.add(n,p,l,j))});return k}m=c.get(m);if(!m){return}g=function(n){if(h.disabled){return}n=n||window.event;if(n&&b){if(!n.target){n.target=n.srcElement}d.extend(n,h._stoppers)}if(!j){return l(n)}return l.call(j,n)};if(p==\"unload\"){d.unloads.unshift({func:g});return g}if(p==\"init\"){if(h.domLoaded){g()}else{h.inits.push(g)}return g}i.push({obj:m,name:p,func:l,cfunc:g,scope:j});h._add(m,p,g);return l},remove:function(l,m,k){var h=this,g=h.events,i=false,j;if(l&&l.hasOwnProperty&&l instanceof Array){j=[];f(l,function(n){n=c.get(n);j.push(h.remove(n,m,k))});return j}l=c.get(l);f(g,function(o,n){if(o.obj==l&&o.name==m&&(!k||(o.func==k||o.cfunc==k))){g.splice(n,1);h._remove(l,m,o.cfunc);i=true;return false}});return i},clear:function(l){var j=this,g=j.events,h,k;if(l){l=c.get(l);for(h=g.length-1;h>=0;h--){k=g[h];if(k.obj===l){j._remove(k.obj,k.name,k.cfunc);k.obj=k.cfunc=null;g.splice(h,1)}}}},cancel:function(g){if(!g){return false}this.stop(g);return this.prevent(g)},stop:function(g){if(g.stopPropagation){g.stopPropagation()}else{g.cancelBubble=true}return false},prevent:function(g){if(g.preventDefault){g.preventDefault()}else{g.returnValue=false}return false},destroy:function(){var g=this;f(g.events,function(j,h){g._remove(j.obj,j.name,j.cfunc);j.obj=j.cfunc=null});g.events=[];g=null},_add:function(h,i,g){if(h.attachEvent){h.attachEvent(\"on\"+i,g)}else{if(h.addEventListener){h.addEventListener(i,g,false)}else{h[\"on\"+i]=g}}},_remove:function(i,j,h){if(i){try{if(i.detachEvent){i.detachEvent(\"on\"+j,h)}else{if(i.removeEventListener){i.removeEventListener(j,h,false)}else{i[\"on\"+j]=null}}}catch(g){}}},_pageInit:function(h){var g=this;if(g.domLoaded){return}g.domLoaded=true;f(g.inits,function(i){i()});g.inits=[]},_wait:function(i){var g=this,h=i.document;if(i.tinyMCE_GZ&&tinyMCE_GZ.loaded){g.domLoaded=1;return}if(h.attachEvent){h.attachEvent(\"onreadystatechange\",function(){if(h.readyState===\"complete\"){h.detachEvent(\"onreadystatechange\",arguments.callee);g._pageInit(i)}});if(h.documentElement.doScroll&&i==i.top){(function(){if(g.domLoaded){return}try{h.documentElement.doScroll(\"left\")}catch(j){setTimeout(arguments.callee,0);return}g._pageInit(i)})()}}else{if(h.addEventListener){g._add(i,\"DOMContentLoaded\",function(){g._pageInit(i)})}}g._add(i,\"load\",function(){g._pageInit(i)})},_stoppers:{preventDefault:function(){this.returnValue=false},stopPropagation:function(){this.cancelBubble=true}}});a=d.dom.Event=new d.dom.EventUtils();a._wait(window);d.addUnload(function(){a.destroy()})})(tinymce);(function(a){a.dom.Element=function(f,d){var b=this,e,c;b.settings=d=d||{};b.id=f;b.dom=e=d.dom||a.DOM;if(!a.isIE){c=e.get(b.id)}a.each((\"getPos,getRect,getParent,add,setStyle,getStyle,setStyles,setAttrib,setAttribs,getAttrib,addClass,removeClass,hasClass,getOuterHTML,setOuterHTML,remove,show,hide,isHidden,setHTML,get\").split(/,/),function(g){b[g]=function(){var h=[f],j;for(j=0;j<arguments.length;j++){h.push(arguments[j])}h=e[g].apply(e,h);b.update(g);return h}});a.extend(b,{on:function(i,h,g){return a.dom.Event.add(b.id,i,h,g)},getXY:function(){return{x:parseInt(b.getStyle(\"left\")),y:parseInt(b.getStyle(\"top\"))}},getSize:function(){var g=e.get(b.id);return{w:parseInt(b.getStyle(\"width\")||g.clientWidth),h:parseInt(b.getStyle(\"height\")||g.clientHeight)}},moveTo:function(g,h){b.setStyles({left:g,top:h})},moveBy:function(g,i){var h=b.getXY();b.moveTo(h.x+g,h.y+i)},resizeTo:function(g,i){b.setStyles({width:g,height:i})},resizeBy:function(g,j){var i=b.getSize();b.resizeTo(i.w+g,i.h+j)},update:function(h){var g;if(a.isIE6&&d.blocker){h=h||\"\";if(h.indexOf(\"get\")===0||h.indexOf(\"has\")===0||h.indexOf(\"is\")===0){return}if(h==\"remove\"){e.remove(b.blocker);return}if(!b.blocker){b.blocker=e.uniqueId();g=e.add(d.container||e.getRoot(),\"iframe\",{id:b.blocker,style:\"position:absolute;\",frameBorder:0,src:'javascript:\"\"'});e.setStyle(g,\"opacity\",0)}else{g=e.get(b.blocker)}e.setStyles(g,{left:b.getStyle(\"left\",1),top:b.getStyle(\"top\",1),width:b.getStyle(\"width\",1),height:b.getStyle(\"height\",1),display:b.getStyle(\"display\",1),zIndex:parseInt(b.getStyle(\"zIndex\",1)||0)-1})}}})}})(tinymce);(function(c){function e(f){return f.replace(/[\\n\\r]+/g,\"\")}var b=c.is,a=c.isIE,d=c.each;c.create(\"tinymce.dom.Selection\",{Selection:function(i,h,g){var f=this;f.dom=i;f.win=h;f.serializer=g;d([\"onBeforeSetContent\",\"onBeforeGetContent\",\"onSetContent\",\"onGetContent\"],function(j){f[j]=new c.util.Dispatcher(f)});if(!f.win.getSelection){f.tridentSel=new c.dom.TridentSelection(f)}if(c.isIE&&i.boxModel){this._fixIESelection()}c.addUnload(f.destroy,f)},setCursorLocation:function(h,i){var f=this;var g=f.dom.createRng();g.setStart(h,i);g.setEnd(h,i);f.setRng(g);f.collapse(false)},getContent:function(g){var f=this,h=f.getRng(),l=f.dom.create(\"body\"),j=f.getSel(),i,k,m;g=g||{};i=k=\"\";g.get=true;g.format=g.format||\"html\";g.forced_root_block=\"\";f.onBeforeGetContent.dispatch(f,g);if(g.format==\"text\"){return f.isCollapsed()?\"\":(h.text||(j.toString?j.toString():\"\"))}if(h.cloneContents){m=h.cloneContents();if(m){l.appendChild(m)}}else{if(b(h.item)||b(h.htmlText)){l.innerHTML=\"<br>\"+(h.item?h.item(0).outerHTML:h.htmlText);l.removeChild(l.firstChild)}else{l.innerHTML=h.toString()}}if(/^\\s/.test(l.innerHTML)){i=\" \"}if(/\\s+$/.test(l.innerHTML)){k=\" \"}g.getInner=true;g.content=f.isCollapsed()?\"\":i+f.serializer.serialize(l,g)+k;f.onGetContent.dispatch(f,g);return g.content},setContent:function(g,i){var n=this,f=n.getRng(),j,k=n.win.document,m,l;i=i||{format:\"html\"};i.set=true;g=i.content=g;if(!i.no_events){n.onBeforeSetContent.dispatch(n,i)}g=i.content;if(f.insertNode){g+='<span id=\"__caret\">_</span>';if(f.startContainer==k&&f.endContainer==k){k.body.innerHTML=g}else{f.deleteContents();if(k.body.childNodes.length==0){k.body.innerHTML=g}else{if(f.createContextualFragment){f.insertNode(f.createContextualFragment(g))}else{m=k.createDocumentFragment();l=k.createElement(\"div\");m.appendChild(l);l.outerHTML=g;f.insertNode(m)}}}j=n.dom.get(\"__caret\");f=k.createRange();f.setStartBefore(j);f.setEndBefore(j);n.setRng(f);n.dom.remove(\"__caret\");try{n.setRng(f)}catch(h){}}else{if(f.item){k.execCommand(\"Delete\",false,null);f=n.getRng()}if(/^\\s+/.test(g)){f.pasteHTML('<span id=\"__mce_tmp\">_</span>'+g);n.dom.remove(\"__mce_tmp\")}else{f.pasteHTML(g)}}if(!i.no_events){n.onSetContent.dispatch(n,i)}},getStart:function(){var g=this.getRng(),h,f,j,i;if(g.duplicate||g.item){if(g.item){return g.item(0)}j=g.duplicate();j.collapse(1);h=j.parentElement();f=i=g.parentElement();while(i=i.parentNode){if(i==h){h=f;break}}return h}else{h=g.startContainer;if(h.nodeType==1&&h.hasChildNodes()){h=h.childNodes[Math.min(h.childNodes.length-1,g.startOffset)]}if(h&&h.nodeType==3){return h.parentNode}return h}},getEnd:function(){var g=this,h=g.getRng(),i,f;if(h.duplicate||h.item){if(h.item){return h.item(0)}h=h.duplicate();h.collapse(0);i=h.parentElement();if(i&&i.nodeName==\"BODY\"){return i.lastChild||i}return i}else{i=h.endContainer;f=h.endOffset;if(i.nodeType==1&&i.hasChildNodes()){i=i.childNodes[f>0?f-1:f]}if(i&&i.nodeType==3){return i.parentNode}return i}},getBookmark:function(r,s){var v=this,m=v.dom,g,j,i,n,h,o,p,l=\"\\uFEFF\",u;function f(x,y){var t=0;d(m.select(x),function(A,z){if(A==y){t=z}});return t}if(r==2){function k(){var x=v.getRng(true),t=m.getRoot(),y={};function z(C,H){var B=C[H?\"startContainer\":\"endContainer\"],G=C[H?\"startOffset\":\"endOffset\"],A=[],D,F,E=0;if(B.nodeType==3){if(s){for(D=B.previousSibling;D&&D.nodeType==3;D=D.previousSibling){G+=D.nodeValue.length}}A.push(G)}else{F=B.childNodes;if(G>=F.length&&F.length){E=1;G=Math.max(0,F.length-1)}A.push(v.dom.nodeIndex(F[G],s)+E)}for(;B&&B!=t;B=B.parentNode){A.push(v.dom.nodeIndex(B,s))}return A}y.start=z(x,true);if(!v.isCollapsed()){y.end=z(x)}return y}if(v.tridentSel){return v.tridentSel.getBookmark(r)}return k()}if(r){return{rng:v.getRng()}}g=v.getRng();i=m.uniqueId();n=tinyMCE.activeEditor.selection.isCollapsed();u=\"overflow:hidden;line-height:0px\";if(g.duplicate||g.item){if(!g.item){j=g.duplicate();try{g.collapse();g.pasteHTML('<span data-mce-type=\"bookmark\" id=\"'+i+'_start\" style=\"'+u+'\">'+l+\"</span>\");if(!n){j.collapse(false);g.moveToElementText(j.parentElement());if(g.compareEndPoints(\"StartToEnd\",j)==0){j.move(\"character\",-1)}j.pasteHTML('<span data-mce-type=\"bookmark\" id=\"'+i+'_end\" style=\"'+u+'\">'+l+\"</span>\")}}catch(q){return null}}else{o=g.item(0);h=o.nodeName;return{name:h,index:f(h,o)}}}else{o=v.getNode();h=o.nodeName;if(h==\"IMG\"){return{name:h,index:f(h,o)}}j=g.cloneRange();if(!n){j.collapse(false);j.insertNode(m.create(\"span\",{\"data-mce-type\":\"bookmark\",id:i+\"_end\",style:u},l))}g.collapse(true);g.insertNode(m.create(\"span\",{\"data-mce-type\":\"bookmark\",id:i+\"_start\",style:u},l))}v.moveToBookmark({id:i,keep:1});return{id:i}},moveToBookmark:function(n){var r=this,l=r.dom,i,h,f,q,j,s,o,p;if(n){if(n.start){f=l.createRng();q=l.getRoot();function g(z){var t=n[z?\"start\":\"end\"],v,x,y,u;if(t){y=t[0];for(x=q,v=t.length-1;v>=1;v--){u=x.childNodes;if(t[v]>u.length-1){return}x=u[t[v]]}if(x.nodeType===3){y=Math.min(t[0],x.nodeValue.length)}if(x.nodeType===1){y=Math.min(t[0],x.childNodes.length)}if(z){f.setStart(x,y)}else{f.setEnd(x,y)}}return true}if(r.tridentSel){return r.tridentSel.moveToBookmark(n)}if(g(true)&&g()){r.setRng(f)}}else{if(n.id){function k(A){var u=l.get(n.id+\"_\"+A),z,t,x,y,v=n.keep;if(u){z=u.parentNode;if(A==\"start\"){if(!v){t=l.nodeIndex(u)}else{z=u.firstChild;t=1}j=s=z;o=p=t}else{if(!v){t=l.nodeIndex(u)}else{z=u.firstChild;t=1}s=z;p=t}if(!v){y=u.previousSibling;x=u.nextSibling;d(c.grep(u.childNodes),function(B){if(B.nodeType==3){B.nodeValue=B.nodeValue.replace(/\\uFEFF/g,\"\")}});while(u=l.get(n.id+\"_\"+A)){l.remove(u,1)}if(y&&x&&y.nodeType==x.nodeType&&y.nodeType==3&&!c.isOpera){t=y.nodeValue.length;y.appendData(x.nodeValue);l.remove(x);if(A==\"start\"){j=s=y;o=p=t}else{s=y;p=t}}}}}function m(t){if(l.isBlock(t)&&!t.innerHTML){t.innerHTML=!a?'<br data-mce-bogus=\"1\" />':\" \"}return t}k(\"start\");k(\"end\");if(j){f=l.createRng();f.setStart(m(j),o);f.setEnd(m(s),p);r.setRng(f)}}else{if(n.name){r.select(l.select(n.name)[n.index])}else{if(n.rng){r.setRng(n.rng)}}}}}},select:function(k,j){var i=this,l=i.dom,g=l.createRng(),f;if(k){f=l.nodeIndex(k);g.setStart(k.parentNode,f);g.setEnd(k.parentNode,f+1);if(j){function h(m,o){var n=new c.dom.TreeWalker(m,m);do{if(m.nodeType==3&&c.trim(m.nodeValue).length!=0){if(o){g.setStart(m,0)}else{g.setEnd(m,m.nodeValue.length)}return}if(m.nodeName==\"BR\"){if(o){g.setStartBefore(m)}else{g.setEndBefore(m)}return}}while(m=(o?n.next():n.prev()))}h(k,1);h(k)}i.setRng(g)}return k},isCollapsed:function(){var f=this,h=f.getRng(),g=f.getSel();if(!h||h.item){return false}if(h.compareEndPoints){return h.compareEndPoints(\"StartToEnd\",h)===0}return !g||h.collapsed},collapse:function(f){var h=this,g=h.getRng(),i;if(g.item){i=g.item(0);g=h.win.document.body.createTextRange();g.moveToElementText(i)}g.collapse(!!f);h.setRng(g)},getSel:function(){var g=this,f=this.win;return f.getSelection?f.getSelection():f.document.selection},getRng:function(l){var g=this,h,i,k,j=g.win.document;if(l&&g.tridentSel){return g.tridentSel.getRangeAt(0)}try{if(h=g.getSel()){i=h.rangeCount>0?h.getRangeAt(0):(h.createRange?h.createRange():j.createRange())}}catch(f){}if(c.isIE&&i&&i.setStart&&j.selection.createRange().item){k=j.selection.createRange().item(0);i=j.createRange();i.setStartBefore(k);i.setEndAfter(k)}if(!i){i=j.createRange?j.createRange():j.body.createTextRange()}if(g.selectedRange&&g.explicitRange){if(i.compareBoundaryPoints(i.START_TO_START,g.selectedRange)===0&&i.compareBoundaryPoints(i.END_TO_END,g.selectedRange)===0){i=g.explicitRange}else{g.selectedRange=null;g.explicitRange=null}}return i},setRng:function(i){var h,g=this;if(!g.tridentSel){h=g.getSel();if(h){g.explicitRange=i;try{h.removeAllRanges()}catch(f){}h.addRange(i);g.selectedRange=h.getRangeAt(0)}}else{if(i.cloneRange){g.tridentSel.addRange(i);return}try{i.select()}catch(f){}}},setNode:function(g){var f=this;f.setContent(f.dom.getOuterHTML(g));return g},getNode:function(){var h=this,g=h.getRng(),i=h.getSel(),l,k=g.startContainer,f=g.endContainer;if(!g){return h.dom.getRoot()}if(g.setStart){l=g.commonAncestorContainer;if(!g.collapsed){if(g.startContainer==g.endContainer){if(g.endOffset-g.startOffset<2){if(g.startContainer.hasChildNodes()){l=g.startContainer.childNodes[g.startOffset]}}}if(k.nodeType===3&&f.nodeType===3){function j(p,m){var o=p;while(p&&p.nodeType===3&&p.length===0){p=m?p.nextSibling:p.previousSibling}return p||o}if(k.length===g.startOffset){k=j(k.nextSibling,true)}else{k=k.parentNode}if(g.endOffset===0){f=j(f.previousSibling,false)}else{f=f.parentNode}if(k&&k===f){return k}}}if(l&&l.nodeType==3){return l.parentNode}return l}return g.item?g.item(0):g.parentElement()},getSelectedBlocks:function(o,g){var m=this,j=m.dom,l,k,h,i=[];l=j.getParent(o||m.getStart(),j.isBlock);k=j.getParent(g||m.getEnd(),j.isBlock);if(l){i.push(l)}if(l&&k&&l!=k){h=l;var f=new c.dom.TreeWalker(l,j.getRoot());while((h=f.next())&&h!=k){if(j.isBlock(h)){i.push(h)}}}if(k&&l!=k){i.push(k)}return i},normalize:function(){var g=this,f,i;if(c.isIE){return}function h(p){var k,o,n,m=g.dom,j=m.getRoot(),l;k=f[(p?\"start\":\"end\")+\"Container\"];o=f[(p?\"start\":\"end\")+\"Offset\"];if(k.nodeType===9){k=k.body;o=0}if(k===j){if(k.hasChildNodes()){k=k.childNodes[Math.min(!p&&o>0?o-1:o,k.childNodes.length-1)];o=0;if(k.hasChildNodes()){l=k;n=new c.dom.TreeWalker(k,j);do{if(l.nodeType===3){o=p?0:l.nodeValue.length-1;k=l;break}if(l.nodeName===\"BR\"){o=m.nodeIndex(l);k=l.parentNode;break}}while(l=(p?n.next():n.prev()));i=true}}}if(i){f[\"set\"+(p?\"Start\":\"End\")](k,o)}}f=g.getRng();h(true);if(f.collapsed){h()}if(i){g.setRng(f)}},destroy:function(g){var f=this;f.win=null;if(!g){c.removeUnload(f.destroy)}},_fixIESelection:function(){var g=this.dom,m=g.doc,h=m.body,j,n,f;m.documentElement.unselectable=true;function i(o,r){var p=h.createTextRange();try{p.moveToPoint(o,r)}catch(q){p=null}return p}function l(p){var o;if(p.button){o=i(p.x,p.y);if(o){if(o.compareEndPoints(\"StartToStart\",n)>0){o.setEndPoint(\"StartToStart\",n)}else{o.setEndPoint(\"EndToEnd\",n)}o.select()}}else{k()}}function k(){var o=m.selection.createRange();if(n&&!o.item&&o.compareEndPoints(\"StartToEnd\",o)===0){n.select()}g.unbind(m,\"mouseup\",k);g.unbind(m,\"mousemove\",l);n=j=0}g.bind(m,[\"mousedown\",\"contextmenu\"],function(o){if(o.target.nodeName===\"HTML\"){if(j){k()}f=m.documentElement;if(f.scrollHeight>f.clientHeight){return}j=1;n=i(o.x,o.y);if(n){g.bind(m,\"mouseup\",k);g.bind(m,\"mousemove\",l);g.win.focus();n.select()}}})}})})(tinymce);(function(a){a.dom.Serializer=function(e,i,f){var h,b,d=a.isIE,g=a.each,c;if(!e.apply_source_formatting){e.indent=false}e.remove_trailing_brs=true;i=i||a.DOM;f=f||new a.html.Schema(e);e.entity_encoding=e.entity_encoding||\"named\";h=new a.util.Dispatcher(self);b=new a.util.Dispatcher(self);c=new a.html.DomParser(e,f);c.addAttributeFilter(\"src,href,style\",function(k,j){var o=k.length,l,q,n=\"data-mce-\"+j,p=e.url_converter,r=e.url_converter_scope,m;while(o--){l=k[o];q=l.attributes.map[n];if(q!==m){l.attr(j,q.length>0?q:null);l.attr(n,null)}else{q=l.attributes.map[j];if(j===\"style\"){q=i.serializeStyle(i.parseStyle(q),l.name)}else{if(p){q=p.call(r,q,j,l.name)}}l.attr(j,q.length>0?q:null)}}});c.addAttributeFilter(\"class\",function(j,k){var l=j.length,m,n;while(l--){m=j[l];n=m.attr(\"class\").replace(/\\s*mce(Item\\w+|Selected)\\s*/g,\"\");m.attr(\"class\",n.length>0?n:null)}});c.addAttributeFilter(\"data-mce-type\",function(j,l,k){var m=j.length,n;while(m--){n=j[m];if(n.attributes.map[\"data-mce-type\"]===\"bookmark\"&&!k.cleanup){n.remove()}}});c.addNodeFilter(\"script,style\",function(k,l){var m=k.length,n,o;function j(p){return p.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g,\"\\n\").replace(/^[\\r\\n]*|[\\r\\n]*$/g,\"\").replace(/^\\s*(\\/\\/\\s*<!--|\\/\\/\\s*<!\\[CDATA\\[|<!--|<!\\[CDATA\\[)[\\r\\n]*/g,\"\").replace(/\\s*(\\/\\/\\s*\\]\\]>|\\/\\/\\s*-->|\\]\\]>|-->|\\]\\]-->)\\s*$/g,\"\")}while(m--){n=k[m];o=n.firstChild?n.firstChild.value:\"\";if(l===\"script\"){n.attr(\"type\",(n.attr(\"type\")||\"text/javascript\").replace(/^mce\\-/,\"\"));if(o.length>0){n.firstChild.value=\"// <![CDATA[\\n\"+j(o)+\"\\n// ]]>\"}}else{if(o.length>0){n.firstChild.value=\"<!--\\n\"+j(o)+\"\\n-->\"}}}});c.addNodeFilter(\"#comment\",function(j,k){var l=j.length,m;while(l--){m=j[l];if(m.value.indexOf(\"[CDATA[\")===0){m.name=\"#cdata\";m.type=4;m.value=m.value.replace(/^\\[CDATA\\[|\\]\\]$/g,\"\")}else{if(m.value.indexOf(\"mce:protected \")===0){m.name=\"#text\";m.type=3;m.raw=true;m.value=unescape(m.value).substr(14)}}}});c.addNodeFilter(\"xml:namespace,input\",function(j,k){var l=j.length,m;while(l--){m=j[l];if(m.type===7){m.remove()}else{if(m.type===1){if(k===\"input\"&&!(\"type\" in m.attributes.map)){m.attr(\"type\",\"text\")}}}}});if(e.fix_list_elements){c.addNodeFilter(\"ul,ol\",function(k,l){var m=k.length,n,j;while(m--){n=k[m];j=n.parent;if(j.name===\"ul\"||j.name===\"ol\"){if(n.prev&&n.prev.name===\"li\"){n.prev.append(n)}}}})}c.addAttributeFilter(\"data-mce-src,data-mce-href,data-mce-style\",function(j,k){var l=j.length;while(l--){j[l].attr(k,null)}});return{schema:f,addNodeFilter:c.addNodeFilter,addAttributeFilter:c.addAttributeFilter,onPreProcess:h,onPostProcess:b,serialize:function(o,m){var l,p,k,j,n;if(d&&i.select(\"script,style,select,map\").length>0){n=o.innerHTML;o=o.cloneNode(false);i.setHTML(o,n)}else{o=o.cloneNode(true)}l=o.ownerDocument.implementation;if(l.createHTMLDocument){p=l.createHTMLDocument(\"\");g(o.nodeName==\"BODY\"?o.childNodes:[o],function(q){p.body.appendChild(p.importNode(q,true))});if(o.nodeName!=\"BODY\"){o=p.body.firstChild}else{o=p.body}k=i.doc;i.doc=p}m=m||{};m.format=m.format||\"html\";if(!m.no_events){m.node=o;h.dispatch(self,m)}j=new a.html.Serializer(e,f);m.content=j.serialize(c.parse(m.getInner?o.innerHTML:a.trim(i.getOuterHTML(o),m),m));if(!m.cleanup){m.content=m.content.replace(/\\uFEFF|\\u200B/g,\"\")}if(!m.no_events){b.dispatch(self,m)}if(k){i.doc=k}m.node=null;return m.content},addRules:function(j){f.addValidElements(j)},setRules:function(j){f.setValidElements(j)}}}})(tinymce);(function(a){a.dom.ScriptLoader=function(h){var c=0,k=1,i=2,l={},j=[],f={},d=[],g=0,e;function b(m,v){var x=this,q=a.DOM,s,o,r,n;function p(){q.remove(n);if(s){s.onreadystatechange=s.onload=s=null}v()}function u(){if(typeof(console)!==\"undefined\"&&console.log){console.log(\"Failed to load: \"+m)}}n=q.uniqueId();if(a.isIE6){o=new a.util.URI(m);r=location;if(o.host==r.hostname&&o.port==r.port&&(o.protocol+\":\")==r.protocol&&o.protocol.toLowerCase()!=\"file\"){a.util.XHR.send({url:a._addVer(o.getURI()),success:function(y){var t=q.create(\"script\",{type:\"text/javascript\"});t.text=y;document.getElementsByTagName(\"head\")[0].appendChild(t);q.remove(t);p()},error:u});return}}s=q.create(\"script\",{id:n,type:\"text/javascript\",src:a._addVer(m)});if(!a.isIE){s.onload=p}s.onerror=u;if(!a.isOpera){s.onreadystatechange=function(){var t=s.readyState;if(t==\"complete\"||t==\"loaded\"){p()}}}(document.getElementsByTagName(\"head\")[0]||document.body).appendChild(s)}this.isDone=function(m){return l[m]==i};this.markDone=function(m){l[m]=i};this.add=this.load=function(m,q,n){var o,p=l[m];if(p==e){j.push(m);l[m]=c}if(q){if(!f[m]){f[m]=[]}f[m].push({func:q,scope:n||this})}};this.loadQueue=function(n,m){this.loadScripts(j,n,m)};this.loadScripts=function(m,q,p){var o;function n(r){a.each(f[r],function(s){s.func.call(s.scope)});f[r]=e}d.push({func:q,scope:p||this});o=function(){var r=a.grep(m);m.length=0;a.each(r,function(s){if(l[s]==i){n(s);return}if(l[s]!=k){l[s]=k;g++;b(s,function(){l[s]=i;g--;n(s);o()})}});if(!g){a.each(d,function(s){s.func.call(s.scope)});d.length=0}};o()}};a.ScriptLoader=new a.dom.ScriptLoader()})(tinymce);tinymce.dom.TreeWalker=function(a,c){var b=a;function d(i,f,e,j){var h,g;if(i){if(!j&&i[f]){return i[f]}if(i!=c){h=i[e];if(h){return h}for(g=i.parentNode;g&&g!=c;g=g.parentNode){h=g[e];if(h){return h}}}}}this.current=function(){return b};this.next=function(e){return(b=d(b,\"firstChild\",\"nextSibling\",e))};this.prev=function(e){return(b=d(b,\"lastChild\",\"previousSibling\",e))}};(function(a){a.dom.RangeUtils=function(c){var b=\"\\uFEFF\";this.walk=function(d,s){var i=d.startContainer,l=d.startOffset,t=d.endContainer,m=d.endOffset,j,g,o,h,r,q,e;e=c.select(\"td.mceSelected,th.mceSelected\");if(e.length>0){a.each(e,function(u){s([u])});return}function f(u){var v;v=u[0];if(v.nodeType===3&&v===i&&l>=v.nodeValue.length){u.splice(0,1)}v=u[u.length-1];if(m===0&&u.length>0&&v===t&&v.nodeType===3){u.splice(u.length-1,1)}return u}function p(x,v,u){var y=[];for(;x&&x!=u;x=x[v]){y.push(x)}return y}function n(v,u){do{if(v.parentNode==u){return v}v=v.parentNode}while(v)}function k(x,v,y){var u=y?\"nextSibling\":\"previousSibling\";for(h=x,r=h.parentNode;h&&h!=v;h=r){r=h.parentNode;q=p(h==x?h:h[u],u);if(q.length){if(!y){q.reverse()}s(f(q))}}}if(i.nodeType==1&&i.hasChildNodes()){i=i.childNodes[l]}if(t.nodeType==1&&t.hasChildNodes()){t=t.childNodes[Math.min(m-1,t.childNodes.length-1)]}if(i==t){return s(f([i]))}j=c.findCommonAncestor(i,t);for(h=i;h;h=h.parentNode){if(h===t){return k(i,j,true)}if(h===j){break}}for(h=t;h;h=h.parentNode){if(h===i){return k(t,j)}if(h===j){break}}g=n(i,j)||i;o=n(t,j)||t;k(i,g,true);q=p(g==i?g:g.nextSibling,\"nextSibling\",o==t?o.nextSibling:o);if(q.length){s(f(q))}k(t,o)};this.split=function(e){var h=e.startContainer,d=e.startOffset,i=e.endContainer,g=e.endOffset;function f(j,k){return j.splitText(k)}if(h==i&&h.nodeType==3){if(d>0&&d<h.nodeValue.length){i=f(h,d);h=i.previousSibling;if(g>d){g=g-d;h=i=f(i,g).previousSibling;g=i.nodeValue.length;d=0}else{g=0}}}else{if(h.nodeType==3&&d>0&&d<h.nodeValue.length){h=f(h,d);d=0}if(i.nodeType==3&&g>0&&g<i.nodeValue.length){i=f(i,g).previousSibling;g=i.nodeValue.length}}return{startContainer:h,startOffset:d,endContainer:i,endOffset:g}}};a.dom.RangeUtils.compareRanges=function(c,b){if(c&&b){if(c.item||c.duplicate){if(c.item&&b.item&&c.item(0)===b.item(0)){return true}if(c.isEqual&&b.isEqual&&b.isEqual(c)){return true}}else{return c.startContainer==b.startContainer&&c.startOffset==b.startOffset}}return false}})(tinymce);(function(b){var a=b.dom.Event,c=b.each;b.create(\"tinymce.ui.KeyboardNavigation\",{KeyboardNavigation:function(e,f){var p=this,m=e.root,l=e.items,n=e.enableUpDown,i=e.enableLeftRight||!e.enableUpDown,k=e.excludeFromTabOrder,j,h,o,d,g;f=f||b.DOM;j=function(q){g=q.target.id};h=function(q){f.setAttrib(q.target.id,\"tabindex\",\"-1\")};d=function(q){var r=f.get(g);f.setAttrib(r,\"tabindex\",\"0\");r.focus()};p.focus=function(){f.get(g).focus()};p.destroy=function(){c(l,function(q){f.unbind(f.get(q.id),\"focus\",j);f.unbind(f.get(q.id),\"blur\",h)});f.unbind(f.get(m),\"focus\",d);f.unbind(f.get(m),\"keydown\",o);l=f=m=p.focus=j=h=o=d=null;p.destroy=function(){}};p.moveFocus=function(u,r){var q=-1,t=p.controls,s;if(!g){return}c(l,function(x,v){if(x.id===g){q=v;return false}});q+=u;if(q<0){q=l.length-1}else{if(q>=l.length){q=0}}s=l[q];f.setAttrib(g,\"tabindex\",\"-1\");f.setAttrib(s.id,\"tabindex\",\"0\");f.get(s.id).focus();if(e.actOnFocus){e.onAction(s.id)}if(r){a.cancel(r)}};o=function(y){var u=37,t=39,x=38,z=40,q=27,s=14,r=13,v=32;switch(y.keyCode){case u:if(i){p.moveFocus(-1)}break;case t:if(i){p.moveFocus(1)}break;case x:if(n){p.moveFocus(-1)}break;case z:if(n){p.moveFocus(1)}break;case q:if(e.onCancel){e.onCancel();a.cancel(y)}break;case s:case r:case v:if(e.onAction){e.onAction(g);a.cancel(y)}break}};c(l,function(s,q){var r;if(!s.id){s.id=f.uniqueId(\"_mce_item_\")}if(k){f.bind(s.id,\"blur\",h);r=\"-1\"}else{r=(q===0?\"0\":\"-1\")}f.setAttrib(s.id,\"tabindex\",r);f.bind(f.get(s.id),\"focus\",j)});if(l[0]){g=l[0].id}f.setAttrib(m,\"tabindex\",\"-1\");f.bind(f.get(m),\"focus\",d);f.bind(f.get(m),\"keydown\",o)}})})(tinymce);(function(c){var b=c.DOM,a=c.is;c.create(\"tinymce.ui.Control\",{Control:function(f,e,d){this.id=f;this.settings=e=e||{};this.rendered=false;this.onRender=new c.util.Dispatcher(this);this.classPrefix=\"\";this.scope=e.scope||this;this.disabled=0;this.active=0;this.editor=d},setAriaProperty:function(f,e){var d=b.get(this.id+\"_aria\")||b.get(this.id);if(d){b.setAttrib(d,\"aria-\"+f,!!e)}},focus:function(){b.get(this.id).focus()},setDisabled:function(d){if(d!=this.disabled){this.setAriaProperty(\"disabled\",d);this.setState(\"Disabled\",d);this.setState(\"Enabled\",!d);this.disabled=d}},isDisabled:function(){return this.disabled},setActive:function(d){if(d!=this.active){this.setState(\"Active\",d);this.active=d;this.setAriaProperty(\"pressed\",d)}},isActive:function(){return this.active},setState:function(f,d){var e=b.get(this.id);f=this.classPrefix+f;if(d){b.addClass(e,f)}else{b.removeClass(e,f)}},isRendered:function(){return this.rendered},renderHTML:function(){},renderTo:function(d){b.setHTML(d,this.renderHTML())},postRender:function(){var e=this,d;if(a(e.disabled)){d=e.disabled;e.disabled=-1;e.setDisabled(d)}if(a(e.active)){d=e.active;e.active=-1;e.setActive(d)}},remove:function(){b.remove(this.id);this.destroy()},destroy:function(){c.dom.Event.clear(this.id)}})})(tinymce);tinymce.create(\"tinymce.ui.Container:tinymce.ui.Control\",{Container:function(c,b,a){this.parent(c,b,a);this.controls=[];this.lookup={}},add:function(a){this.lookup[a.id]=a;this.controls.push(a);return a},get:function(a){return this.lookup[a]}});tinymce.create(\"tinymce.ui.Separator:tinymce.ui.Control\",{Separator:function(b,a){this.parent(b,a);this.classPrefix=\"mceSeparator\";this.setDisabled(true)},renderHTML:function(){return tinymce.DOM.createHTML(\"span\",{\"class\":this.classPrefix,role:\"separator\",\"aria-orientation\":\"vertical\",tabindex:\"-1\"})}});(function(d){var c=d.is,b=d.DOM,e=d.each,a=d.walk;d.create(\"tinymce.ui.MenuItem:tinymce.ui.Control\",{MenuItem:function(g,f){this.parent(g,f);this.classPrefix=\"mceMenuItem\"},setSelected:function(f){this.setState(\"Selected\",f);this.setAriaProperty(\"checked\",!!f);this.selected=f},isSelected:function(){return this.selected},postRender:function(){var f=this;f.parent();if(c(f.selected)){f.setSelected(f.selected)}}})})(tinymce);(function(d){var c=d.is,b=d.DOM,e=d.each,a=d.walk;d.create(\"tinymce.ui.Menu:tinymce.ui.MenuItem\",{Menu:function(h,g){var f=this;f.parent(h,g);f.items={};f.collapsed=false;f.menuCount=0;f.onAddItem=new d.util.Dispatcher(this)},expand:function(g){var f=this;if(g){a(f,function(h){if(h.expand){h.expand()}},\"items\",f)}f.collapsed=false},collapse:function(g){var f=this;if(g){a(f,function(h){if(h.collapse){h.collapse()}},\"items\",f)}f.collapsed=true},isCollapsed:function(){return this.collapsed},add:function(f){if(!f.settings){f=new d.ui.MenuItem(f.id||b.uniqueId(),f)}this.onAddItem.dispatch(this,f);return this.items[f.id]=f},addSeparator:function(){return this.add({separator:true})},addMenu:function(f){if(!f.collapse){f=this.createMenu(f)}this.menuCount++;return this.add(f)},hasMenus:function(){return this.menuCount!==0},remove:function(f){delete this.items[f.id]},removeAll:function(){var f=this;a(f,function(g){if(g.removeAll){g.removeAll()}else{g.remove()}g.destroy()},\"items\",f);f.items={}},createMenu:function(g){var f=new d.ui.Menu(g.id||b.uniqueId(),g);f.onAddItem.add(this.onAddItem.dispatch,this.onAddItem);return f}})})(tinymce);(function(e){var d=e.is,c=e.DOM,f=e.each,a=e.dom.Event,b=e.dom.Element;e.create(\"tinymce.ui.DropMenu:tinymce.ui.Menu\",{DropMenu:function(h,g){g=g||{};g.container=g.container||c.doc.body;g.offset_x=g.offset_x||0;g.offset_y=g.offset_y||0;g.vp_offset_x=g.vp_offset_x||0;g.vp_offset_y=g.vp_offset_y||0;if(d(g.icons)&&!g.icons){g[\"class\"]+=\" mceNoIcons\"}this.parent(h,g);this.onShowMenu=new e.util.Dispatcher(this);this.onHideMenu=new e.util.Dispatcher(this);this.classPrefix=\"mceMenu\"},createMenu:function(j){var h=this,i=h.settings,g;j.container=j.container||i.container;j.parent=h;j.constrain=j.constrain||i.constrain;j[\"class\"]=j[\"class\"]||i[\"class\"];j.vp_offset_x=j.vp_offset_x||i.vp_offset_x;j.vp_offset_y=j.vp_offset_y||i.vp_offset_y;j.keyboard_focus=i.keyboard_focus;g=new e.ui.DropMenu(j.id||c.uniqueId(),j);g.onAddItem.add(h.onAddItem.dispatch,h.onAddItem);return g},focus:function(){var g=this;if(g.keyboardNav){g.keyboardNav.focus()}},update:function(){var i=this,j=i.settings,g=c.get(\"menu_\"+i.id+\"_tbl\"),l=c.get(\"menu_\"+i.id+\"_co\"),h,k;h=j.max_width?Math.min(g.clientWidth,j.max_width):g.clientWidth;k=j.max_height?Math.min(g.clientHeight,j.max_height):g.clientHeight;if(!c.boxModel){i.element.setStyles({width:h+2,height:k+2})}else{i.element.setStyles({width:h,height:k})}if(j.max_width){c.setStyle(l,\"width\",h)}if(j.max_height){c.setStyle(l,\"height\",k);if(g.clientHeight<j.max_height){c.setStyle(l,\"overflow\",\"hidden\")}}},showMenu:function(p,n,r){var z=this,A=z.settings,o,g=c.getViewPort(),u,l,v,q,i=2,k,j,m=z.classPrefix;z.collapse(1);if(z.isMenuVisible){return}if(!z.rendered){o=c.add(z.settings.container,z.renderNode());f(z.items,function(h){h.postRender()});z.element=new b(\"menu_\"+z.id,{blocker:1,container:A.container})}else{o=c.get(\"menu_\"+z.id)}if(!e.isOpera){c.setStyles(o,{left:-65535,top:-65535})}c.show(o);z.update();p+=A.offset_x||0;n+=A.offset_y||0;g.w-=4;g.h-=4;if(A.constrain){u=o.clientWidth-i;l=o.clientHeight-i;v=g.x+g.w;q=g.y+g.h;if((p+A.vp_offset_x+u)>v){p=r?r-u:Math.max(0,(v-A.vp_offset_x)-u)}if((n+A.vp_offset_y+l)>q){n=Math.max(0,(q-A.vp_offset_y)-l)}}c.setStyles(o,{left:p,top:n});z.element.update();z.isMenuVisible=1;z.mouseClickFunc=a.add(o,\"click\",function(s){var h;s=s.target;if(s&&(s=c.getParent(s,\"tr\"))&&!c.hasClass(s,m+\"ItemSub\")){h=z.items[s.id];if(h.isDisabled()){return}k=z;while(k){if(k.hideMenu){k.hideMenu()}k=k.settings.parent}if(h.settings.onclick){h.settings.onclick(s)}return a.cancel(s)}});if(z.hasMenus()){z.mouseOverFunc=a.add(o,\"mouseover\",function(x){var h,t,s;x=x.target;if(x&&(x=c.getParent(x,\"tr\"))){h=z.items[x.id];if(z.lastMenu){z.lastMenu.collapse(1)}if(h.isDisabled()){return}if(x&&c.hasClass(x,m+\"ItemSub\")){t=c.getRect(x);h.showMenu((t.x+t.w-i),t.y-i,t.x);z.lastMenu=h;c.addClass(c.get(h.id).firstChild,m+\"ItemActive\")}}})}a.add(o,\"keydown\",z._keyHandler,z);z.onShowMenu.dispatch(z);if(A.keyboard_focus){z._setupKeyboardNav()}},hideMenu:function(j){var g=this,i=c.get(\"menu_\"+g.id),h;if(!g.isMenuVisible){return}if(g.keyboardNav){g.keyboardNav.destroy()}a.remove(i,\"mouseover\",g.mouseOverFunc);a.remove(i,\"click\",g.mouseClickFunc);a.remove(i,\"keydown\",g._keyHandler);c.hide(i);g.isMenuVisible=0;if(!j){g.collapse(1)}if(g.element){g.element.hide()}if(h=c.get(g.id)){c.removeClass(h.firstChild,g.classPrefix+\"ItemActive\")}g.onHideMenu.dispatch(g)},add:function(i){var g=this,h;i=g.parent(i);if(g.isRendered&&(h=c.get(\"menu_\"+g.id))){g._add(c.select(\"tbody\",h)[0],i)}return i},collapse:function(g){this.parent(g);this.hideMenu(1)},remove:function(g){c.remove(g.id);this.destroy();return this.parent(g)},destroy:function(){var g=this,h=c.get(\"menu_\"+g.id);if(g.keyboardNav){g.keyboardNav.destroy()}a.remove(h,\"mouseover\",g.mouseOverFunc);a.remove(c.select(\"a\",h),\"focus\",g.mouseOverFunc);a.remove(h,\"click\",g.mouseClickFunc);a.remove(h,\"keydown\",g._keyHandler);if(g.element){g.element.remove()}c.remove(h)},renderNode:function(){var i=this,j=i.settings,l,h,k,g;g=c.create(\"div\",{role:\"listbox\",id:\"menu_\"+i.id,\"class\":j[\"class\"],style:\"position:absolute;left:0;top:0;z-index:200000;outline:0\"});if(i.settings.parent){c.setAttrib(g,\"aria-parent\",\"menu_\"+i.settings.parent.id)}k=c.add(g,\"div\",{role:\"presentation\",id:\"menu_\"+i.id+\"_co\",\"class\":i.classPrefix+(j[\"class\"]?\" \"+j[\"class\"]:\"\")});i.element=new b(\"menu_\"+i.id,{blocker:1,container:j.container});if(j.menu_line){c.add(k,\"span\",{\"class\":i.classPrefix+\"Line\"})}l=c.add(k,\"table\",{role:\"presentation\",id:\"menu_\"+i.id+\"_tbl\",border:0,cellPadding:0,cellSpacing:0});h=c.add(l,\"tbody\");f(i.items,function(m){i._add(h,m)});i.rendered=true;return g},_setupKeyboardNav:function(){var i,h,g=this;i=c.select(\"#menu_\"+g.id)[0];h=c.select(\"a[role=option]\",\"menu_\"+g.id);h.splice(0,0,i);g.keyboardNav=new e.ui.KeyboardNavigation({root:\"menu_\"+g.id,items:h,onCancel:function(){g.hideMenu()},enableUpDown:true});i.focus()},_keyHandler:function(g){var h=this,i;switch(g.keyCode){case 37:if(h.settings.parent){h.hideMenu();h.settings.parent.focus();a.cancel(g)}break;case 39:if(h.mouseOverFunc){h.mouseOverFunc(g)}break}},_add:function(j,h){var i,q=h.settings,p,l,k,m=this.classPrefix,g;if(q.separator){l=c.add(j,\"tr\",{id:h.id,\"class\":m+\"ItemSeparator\"});c.add(l,\"td\",{\"class\":m+\"ItemSeparator\"});if(i=l.previousSibling){c.addClass(i,\"mceLast\")}return}i=l=c.add(j,\"tr\",{id:h.id,\"class\":m+\"Item \"+m+\"ItemEnabled\"});i=k=c.add(i,q.titleItem?\"th\":\"td\");i=p=c.add(i,\"a\",{id:h.id+\"_aria\",role:q.titleItem?\"presentation\":\"option\",href:\"javascript:;\",onclick:\"return false;\",onmousedown:\"return false;\"});if(q.parent){c.setAttrib(p,\"aria-haspopup\",\"true\");c.setAttrib(p,\"aria-owns\",\"menu_\"+h.id)}c.addClass(k,q[\"class\"]);g=c.add(i,\"span\",{\"class\":\"mceIcon\"+(q.icon?\" mce_\"+q.icon:\"\")});if(q.icon_src){c.add(g,\"img\",{src:q.icon_src})}i=c.add(i,q.element||\"span\",{\"class\":\"mceText\",title:h.settings.title},h.settings.title);if(h.settings.style){c.setAttrib(i,\"style\",h.settings.style)}if(j.childNodes.length==1){c.addClass(l,\"mceFirst\")}if((i=l.previousSibling)&&c.hasClass(i,m+\"ItemSeparator\")){c.addClass(l,\"mceFirst\")}if(h.collapse){c.addClass(l,m+\"ItemSub\")}if(i=l.previousSibling){c.removeClass(i,\"mceLast\")}c.addClass(l,\"mceLast\")}})})(tinymce);(function(b){var a=b.DOM;b.create(\"tinymce.ui.Button:tinymce.ui.Control\",{Button:function(e,d,c){this.parent(e,d,c);this.classPrefix=\"mceButton\"},renderHTML:function(){var f=this.classPrefix,e=this.settings,d,c;c=a.encode(e.label||\"\");d='<a role=\"button\" id=\"'+this.id+'\" href=\"javascript:;\" class=\"'+f+\" \"+f+\"Enabled \"+e[\"class\"]+(c?\" \"+f+\"Labeled\":\"\")+'\" onmousedown=\"return false;\" onclick=\"return false;\" aria-labelledby=\"'+this.id+'_voice\" title=\"'+a.encode(e.title)+'\">';if(e.image&&!(this.editor&&this.editor.forcedHighContrastMode)){d+='<img class=\"mceIcon\" src=\"'+e.image+'\" alt=\"'+a.encode(e.title)+'\" />'+c}else{d+='<span class=\"mceIcon '+e[\"class\"]+'\"></span>'+(c?'<span class=\"'+f+'Label\">'+c+\"</span>\":\"\")}d+='<span class=\"mceVoiceLabel mceIconOnly\" style=\"display: none;\" id=\"'+this.id+'_voice\">'+e.title+\"</span>\";d+=\"</a>\";return d},postRender:function(){var c=this,d=c.settings;b.dom.Event.add(c.id,\"click\",function(f){if(!c.isDisabled()){return d.onclick.call(d.scope,f)}})}})})(tinymce);(function(d){var c=d.DOM,b=d.dom.Event,e=d.each,a=d.util.Dispatcher;d.create(\"tinymce.ui.ListBox:tinymce.ui.Control\",{ListBox:function(i,h,f){var g=this;g.parent(i,h,f);g.items=[];g.onChange=new a(g);g.onPostRender=new a(g);g.onAdd=new a(g);g.onRenderMenu=new d.util.Dispatcher(this);g.classPrefix=\"mceListBox\"},select:function(h){var g=this,j,i;if(h==undefined){return g.selectByIndex(-1)}if(h&&h.call){i=h}else{i=function(f){return f==h}}if(h!=g.selectedValue){e(g.items,function(k,f){if(i(k.value)){j=1;g.selectByIndex(f);return false}});if(!j){g.selectByIndex(-1)}}},selectByIndex:function(f){var h=this,i,j,g;if(f!=h.selectedIndex){i=c.get(h.id+\"_text\");g=c.get(h.id+\"_voiceDesc\");j=h.items[f];if(j){h.selectedValue=j.value;h.selectedIndex=f;c.setHTML(i,c.encode(j.title));c.setHTML(g,h.settings.title+\" - \"+j.title);c.removeClass(i,\"mceTitle\");c.setAttrib(h.id,\"aria-valuenow\",j.title)}else{c.setHTML(i,c.encode(h.settings.title));c.setHTML(g,c.encode(h.settings.title));c.addClass(i,\"mceTitle\");h.selectedValue=h.selectedIndex=null;c.setAttrib(h.id,\"aria-valuenow\",h.settings.title)}i=0}},add:function(i,f,h){var g=this;h=h||{};h=d.extend(h,{title:i,value:f});g.items.push(h);g.onAdd.dispatch(g,h)},getLength:function(){return this.items.length},renderHTML:function(){var i=\"\",f=this,g=f.settings,j=f.classPrefix;i='<span role=\"listbox\" aria-haspopup=\"true\" aria-labelledby=\"'+f.id+'_voiceDesc\" aria-describedby=\"'+f.id+'_voiceDesc\"><table role=\"presentation\" tabindex=\"0\" id=\"'+f.id+'\" cellpadding=\"0\" cellspacing=\"0\" class=\"'+j+\" \"+j+\"Enabled\"+(g[\"class\"]?(\" \"+g[\"class\"]):\"\")+'\"><tbody><tr>';i+=\"<td>\"+c.createHTML(\"span\",{id:f.id+\"_voiceDesc\",\"class\":\"voiceLabel\",style:\"display:none;\"},f.settings.title);i+=c.createHTML(\"a\",{id:f.id+\"_text\",tabindex:-1,href:\"javascript:;\",\"class\":\"mceText\",onclick:\"return false;\",onmousedown:\"return false;\"},c.encode(f.settings.title))+\"</td>\";i+=\"<td>\"+c.createHTML(\"a\",{id:f.id+\"_open\",tabindex:-1,href:\"javascript:;\",\"class\":\"mceOpen\",onclick:\"return false;\",onmousedown:\"return false;\"},'<span><span style=\"display:none;\" class=\"mceIconOnly\" aria-hidden=\"true\">\\u25BC</span></span>')+\"</td>\";i+=\"</tr></tbody></table></span>\";return i},showMenu:function(){var g=this,i,h=c.get(this.id),f;if(g.isDisabled()||g.items.length==0){return}if(g.menu&&g.menu.isMenuVisible){return g.hideMenu()}if(!g.isMenuRendered){g.renderMenu();g.isMenuRendered=true}i=c.getPos(h);f=g.menu;f.settings.offset_x=i.x;f.settings.offset_y=i.y;f.settings.keyboard_focus=!d.isOpera;if(g.oldID){f.items[g.oldID].setSelected(0)}e(g.items,function(j){if(j.value===g.selectedValue){f.items[j.id].setSelected(1);g.oldID=j.id}});f.showMenu(0,h.clientHeight);b.add(c.doc,\"mousedown\",g.hideMenu,g);c.addClass(g.id,g.classPrefix+\"Selected\")},hideMenu:function(g){var f=this;if(f.menu&&f.menu.isMenuVisible){c.removeClass(f.id,f.classPrefix+\"Selected\");if(g&&g.type==\"mousedown\"&&(g.target.id==f.id+\"_text\"||g.target.id==f.id+\"_open\")){return}if(!g||!c.getParent(g.target,\".mceMenu\")){c.removeClass(f.id,f.classPrefix+\"Selected\");b.remove(c.doc,\"mousedown\",f.hideMenu,f);f.menu.hideMenu()}}},renderMenu:function(){var g=this,f;f=g.settings.control_manager.createDropMenu(g.id+\"_menu\",{menu_line:1,\"class\":g.classPrefix+\"Menu mceNoIcons\",max_width:150,max_height:150});f.onHideMenu.add(function(){g.hideMenu();g.focus()});f.add({title:g.settings.title,\"class\":\"mceMenuItemTitle\",onclick:function(){if(g.settings.onselect(\"\")!==false){g.select(\"\")}}});e(g.items,function(h){if(h.value===undefined){f.add({title:h.title,role:\"option\",\"class\":\"mceMenuItemTitle\",onclick:function(){if(g.settings.onselect(\"\")!==false){g.select(\"\")}}})}else{h.id=c.uniqueId();h.role=\"option\";h.onclick=function(){if(g.settings.onselect(h.value)!==false){g.select(h.value)}};f.add(h)}});g.onRenderMenu.dispatch(g,f);g.menu=f},postRender:function(){var f=this,g=f.classPrefix;b.add(f.id,\"click\",f.showMenu,f);b.add(f.id,\"keydown\",function(h){if(h.keyCode==32){f.showMenu(h);b.cancel(h)}});b.add(f.id,\"focus\",function(){if(!f._focused){f.keyDownHandler=b.add(f.id,\"keydown\",function(h){if(h.keyCode==40){f.showMenu();b.cancel(h)}});f.keyPressHandler=b.add(f.id,\"keypress\",function(i){var h;if(i.keyCode==13){h=f.selectedValue;f.selectedValue=null;b.cancel(i);f.settings.onselect(h)}})}f._focused=1});b.add(f.id,\"blur\",function(){b.remove(f.id,\"keydown\",f.keyDownHandler);b.remove(f.id,\"keypress\",f.keyPressHandler);f._focused=0});if(d.isIE6||!c.boxModel){b.add(f.id,\"mouseover\",function(){if(!c.hasClass(f.id,g+\"Disabled\")){c.addClass(f.id,g+\"Hover\")}});b.add(f.id,\"mouseout\",function(){if(!c.hasClass(f.id,g+\"Disabled\")){c.removeClass(f.id,g+\"Hover\")}})}f.onPostRender.dispatch(f,c.get(f.id))},destroy:function(){this.parent();b.clear(this.id+\"_text\");b.clear(this.id+\"_open\")}})})(tinymce);(function(d){var c=d.DOM,b=d.dom.Event,e=d.each,a=d.util.Dispatcher;d.create(\"tinymce.ui.NativeListBox:tinymce.ui.ListBox\",{NativeListBox:function(g,f){this.parent(g,f);this.classPrefix=\"mceNativeListBox\"},setDisabled:function(f){c.get(this.id).disabled=f;this.setAriaProperty(\"disabled\",f)},isDisabled:function(){return c.get(this.id).disabled},select:function(h){var g=this,j,i;if(h==undefined){return g.selectByIndex(-1)}if(h&&h.call){i=h}else{i=function(f){return f==h}}if(h!=g.selectedValue){e(g.items,function(k,f){if(i(k.value)){j=1;g.selectByIndex(f);return false}});if(!j){g.selectByIndex(-1)}}},selectByIndex:function(f){c.get(this.id).selectedIndex=f+1;this.selectedValue=this.items[f]?this.items[f].value:null},add:function(j,g,f){var i,h=this;f=f||{};f.value=g;if(h.isRendered()){c.add(c.get(this.id),\"option\",f,j)}i={title:j,value:g,attribs:f};h.items.push(i);h.onAdd.dispatch(h,i)},getLength:function(){return this.items.length},renderHTML:function(){var g,f=this;g=c.createHTML(\"option\",{value:\"\"},\"-- \"+f.settings.title+\" --\");e(f.items,function(h){g+=c.createHTML(\"option\",{value:h.value},h.title)});g=c.createHTML(\"select\",{id:f.id,\"class\":\"mceNativeListBox\",\"aria-labelledby\":f.id+\"_aria\"},g);g+=c.createHTML(\"span\",{id:f.id+\"_aria\",style:\"display: none\"},f.settings.title);return g},postRender:function(){var g=this,h,i=true;g.rendered=true;function f(k){var j=g.items[k.target.selectedIndex-1];if(j&&(j=j.value)){g.onChange.dispatch(g,j);if(g.settings.onselect){g.settings.onselect(j)}}}b.add(g.id,\"change\",f);b.add(g.id,\"keydown\",function(k){var j;b.remove(g.id,\"change\",h);i=false;j=b.add(g.id,\"blur\",function(){if(i){return}i=true;b.add(g.id,\"change\",f);b.remove(g.id,\"blur\",j)});if(d.isWebKit&&(k.keyCode==37||k.keyCode==39)){return b.prevent(k)}if(k.keyCode==13||k.keyCode==32){f(k);return b.cancel(k)}});g.onPostRender.dispatch(g,c.get(g.id))}})})(tinymce);(function(c){var b=c.DOM,a=c.dom.Event,d=c.each;c.create(\"tinymce.ui.MenuButton:tinymce.ui.Button\",{MenuButton:function(g,f,e){this.parent(g,f,e);this.onRenderMenu=new c.util.Dispatcher(this);f.menu_container=f.menu_container||b.doc.body},showMenu:function(){var g=this,j,i,h=b.get(g.id),f;if(g.isDisabled()){return}if(!g.isMenuRendered){g.renderMenu();g.isMenuRendered=true}if(g.isMenuVisible){return g.hideMenu()}j=b.getPos(g.settings.menu_container);i=b.getPos(h);f=g.menu;f.settings.offset_x=i.x;f.settings.offset_y=i.y;f.settings.vp_offset_x=i.x;f.settings.vp_offset_y=i.y;f.settings.keyboard_focus=g._focused;f.showMenu(0,h.clientHeight);a.add(b.doc,\"mousedown\",g.hideMenu,g);g.setState(\"Selected\",1);g.isMenuVisible=1},renderMenu:function(){var f=this,e;e=f.settings.control_manager.createDropMenu(f.id+\"_menu\",{menu_line:1,\"class\":this.classPrefix+\"Menu\",icons:f.settings.icons});e.onHideMenu.add(function(){f.hideMenu();f.focus()});f.onRenderMenu.dispatch(f,e);f.menu=e},hideMenu:function(g){var f=this;if(g&&g.type==\"mousedown\"&&b.getParent(g.target,function(h){return h.id===f.id||h.id===f.id+\"_open\"})){return}if(!g||!b.getParent(g.target,\".mceMenu\")){f.setState(\"Selected\",0);a.remove(b.doc,\"mousedown\",f.hideMenu,f);if(f.menu){f.menu.hideMenu()}}f.isMenuVisible=0},postRender:function(){var e=this,f=e.settings;a.add(e.id,\"click\",function(){if(!e.isDisabled()){if(f.onclick){f.onclick(e.value)}e.showMenu()}})}})})(tinymce);(function(c){var b=c.DOM,a=c.dom.Event,d=c.each;c.create(\"tinymce.ui.SplitButton:tinymce.ui.MenuButton\",{SplitButton:function(g,f,e){this.parent(g,f,e);this.classPrefix=\"mceSplitButton\"},renderHTML:function(){var i,f=this,g=f.settings,e;i=\"<tbody><tr>\";if(g.image){e=b.createHTML(\"img \",{src:g.image,role:\"presentation\",\"class\":\"mceAction \"+g[\"class\"]})}else{e=b.createHTML(\"span\",{\"class\":\"mceAction \"+g[\"class\"]},\"\")}e+=b.createHTML(\"span\",{\"class\":\"mceVoiceLabel mceIconOnly\",id:f.id+\"_voice\",style:\"display:none;\"},g.title);i+=\"<td >\"+b.createHTML(\"a\",{role:\"button\",id:f.id+\"_action\",tabindex:\"-1\",href:\"javascript:;\",\"class\":\"mceAction \"+g[\"class\"],onclick:\"return false;\",onmousedown:\"return false;\",title:g.title},e)+\"</td>\";e=b.createHTML(\"span\",{\"class\":\"mceOpen \"+g[\"class\"]},'<span style=\"display:none;\" class=\"mceIconOnly\" aria-hidden=\"true\">\\u25BC</span>');i+=\"<td >\"+b.createHTML(\"a\",{role:\"button\",id:f.id+\"_open\",tabindex:\"-1\",href:\"javascript:;\",\"class\":\"mceOpen \"+g[\"class\"],onclick:\"return false;\",onmousedown:\"return false;\",title:g.title},e)+\"</td>\";i+=\"</tr></tbody>\";i=b.createHTML(\"table\",{role:\"presentation\",\"class\":\"mceSplitButton mceSplitButtonEnabled \"+g[\"class\"],cellpadding:\"0\",cellspacing:\"0\",title:g.title},i);return b.createHTML(\"div\",{id:f.id,role:\"button\",tabindex:\"0\",\"aria-labelledby\":f.id+\"_voice\",\"aria-haspopup\":\"true\"},i)},postRender:function(){var e=this,g=e.settings,f;if(g.onclick){f=function(h){if(!e.isDisabled()){g.onclick(e.value);a.cancel(h)}};a.add(e.id+\"_action\",\"click\",f);a.add(e.id,[\"click\",\"keydown\"],function(h){var k=32,m=14,i=13,j=38,l=40;if((h.keyCode===32||h.keyCode===13||h.keyCode===14)&&!h.altKey&&!h.ctrlKey&&!h.metaKey){f();a.cancel(h)}else{if(h.type===\"click\"||h.keyCode===l){e.showMenu();a.cancel(h)}}})}a.add(e.id+\"_open\",\"click\",function(h){e.showMenu();a.cancel(h)});a.add([e.id,e.id+\"_open\"],\"focus\",function(){e._focused=1});a.add([e.id,e.id+\"_open\"],\"blur\",function(){e._focused=0});if(c.isIE6||!b.boxModel){a.add(e.id,\"mouseover\",function(){if(!b.hasClass(e.id,\"mceSplitButtonDisabled\")){b.addClass(e.id,\"mceSplitButtonHover\")}});a.add(e.id,\"mouseout\",function(){if(!b.hasClass(e.id,\"mceSplitButtonDisabled\")){b.removeClass(e.id,\"mceSplitButtonHover\")}})}},destroy:function(){this.parent();a.clear(this.id+\"_action\");a.clear(this.id+\"_open\");a.clear(this.id)}})})(tinymce);(function(d){var c=d.DOM,a=d.dom.Event,b=d.is,e=d.each;d.create(\"tinymce.ui.ColorSplitButton:tinymce.ui.SplitButton\",{ColorSplitButton:function(i,h,f){var g=this;g.parent(i,h,f);g.settings=h=d.extend({colors:\"000000,993300,333300,003300,003366,000080,333399,333333,800000,FF6600,808000,008000,008080,0000FF,666699,808080,FF0000,FF9900,99CC00,339966,33CCCC,3366FF,800080,999999,FF00FF,FFCC00,FFFF00,00FF00,00FFFF,00CCFF,993366,C0C0C0,FF99CC,FFCC99,FFFF99,CCFFCC,CCFFFF,99CCFF,CC99FF,FFFFFF\",grid_width:8,default_color:\"#888888\"},g.settings);g.onShowMenu=new d.util.Dispatcher(g);g.onHideMenu=new d.util.Dispatcher(g);g.value=h.default_color},showMenu:function(){var f=this,g,j,i,h;if(f.isDisabled()){return}if(!f.isMenuRendered){f.renderMenu();f.isMenuRendered=true}if(f.isMenuVisible){return f.hideMenu()}i=c.get(f.id);c.show(f.id+\"_menu\");c.addClass(i,\"mceSplitButtonSelected\");h=c.getPos(i);c.setStyles(f.id+\"_menu\",{left:h.x,top:h.y+i.clientHeight,zIndex:200000});i=0;a.add(c.doc,\"mousedown\",f.hideMenu,f);f.onShowMenu.dispatch(f);if(f._focused){f._keyHandler=a.add(f.id+\"_menu\",\"keydown\",function(k){if(k.keyCode==27){f.hideMenu()}});c.select(\"a\",f.id+\"_menu\")[0].focus()}f.isMenuVisible=1},hideMenu:function(g){var f=this;if(f.isMenuVisible){if(g&&g.type==\"mousedown\"&&c.getParent(g.target,function(h){return h.id===f.id+\"_open\"})){return}if(!g||!c.getParent(g.target,\".mceSplitButtonMenu\")){c.removeClass(f.id,\"mceSplitButtonSelected\");a.remove(c.doc,\"mousedown\",f.hideMenu,f);a.remove(f.id+\"_menu\",\"keydown\",f._keyHandler);c.hide(f.id+\"_menu\")}f.isMenuVisible=0;f.onHideMenu.dispatch()}},renderMenu:function(){var p=this,h,k=0,q=p.settings,g,j,l,o,f;o=c.add(q.menu_container,\"div\",{role:\"listbox\",id:p.id+\"_menu\",\"class\":q.menu_class+\" \"+q[\"class\"],style:\"position:absolute;left:0;top:-1000px;\"});h=c.add(o,\"div\",{\"class\":q[\"class\"]+\" mceSplitButtonMenu\"});c.add(h,\"span\",{\"class\":\"mceMenuLine\"});g=c.add(h,\"table\",{role:\"presentation\",\"class\":\"mceColorSplitMenu\"});j=c.add(g,\"tbody\");k=0;e(b(q.colors,\"array\")?q.colors:q.colors.split(\",\"),function(i){i=i.replace(/^#/,\"\");if(!k--){l=c.add(j,\"tr\");k=q.grid_width-1}g=c.add(l,\"td\");g=c.add(g,\"a\",{role:\"option\",href:\"javascript:;\",style:{backgroundColor:\"#\"+i},title:p.editor.getLang(\"colors.\"+i,i),\"data-mce-color\":\"#\"+i});if(p.editor.forcedHighContrastMode){g=c.add(g,\"canvas\",{width:16,height:16,\"aria-hidden\":\"true\"});if(g.getContext&&(f=g.getContext(\"2d\"))){f.fillStyle=\"#\"+i;f.fillRect(0,0,16,16)}else{c.remove(g)}}});if(q.more_colors_func){g=c.add(j,\"tr\");g=c.add(g,\"td\",{colspan:q.grid_width,\"class\":\"mceMoreColors\"});g=c.add(g,\"a\",{role:\"option\",id:p.id+\"_more\",href:\"javascript:;\",onclick:\"return false;\",\"class\":\"mceMoreColors\"},q.more_colors_title);a.add(g,\"click\",function(i){q.more_colors_func.call(q.more_colors_scope||this);return a.cancel(i)})}c.addClass(h,\"mceColorSplitMenu\");new d.ui.KeyboardNavigation({root:p.id+\"_menu\",items:c.select(\"a\",p.id+\"_menu\"),onCancel:function(){p.hideMenu();p.focus()}});a.add(p.id+\"_menu\",\"mousedown\",function(i){return a.cancel(i)});a.add(p.id+\"_menu\",\"click\",function(i){var m;i=c.getParent(i.target,\"a\",j);if(i&&i.nodeName.toLowerCase()==\"a\"&&(m=i.getAttribute(\"data-mce-color\"))){p.setColor(m)}return a.cancel(i)});return o},setColor:function(f){this.displayColor(f);this.hideMenu();this.settings.onselect(f)},displayColor:function(g){var f=this;c.setStyle(f.id+\"_preview\",\"backgroundColor\",g);f.value=g},postRender:function(){var f=this,g=f.id;f.parent();c.add(g+\"_action\",\"div\",{id:g+\"_preview\",\"class\":\"mceColorPreview\"});c.setStyle(f.id+\"_preview\",\"backgroundColor\",f.value)},destroy:function(){this.parent();a.clear(this.id+\"_menu\");a.clear(this.id+\"_more\");c.remove(this.id+\"_menu\")}})})(tinymce);(function(b){var d=b.DOM,c=b.each,a=b.dom.Event;b.create(\"tinymce.ui.ToolbarGroup:tinymce.ui.Container\",{renderHTML:function(){var f=this,i=[],e=f.controls,j=b.each,g=f.settings;i.push('<div id=\"'+f.id+'\" role=\"group\" aria-labelledby=\"'+f.id+'_voice\">');i.push(\"<span role='application'>\");i.push('<span id=\"'+f.id+'_voice\" class=\"mceVoiceLabel\" style=\"display:none;\">'+d.encode(g.name)+\"</span>\");j(e,function(h){i.push(h.renderHTML())});i.push(\"</span>\");i.push(\"</div>\");return i.join(\"\")},focus:function(){var e=this;d.get(e.id).focus()},postRender:function(){var f=this,e=[];c(f.controls,function(g){c(g.controls,function(h){if(h.id){e.push(h)}})});f.keyNav=new b.ui.KeyboardNavigation({root:f.id,items:e,onCancel:function(){if(b.isWebKit){d.get(f.editor.id+\"_ifr\").focus()}f.editor.focus()},excludeFromTabOrder:!f.settings.tab_focus_toolbar})},destroy:function(){var e=this;e.parent();e.keyNav.destroy();a.clear(e.id)}})})(tinymce);(function(a){var c=a.DOM,b=a.each;a.create(\"tinymce.ui.Toolbar:tinymce.ui.Container\",{renderHTML:function(){var m=this,f=\"\",j,k,n=m.settings,e,d,g,l;l=m.controls;for(e=0;e<l.length;e++){k=l[e];d=l[e-1];g=l[e+1];if(e===0){j=\"mceToolbarStart\";if(k.Button){j+=\" mceToolbarStartButton\"}else{if(k.SplitButton){j+=\" mceToolbarStartSplitButton\"}else{if(k.ListBox){j+=\" mceToolbarStartListBox\"}}}f+=c.createHTML(\"td\",{\"class\":j},c.createHTML(\"span\",null,\"<!-- IE -->\"))}if(d&&k.ListBox){if(d.Button||d.SplitButton){f+=c.createHTML(\"td\",{\"class\":\"mceToolbarEnd\"},c.createHTML(\"span\",null,\"<!-- IE -->\"))}}if(c.stdMode){f+='<td style=\"position: relative\">'+k.renderHTML()+\"</td>\"}else{f+=\"<td>\"+k.renderHTML()+\"</td>\"}if(g&&k.ListBox){if(g.Button||g.SplitButton){f+=c.createHTML(\"td\",{\"class\":\"mceToolbarStart\"},c.createHTML(\"span\",null,\"<!-- IE -->\"))}}}j=\"mceToolbarEnd\";if(k.Button){j+=\" mceToolbarEndButton\"}else{if(k.SplitButton){j+=\" mceToolbarEndSplitButton\"}else{if(k.ListBox){j+=\" mceToolbarEndListBox\"}}}f+=c.createHTML(\"td\",{\"class\":j},c.createHTML(\"span\",null,\"<!-- IE -->\"));return c.createHTML(\"table\",{id:m.id,\"class\":\"mceToolbar\"+(n[\"class\"]?\" \"+n[\"class\"]:\"\"),cellpadding:\"0\",cellspacing:\"0\",align:m.settings.align||\"\",role:\"presentation\",tabindex:\"-1\"},\"<tbody><tr>\"+f+\"</tr></tbody>\")}})})(tinymce);(function(b){var a=b.util.Dispatcher,c=b.each;b.create(\"tinymce.AddOnManager\",{AddOnManager:function(){var d=this;d.items=[];d.urls={};d.lookup={};d.onAdd=new a(d)},get:function(d){if(this.lookup[d]){return this.lookup[d].instance}else{return undefined}},dependencies:function(e){var d;if(this.lookup[e]){d=this.lookup[e].dependencies}return d||[]},requireLangPack:function(e){var d=b.settings;if(d&&d.language&&d.language_load!==false){b.ScriptLoader.add(this.urls[e]+\"/langs/\"+d.language+\".js\")}},add:function(f,e,d){this.items.push(e);this.lookup[f]={instance:e,dependencies:d};this.onAdd.dispatch(this,f,e);return e},createUrl:function(d,e){if(typeof e===\"object\"){return e}else{return{prefix:d.prefix,resource:e,suffix:d.suffix}}},addComponents:function(f,d){var e=this.urls[f];b.each(d,function(g){b.ScriptLoader.add(e+\"/\"+g)})},load:function(j,f,d,h){var g=this,e=f;function i(){var k=g.dependencies(j);b.each(k,function(m){var l=g.createUrl(f,m);g.load(l.resource,l,undefined,undefined)});if(d){if(h){d.call(h)}else{d.call(b.ScriptLoader)}}}if(g.urls[j]){return}if(typeof f===\"object\"){e=f.prefix+f.resource+f.suffix}if(e.indexOf(\"/\")!=0&&e.indexOf(\"://\")==-1){e=b.baseURL+\"/\"+e}g.urls[j]=e.substring(0,e.lastIndexOf(\"/\"));if(g.lookup[j]){i()}else{b.ScriptLoader.add(e,i,h)}}});b.PluginManager=new b.AddOnManager();b.ThemeManager=new b.AddOnManager()}(tinymce));(function(j){var g=j.each,d=j.extend,k=j.DOM,i=j.dom.Event,f=j.ThemeManager,b=j.PluginManager,e=j.explode,h=j.util.Dispatcher,a,c=0;j.documentBaseURL=window.location.href.replace(/[\\?#].*$/,\"\").replace(/[\\/\\\\][^\\/]+$/,\"\");if(!/[\\/\\\\]$/.test(j.documentBaseURL)){j.documentBaseURL+=\"/\"}j.baseURL=new j.util.URI(j.documentBaseURL).toAbsolute(j.baseURL);j.baseURI=new j.util.URI(j.baseURL);j.onBeforeUnload=new h(j);i.add(window,\"beforeunload\",function(l){j.onBeforeUnload.dispatch(j,l)});j.onAddEditor=new h(j);j.onRemoveEditor=new h(j);j.EditorManager=d(j,{editors:[],i18n:{},activeEditor:null,init:function(q){var n=this,p,l=j.ScriptLoader,u,o=[],m;function r(x,y,t){var v=x[y];if(!v){return}if(j.is(v,\"string\")){t=v.replace(/\\.\\w+$/,\"\");t=t?j.resolve(t):0;v=j.resolve(v)}return v.apply(t||this,Array.prototype.slice.call(arguments,2))}q=d({theme:\"simple\",language:\"en\"},q);n.settings=q;i.add(document,\"init\",function(){var s,v;r(q,\"onpageload\");switch(q.mode){case\"exact\":s=q.elements||\"\";if(s.length>0){g(e(s),function(x){if(k.get(x)){m=new j.Editor(x,q);o.push(m);m.render(1)}else{g(document.forms,function(y){g(y.elements,function(z){if(z.name===x){x=\"mce_editor_\"+c++;k.setAttrib(z,\"id\",x);m=new j.Editor(x,q);o.push(m);m.render(1)}})})}})}break;case\"textareas\":case\"specific_textareas\":function t(y,x){return x.constructor===RegExp?x.test(y.className):k.hasClass(y,x)}g(k.select(\"textarea\"),function(x){if(q.editor_deselector&&t(x,q.editor_deselector)){return}if(!q.editor_selector||t(x,q.editor_selector)){u=k.get(x.name);if(!x.id&&!u){x.id=x.name}if(!x.id||n.get(x.id)){x.id=k.uniqueId()}m=new j.Editor(x.id,q);o.push(m);m.render(1)}});break}if(q.oninit){s=v=0;g(o,function(x){v++;if(!x.initialized){x.onInit.add(function(){s++;if(s==v){r(q,\"oninit\")}})}else{s++}if(s==v){r(q,\"oninit\")}})}})},get:function(l){if(l===a){return this.editors}return this.editors[l]},getInstanceById:function(l){return this.get(l)},add:function(m){var l=this,n=l.editors;n[m.id]=m;n.push(m);l._setActive(m);l.onAddEditor.dispatch(l,m);return m},remove:function(n){var m=this,l,o=m.editors;if(!o[n.id]){return null}delete o[n.id];for(l=0;l<o.length;l++){if(o[l]==n){o.splice(l,1);break}}if(m.activeEditor==n){m._setActive(o[0])}n.destroy();m.onRemoveEditor.dispatch(m,n);return n},execCommand:function(r,p,o){var q=this,n=q.get(o),l;switch(r){case\"mceFocus\":n.focus();return true;case\"mceAddEditor\":case\"mceAddControl\":if(!q.get(o)){new j.Editor(o,q.settings).render()}return true;case\"mceAddFrameControl\":l=o.window;l.tinyMCE=tinyMCE;l.tinymce=j;j.DOM.doc=l.document;j.DOM.win=l;n=new j.Editor(o.element_id,o);n.render();if(j.isIE){function m(){n.destroy();l.detachEvent(\"onunload\",m);l=l.tinyMCE=l.tinymce=null}l.attachEvent(\"onunload\",m)}o.page_window=null;return true;case\"mceRemoveEditor\":case\"mceRemoveControl\":if(n){n.remove()}return true;case\"mceToggleEditor\":if(!n){q.execCommand(\"mceAddControl\",0,o);return true}if(n.isHidden()){n.show()}else{n.hide()}return true}if(q.activeEditor){return q.activeEditor.execCommand(r,p,o)}return false},execInstanceCommand:function(p,o,n,m){var l=this.get(p);if(l){return l.execCommand(o,n,m)}return false},triggerSave:function(){g(this.editors,function(l){l.save()})},addI18n:function(n,q){var l,m=this.i18n;if(!j.is(n,\"string\")){g(n,function(r,p){g(r,function(t,s){g(t,function(v,u){if(s===\"common\"){m[p+\".\"+u]=v}else{m[p+\".\"+s+\".\"+u]=v}})})})}else{g(q,function(r,p){m[n+\".\"+p]=r})}},_setActive:function(l){this.selectedInstance=this.activeEditor=l}})})(tinymce);(function(m){var n=m.DOM,j=m.dom.Event,f=m.extend,k=m.util.Dispatcher,i=m.each,a=m.isGecko,b=m.isIE,e=m.isWebKit,d=m.is,h=m.ThemeManager,c=m.PluginManager,o=m.inArray,l=m.grep,g=m.explode;m.create(\"tinymce.Editor\",{Editor:function(r,q){var p=this;p.id=p.editorId=r;p.execCommands={};p.queryStateCommands={};p.queryValueCommands={};p.isNotDirty=false;p.plugins={};i([\"onPreInit\",\"onBeforeRenderUI\",\"onPostRender\",\"onInit\",\"onRemove\",\"onActivate\",\"onDeactivate\",\"onClick\",\"onEvent\",\"onMouseUp\",\"onMouseDown\",\"onDblClick\",\"onKeyDown\",\"onKeyUp\",\"onKeyPress\",\"onContextMenu\",\"onSubmit\",\"onReset\",\"onPaste\",\"onPreProcess\",\"onPostProcess\",\"onBeforeSetContent\",\"onBeforeGetContent\",\"onSetContent\",\"onGetContent\",\"onLoadContent\",\"onSaveContent\",\"onNodeChange\",\"onChange\",\"onBeforeExecCommand\",\"onExecCommand\",\"onUndo\",\"onRedo\",\"onVisualAid\",\"onSetProgressState\"],function(s){p[s]=new k(p)});p.settings=q=f({id:r,language:\"en\",docs_language:\"en\",theme:\"simple\",skin:\"default\",delta_width:0,delta_height:0,popup_css:\"\",plugins:\"\",document_base_url:m.documentBaseURL,add_form_submit_trigger:1,submit_patch:1,add_unload_trigger:1,convert_urls:1,relative_urls:1,remove_script_host:1,table_inline_editing:0,object_resizing:1,cleanup:1,accessibility_focus:1,custom_shortcuts:1,custom_undo_redo_keyboard_shortcuts:1,custom_undo_redo_restore_selection:1,custom_undo_redo:1,doctype:m.isIE6?'<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">':\"<!DOCTYPE>\",visual_table_class:\"mceItemTable\",visual:1,font_size_style_values:\"xx-small,x-small,small,medium,large,x-large,xx-large\",font_size_legacy_values:\"xx-small,small,medium,large,x-large,xx-large,300%\",apply_source_formatting:1,directionality:\"ltr\",forced_root_block:\"p\",hidden_input:1,padd_empty_editor:1,render_ui:1,init_theme:1,force_p_newlines:1,indentation:\"30px\",keep_styles:1,fix_table_elements:1,inline_styles:1,convert_fonts_to_spans:true,indent:\"simple\",indent_before:\"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,li,area,table,thead,tfoot,tbody,tr\",indent_after:\"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,li,area,table,thead,tfoot,tbody,tr\",validate:true,entity_encoding:\"named\",url_converter:p.convertURL,url_converter_scope:p,ie7_compat:true},q);p.documentBaseURI=new m.util.URI(q.document_base_url||m.documentBaseURL,{base_uri:tinyMCE.baseURI});p.baseURI=m.baseURI;p.contentCSS=[];p.execCallback(\"setup\",p)},render:function(r){var u=this,v=u.settings,x=u.id,p=m.ScriptLoader;if(!j.domLoaded){j.add(document,\"init\",function(){u.render()});return}tinyMCE.settings=v;if(!u.getElement()){return}if(m.isIDevice&&!m.isIOS5){return}if(!/TEXTAREA|INPUT/i.test(u.getElement().nodeName)&&v.hidden_input&&n.getParent(x,\"form\")){n.insertAfter(n.create(\"input\",{type:\"hidden\",name:x}),x)}if(m.WindowManager){u.windowManager=new m.WindowManager(u)}if(v.encoding==\"xml\"){u.onGetContent.add(function(s,t){if(t.save){t.content=n.encode(t.content)}})}if(v.add_form_submit_trigger){u.onSubmit.addToTop(function(){if(u.initialized){u.save();u.isNotDirty=1}})}if(v.add_unload_trigger){u._beforeUnload=tinyMCE.onBeforeUnload.add(function(){if(u.initialized&&!u.destroyed&&!u.isHidden()){u.save({format:\"raw\",no_events:true})}})}m.addUnload(u.destroy,u);if(v.submit_patch){u.onBeforeRenderUI.add(function(){var s=u.getElement().form;if(!s){return}if(s._mceOldSubmit){return}if(!s.submit.nodeType&&!s.submit.length){u.formElement=s;s._mceOldSubmit=s.submit;s.submit=function(){m.triggerSave();u.isNotDirty=1;return u.formElement._mceOldSubmit(u.formElement)}}s=null})}function q(){if(v.language&&v.language_load!==false){p.add(m.baseURL+\"/langs/\"+v.language+\".js\")}if(v.theme&&v.theme.charAt(0)!=\"-\"&&!h.urls[v.theme]){h.load(v.theme,\"themes/\"+v.theme+\"/editor_template\"+m.suffix+\".js\")}i(g(v.plugins),function(t){if(t&&!c.urls[t]){if(t.charAt(0)==\"-\"){t=t.substr(1,t.length);var s=c.dependencies(t);i(s,function(z){var y={prefix:\"plugins/\",resource:z,suffix:\"/editor_plugin\"+m.suffix+\".js\"};var z=c.createUrl(y,z);c.load(z.resource,z)})}else{if(t==\"safari\"){return}c.load(t,{prefix:\"plugins/\",resource:t,suffix:\"/editor_plugin\"+m.suffix+\".js\"})}}});p.loadQueue(function(){if(!u.removed){u.init()}})}q()},init:function(){var r,H=this,I=H.settings,E,A,D=H.getElement(),q,p,F,y,C,G,z,v=[];m.add(H);I.aria_label=I.aria_label||n.getAttrib(D,\"aria-label\",H.getLang(\"aria.rich_text_area\"));if(I.theme){I.theme=I.theme.replace(/-/,\"\");q=h.get(I.theme);H.theme=new q();if(H.theme.init&&I.init_theme){H.theme.init(H,h.urls[I.theme]||m.documentBaseURL.replace(/\\/$/,\"\"))}}function B(J){var K=c.get(J),t=c.urls[J]||m.documentBaseURL.replace(/\\/$/,\"\"),s;if(K&&m.inArray(v,J)===-1){i(c.dependencies(J),function(u){B(u)});s=new K(H,t);H.plugins[J]=s;if(s.init){s.init(H,t);v.push(J)}}}i(g(I.plugins.replace(/\\-/g,\"\")),B);if(I.popup_css!==false){if(I.popup_css){I.popup_css=H.documentBaseURI.toAbsolute(I.popup_css)}else{I.popup_css=H.baseURI.toAbsolute(\"themes/\"+I.theme+\"/skins/\"+I.skin+\"/dialog.css\")}}if(I.popup_css_add){I.popup_css+=\",\"+H.documentBaseURI.toAbsolute(I.popup_css_add)}H.controlManager=new m.ControlManager(H);if(I.custom_undo_redo){H.onBeforeExecCommand.add(function(t,J,u,K,s){if(J!=\"Undo\"&&J!=\"Redo\"&&J!=\"mceRepaint\"&&(!s||!s.skip_undo)){H.undoManager.beforeChange()}});H.onExecCommand.add(function(t,J,u,K,s){if(J!=\"Undo\"&&J!=\"Redo\"&&J!=\"mceRepaint\"&&(!s||!s.skip_undo)){H.undoManager.add()}})}H.onExecCommand.add(function(s,t){if(!/^(FontName|FontSize)$/.test(t)){H.nodeChanged()}});if(a){function x(s,t){if(!t||!t.initial){H.execCommand(\"mceRepaint\")}}H.onUndo.add(x);H.onRedo.add(x);H.onSetContent.add(x)}H.onBeforeRenderUI.dispatch(H,H.controlManager);if(I.render_ui){E=I.width||D.style.width||D.offsetWidth;A=I.height||D.style.height||D.offsetHeight;H.orgDisplay=D.style.display;G=/^[0-9\\.]+(|px)$/i;if(G.test(\"\"+E)){E=Math.max(parseInt(E)+(q.deltaWidth||0),100)}if(G.test(\"\"+A)){A=Math.max(parseInt(A)+(q.deltaHeight||0),100)}q=H.theme.renderUI({targetNode:D,width:E,height:A,deltaWidth:I.delta_width,deltaHeight:I.delta_height});H.editorContainer=q.editorContainer}if(document.domain&&location.hostname!=document.domain){m.relaxedDomain=document.domain}n.setStyles(q.sizeContainer||q.editorContainer,{width:E,height:A});if(I.content_css){m.each(g(I.content_css),function(s){H.contentCSS.push(H.documentBaseURI.toAbsolute(s))})}A=(q.iframeHeight||A)+(typeof(A)==\"number\"?(q.deltaHeight||0):\"\");if(A<100){A=100}H.iframeHTML=I.doctype+'<html><head xmlns=\"http://www.w3.org/1999/xhtml\">';if(I.document_base_url!=m.documentBaseURL){H.iframeHTML+='<base href=\"'+H.documentBaseURI.getURI()+'\" />'}if(I.ie7_compat){H.iframeHTML+='<meta http-equiv=\"X-UA-Compatible\" content=\"IE=7\" />'}else{H.iframeHTML+='<meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />'}H.iframeHTML+='<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';for(z=0;z<H.contentCSS.length;z++){H.iframeHTML+='<link type=\"text/css\" rel=\"stylesheet\" href=\"'+H.contentCSS[z]+'\" />'}y=I.body_id||\"tinymce\";if(y.indexOf(\"=\")!=-1){y=H.getParam(\"body_id\",\"\",\"hash\");y=y[H.id]||y}C=I.body_class||\"\";if(C.indexOf(\"=\")!=-1){C=H.getParam(\"body_class\",\"\",\"hash\");C=C[H.id]||\"\"}H.iframeHTML+='</head><body id=\"'+y+'\" class=\"mceContentBody '+C+'\"><br></body></html>';if(m.relaxedDomain&&(b||(m.isOpera&&parseFloat(opera.version())<11))){F='javascript:(function(){document.open();document.domain=\"'+document.domain+'\";var ed = window.parent.tinyMCE.get(\"'+H.id+'\");document.write(ed.iframeHTML);document.close();ed.setupIframe();})()'}r=n.add(q.iframeContainer,\"iframe\",{id:H.id+\"_ifr\",src:F||'javascript:\"\"',frameBorder:\"0\",allowTransparency:\"true\",title:I.aria_label,style:{width:\"100%\",height:A,display:\"block\"}});H.contentAreaContainer=q.iframeContainer;n.get(q.editorContainer).style.display=H.orgDisplay;n.get(H.id).style.display=\"none\";n.setAttrib(H.id,\"aria-hidden\",true);if(!m.relaxedDomain||!F){H.setupIframe()}D=r=q=null},setupIframe:function(){var q=this,v=q.settings,x=n.get(q.id),y=q.getDoc(),u,p;if(!b||!m.relaxedDomain){y.open();y.write(q.iframeHTML);y.close();if(m.relaxedDomain){y.domain=m.relaxedDomain}}p=q.getBody();p.disabled=true;if(!v.readonly){p.contentEditable=true}p.disabled=false;q.schema=new m.html.Schema(v);q.dom=new m.dom.DOMUtils(q.getDoc(),{keep_values:true,url_converter:q.convertURL,url_converter_scope:q,hex_colors:v.force_hex_style_colors,class_filter:v.class_filter,update_styles:1,fix_ie_paragraphs:1,schema:q.schema});q.parser=new m.html.DomParser(v,q.schema);if(!q.settings.allow_html_in_named_anchor){q.parser.addAttributeFilter(\"name\",function(s,t){var A=s.length,C,z,B,D;while(A--){D=s[A];if(D.name===\"a\"&&D.firstChild){B=D.parent;C=D.lastChild;do{z=C.prev;B.insert(C,D);C=z}while(C)}}})}q.parser.addAttributeFilter(\"src,href,style\",function(s,t){var z=s.length,B,D=q.dom,C,A;while(z--){B=s[z];C=B.attr(t);A=\"data-mce-\"+t;if(!B.attributes.map[A]){if(t===\"style\"){B.attr(A,D.serializeStyle(D.parseStyle(C),B.name))}else{B.attr(A,q.convertURL(C,t,B.name))}}}});q.parser.addNodeFilter(\"script\",function(s,t){var z=s.length,A;while(z--){A=s[z];A.attr(\"type\",\"mce-\"+(A.attr(\"type\")||\"text/javascript\"))}});q.parser.addNodeFilter(\"#cdata\",function(s,t){var z=s.length,A;while(z--){A=s[z];A.type=8;A.name=\"#comment\";A.value=\"[CDATA[\"+A.value+\"]]\"}});q.parser.addNodeFilter(\"p,h1,h2,h3,h4,h5,h6,div\",function(t,z){var A=t.length,B,s=q.schema.getNonEmptyElements();while(A--){B=t[A];if(B.isEmpty(s)){B.empty().append(new m.html.Node(\"br\",1)).shortEnded=true}}});q.serializer=new m.dom.Serializer(v,q.dom,q.schema);q.selection=new m.dom.Selection(q.dom,q.getWin(),q.serializer);q.formatter=new m.Formatter(this);q.formatter.register({alignleft:[{selector:\"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li\",styles:{textAlign:\"left\"}},{selector:\"img,table\",collapsed:false,styles:{\"float\":\"left\"}}],aligncenter:[{selector:\"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li\",styles:{textAlign:\"center\"}},{selector:\"img\",collapsed:false,styles:{display:\"block\",marginLeft:\"auto\",marginRight:\"auto\"}},{selector:\"table\",collapsed:false,styles:{marginLeft:\"auto\",marginRight:\"auto\"}}],alignright:[{selector:\"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li\",styles:{textAlign:\"right\"}},{selector:\"img,table\",collapsed:false,styles:{\"float\":\"right\"}}],alignfull:[{selector:\"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li\",styles:{textAlign:\"justify\"}}],bold:[{inline:\"strong\",remove:\"all\"},{inline:\"span\",styles:{fontWeight:\"bold\"}},{inline:\"b\",remove:\"all\"}],italic:[{inline:\"em\",remove:\"all\"},{inline:\"span\",styles:{fontStyle:\"italic\"}},{inline:\"i\",remove:\"all\"}],underline:[{inline:\"span\",styles:{textDecoration:\"underline\"},exact:true},{inline:\"u\",remove:\"all\"}],strikethrough:[{inline:\"span\",styles:{textDecoration:\"line-through\"},exact:true},{inline:\"strike\",remove:\"all\"}],forecolor:{inline:\"span\",styles:{color:\"%value\"},wrap_links:false},hilitecolor:{inline:\"span\",styles:{backgroundColor:\"%value\"},wrap_links:false},fontname:{inline:\"span\",styles:{fontFamily:\"%value\"}},fontsize:{inline:\"span\",styles:{fontSize:\"%value\"}},fontsize_class:{inline:\"span\",attributes:{\"class\":\"%value\"}},blockquote:{block:\"blockquote\",wrapper:1,remove:\"all\"},subscript:{inline:\"sub\"},superscript:{inline:\"sup\"},link:{inline:\"a\",selector:\"a\",remove:\"all\",split:true,deep:true,onmatch:function(s){return true},onformat:function(z,s,t){i(t,function(B,A){q.dom.setAttrib(z,A,B)})}},removeformat:[{selector:\"b,strong,em,i,font,u,strike\",remove:\"all\",split:true,expand:false,block_expand:true,deep:true},{selector:\"span\",attributes:[\"style\",\"class\"],remove:\"empty\",split:true,expand:false,deep:true},{selector:\"*\",attributes:[\"style\",\"class\"],split:false,expand:false,deep:true}]});i(\"p h1 h2 h3 h4 h5 h6 div address pre div code dt dd samp\".split(/\\s/),function(s){q.formatter.register(s,{block:s,remove:\"all\"})});q.formatter.register(q.settings.formats);q.undoManager=new m.UndoManager(q);q.undoManager.onAdd.add(function(t,s){if(t.hasUndo()){return q.onChange.dispatch(q,s,t)}});q.undoManager.onUndo.add(function(t,s){return q.onUndo.dispatch(q,s,t)});q.undoManager.onRedo.add(function(t,s){return q.onRedo.dispatch(q,s,t)});q.forceBlocks=new m.ForceBlocks(q,{forced_root_block:v.forced_root_block});q.editorCommands=new m.EditorCommands(q);q.serializer.onPreProcess.add(function(s,t){return q.onPreProcess.dispatch(q,t,s)});q.serializer.onPostProcess.add(function(s,t){return q.onPostProcess.dispatch(q,t,s)});q.onPreInit.dispatch(q);if(!v.gecko_spellcheck){q.getBody().spellcheck=0}if(!v.readonly){q._addEvents()}q.controlManager.onPostRender.dispatch(q,q.controlManager);q.onPostRender.dispatch(q);q.quirks=new m.util.Quirks(this);if(v.directionality){q.getBody().dir=v.directionality}if(v.nowrap){q.getBody().style.whiteSpace=\"nowrap\"}if(v.handle_node_change_callback){q.onNodeChange.add(function(t,s,z){q.execCallback(\"handle_node_change_callback\",q.id,z,-1,-1,true,q.selection.isCollapsed())})}if(v.save_callback){q.onSaveContent.add(function(s,z){var t=q.execCallback(\"save_callback\",q.id,z.content,q.getBody());if(t){z.content=t}})}if(v.onchange_callback){q.onChange.add(function(t,s){q.execCallback(\"onchange_callback\",q,s)})}if(v.protect){q.onBeforeSetContent.add(function(s,t){if(v.protect){i(v.protect,function(z){t.content=t.content.replace(z,function(A){return\"<!--mce:protected \"+escape(A)+\"-->\"})})}})}if(v.convert_newlines_to_brs){q.onBeforeSetContent.add(function(s,t){if(t.initial){t.content=t.content.replace(/\\r?\\n/g,\"<br />\")}})}if(v.preformatted){q.onPostProcess.add(function(s,t){t.content=t.content.replace(/^\\s*<pre.*?>/,\"\");t.content=t.content.replace(/<\\/pre>\\s*$/,\"\");if(t.set){t.content='<pre class=\"mceItemHidden\">'+t.content+\"</pre>\"}})}if(v.verify_css_classes){q.serializer.attribValueFilter=function(B,z){var A,t;if(B==\"class\"){if(!q.classesRE){t=q.dom.getClasses();if(t.length>0){A=\"\";i(t,function(s){A+=(A?\"|\":\"\")+s[\"class\"]});q.classesRE=new RegExp(\"(\"+A+\")\",\"gi\")}}return !q.classesRE||/(\\bmceItem\\w+\\b|\\bmceTemp\\w+\\b)/g.test(z)||q.classesRE.test(z)?z:\"\"}return z}}if(v.cleanup_callback){q.onBeforeSetContent.add(function(s,t){t.content=q.execCallback(\"cleanup_callback\",\"insert_to_editor\",t.content,t)});q.onPreProcess.add(function(s,t){if(t.set){q.execCallback(\"cleanup_callback\",\"insert_to_editor_dom\",t.node,t)}if(t.get){q.execCallback(\"cleanup_callback\",\"get_from_editor_dom\",t.node,t)}});q.onPostProcess.add(function(s,t){if(t.set){t.content=q.execCallback(\"cleanup_callback\",\"insert_to_editor\",t.content,t)}if(t.get){t.content=q.execCallback(\"cleanup_callback\",\"get_from_editor\",t.content,t)}})}if(v.save_callback){q.onGetContent.add(function(s,t){if(t.save){t.content=q.execCallback(\"save_callback\",q.id,t.content,q.getBody())}})}if(v.handle_event_callback){q.onEvent.add(function(s,t,z){if(q.execCallback(\"handle_event_callback\",t,s,z)===false){j.cancel(t)}})}q.onSetContent.add(function(){q.addVisual(q.getBody())});if(v.padd_empty_editor){q.onPostProcess.add(function(s,t){t.content=t.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\\s|\\u00a0|)<\\/p>[\\r\\n]*|<br \\/>[\\r\\n]*)$/,\"\")})}if(a){function r(s,t){i(s.dom.select(\"a\"),function(A){var z=A.parentNode;if(s.dom.isBlock(z)&&z.lastChild===A){s.dom.add(z,\"br\",{\"data-mce-bogus\":1})}})}q.onExecCommand.add(function(s,t){if(t===\"CreateLink\"){r(s)}});q.onSetContent.add(q.selection.onSetContent.add(r))}q.load({initial:true,format:\"html\"});q.startContent=q.getContent({format:\"raw\"});q.undoManager.add();q.initialized=true;q.onInit.dispatch(q);q.execCallback(\"setupcontent_callback\",q.id,q.getBody(),q.getDoc());q.execCallback(\"init_instance_callback\",q);q.focus(true);q.nodeChanged({initial:1});i(q.contentCSS,function(s){q.dom.loadCSS(s)});if(v.auto_focus){setTimeout(function(){var s=m.get(v.auto_focus);s.selection.select(s.getBody(),1);s.selection.collapse(1);s.getBody().focus();s.getWin().focus()},100)}x=null},focus:function(u){var y,q=this,s=q.selection,x=q.settings.content_editable,r,p,v=q.getDoc();if(!u){r=s.getRng();if(r.item){p=r.item(0)}q._refreshContentEditable();s.normalize();if(!x){q.getWin().focus()}if(m.isGecko){q.getBody().focus()}if(p&&p.ownerDocument==v){r=v.body.createControlRange();r.addElement(p);r.select()}}if(m.activeEditor!=q){if((y=m.activeEditor)!=null){y.onDeactivate.dispatch(y,q)}q.onActivate.dispatch(q,y)}m._setActive(q)},execCallback:function(u){var p=this,r=p.settings[u],q;if(!r){return}if(p.callbackLookup&&(q=p.callbackLookup[u])){r=q.func;q=q.scope}if(d(r,\"string\")){q=r.replace(/\\.\\w+$/,\"\");q=q?m.resolve(q):0;r=m.resolve(r);p.callbackLookup=p.callbackLookup||{};p.callbackLookup[u]={func:r,scope:q}}return r.apply(q||p,Array.prototype.slice.call(arguments,1))},translate:function(p){var r=this.settings.language||\"en\",q=m.i18n;if(!p){return\"\"}return q[r+\".\"+p]||p.replace(/{\\#([^}]+)\\}/g,function(t,s){return q[r+\".\"+s]||\"{#\"+s+\"}\"})},getLang:function(q,p){return m.i18n[(this.settings.language||\"en\")+\".\"+q]||(d(p)?p:\"{#\"+q+\"}\")},getParam:function(u,r,p){var s=m.trim,q=d(this.settings[u])?this.settings[u]:r,t;if(p===\"hash\"){t={};if(d(q,\"string\")){i(q.indexOf(\"=\")>0?q.split(/[;,](?![^=;,]*(?:[;,]|$))/):q.split(\",\"),function(x){x=x.split(\"=\");if(x.length>1){t[s(x[0])]=s(x[1])}else{t[s(x[0])]=s(x)}})}else{t=q}return t}return q},nodeChanged:function(r){var p=this,q=p.selection,u=q.getStart()||p.getBody();if(p.initialized){r=r||{};u=b&&u.ownerDocument!=p.getDoc()?p.getBody():u;r.parents=[];p.dom.getParent(u,function(s){if(s.nodeName==\"BODY\"){return true}r.parents.push(s)});p.onNodeChange.dispatch(p,r?r.controlManager||p.controlManager:p.controlManager,u,q.isCollapsed(),r)}},addButton:function(r,q){var p=this;p.buttons=p.buttons||{};p.buttons[r]=q},addCommand:function(p,r,q){this.execCommands[p]={func:r,scope:q||this}},addQueryStateHandler:function(p,r,q){this.queryStateCommands[p]={func:r,scope:q||this}},addQueryValueHandler:function(p,r,q){this.queryValueCommands[p]={func:r,scope:q||this}},addShortcut:function(r,u,p,s){var q=this,v;if(!q.settings.custom_shortcuts){return false}q.shortcuts=q.shortcuts||{};if(d(p,\"string\")){v=p;p=function(){q.execCommand(v,false,null)}}if(d(p,\"object\")){v=p;p=function(){q.execCommand(v[0],v[1],v[2])}}i(g(r),function(t){var x={func:p,scope:s||this,desc:u,alt:false,ctrl:false,shift:false};i(g(t,\"+\"),function(y){switch(y){case\"alt\":case\"ctrl\":case\"shift\":x[y]=true;break;default:x.charCode=y.charCodeAt(0);x.keyCode=y.toUpperCase().charCodeAt(0)}});q.shortcuts[(x.ctrl?\"ctrl\":\"\")+\",\"+(x.alt?\"alt\":\"\")+\",\"+(x.shift?\"shift\":\"\")+\",\"+x.keyCode]=x});return true},execCommand:function(x,v,z,p){var r=this,u=0,y,q;if(!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint|SelectAll)$/.test(x)&&(!p||!p.skip_focus)){r.focus()}y={};r.onBeforeExecCommand.dispatch(r,x,v,z,y);if(y.terminate){return false}if(r.execCallback(\"execcommand_callback\",r.id,r.selection.getNode(),x,v,z)){r.onExecCommand.dispatch(r,x,v,z,p);return true}if(y=r.execCommands[x]){q=y.func.call(y.scope,v,z);if(q!==true){r.onExecCommand.dispatch(r,x,v,z,p);return q}}i(r.plugins,function(s){if(s.execCommand&&s.execCommand(x,v,z)){r.onExecCommand.dispatch(r,x,v,z,p);u=1;return false}});if(u){return true}if(r.theme&&r.theme.execCommand&&r.theme.execCommand(x,v,z)){r.onExecCommand.dispatch(r,x,v,z,p);return true}if(r.editorCommands.execCommand(x,v,z)){r.onExecCommand.dispatch(r,x,v,z,p);return true}r.getDoc().execCommand(x,v,z);r.onExecCommand.dispatch(r,x,v,z,p)},queryCommandState:function(u){var q=this,v,r;if(q._isHidden()){return}if(v=q.queryStateCommands[u]){r=v.func.call(v.scope);if(r!==true){return r}}v=q.editorCommands.queryCommandState(u);if(v!==-1){return v}try{return this.getDoc().queryCommandState(u)}catch(p){}},queryCommandValue:function(v){var q=this,u,r;if(q._isHidden()){return}if(u=q.queryValueCommands[v]){r=u.func.call(u.scope);if(r!==true){return r}}u=q.editorCommands.queryCommandValue(v);if(d(u)){return u}try{return this.getDoc().queryCommandValue(v)}catch(p){}},show:function(){var p=this;n.show(p.getContainer());n.hide(p.id);p.load()},hide:function(){var p=this,q=p.getDoc();if(b&&q){q.execCommand(\"SelectAll\")}p.save();n.hide(p.getContainer());n.setStyle(p.id,\"display\",p.orgDisplay)},isHidden:function(){return !n.isHidden(this.id)},setProgressState:function(p,q,r){this.onSetProgressState.dispatch(this,p,q,r);return p},load:function(s){var p=this,r=p.getElement(),q;if(r){s=s||{};s.load=true;q=p.setContent(d(r.value)?r.value:r.innerHTML,s);s.element=r;if(!s.no_events){p.onLoadContent.dispatch(p,s)}s.element=r=null;return q}},save:function(u){var p=this,s=p.getElement(),q,r;if(!s||!p.initialized){return}u=u||{};u.save=true;if(!u.no_events){p.undoManager.typing=false;p.undoManager.add()}u.element=s;q=u.content=p.getContent(u);if(!u.no_events){p.onSaveContent.dispatch(p,u)}q=u.content;if(!/TEXTAREA|INPUT/i.test(s.nodeName)){s.innerHTML=q;if(r=n.getParent(p.id,\"form\")){i(r.elements,function(t){if(t.name==p.id){t.value=q;return false}})}}else{s.value=q}u.element=s=null;return q},setContent:function(u,s){var r=this,q,p=r.getBody(),t;s=s||{};s.format=s.format||\"html\";s.set=true;s.content=u;if(!s.no_events){r.onBeforeSetContent.dispatch(r,s)}u=s.content;if(!m.isIE&&(u.length===0||/^\\s+$/.test(u))){t=r.settings.forced_root_block;if(t){u=\"<\"+t+'><br data-mce-bogus=\"1\"></'+t+\">\"}else{u='<br data-mce-bogus=\"1\">'}p.innerHTML=u;r.selection.select(p,true);r.selection.collapse(true);return}if(s.format!==\"raw\"){u=new m.html.Serializer({},r.schema).serialize(r.parser.parse(u))}s.content=m.trim(u);r.dom.setHTML(p,s.content);if(!s.no_events){r.onSetContent.dispatch(r,s)}r.selection.normalize();return s.content},getContent:function(q){var p=this,r;q=q||{};q.format=q.format||\"html\";q.get=true;if(!q.no_events){p.onBeforeGetContent.dispatch(p,q)}if(q.format==\"raw\"){r=p.getBody().innerHTML}else{r=p.serializer.serialize(p.getBody(),q)}q.content=m.trim(r);if(!q.no_events){p.onGetContent.dispatch(p,q)}return q.content},isDirty:function(){var p=this;return m.trim(p.startContent)!=m.trim(p.getContent({format:\"raw\",no_events:1}))&&!p.isNotDirty},getContainer:function(){var p=this;if(!p.container){p.container=n.get(p.editorContainer||p.id+\"_parent\")}return p.container},getContentAreaContainer:function(){return this.contentAreaContainer},getElement:function(){return n.get(this.settings.content_element||this.id)},getWin:function(){var p=this,q;if(!p.contentWindow){q=n.get(p.id+\"_ifr\");if(q){p.contentWindow=q.contentWindow}}return p.contentWindow},getDoc:function(){var q=this,p;if(!q.contentDocument){p=q.getWin();if(p){q.contentDocument=p.document}}return q.contentDocument},getBody:function(){return this.bodyElement||this.getDoc().body},convertURL:function(p,x,v){var q=this,r=q.settings;if(r.urlconverter_callback){return q.execCallback(\"urlconverter_callback\",p,v,true,x)}if(!r.convert_urls||(v&&v.nodeName==\"LINK\")||p.indexOf(\"file:\")===0){return p}if(r.relative_urls){return q.documentBaseURI.toRelative(p)}p=q.documentBaseURI.toAbsolute(p,r.remove_script_host);return p},addVisual:function(r){var p=this,q=p.settings;r=r||p.getBody();if(!d(p.hasVisual)){p.hasVisual=q.visual}i(p.dom.select(\"table,a\",r),function(t){var s;switch(t.nodeName){case\"TABLE\":s=p.dom.getAttrib(t,\"border\");if(!s||s==\"0\"){if(p.hasVisual){p.dom.addClass(t,q.visual_table_class)}else{p.dom.removeClass(t,q.visual_table_class)}}return;case\"A\":s=p.dom.getAttrib(t,\"name\");if(s){if(p.hasVisual){p.dom.addClass(t,\"mceItemAnchor\")}else{p.dom.removeClass(t,\"mceItemAnchor\")}}return}});p.onVisualAid.dispatch(p,r,p.hasVisual)},remove:function(){var p=this,q=p.getContainer();p.removed=1;p.hide();p.execCallback(\"remove_instance_callback\",p);p.onRemove.dispatch(p);p.onExecCommand.listeners=[];m.remove(p);n.remove(q)},destroy:function(q){var p=this;if(p.destroyed){return}if(!q){m.removeUnload(p.destroy);tinyMCE.onBeforeUnload.remove(p._beforeUnload);if(p.theme&&p.theme.destroy){p.theme.destroy()}p.controlManager.destroy();p.selection.destroy();p.dom.destroy();if(!p.settings.content_editable){j.clear(p.getWin());j.clear(p.getDoc())}j.clear(p.getBody());j.clear(p.formElement)}if(p.formElement){p.formElement.submit=p.formElement._mceOldSubmit;p.formElement._mceOldSubmit=null}p.contentAreaContainer=p.formElement=p.container=p.settings.content_element=p.bodyElement=p.contentDocument=p.contentWindow=null;if(p.selection){p.selection=p.selection.win=p.selection.dom=p.selection.dom.doc=null}p.destroyed=1},_addEvents:function(){var B=this,r,C=B.settings,q=B.dom,x={mouseup:\"onMouseUp\",mousedown:\"onMouseDown\",click:\"onClick\",keyup:\"onKeyUp\",keydown:\"onKeyDown\",keypress:\"onKeyPress\",submit:\"onSubmit\",reset:\"onReset\",contextmenu:\"onContextMenu\",dblclick:\"onDblClick\",paste:\"onPaste\"};function p(t,D){var s=t.type;if(B.removed){return}if(B.onEvent.dispatch(B,t,D)!==false){B[x[t.fakeType||t.type]].dispatch(B,t,D)}}i(x,function(t,s){switch(s){case\"contextmenu\":q.bind(B.getDoc(),s,p);break;case\"paste\":q.bind(B.getBody(),s,function(D){p(D)});break;case\"submit\":case\"reset\":q.bind(B.getElement().form||n.getParent(B.id,\"form\"),s,p);break;default:q.bind(C.content_editable?B.getBody():B.getDoc(),s,p)}});q.bind(C.content_editable?B.getBody():(a?B.getDoc():B.getWin()),\"focus\",function(s){B.focus(true)});if(m.isGecko){q.bind(B.getDoc(),\"DOMNodeInserted\",function(t){var s;t=t.target;if(t.nodeType===1&&t.nodeName===\"IMG\"&&(s=t.getAttribute(\"data-mce-src\"))){t.src=B.documentBaseURI.toAbsolute(s)}})}if(a){function u(){var E=this,G=E.getDoc(),F=E.settings;if(a&&!F.readonly){E._refreshContentEditable();try{G.execCommand(\"styleWithCSS\",0,false)}catch(D){if(!E._isHidden()){try{G.execCommand(\"useCSS\",0,true)}catch(D){}}}if(!F.table_inline_editing){try{G.execCommand(\"enableInlineTableEditing\",false,false)}catch(D){}}if(!F.object_resizing){try{G.execCommand(\"enableObjectResizing\",false,false)}catch(D){}}}}B.onBeforeExecCommand.add(u);B.onMouseDown.add(u)}B.onMouseUp.add(B.nodeChanged);B.onKeyUp.add(function(s,t){var D=t.keyCode;if((D>=33&&D<=36)||(D>=37&&D<=40)||D==13||D==45||D==46||D==8||(m.isMac&&(D==91||D==93))||t.ctrlKey){B.nodeChanged()}});B.onKeyDown.add(function(t,D){if(D.keyCode!=8){return}var F=t.selection.getRng().startContainer;var E=t.selection.getRng().startOffset;while(F&&F.nodeType&&F.nodeType!=1&&F.parentNode){F=F.parentNode}if(F&&F.parentNode&&F.parentNode.tagName===\"BLOCKQUOTE\"&&F.parentNode.firstChild==F&&E==0){t.formatter.toggle(\"blockquote\",null,F.parentNode);var s=t.selection.getRng();s.setStart(F,0);s.setEnd(F,0);t.selection.setRng(s);t.selection.collapse(false)}});B.onReset.add(function(){B.setContent(B.startContent,{format:\"raw\"})});if(C.custom_shortcuts){if(C.custom_undo_redo_keyboard_shortcuts){B.addShortcut(\"ctrl+z\",B.getLang(\"undo_desc\"),\"Undo\");B.addShortcut(\"ctrl+y\",B.getLang(\"redo_desc\"),\"Redo\")}B.addShortcut(\"ctrl+b\",B.getLang(\"bold_desc\"),\"Bold\");B.addShortcut(\"ctrl+i\",B.getLang(\"italic_desc\"),\"Italic\");B.addShortcut(\"ctrl+u\",B.getLang(\"underline_desc\"),\"Underline\");for(r=1;r<=6;r++){B.addShortcut(\"ctrl+\"+r,\"\",[\"FormatBlock\",false,\"h\"+r])}B.addShortcut(\"ctrl+7\",\"\",[\"FormatBlock\",false,\"p\"]);B.addShortcut(\"ctrl+8\",\"\",[\"FormatBlock\",false,\"div\"]);B.addShortcut(\"ctrl+9\",\"\",[\"FormatBlock\",false,\"address\"]);function v(t){var s=null;if(!t.altKey&&!t.ctrlKey&&!t.metaKey){return s}i(B.shortcuts,function(D){if(m.isMac&&D.ctrl!=t.metaKey){return}else{if(!m.isMac&&D.ctrl!=t.ctrlKey){return}}if(D.alt!=t.altKey){return}if(D.shift!=t.shiftKey){return}if(t.keyCode==D.keyCode||(t.charCode&&t.charCode==D.charCode)){s=D;return false}});return s}B.onKeyUp.add(function(s,t){var D=v(t);if(D){return j.cancel(t)}});B.onKeyPress.add(function(s,t){var D=v(t);if(D){return j.cancel(t)}});B.onKeyDown.add(function(s,t){var D=v(t);if(D){D.func.call(D.scope);return j.cancel(t)}})}if(m.isIE){q.bind(B.getDoc(),\"controlselect\",function(D){var t=B.resizeInfo,s;D=D.target;if(D.nodeName!==\"IMG\"){return}if(t){q.unbind(t.node,t.ev,t.cb)}if(!q.hasClass(D,\"mceItemNoResize\")){ev=\"resizeend\";s=q.bind(D,ev,function(F){var E;F=F.target;if(E=q.getStyle(F,\"width\")){q.setAttrib(F,\"width\",E.replace(/[^0-9%]+/g,\"\"));q.setStyle(F,\"width\",\"\")}if(E=q.getStyle(F,\"height\")){q.setAttrib(F,\"height\",E.replace(/[^0-9%]+/g,\"\"));q.setStyle(F,\"height\",\"\")}})}else{ev=\"resizestart\";s=q.bind(D,\"resizestart\",j.cancel,j)}t=B.resizeInfo={node:D,ev:ev,cb:s}})}if(m.isOpera){B.onClick.add(function(s,t){j.prevent(t)})}if(C.custom_undo_redo){function y(){B.undoManager.typing=false;B.undoManager.add()}q.bind(B.getDoc(),\"focusout\",function(s){if(!B.removed&&B.undoManager.typing){y()}});B.dom.bind(B.dom.getRoot(),\"dragend\",function(s){y()});B.onKeyUp.add(function(s,D){var t=D.keyCode;if((t>=33&&t<=36)||(t>=37&&t<=40)||t==13||t==45||D.ctrlKey){y()}});B.onKeyDown.add(function(s,E){var D=E.keyCode,t;if(D==8){t=B.getDoc().selection;if(t&&t.createRange&&t.createRange().item){B.undoManager.beforeChange();s.dom.remove(t.createRange().item(0));y();return j.cancel(E)}}if((D>=33&&D<=36)||(D>=37&&D<=40)||D==13||D==45){if(m.isIE&&D==13){B.undoManager.beforeChange()}if(B.undoManager.typing){y()}return}if((D<16||D>20)&&D!=224&&D!=91&&!B.undoManager.typing){B.undoManager.beforeChange();B.undoManager.typing=true;B.undoManager.add()}});B.onMouseDown.add(function(){if(B.undoManager.typing){y()}})}if(m.isGecko){function A(){var s=B.dom.getAttribs(B.selection.getStart().cloneNode(false));return function(){var t=B.selection.getStart();if(t!==B.getBody()){B.dom.setAttrib(t,\"style\",null);i(s,function(D){t.setAttributeNode(D.cloneNode(true))})}}}function z(){var t=B.selection;return !t.isCollapsed()&&t.getStart()!=t.getEnd()}B.onKeyPress.add(function(s,D){var t;if((D.keyCode==8||D.keyCode==46)&&z()){t=A();B.getDoc().execCommand(\"delete\",false,null);t();return j.cancel(D)}});B.dom.bind(B.getDoc(),\"cut\",function(t){var s;if(z()){s=A();B.onKeyUp.addToTop(j.cancel,j);setTimeout(function(){s();B.onKeyUp.remove(j.cancel,j)},0)}})}},_refreshContentEditable:function(){var q=this,p,r;if(q._isHidden()){p=q.getBody();r=p.parentNode;r.removeChild(p);r.appendChild(p);p.focus()}},_isHidden:function(){var p;if(!a){return 0}p=this.selection.getSel();return(!p||!p.rangeCount||p.rangeCount==0)}})})(tinymce);(function(c){var d=c.each,e,a=true,b=false;c.EditorCommands=function(n){var m=n.dom,p=n.selection,j={state:{},exec:{},value:{}},k=n.settings,q=n.formatter,o;function r(z,y,x){var v;z=z.toLowerCase();if(v=j.exec[z]){v(z,y,x);return a}return b}function l(x){var v;x=x.toLowerCase();if(v=j.state[x]){return v(x)}return -1}function h(x){var v;x=x.toLowerCase();if(v=j.value[x]){return v(x)}return b}function u(v,x){x=x||\"exec\";d(v,function(z,y){d(y.toLowerCase().split(\",\"),function(A){j[x][A]=z})})}c.extend(this,{execCommand:r,queryCommandState:l,queryCommandValue:h,addCommands:u});function f(y,x,v){if(x===e){x=b}if(v===e){v=null}return n.getDoc().execCommand(y,x,v)}function t(v){return q.match(v)}function s(v,x){q.toggle(v,x?{value:x}:e)}function i(v){o=p.getBookmark(v)}function g(){p.moveToBookmark(o)}u({\"mceResetDesignMode,mceBeginUndoLevel\":function(){},\"mceEndUndoLevel,mceAddUndoLevel\":function(){n.undoManager.add()},\"Cut,Copy,Paste\":function(z){var y=n.getDoc(),v;try{f(z)}catch(x){v=a}if(v||!y.queryCommandSupported(z)){if(c.isGecko){n.windowManager.confirm(n.getLang(\"clipboard_msg\"),function(A){if(A){open(\"http://www.mozilla.org/editor/midasdemo/securityprefs.html\",\"_blank\")}})}else{n.windowManager.alert(n.getLang(\"clipboard_no_support\"))}}},unlink:function(v){if(p.isCollapsed()){p.select(p.getNode())}f(v);p.collapse(b)},\"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull\":function(v){var x=v.substring(7);d(\"left,center,right,full\".split(\",\"),function(y){if(x!=y){q.remove(\"align\"+y)}});s(\"align\"+x);r(\"mceRepaint\")},\"InsertUnorderedList,InsertOrderedList\":function(y){var v,x;f(y);v=m.getParent(p.getNode(),\"ol,ul\");if(v){x=v.parentNode;if(/^(H[1-6]|P|ADDRESS|PRE)$/.test(x.nodeName)){i();m.split(x,v);g()}}},\"Bold,Italic,Underline,Strikethrough,Superscript,Subscript\":function(v){s(v)},\"ForeColor,HiliteColor,FontName\":function(y,x,v){s(y,v)},FontSize:function(z,y,x){var v,A;if(x>=1&&x<=7){A=c.explode(k.font_size_style_values);v=c.explode(k.font_size_classes);if(v){x=v[x-1]||x}else{x=A[x-1]||x}}s(z,x)},RemoveFormat:function(v){q.remove(v)},mceBlockQuote:function(v){s(\"blockquote\")},FormatBlock:function(y,x,v){return s(v||\"p\")},mceCleanup:function(){var v=p.getBookmark();n.setContent(n.getContent({cleanup:a}),{cleanup:a});p.moveToBookmark(v)},mceRemoveNode:function(z,y,x){var v=x||p.getNode();if(v!=n.getBody()){i();n.dom.remove(v,a);g()}},mceSelectNodeDepth:function(z,y,x){var v=0;m.getParent(p.getNode(),function(A){if(A.nodeType==1&&v++==x){p.select(A);return b}},n.getBody())},mceSelectNode:function(y,x,v){p.select(v)},mceInsertContent:function(B,I,K){var y,J,E,z,F,G,D,C,L,x,A,M,v,H;y=n.parser;J=new c.html.Serializer({},n.schema);v='<span id=\"mce_marker\" data-mce-type=\"bookmark\">\\uFEFF</span>';G={content:K,format:\"html\"};p.onBeforeSetContent.dispatch(p,G);K=G.content;if(K.indexOf(\"{$caret}\")==-1){K+=\"{$caret}\"}K=K.replace(/\\{\\$caret\\}/,v);if(!p.isCollapsed()){n.getDoc().execCommand(\"Delete\",false,null)}E=p.getNode();G={context:E.nodeName.toLowerCase()};F=y.parse(K,G);A=F.lastChild;if(A.attr(\"id\")==\"mce_marker\"){D=A;for(A=A.prev;A;A=A.walk(true)){if(A.type==3||!m.isBlock(A.name)){A.parent.insert(D,A,A.name===\"br\");break}}}if(!G.invalid){K=J.serialize(F);A=E.firstChild;M=E.lastChild;if(!A||(A===M&&A.nodeName===\"BR\")){m.setHTML(E,K)}else{p.setContent(K)}}else{p.setContent(v);E=n.selection.getNode();z=n.getBody();if(E.nodeType==9){E=A=z}else{A=E}while(A!==z){E=A;A=A.parentNode}K=E==z?z.innerHTML:m.getOuterHTML(E);K=J.serialize(y.parse(K.replace(/<span (id=\"mce_marker\"|id=mce_marker).+?<\\/span>/i,function(){return J.serialize(F)})));if(E==z){m.setHTML(z,K)}else{m.setOuterHTML(E,K)}}D=m.get(\"mce_marker\");C=m.getRect(D);L=m.getViewPort(n.getWin());if((C.y+C.h>L.y+L.h||C.y<L.y)||(C.x>L.x+L.w||C.x<L.x)){H=c.isIE?n.getDoc().documentElement:n.getBody();H.scrollLeft=C.x;H.scrollTop=C.y-L.h+25}x=m.createRng();A=D.previousSibling;if(A&&A.nodeType==3){x.setStart(A,A.nodeValue.length)}else{x.setStartBefore(D);x.setEndBefore(D)}m.remove(D);p.setRng(x);p.onSetContent.dispatch(p,G);n.addVisual()},mceInsertRawHTML:function(y,x,v){p.setContent(\"tiny_mce_marker\");n.setContent(n.getContent().replace(/tiny_mce_marker/g,function(){return v}))},mceSetContent:function(y,x,v){n.setContent(v)},\"Indent,Outdent\":function(z){var x,v,y;x=k.indentation;v=/[a-z%]+$/i.exec(x);x=parseInt(x);if(!l(\"InsertUnorderedList\")&&!l(\"InsertOrderedList\")){d(p.getSelectedBlocks(),function(A){if(z==\"outdent\"){y=Math.max(0,parseInt(A.style.paddingLeft||0)-x);m.setStyle(A,\"paddingLeft\",y?y+v:\"\")}else{m.setStyle(A,\"paddingLeft\",(parseInt(A.style.paddingLeft||0)+x)+v)}})}else{f(z)}},mceRepaint:function(){var x;if(c.isGecko){try{i(a);if(p.getSel()){p.getSel().selectAllChildren(n.getBody())}p.collapse(a);g()}catch(v){}}},mceToggleFormat:function(y,x,v){q.toggle(v)},InsertHorizontalRule:function(){n.execCommand(\"mceInsertContent\",false,\"<hr />\")},mceToggleVisualAid:function(){n.hasVisual=!n.hasVisual;n.addVisual()},mceReplaceContent:function(y,x,v){n.execCommand(\"mceInsertContent\",false,v.replace(/\\{\\$selection\\}/g,p.getContent({format:\"text\"})))},mceInsertLink:function(z,y,x){var v;if(typeof(x)==\"string\"){x={href:x}}v=m.getParent(p.getNode(),\"a\");x.href=x.href.replace(\" \",\"%20\");if(!v||!x.href){q.remove(\"link\")}if(x.href){q.apply(\"link\",x,v)}},selectAll:function(){var x=m.getRoot(),v=m.createRng();v.setStart(x,0);v.setEnd(x,x.childNodes.length);n.selection.setRng(v)}});u({\"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull\":function(v){return t(\"align\"+v.substring(7))},\"Bold,Italic,Underline,Strikethrough,Superscript,Subscript\":function(v){return t(v)},mceBlockQuote:function(){return t(\"blockquote\")},Outdent:function(){var v;if(k.inline_styles){if((v=m.getParent(p.getStart(),m.isBlock))&&parseInt(v.style.paddingLeft)>0){return a}if((v=m.getParent(p.getEnd(),m.isBlock))&&parseInt(v.style.paddingLeft)>0){return a}}return l(\"InsertUnorderedList\")||l(\"InsertOrderedList\")||(!k.inline_styles&&!!m.getParent(p.getNode(),\"BLOCKQUOTE\"))},\"InsertUnorderedList,InsertOrderedList\":function(v){return m.getParent(p.getNode(),v==\"insertunorderedlist\"?\"UL\":\"OL\")}},\"state\");u({\"FontSize,FontName\":function(y){var x=0,v;if(v=m.getParent(p.getNode(),\"span\")){if(y==\"fontsize\"){x=v.style.fontSize}else{x=v.style.fontFamily.replace(/, /g,\",\").replace(/[\\'\\\"]/g,\"\").toLowerCase()}}return x}},\"value\");if(k.custom_undo_redo){u({Undo:function(){n.undoManager.undo()},Redo:function(){n.undoManager.redo()}})}}})(tinymce);(function(b){var a=b.util.Dispatcher;b.UndoManager=function(f){var d,e=0,h=[],c;function g(){return b.trim(f.getContent({format:\"raw\",no_events:1}))}return d={typing:false,onAdd:new a(d),onUndo:new a(d),onRedo:new a(d),beforeChange:function(){c=f.selection.getBookmark(2,true)},add:function(m){var j,k=f.settings,l;m=m||{};m.content=g();l=h[e];if(l&&l.content==m.content){return null}if(h[e]){h[e].beforeBookmark=c}if(k.custom_undo_redo_levels){if(h.length>k.custom_undo_redo_levels){for(j=0;j<h.length-1;j++){h[j]=h[j+1]}h.length--;e=h.length}}m.bookmark=f.selection.getBookmark(2,true);if(e<h.length-1){h.length=e+1}h.push(m);e=h.length-1;d.onAdd.dispatch(d,m);f.isNotDirty=0;return m},undo:function(){var k,j;if(d.typing){d.add();d.typing=false}if(e>0){k=h[--e];f.setContent(k.content,{format:\"raw\"});f.selection.moveToBookmark(k.beforeBookmark);d.onUndo.dispatch(d,k)}return k},redo:function(){var i;if(e<h.length-1){i=h[++e];f.setContent(i.content,{format:\"raw\"});f.selection.moveToBookmark(i.bookmark);d.onRedo.dispatch(d,i)}return i},clear:function(){h=[];e=0;d.typing=false},hasUndo:function(){return e>0||this.typing},hasRedo:function(){return e<h.length-1&&!this.typing}}}})(tinymce);(function(l){var j=l.dom.Event,c=l.isIE,a=l.isGecko,b=l.isOpera,i=l.each,h=l.extend,d=true,g=false;function k(o){var p,n,m;do{if(/^(SPAN|STRONG|B|EM|I|FONT|STRIKE|U)$/.test(o.nodeName)){if(p){n=o.cloneNode(false);n.appendChild(p);p=n}else{p=m=o.cloneNode(false)}p.removeAttribute(\"id\")}}while(o=o.parentNode);if(p){return{wrapper:p,inner:m}}}function f(n,o){var m=o.ownerDocument.createRange();m.setStart(n.endContainer,n.endOffset);m.setEndAfter(o);return m.cloneContents().textContent.length==0}function e(o,q,m){var n,p;if(q.isEmpty(m)){n=q.getParent(m,\"ul,ol\");if(!q.getParent(n.parentNode,\"ul,ol\")){q.split(n,m);p=q.create(\"p\",0,'<br data-mce-bogus=\"1\" />');q.replace(p,m);o.select(p,1)}return g}return d}l.create(\"tinymce.ForceBlocks\",{ForceBlocks:function(m){var n=this,o=m.settings,p;n.editor=m;n.dom=m.dom;p=(o.forced_root_block||\"p\").toLowerCase();o.element=p.toUpperCase();m.onPreInit.add(n.setup,n)},setup:function(){var n=this,m=n.editor,p=m.settings,u=m.dom,o=m.selection,q=m.schema.getBlockElements();if(p.forced_root_block){function v(){var y=o.getStart(),t=m.getBody(),s,z,D,F,E,x,A,B=-16777215;if(!y||y.nodeType!==1){return}while(y!=t){if(q[y.nodeName]){return}y=y.parentNode}s=o.getRng();if(s.setStart){z=s.startContainer;D=s.startOffset;F=s.endContainer;E=s.endOffset}else{if(s.item){s=m.getDoc().body.createTextRange();s.moveToElementText(s.item(0))}tmpRng=s.duplicate();tmpRng.collapse(true);D=tmpRng.move(\"character\",B)*-1;if(!tmpRng.collapsed){tmpRng=s.duplicate();tmpRng.collapse(false);E=(tmpRng.move(\"character\",B)*-1)-D}}for(y=t.firstChild;y;y){if(y.nodeType===3||(y.nodeType==1&&!q[y.nodeName])){if(!x){x=u.create(p.forced_root_block);y.parentNode.insertBefore(x,y)}A=y;y=y.nextSibling;x.appendChild(A)}else{x=null;y=y.nextSibling}}if(s.setStart){s.setStart(z,D);s.setEnd(F,E);o.setRng(s)}else{try{s=m.getDoc().body.createTextRange();s.moveToElementText(t);s.collapse(true);s.moveStart(\"character\",D);if(E>0){s.moveEnd(\"character\",E)}s.select()}catch(C){}}m.nodeChanged()}m.onKeyUp.add(v);m.onClick.add(v)}if(p.force_br_newlines){if(c){m.onKeyPress.add(function(s,t){var x;if(t.keyCode==13&&o.getNode().nodeName!=\"LI\"){o.setContent('<br id=\"__\" /> ',{format:\"raw\"});x=u.get(\"__\");x.removeAttribute(\"id\");o.select(x);o.collapse();return j.cancel(t)}})}}if(p.force_p_newlines){if(!c){m.onKeyPress.add(function(s,t){if(t.keyCode==13&&!t.shiftKey&&!n.insertPara(t)){j.cancel(t)}})}else{l.addUnload(function(){n._previousFormats=0});m.onKeyPress.add(function(s,t){n._previousFormats=0;if(t.keyCode==13&&!t.shiftKey&&s.selection.isCollapsed()&&p.keep_styles){n._previousFormats=k(s.selection.getStart())}});m.onKeyUp.add(function(t,y){if(y.keyCode==13&&!y.shiftKey){var x=t.selection.getStart(),s=n._previousFormats;if(!x.hasChildNodes()&&s){x=u.getParent(x,u.isBlock);if(x&&x.nodeName!=\"LI\"){x.innerHTML=\"\";if(n._previousFormats){x.appendChild(s.wrapper);s.inner.innerHTML=\"\\uFEFF\"}else{x.innerHTML=\"\\uFEFF\"}o.select(x,1);o.collapse(true);t.getDoc().execCommand(\"Delete\",false,null);n._previousFormats=0}}}})}if(a){m.onKeyDown.add(function(s,t){if((t.keyCode==8||t.keyCode==46)&&!t.shiftKey){n.backspaceDelete(t,t.keyCode==8)}})}}if(l.isWebKit){function r(t){var s=o.getRng(),x,A=u.create(\"div\",null,\" \"),z,y=u.getViewPort(t.getWin()).h;s.insertNode(x=u.create(\"br\"));s.setStartAfter(x);s.setEndAfter(x);o.setRng(s);if(o.getSel().focusNode==x.previousSibling){o.select(u.insertAfter(u.doc.createTextNode(\"\\u00a0\"),x));o.collapse(d)}u.insertAfter(A,x);z=u.getPos(A).y;u.remove(A);if(z>y){t.getWin().scrollTo(0,z)}}m.onKeyPress.add(function(s,t){if(t.keyCode==13&&(t.shiftKey||(p.force_br_newlines&&!u.getParent(o.getNode(),\"h1,h2,h3,h4,h5,h6,ol,ul\")))){r(s);j.cancel(t)}})}if(c){if(p.element!=\"P\"){m.onKeyPress.add(function(s,t){n.lastElm=o.getNode().nodeName});m.onKeyUp.add(function(t,x){var z,y=o.getNode(),s=t.getBody();if(s.childNodes.length===1&&y.nodeName==\"P\"){y=u.rename(y,p.element);o.select(y);o.collapse();t.nodeChanged()}else{if(x.keyCode==13&&!x.shiftKey&&n.lastElm!=\"P\"){z=u.getParent(y,\"p\");if(z){u.rename(z,p.element);t.nodeChanged()}}}})}}},getParentBlock:function(o){var m=this.dom;return m.getParent(o,m.isBlock)},insertPara:function(Q){var E=this,v=E.editor,M=v.dom,R=v.getDoc(),V=v.settings,F=v.selection.getSel(),G=F.getRangeAt(0),U=R.body;var J,K,H,O,N,q,o,u,z,m,C,T,p,x,I,L=M.getViewPort(v.getWin()),B,D,A;v.undoManager.beforeChange();J=R.createRange();J.setStart(F.anchorNode,F.anchorOffset);J.collapse(d);K=R.createRange();K.setStart(F.focusNode,F.focusOffset);K.collapse(d);H=J.compareBoundaryPoints(J.START_TO_END,K)<0;O=H?F.anchorNode:F.focusNode;N=H?F.anchorOffset:F.focusOffset;q=H?F.focusNode:F.anchorNode;o=H?F.focusOffset:F.anchorOffset;if(O===q&&/^(TD|TH)$/.test(O.nodeName)){if(O.firstChild.nodeName==\"BR\"){M.remove(O.firstChild)}if(O.childNodes.length==0){v.dom.add(O,V.element,null,\"<br />\");T=v.dom.add(O,V.element,null,\"<br />\")}else{I=O.innerHTML;O.innerHTML=\"\";v.dom.add(O,V.element,null,I);T=v.dom.add(O,V.element,null,\"<br />\")}G=R.createRange();G.selectNodeContents(T);G.collapse(1);v.selection.setRng(G);return g}if(O==U&&q==U&&U.firstChild&&v.dom.isBlock(U.firstChild)){O=q=O.firstChild;N=o=0;J=R.createRange();J.setStart(O,0);K=R.createRange();K.setStart(q,0)}if(!R.body.hasChildNodes()){R.body.appendChild(M.create(\"br\"))}O=O.nodeName==\"HTML\"?R.body:O;O=O.nodeName==\"BODY\"?O.firstChild:O;q=q.nodeName==\"HTML\"?R.body:q;q=q.nodeName==\"BODY\"?q.firstChild:q;u=E.getParentBlock(O);z=E.getParentBlock(q);m=u?u.nodeName:V.element;if(I=E.dom.getParent(u,\"li,pre\")){if(I.nodeName==\"LI\"){return e(v.selection,E.dom,I)}return d}if(u&&(u.nodeName==\"CAPTION\"||/absolute|relative|fixed/gi.test(M.getStyle(u,\"position\",1)))){m=V.element;u=null}if(z&&(z.nodeName==\"CAPTION\"||/absolute|relative|fixed/gi.test(M.getStyle(u,\"position\",1)))){m=V.element;z=null}if(/(TD|TABLE|TH|CAPTION)/.test(m)||(u&&m==\"DIV\"&&/left|right/gi.test(M.getStyle(u,\"float\",1)))){m=V.element;u=z=null}C=(u&&u.nodeName==m)?u.cloneNode(0):v.dom.create(m);T=(z&&z.nodeName==m)?z.cloneNode(0):v.dom.create(m);T.removeAttribute(\"id\");if(/^(H[1-6])$/.test(m)&&f(G,u)){T=v.dom.create(V.element)}I=p=O;do{if(I==U||I.nodeType==9||E.dom.isBlock(I)||/(TD|TABLE|TH|CAPTION)/.test(I.nodeName)){break}p=I}while((I=I.previousSibling?I.previousSibling:I.parentNode));I=x=q;do{if(I==U||I.nodeType==9||E.dom.isBlock(I)||/(TD|TABLE|TH|CAPTION)/.test(I.nodeName)){break}x=I}while((I=I.nextSibling?I.nextSibling:I.parentNode));if(p.nodeName==m){J.setStart(p,0)}else{J.setStartBefore(p)}J.setEnd(O,N);C.appendChild(J.cloneContents()||R.createTextNode(\"\"));try{K.setEndAfter(x)}catch(P){}K.setStart(q,o);T.appendChild(K.cloneContents()||R.createTextNode(\"\"));G=R.createRange();if(!p.previousSibling&&p.parentNode.nodeName==m){G.setStartBefore(p.parentNode)}else{if(J.startContainer.nodeName==m&&J.startOffset==0){G.setStartBefore(J.startContainer)}else{G.setStart(J.startContainer,J.startOffset)}}if(!x.nextSibling&&x.parentNode.nodeName==m){G.setEndAfter(x.parentNode)}else{G.setEnd(K.endContainer,K.endOffset)}G.deleteContents();if(b){v.getWin().scrollTo(0,L.y)}if(C.firstChild&&C.firstChild.nodeName==m){C.innerHTML=C.firstChild.innerHTML}if(T.firstChild&&T.firstChild.nodeName==m){T.innerHTML=T.firstChild.innerHTML}function S(y,s){var r=[],X,W,t;y.innerHTML=\"\";if(V.keep_styles){W=s;do{if(/^(SPAN|STRONG|B|EM|I|FONT|STRIKE|U)$/.test(W.nodeName)){X=W.cloneNode(g);M.setAttrib(X,\"id\",\"\");r.push(X)}}while(W=W.parentNode)}if(r.length>0){for(t=r.length-1,X=y;t>=0;t--){X=X.appendChild(r[t])}r[0].innerHTML=b?\"\\u00a0\":\"<br />\";return r[0]}else{y.innerHTML=b?\"\\u00a0\":\"<br />\"}}if(M.isEmpty(C)){S(C,O)}if(M.isEmpty(T)){A=S(T,q)}if(b&&parseFloat(opera.version())<9.5){G.insertNode(C);G.insertNode(T)}else{G.insertNode(T);G.insertNode(C)}T.normalize();C.normalize();v.selection.select(T,true);v.selection.collapse(true);B=v.dom.getPos(T).y;if(B<L.y||B+25>L.y+L.h){v.getWin().scrollTo(0,B<L.y?B:B-L.h+25)}v.undoManager.add();return g},backspaceDelete:function(u,B){var C=this,s=C.editor,y=s.getBody(),q=s.dom,p,v=s.selection,o=v.getRng(),x=o.startContainer,p,z,A,m;if(!B&&o.collapsed&&x.nodeType==1&&o.startOffset==x.childNodes.length){m=new l.dom.TreeWalker(x.lastChild,x);for(p=x.lastChild;p;p=m.prev()){if(p.nodeType==3){o.setStart(p,p.nodeValue.length);o.collapse(true);v.setRng(o);return}}}if(x&&s.dom.isBlock(x)&&!/^(TD|TH)$/.test(x.nodeName)&&B){if(x.childNodes.length==0||(x.childNodes.length==1&&x.firstChild.nodeName==\"BR\")){p=x;while((p=p.previousSibling)&&!s.dom.isBlock(p)){}if(p){if(x!=y.firstChild){z=s.dom.doc.createTreeWalker(p,NodeFilter.SHOW_TEXT,null,g);while(A=z.nextNode()){p=A}o=s.getDoc().createRange();o.setStart(p,p.nodeValue?p.nodeValue.length:0);o.setEnd(p,p.nodeValue?p.nodeValue.length:0);v.setRng(o);s.dom.remove(x)}return j.cancel(u)}}}}})})(tinymce);(function(c){var b=c.DOM,a=c.dom.Event,d=c.each,e=c.extend;c.create(\"tinymce.ControlManager\",{ControlManager:function(f,j){var h=this,g;j=j||{};h.editor=f;h.controls={};h.onAdd=new c.util.Dispatcher(h);h.onPostRender=new c.util.Dispatcher(h);h.prefix=j.prefix||f.id+\"_\";h._cls={};h.onPostRender.add(function(){d(h.controls,function(i){i.postRender()})})},get:function(f){return this.controls[this.prefix+f]||this.controls[f]},setActive:function(h,f){var g=null;if(g=this.get(h)){g.setActive(f)}return g},setDisabled:function(h,f){var g=null;if(g=this.get(h)){g.setDisabled(f)}return g},add:function(g){var f=this;if(g){f.controls[g.id]=g;f.onAdd.dispatch(g,f)}return g},createControl:function(i){var h,g=this,f=g.editor;d(f.plugins,function(j){if(j.createControl){h=j.createControl(i,g);if(h){return false}}});switch(i){case\"|\":case\"separator\":return g.createSeparator()}if(!h&&f.buttons&&(h=f.buttons[i])){return g.createButton(i,h)}return g.add(h)},createDropMenu:function(f,n,h){var m=this,i=m.editor,j,g,k,l;n=e({\"class\":\"mceDropDown\",constrain:i.settings.constrain_menus},n);n[\"class\"]=n[\"class\"]+\" \"+i.getParam(\"skin\")+\"Skin\";if(k=i.getParam(\"skin_variant\")){n[\"class\"]+=\" \"+i.getParam(\"skin\")+\"Skin\"+k.substring(0,1).toUpperCase()+k.substring(1)}f=m.prefix+f;l=h||m._cls.dropmenu||c.ui.DropMenu;j=m.controls[f]=new l(f,n);j.onAddItem.add(function(r,q){var p=q.settings;p.title=i.getLang(p.title,p.title);if(!p.onclick){p.onclick=function(o){if(p.cmd){i.execCommand(p.cmd,p.ui||false,p.value)}}}});i.onRemove.add(function(){j.destroy()});if(c.isIE){j.onShowMenu.add(function(){i.focus();g=i.selection.getBookmark(1)});j.onHideMenu.add(function(){if(g){i.selection.moveToBookmark(g);g=0}})}return m.add(j)},createListBox:function(f,n,h){var l=this,j=l.editor,i,k,m;if(l.get(f)){return null}n.title=j.translate(n.title);n.scope=n.scope||j;if(!n.onselect){n.onselect=function(o){j.execCommand(n.cmd,n.ui||false,o||n.value)}}n=e({title:n.title,\"class\":\"mce_\"+f,scope:n.scope,control_manager:l},n);f=l.prefix+f;function g(o){return o.settings.use_accessible_selects&&!c.isGecko}if(j.settings.use_native_selects||g(j)){k=new c.ui.NativeListBox(f,n)}else{m=h||l._cls.listbox||c.ui.ListBox;k=new m(f,n,j)}l.controls[f]=k;if(c.isWebKit){k.onPostRender.add(function(p,o){a.add(o,\"mousedown\",function(){j.bookmark=j.selection.getBookmark(1)});a.add(o,\"focus\",function(){j.selection.moveToBookmark(j.bookmark);j.bookmark=null})})}if(k.hideMenu){j.onMouseDown.add(k.hideMenu,k)}return l.add(k)},createButton:function(m,i,l){var h=this,g=h.editor,j,k,f;if(h.get(m)){return null}i.title=g.translate(i.title);i.label=g.translate(i.label);i.scope=i.scope||g;if(!i.onclick&&!i.menu_button){i.onclick=function(){g.execCommand(i.cmd,i.ui||false,i.value)}}i=e({title:i.title,\"class\":\"mce_\"+m,unavailable_prefix:g.getLang(\"unavailable\",\"\"),scope:i.scope,control_manager:h},i);m=h.prefix+m;if(i.menu_button){f=l||h._cls.menubutton||c.ui.MenuButton;k=new f(m,i,g);g.onMouseDown.add(k.hideMenu,k)}else{f=h._cls.button||c.ui.Button;k=new f(m,i,g)}return h.add(k)},createMenuButton:function(h,f,g){f=f||{};f.menu_button=1;return this.createButton(h,f,g)},createSplitButton:function(m,i,l){var h=this,g=h.editor,j,k,f;if(h.get(m)){return null}i.title=g.translate(i.title);i.scope=i.scope||g;if(!i.onclick){i.onclick=function(n){g.execCommand(i.cmd,i.ui||false,n||i.value)}}if(!i.onselect){i.onselect=function(n){g.execCommand(i.cmd,i.ui||false,n||i.value)}}i=e({title:i.title,\"class\":\"mce_\"+m,scope:i.scope,control_manager:h},i);m=h.prefix+m;f=l||h._cls.splitbutton||c.ui.SplitButton;k=h.add(new f(m,i,g));g.onMouseDown.add(k.hideMenu,k);return k},createColorSplitButton:function(f,n,h){var l=this,j=l.editor,i,k,m,g;if(l.get(f)){return null}n.title=j.translate(n.title);n.scope=n.scope||j;if(!n.onclick){n.onclick=function(o){if(c.isIE){g=j.selection.getBookmark(1)}j.execCommand(n.cmd,n.ui||false,o||n.value)}}if(!n.onselect){n.onselect=function(o){j.execCommand(n.cmd,n.ui||false,o||n.value)}}n=e({title:n.title,\"class\":\"mce_\"+f,menu_class:j.getParam(\"skin\")+\"Skin\",scope:n.scope,more_colors_title:j.getLang(\"more_colors\")},n);f=l.prefix+f;m=h||l._cls.colorsplitbutton||c.ui.ColorSplitButton;k=new m(f,n,j);j.onMouseDown.add(k.hideMenu,k);j.onRemove.add(function(){k.destroy()});if(c.isIE){k.onShowMenu.add(function(){j.focus();g=j.selection.getBookmark(1)});k.onHideMenu.add(function(){if(g){j.selection.moveToBookmark(g);g=0}})}return l.add(k)},createToolbar:function(k,h,j){var i,g=this,f;k=g.prefix+k;f=j||g._cls.toolbar||c.ui.Toolbar;i=new f(k,h,g.editor);if(g.get(k)){return null}return g.add(i)},createToolbarGroup:function(k,h,j){var i,g=this,f;k=g.prefix+k;f=j||this._cls.toolbarGroup||c.ui.ToolbarGroup;i=new f(k,h,g.editor);if(g.get(k)){return null}return g.add(i)},createSeparator:function(g){var f=g||this._cls.separator||c.ui.Separator;return new f()},setControlType:function(g,f){return this._cls[g.toLowerCase()]=f},destroy:function(){d(this.controls,function(f){f.destroy()});this.controls=null}})})(tinymce);(function(d){var a=d.util.Dispatcher,e=d.each,c=d.isIE,b=d.isOpera;d.create(\"tinymce.WindowManager\",{WindowManager:function(f){var g=this;g.editor=f;g.onOpen=new a(g);g.onClose=new a(g);g.params={};g.features={}},open:function(z,h){var v=this,k=\"\",n,m,i=v.editor.settings.dialog_type==\"modal\",q,o,j,g=d.DOM.getViewPort(),r;z=z||{};h=h||{};o=b?g.w:screen.width;j=b?g.h:screen.height;z.name=z.name||\"mc_\"+new Date().getTime();z.width=parseInt(z.width||320);z.height=parseInt(z.height||240);z.resizable=true;z.left=z.left||parseInt(o/2)-(z.width/2);z.top=z.top||parseInt(j/2)-(z.height/2);h.inline=false;h.mce_width=z.width;h.mce_height=z.height;h.mce_auto_focus=z.auto_focus;if(i){if(c){z.center=true;z.help=false;z.dialogWidth=z.width+\"px\";z.dialogHeight=z.height+\"px\";z.scroll=z.scrollbars||false}}e(z,function(p,f){if(d.is(p,\"boolean\")){p=p?\"yes\":\"no\"}if(!/^(name|url)$/.test(f)){if(c&&i){k+=(k?\";\":\"\")+f+\":\"+p}else{k+=(k?\",\":\"\")+f+\"=\"+p}}});v.features=z;v.params=h;v.onOpen.dispatch(v,z,h);r=z.url||z.file;r=d._addVer(r);try{if(c&&i){q=1;window.showModalDialog(r,window,k)}else{q=window.open(r,z.name,k)}}catch(l){}if(!q){alert(v.editor.getLang(\"popup_blocked\"))}},close:function(f){f.close();this.onClose.dispatch(this)},createInstance:function(i,h,g,m,l,k){var j=d.resolve(i);return new j(h,g,m,l,k)},confirm:function(h,f,i,g){g=g||window;f.call(i||this,g.confirm(this._decode(this.editor.getLang(h,h))))},alert:function(h,f,j,g){var i=this;g=g||window;g.alert(i._decode(i.editor.getLang(h,h)));if(f){f.call(j||i)}},resizeBy:function(f,g,h){h.resizeBy(f,g)},_decode:function(f){return d.DOM.decode(f).replace(/\\\\n/g,\"\\n\")}})}(tinymce));(function(a){a.Formatter=function(U){var M={},O=a.each,c=U.dom,q=U.selection,t=a.dom.TreeWalker,K=new a.dom.RangeUtils(c),d=U.schema.isValidChild,F=c.isBlock,l=U.settings.forced_root_block,s=c.nodeIndex,E=\"\\uFEFF\",e=/^(src|href|style)$/,R=false,B=true,p;function z(V){return V instanceof Array}function m(W,V){return c.getParents(W,V,c.getRoot())}function b(V){return V.nodeType===1&&(V.face===\"mceinline\"||V.style.fontFamily===\"mceinline\")}function Q(V){return V?M[V]:M}function k(V,W){if(V){if(typeof(V)!==\"string\"){O(V,function(Y,X){k(X,Y)})}else{W=W.length?W:[W];O(W,function(X){if(X.deep===p){X.deep=!X.selector}if(X.split===p){X.split=!X.selector||X.inline}if(X.remove===p&&X.selector&&!X.inline){X.remove=\"none\"}if(X.selector&&X.inline){X.mixed=true;X.block_expand=true}if(typeof(X.classes)===\"string\"){X.classes=X.classes.split(/\\s+/)}});M[V]=W}}}var i=function(W){var V;U.dom.getParent(W,function(X){V=U.dom.getStyle(X,\"text-decoration\");return V&&V!==\"none\"});return V};var I=function(V){var W;if(V.nodeType===1&&V.parentNode&&V.parentNode.nodeType===1){W=i(V.parentNode);if(U.dom.getStyle(V,\"color\")&&W){U.dom.setStyle(V,\"text-decoration\",W)}else{if(U.dom.getStyle(V,\"textdecoration\")===W){U.dom.setStyle(V,\"text-decoration\",null)}}}};function S(Y,ag,ab){var ac=Q(Y),ah=ac[0],af,W,ae,ad=q.isCollapsed();function Z(al){var ak=al.startContainer,ao=al.startOffset,an,am;if(ak.nodeType==1||ak.nodeValue===\"\"){ak=ak.nodeType==1?ak.childNodes[ao]:ak;if(ak){an=new t(ak,ak.parentNode);for(am=an.current();am;am=an.next()){if(am.nodeType==3&&!f(am)){al.setStart(am,0);break}}}}return al}function V(al,ak){ak=ak||ah;if(al){if(ak.onformat){ak.onformat(al,ak,ag,ab)}O(ak.styles,function(an,am){c.setStyle(al,am,r(an,ag))});O(ak.attributes,function(an,am){c.setAttrib(al,am,r(an,ag))});O(ak.classes,function(am){am=r(am,ag);if(!c.hasClass(al,am)){c.addClass(al,am)}})}}function aa(){function am(at,aq){var ar=new t(aq);for(ab=ar.current();ab;ab=ar.prev()){if(ab.childNodes.length>1||ab==at){return ab}}}var al=U.selection.getRng();var ap=al.startContainer;var ak=al.endContainer;if(ap!=ak&&al.endOffset==0){var ao=am(ap,ak);var an=ao.nodeType==3?ao.length:ao.childNodes.length;al.setEnd(ao,an)}return al}function X(an,at,aq,ap,al){var ak=[],am=-1,ar,av=-1,ao=-1,au;O(an.childNodes,function(ax,aw){if(ax.nodeName===\"UL\"||ax.nodeName===\"OL\"){am=aw;ar=ax;return false}});O(an.childNodes,function(ax,aw){if(ax.nodeName===\"SPAN\"&&c.getAttrib(ax,\"data-mce-type\")==\"bookmark\"){if(ax.id==at.id+\"_start\"){av=aw}else{if(ax.id==at.id+\"_end\"){ao=aw}}}});if(am<=0||(av<am&&ao>am)){O(a.grep(an.childNodes),al);return 0}else{au=aq.cloneNode(R);O(a.grep(an.childNodes),function(ax,aw){if((av<am&&aw<am)||(av>am&&aw>am)){ak.push(ax);ax.parentNode.removeChild(ax)}});if(av<am){an.insertBefore(au,ar)}else{if(av>am){an.insertBefore(au,ar.nextSibling)}}ap.push(au);O(ak,function(aw){au.appendChild(aw)});return au}}function ai(al,an,ap){var ak=[],ao,am;ao=ah.inline||ah.block;am=c.create(ao);V(am);K.walk(al,function(aq){var ar;function at(au){var ax=au.nodeName.toLowerCase(),aw=au.parentNode.nodeName.toLowerCase(),av;if(g(ax,\"br\")){ar=0;if(ah.block){c.remove(au)}return}if(ah.wrapper&&x(au,Y,ag)){ar=0;return}if(ah.block&&!ah.wrapper&&G(ax)){au=c.rename(au,ao);V(au);ak.push(au);ar=0;return}if(ah.selector){O(ac,function(ay){if(\"collapsed\" in ay&&ay.collapsed!==ad){return}if(c.is(au,ay.selector)&&!b(au)){V(au,ay);av=true}});if(!ah.inline||av){ar=0;return}}if(d(ao,ax)&&d(aw,ao)&&!(!ap&&au.nodeType===3&&au.nodeValue.length===1&&au.nodeValue.charCodeAt(0)===65279)&&au.id!==\"_mce_caret\"){if(!ar){ar=am.cloneNode(R);au.parentNode.insertBefore(ar,au);ak.push(ar)}ar.appendChild(au)}else{if(ax==\"li\"&&an){ar=X(au,an,am,ak,at)}else{ar=0;O(a.grep(au.childNodes),at);ar=0}}}O(aq,at)});if(ah.wrap_links===false){O(ak,function(aq){function ar(aw){var av,au,at;if(aw.nodeName===\"A\"){au=am.cloneNode(R);ak.push(au);at=a.grep(aw.childNodes);for(av=0;av<at.length;av++){au.appendChild(at[av])}aw.appendChild(au)}O(a.grep(aw.childNodes),ar)}ar(aq)})}O(ak,function(at){var aq;function au(aw){var av=0;O(aw.childNodes,function(ax){if(!f(ax)&&!H(ax)){av++}});return av}function ar(av){var ax,aw;O(av.childNodes,function(ay){if(ay.nodeType==1&&!H(ay)&&!b(ay)){ax=ay;return R}});if(ax&&h(ax,ah)){aw=ax.cloneNode(R);V(aw);c.replace(aw,av,B);c.remove(ax,1)}return aw||av}aq=au(at);if((ak.length>1||!F(at))&&aq===0){c.remove(at,1);return}if(ah.inline||ah.wrapper){if(!ah.exact&&aq===1){at=ar(at)}O(ac,function(av){O(c.select(av.inline,at),function(ax){var aw;if(av.wrap_links===false){aw=ax.parentNode;do{if(aw.nodeName===\"A\"){return}}while(aw=aw.parentNode)}T(av,ag,ax,av.exact?ax:null)})});if(x(at.parentNode,Y,ag)){c.remove(at,1);at=0;return B}if(ah.merge_with_parents){c.getParent(at.parentNode,function(av){if(x(av,Y,ag)){c.remove(at,1);at=0;return B}})}if(at&&ah.merge_siblings!==false){at=u(C(at),at);at=u(at,C(at,B))}}})}if(ah){if(ab){if(ab.nodeType){W=c.createRng();W.setStartBefore(ab);W.setEndAfter(ab);ai(o(W,ac),null,true)}else{ai(ab,null,true)}}else{if(!ad||!ah.inline||c.select(\"td.mceSelected,th.mceSelected\").length){var aj=U.selection.getNode();U.selection.setRng(aa());af=q.getBookmark();ai(o(q.getRng(B),ac),af);if(ah.styles&&(ah.styles.color||ah.styles.textDecoration)){a.walk(aj,I,\"childNodes\");I(aj)}q.moveToBookmark(af);q.setRng(Z(q.getRng(B)));U.nodeChanged()}else{P(\"apply\",Y,ag)}}}}function A(X,ag,aa){var ab=Q(X),ai=ab[0],af,ae,W;function Z(al){var ak=al.startContainer,aq=al.startOffset,ap,ao,am,an;if(ak.nodeType==3&&aq>=ak.nodeValue.length-1){ak=ak.parentNode;aq=s(ak)+1}if(ak.nodeType==1){am=ak.childNodes;ak=am[Math.min(aq,am.length-1)];ap=new t(ak);if(aq>am.length-1){ap.next()}for(ao=ap.current();ao;ao=ap.next()){if(ao.nodeType==3&&!f(ao)){an=c.create(\"a\",null,E);ao.parentNode.insertBefore(an,ao);al.setStart(ao,0);q.setRng(al);c.remove(an);return}}}}function Y(an){var am,al,ak;am=a.grep(an.childNodes);for(al=0,ak=ab.length;al<ak;al++){if(T(ab[al],ag,an,an)){break}}if(ai.deep){for(al=0,ak=am.length;al<ak;al++){Y(am[al])}}}function ac(ak){var al;O(m(ak.parentNode).reverse(),function(am){var an;if(!al&&am.id!=\"_start\"&&am.id!=\"_end\"){an=x(am,X,ag);if(an&&an.split!==false){al=am}}});return al}function V(an,ak,ap,at){var au,ar,aq,am,ao,al;if(an){al=an.parentNode;for(au=ak.parentNode;au&&au!=al;au=au.parentNode){ar=au.cloneNode(R);for(ao=0;ao<ab.length;ao++){if(T(ab[ao],ag,ar,ar)){ar=0;break}}if(ar){if(aq){ar.appendChild(aq)}if(!am){am=ar}aq=ar}}if(at&&(!ai.mixed||!F(an))){ak=c.split(an,ak)}if(aq){ap.parentNode.insertBefore(aq,ap);am.appendChild(ap)}}return ak}function ah(ak){return V(ac(ak),ak,ak,true)}function ad(am){var al=c.get(am?\"_start\":\"_end\"),ak=al[am?\"firstChild\":\"lastChild\"];if(H(ak)){ak=ak[am?\"firstChild\":\"lastChild\"]}c.remove(al,true);return ak}function aj(ak){var al,am;ak=o(ak,ab,B);if(ai.split){al=J(ak,B);am=J(ak);if(al!=am){al=N(al,\"span\",{id:\"_start\",\"data-mce-type\":\"bookmark\"});am=N(am,\"span\",{id:\"_end\",\"data-mce-type\":\"bookmark\"});ah(al);ah(am);al=ad(B);am=ad()}else{al=am=ah(al)}ak.startContainer=al.parentNode;ak.startOffset=s(al);ak.endContainer=am.parentNode;ak.endOffset=s(am)+1}K.walk(ak,function(an){O(an,function(ao){Y(ao);if(ao.nodeType===1&&U.dom.getStyle(ao,\"text-decoration\")===\"underline\"&&ao.parentNode&&i(ao.parentNode)===\"underline\"){T({deep:false,exact:true,inline:\"span\",styles:{textDecoration:\"underline\"}},null,ao)}})})}if(aa){if(aa.nodeType){W=c.createRng();W.setStartBefore(aa);W.setEndAfter(aa);aj(W)}else{aj(aa)}return}if(!q.isCollapsed()||!ai.inline||c.select(\"td.mceSelected,th.mceSelected\").length){af=q.getBookmark();aj(q.getRng(B));q.moveToBookmark(af);if(ai.inline&&j(X,ag,q.getStart())){Z(q.getRng(true))}U.nodeChanged()}else{P(\"remove\",X,ag)}if(a.isWebKit){U.execCommand(\"mceCleanup\")}}function D(W,Y,X){var V=Q(W);if(j(W,Y,X)&&(!(\"toggle\" in V[0])||V[0][\"toggle\"])){A(W,Y,X)}else{S(W,Y,X)}}function x(W,V,ab,Z){var X=Q(V),ac,aa,Y;function ad(ah,aj,ak){var ag,ai,ae=aj[ak],af;if(aj.onmatch){return aj.onmatch(ah,aj,ak)}if(ae){if(ae.length===p){for(ag in ae){if(ae.hasOwnProperty(ag)){if(ak===\"attributes\"){ai=c.getAttrib(ah,ag)}else{ai=L(ah,ag)}if(Z&&!ai&&!aj.exact){return}if((!Z||aj.exact)&&!g(ai,r(ae[ag],ab))){return}}}}else{for(af=0;af<ae.length;af++){if(ak===\"attributes\"?c.getAttrib(ah,ae[af]):L(ah,ae[af])){return aj}}}}return aj}if(X&&W){for(aa=0;aa<X.length;aa++){ac=X[aa];if(h(W,ac)&&ad(W,ac,\"attributes\")&&ad(W,ac,\"styles\")){if(Y=ac.classes){for(aa=0;aa<Y.length;aa++){if(!c.hasClass(W,Y[aa])){return}}}return ac}}}}function j(X,Z,Y){var W;function V(aa){aa=c.getParent(aa,function(ab){return !!x(ab,X,Z,true)});return x(aa,X,Z)}if(Y){return V(Y)}Y=q.getNode();if(V(Y)){return B}W=q.getStart();if(W!=Y){if(V(W)){return B}}return R}function v(ac,ab){var Z,aa=[],Y={},X,W,V;Z=q.getStart();c.getParent(Z,function(af){var ae,ad;for(ae=0;ae<ac.length;ae++){ad=ac[ae];if(!Y[ad]&&x(af,ad,ab)){Y[ad]=true;aa.push(ad)}}});return aa}function y(Z){var ab=Q(Z),Y,X,aa,W,V;if(ab){Y=q.getStart();X=m(Y);for(W=ab.length-1;W>=0;W--){V=ab[W].selector;if(!V){return B}for(aa=X.length-1;aa>=0;aa--){if(c.is(X[aa],V)){return B}}}}return R}a.extend(this,{get:Q,register:k,apply:S,remove:A,toggle:D,match:j,matchAll:v,matchNode:x,canApply:y});function h(V,W){if(g(V,W.inline)){return B}if(g(V,W.block)){return B}if(W.selector){return c.is(V,W.selector)}}function g(W,V){W=W||\"\";V=V||\"\";W=\"\"+(W.nodeName||W);V=\"\"+(V.nodeName||V);return W.toLowerCase()==V.toLowerCase()}function L(W,V){var X=c.getStyle(W,V);if(V==\"color\"||V==\"backgroundColor\"){X=c.toHex(X)}if(V==\"fontWeight\"&&X==700){X=\"bold\"}return\"\"+X}function r(V,W){if(typeof(V)!=\"string\"){V=V(W)}else{if(W){V=V.replace(/%(\\w+)/g,function(Y,X){return W[X]||Y})}}return V}function f(V){return V&&V.nodeType===3&&/^([\\t \\r\\n]+|)$/.test(V.nodeValue)}function N(X,W,V){var Y=c.create(W,V);X.parentNode.insertBefore(Y,X);Y.appendChild(X);return Y}function o(V,ah,Y){var X=V.startContainer,ac=V.startOffset,ak=V.endContainer,ae=V.endOffset,aj,ag,ab,af;function ai(aq){var al,ao,ap,an,am;al=ao=aq?X:ak;am=aq?\"previousSibling\":\"nextSibling\";root=c.getRoot();if(al.nodeType==3&&!f(al)){if(aq?ac>0:ae<al.nodeValue.length){return al}}for(;;){if(ao==root||(!ah[0].block_expand&&F(ao))){return ao}for(an=ao[am];an;an=an[am]){if(!H(an)&&!f(an)){return ao}}ao=ao.parentNode}return al}function aa(al,am){if(am===p){am=al.nodeType===3?al.length:al.childNodes.length}while(al&&al.hasChildNodes()){al=al.childNodes[am];if(al){am=al.nodeType===3?al.length:al.childNodes.length}}return{node:al,offset:am}}if(X.nodeType==1&&X.hasChildNodes()){ag=X.childNodes.length-1;X=X.childNodes[ac>ag?ag:ac];if(X.nodeType==3){ac=0}}if(ak.nodeType==1&&ak.hasChildNodes()){ag=ak.childNodes.length-1;ak=ak.childNodes[ae>ag?ag:ae-1];if(ak.nodeType==3){ae=ak.nodeValue.length}}if(H(X.parentNode)||H(X)){X=H(X)?X:X.parentNode;X=X.nextSibling||X;if(X.nodeType==3){ac=0}}if(H(ak.parentNode)||H(ak)){ak=H(ak)?ak:ak.parentNode;ak=ak.previousSibling||ak;if(ak.nodeType==3){ae=ak.length}}if(ah[0].inline){if(V.collapsed){function ad(am,aq,at){var ap,an,ar,al;function ao(av,ax){var ay,au,aw=av.nodeValue;if(typeof(ax)==\"undefined\"){ax=at?aw.length:0}if(at){ay=aw.lastIndexOf(\" \",ax);au=aw.lastIndexOf(\"\\u00a0\",ax);ay=ay>au?ay:au;if(ay!==-1&&!Y){ay++}}else{ay=aw.indexOf(\" \",ax);au=aw.indexOf(\"\\u00a0\",ax);ay=ay!==-1&&(au===-1||ay<au)?ay:au}return ay}if(am.nodeType===3){ar=ao(am,aq);if(ar!==-1){return{container:am,offset:ar}}al=am}ap=new t(am,c.getParent(am,F)||U.getBody());while(an=ap[at?\"prev\":\"next\"]()){if(an.nodeType===3){al=an;ar=ao(an);if(ar!==-1){return{container:an,offset:ar}}}else{if(F(an)){break}}}if(al){if(at){aq=0}else{aq=al.length}return{container:al,offset:aq}}}af=ad(X,ac,true);if(af){X=af.container;ac=af.offset}af=ad(ak,ae);if(af){ak=af.container;ae=af.offset}}ab=aa(ak,ae);if(ab.node){while(ab.node&&ab.offset===0&&ab.node.previousSibling){ab=aa(ab.node.previousSibling)}if(ab.node&&ab.offset>0&&ab.node.nodeType===3&&ab.node.nodeValue.charAt(ab.offset-1)===\" \"){if(ab.offset>1){ak=ab.node;ak.splitText(ab.offset-1)}else{if(ab.node.previousSibling){}}}}}if(ah[0].inline||ah[0].block_expand){if(!ah[0].inline||(X.nodeType!=3||ac===0)){X=ai(true)}if(!ah[0].inline||(ak.nodeType!=3||ae===ak.nodeValue.length)){ak=ai()}}if(ah[0].selector&&ah[0].expand!==R&&!ah[0].inline){function Z(am,al){var an,ao,aq,ap;if(am.nodeType==3&&am.nodeValue.length==0&&am[al]){am=am[al]}an=m(am);for(ao=0;ao<an.length;ao++){for(aq=0;aq<ah.length;aq++){ap=ah[aq];if(\"collapsed\" in ap&&ap.collapsed!==V.collapsed){continue}if(c.is(an[ao],ap.selector)){return an[ao]}}}return am}X=Z(X,\"previousSibling\");ak=Z(ak,\"nextSibling\")}if(ah[0].block||ah[0].selector){function W(am,al,ao){var an;if(!ah[0].wrapper){an=c.getParent(am,ah[0].block)}if(!an){an=c.getParent(am.nodeType==3?am.parentNode:am,F)}if(an&&ah[0].wrapper){an=m(an,\"ul,ol\").reverse()[0]||an}if(!an){an=am;while(an[al]&&!F(an[al])){an=an[al];if(g(an,\"br\")){break}}}return an||am}X=W(X,\"previousSibling\");ak=W(ak,\"nextSibling\");if(ah[0].block){if(!F(X)){X=ai(true)}if(!F(ak)){ak=ai()}}}if(X.nodeType==1){ac=s(X);X=X.parentNode}if(ak.nodeType==1){ae=s(ak)+1;ak=ak.parentNode}return{startContainer:X,startOffset:ac,endContainer:ak,endOffset:ae}}function T(ab,aa,Y,V){var X,W,Z;if(!h(Y,ab)){return R}if(ab.remove!=\"all\"){O(ab.styles,function(ad,ac){ad=r(ad,aa);if(typeof(ac)===\"number\"){ac=ad;V=0}if(!V||g(L(V,ac),ad)){c.setStyle(Y,ac,\"\")}Z=1});if(Z&&c.getAttrib(Y,\"style\")==\"\"){Y.removeAttribute(\"style\");Y.removeAttribute(\"data-mce-style\")}O(ab.attributes,function(ae,ac){var ad;ae=r(ae,aa);if(typeof(ac)===\"number\"){ac=ae;V=0}if(!V||g(c.getAttrib(V,ac),ae)){if(ac==\"class\"){ae=c.getAttrib(Y,ac);if(ae){ad=\"\";O(ae.split(/\\s+/),function(af){if(/mce\\w+/.test(af)){ad+=(ad?\" \":\"\")+af}});if(ad){c.setAttrib(Y,ac,ad);return}}}if(ac==\"class\"){Y.removeAttribute(\"className\")}if(e.test(ac)){Y.removeAttribute(\"data-mce-\"+ac)}Y.removeAttribute(ac)}});O(ab.classes,function(ac){ac=r(ac,aa);if(!V||c.hasClass(V,ac)){c.removeClass(Y,ac)}});W=c.getAttribs(Y);for(X=0;X<W.length;X++){if(W[X].nodeName.indexOf(\"_\")!==0){return R}}}if(ab.remove!=\"none\"){n(Y,ab);return B}}function n(X,Y){var V=X.parentNode,W;if(Y.block){if(!l){function Z(ab,aa,ac){ab=C(ab,aa,ac);return !ab||(ab.nodeName==\"BR\"||F(ab))}if(F(X)&&!F(V)){if(!Z(X,R)&&!Z(X.firstChild,B,1)){X.insertBefore(c.create(\"br\"),X.firstChild)}if(!Z(X,B)&&!Z(X.lastChild,R,1)){X.appendChild(c.create(\"br\"))}}}else{if(V==c.getRoot()){if(!Y.list_block||!g(X,Y.list_block)){O(a.grep(X.childNodes),function(aa){if(d(l,aa.nodeName.toLowerCase())){if(!W){W=N(aa,l)}else{W.appendChild(aa)}}else{W=0}})}}}}if(Y.selector&&Y.inline&&!g(Y.inline,X)){return}c.remove(X,1)}function C(W,V,X){if(W){V=V?\"nextSibling\":\"previousSibling\";for(W=X?W:W[V];W;W=W[V]){if(W.nodeType==1||!f(W)){return W}}}}function H(V){return V&&V.nodeType==1&&V.getAttribute(\"data-mce-type\")==\"bookmark\"}function u(Z,Y){var V,X,W;function ab(ae,ad){if(ae.nodeName!=ad.nodeName){return R}function ac(ag){var ah={};O(c.getAttribs(ag),function(ai){var aj=ai.nodeName.toLowerCase();if(aj.indexOf(\"_\")!==0&&aj!==\"style\"){ah[aj]=c.getAttrib(ag,aj)}});return ah}function af(aj,ai){var ah,ag;for(ag in aj){if(aj.hasOwnProperty(ag)){ah=ai[ag];if(ah===p){return R}if(aj[ag]!=ah){return R}delete ai[ag]}}for(ag in ai){if(ai.hasOwnProperty(ag)){return R}}return B}if(!af(ac(ae),ac(ad))){return R}if(!af(c.parseStyle(c.getAttrib(ae,\"style\")),c.parseStyle(c.getAttrib(ad,\"style\")))){return R}return B}if(Z&&Y){function aa(ad,ac){for(X=ad;X;X=X[ac]){if(X.nodeType==3&&X.nodeValue.length!==0){return ad}if(X.nodeType==1&&!H(X)){return X}}return ad}Z=aa(Z,\"previousSibling\");Y=aa(Y,\"nextSibling\");if(ab(Z,Y)){for(X=Z.nextSibling;X&&X!=Y;){W=X;X=X.nextSibling;Z.appendChild(W)}c.remove(Y);O(a.grep(Y.childNodes),function(ac){Z.appendChild(ac)});return Z}}return Y}function G(V){return/^(h[1-6]|p|div|pre|address|dl|dt|dd)$/.test(V)}function J(W,aa){var V,Z,X,Y;V=W[aa?\"startContainer\":\"endContainer\"];Z=W[aa?\"startOffset\":\"endOffset\"];if(V.nodeType==1){X=V.childNodes.length-1;if(!aa&&Z){Z--}V=V.childNodes[Z>X?X:Z]}if(V.nodeType===3&&aa&&Z>=V.nodeValue.length){V=new t(V,U.getBody()).next()||V}if(V.nodeType===3&&!aa&&Z==0){V=new t(V,U.getBody()).prev()||V}return V}function P(ae,V,ac){var ah,af=\"_mce_caret\",W=U.settings.caret_debug;ah=a.isGecko?\"\\u200B\":E;function X(aj){var ai=c.create(\"span\",{id:af,\"data-mce-bogus\":true,style:W?\"color:red\":\"\"});if(aj){ai.appendChild(U.getDoc().createTextNode(ah))}return ai}function ad(aj,ai){while(aj){if((aj.nodeType===3&&aj.nodeValue!==ah)||aj.childNodes.length>1){return false}if(ai&&aj.nodeType===1){ai.push(aj)}aj=aj.firstChild}return true}function aa(ai){while(ai){if(ai.id===af){return ai}ai=ai.parentNode}}function Z(ai){var aj;if(ai){aj=new t(ai,ai);for(ai=aj.current();ai;ai=aj.next()){if(ai.nodeType===3){return ai}}}}function Y(ak,aj){var al,ai;if(!ak){ak=aa(q.getStart());if(!ak){while(ak=c.get(af)){Y(ak,false)}}}else{ai=q.getRng(true);if(ad(ak)){if(aj!==false){ai.setStartBefore(ak);ai.setEndBefore(ak)}c.remove(ak)}else{al=Z(ak);al=al.deleteData(0,1);c.remove(ak,1)}q.setRng(ai)}}function ab(){var ak,ai,ao,an,al,aj,am;ak=q.getRng(true);an=ak.startOffset;aj=ak.startContainer;am=aj.nodeValue;ai=aa(q.getStart());if(ai){ao=Z(ai)}if(am&&an>0&&an<am.length&&/\\w/.test(am.charAt(an))&&/\\w/.test(am.charAt(an-1))){al=q.getBookmark();ak.collapse(true);ak=o(ak,Q(V));ak=K.split(ak);S(V,ac,ak);q.moveToBookmark(al)}else{if(!ai||ao.nodeValue!==ah){ai=X(true);ao=ai.firstChild;ak.insertNode(ai);an=1;S(V,ac,ai)}else{S(V,ac,ai)}q.setCursorLocation(ao,an)}}function ag(){var ai=q.getRng(true),aj,al,ao,an,ak,ar,aq=[],am,ap;aj=ai.startContainer;al=ai.startOffset;ak=aj;if(aj.nodeType==3){if(al!=aj.nodeValue.length||aj.nodeValue===ah){an=true}ak=ak.parentNode}while(ak){if(x(ak,V,ac)){ar=ak;break}if(ak.nextSibling){an=true}aq.push(ak);ak=ak.parentNode}if(!ar){return}if(an){ao=q.getBookmark();ai.collapse(true);ai=o(ai,Q(V),true);ai=K.split(ai);A(V,ac,ai);q.moveToBookmark(ao)}else{ap=X();ak=ap;for(am=aq.length-1;am>=0;am--){ak.appendChild(aq[am].cloneNode(false));ak=ak.firstChild}ak.appendChild(c.doc.createTextNode(ah));ak=ak.firstChild;c.insertAfter(ap,ar);q.setCursorLocation(ak,1)}}U.onBeforeGetContent.addToTop(function(){var ai=[],aj;if(ad(aa(q.getStart()),ai)){aj=ai.length;while(aj--){c.setAttrib(ai[aj],\"data-mce-bogus\",\"1\")}}});a.each(\"onMouseUp onKeyUp\".split(\" \"),function(ai){U[ai].addToTop(function(){Y()})});U.onKeyDown.addToTop(function(ai,ak){var aj=ak.keyCode;if(aj==8||aj==37||aj==39){Y(aa(q.getStart()))}});if(ae==\"apply\"){ab()}else{ag()}}}})(tinymce);tinymce.onAddEditor.add(function(e,a){var d,h,g,c=a.settings;if(c.inline_styles){h=e.explode(c.font_size_legacy_values);function b(j,i){e.each(i,function(l,k){if(l){g.setStyle(j,k,l)}});g.rename(j,\"span\")}d={font:function(j,i){b(i,{backgroundColor:i.style.backgroundColor,color:i.color,fontFamily:i.face,fontSize:h[parseInt(i.size)-1]})},u:function(j,i){b(i,{textDecoration:\"underline\"})},strike:function(j,i){b(i,{textDecoration:\"line-through\"})}};function f(i,j){g=i.dom;if(c.convert_fonts_to_spans){e.each(g.select(\"font,u,strike\",j.node),function(k){d[k.nodeName.toLowerCase()](a.dom,k)})}}a.onPreProcess.add(f);a.onSetContent.add(f);a.onInit.add(function(){a.selection.onSetContent.add(f)})}});","Magento_Tinymce3/tiny_mce/tiny_mce_prototype_src.js":"(function(win) {\r\n\tvar whiteSpaceRe = /^\\s*|\\s*$/g,\r\n\t\tundefined, isRegExpBroken = 'B'.replace(/A(.)|B/, '$1') === '$1';\r\n\r\n\tvar tinymce = {\r\n\t\tmajorVersion : '3',\r\n\r\n\t\tminorVersion : '4.7',\r\n\r\n\t\treleaseDate : '2011-11-03',\r\n\r\n\t\t_init : function() {\r\n\t\t\tvar t = this, d = document, na = navigator, ua = na.userAgent, i, nl, n, base, p, v;\r\n\r\n\t\t\tt.isOpera = win.opera && opera.buildNumber;\r\n\r\n\t\t\tt.isWebKit = /WebKit/.test(ua);\r\n\r\n\t\t\tt.isIE = !t.isWebKit && !t.isOpera && (/MSIE/gi).test(ua) && (/Explorer/gi).test(na.appName);\r\n\r\n\t\t\tt.isIE6 = t.isIE && /MSIE [56]/.test(ua);\r\n\r\n\t\t\tt.isIE7 = t.isIE && /MSIE [7]/.test(ua);\r\n\r\n\t\t\tt.isIE8 = t.isIE && /MSIE [8]/.test(ua);\r\n\r\n\t\t\tt.isIE9 = t.isIE && /MSIE [9]/.test(ua);\r\n\r\n\t\t\tt.isGecko = !t.isWebKit && /Gecko/.test(ua);\r\n\r\n\t\t\tt.isMac = ua.indexOf('Mac') != -1;\r\n\r\n\t\t\tt.isAir = /adobeair/i.test(ua);\r\n\r\n\t\t\tt.isIDevice = /(iPad|iPhone)/.test(ua);\r\n\t\t\t\r\n\t\t\tt.isIOS5 = t.isIDevice && ua.match(/AppleWebKit\\/(\\d*)/)[1]>=534;\r\n\r\n\t\t\t// TinyMCE .NET webcontrol might be setting the values for TinyMCE\r\n\t\t\tif (win.tinyMCEPreInit) {\r\n\t\t\t\tt.suffix = tinyMCEPreInit.suffix;\r\n\t\t\t\tt.baseURL = tinyMCEPreInit.base;\r\n\t\t\t\tt.query = tinyMCEPreInit.query;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Get suffix and base\r\n\t\t\tt.suffix = '';\r\n\r\n\t\t\t// If base element found, add that infront of baseURL\r\n\t\t\tnl = d.getElementsByTagName('base');\r\n\t\t\tfor (i=0; i<nl.length; i++) {\r\n\t\t\t\tif (v = nl[i].href) {\r\n\t\t\t\t\t// Host only value like http://site.com or http://site.com:8008\r\n\t\t\t\t\tif (/^https?:\\/\\/[^\\/]+$/.test(v))\r\n\t\t\t\t\t\tv += '/';\r\n\r\n\t\t\t\t\tbase = v ? v.match(/.*\\//)[0] : ''; // Get only directory\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction getBase(n) {\r\n\t\t\t\tif (n.src && /tiny_mce(|_gzip|_jquery|_prototype|_full)(_dev|_src)?.js/.test(n.src)) {\r\n\t\t\t\t\tif (/_(src|dev)\\.js/g.test(n.src))\r\n\t\t\t\t\t\tt.suffix = '_src';\r\n\r\n\t\t\t\t\tif ((p = n.src.indexOf('?')) != -1)\r\n\t\t\t\t\t\tt.query = n.src.substring(p + 1);\r\n\r\n\t\t\t\t\tt.baseURL = n.src.substring(0, n.src.lastIndexOf('/'));\r\n\r\n\t\t\t\t\t// If path to script is relative and a base href was found add that one infront\r\n\t\t\t\t\t// the src property will always be an absolute one on non IE browsers and IE 8\r\n\t\t\t\t\t// so this logic will basically only be executed on older IE versions\r\n\t\t\t\t\tif (base && t.baseURL.indexOf('://') == -1 && t.baseURL.indexOf('/') !== 0)\r\n\t\t\t\t\t\tt.baseURL = base + t.baseURL;\r\n\r\n\t\t\t\t\treturn t.baseURL;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn null;\r\n\t\t\t};\r\n\r\n\t\t\t// Check document\r\n\t\t\tnl = d.getElementsByTagName('script');\r\n\t\t\tfor (i=0; i<nl.length; i++) {\r\n\t\t\t\tif (getBase(nl[i]))\r\n\t\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Check head\r\n\t\t\tn = d.getElementsByTagName('head')[0];\r\n\t\t\tif (n) {\r\n\t\t\t\tnl = n.getElementsByTagName('script');\r\n\t\t\t\tfor (i=0; i<nl.length; i++) {\r\n\t\t\t\t\tif (getBase(nl[i]))\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t},\r\n\r\n\t\tis : function(o, t) {\r\n\t\t\tif (!t)\r\n\t\t\t\treturn o !== undefined;\r\n\r\n\t\t\tif (t == 'array' && (o.hasOwnProperty && o instanceof Array))\r\n\t\t\t\treturn true;\r\n\r\n\t\t\treturn typeof(o) == t;\r\n\t\t},\r\n\r\n\t\tmakeMap : function(items, delim, map) {\r\n\t\t\tvar i;\r\n\r\n\t\t\titems = items || [];\r\n\t\t\tdelim = delim || ',';\r\n\r\n\t\t\tif (typeof(items) == \"string\")\r\n\t\t\t\titems = items.split(delim);\r\n\r\n\t\t\tmap = map || {};\r\n\r\n\t\t\ti = items.length;\r\n\t\t\twhile (i--)\r\n\t\t\t\tmap[items[i]] = {};\r\n\r\n\t\t\treturn map;\r\n\t\t},\r\n\r\n\t\teach : function(o, cb, s) {\r\n\t\t\tvar n, l;\r\n\r\n\t\t\tif (!o)\r\n\t\t\t\treturn 0;\r\n\r\n\t\t\ts = s || o;\r\n\r\n\t\t\tif (o.length !== undefined) {\r\n\t\t\t\t// Indexed arrays, needed for Safari\r\n\t\t\t\tfor (n=0, l = o.length; n < l; n++) {\r\n\t\t\t\t\tif (cb.call(s, o[n], n, o) === false)\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Hashtables\r\n\t\t\t\tfor (n in o) {\r\n\t\t\t\t\tif (o.hasOwnProperty(n)) {\r\n\t\t\t\t\t\tif (cb.call(s, o[n], n, o) === false)\r\n\t\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn 1;\r\n\t\t},\r\n\r\n\r\n\t\tmap : function(a, f) {\r\n\t\t\tvar o = [];\r\n\r\n\t\t\ttinymce.each(a, function(v) {\r\n\t\t\t\to.push(f(v));\r\n\t\t\t});\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\r\n\t\tgrep : function(a, f) {\r\n\t\t\tvar o = [];\r\n\r\n\t\t\ttinymce.each(a, function(v) {\r\n\t\t\t\tif (!f || f(v))\r\n\t\t\t\t\to.push(v);\r\n\t\t\t});\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\r\n\t\tinArray : function(a, v) {\r\n\t\t\tvar i, l;\r\n\r\n\t\t\tif (a) {\r\n\t\t\t\tfor (i = 0, l = a.length; i < l; i++) {\r\n\t\t\t\t\tif (a[i] === v)\r\n\t\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn -1;\r\n\t\t},\r\n\r\n\t\textend : function(o, e) {\r\n\t\t\tvar i, l, a = arguments;\r\n\r\n\t\t\tfor (i = 1, l = a.length; i < l; i++) {\r\n\t\t\t\te = a[i];\r\n\r\n\t\t\t\ttinymce.each(e, function(v, n) {\r\n\t\t\t\t\tif (v !== undefined)\r\n\t\t\t\t\t\to[n] = v;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\r\n\r\n\t\ttrim : function(s) {\r\n\t\t\treturn (s ? '' + s : '').replace(whiteSpaceRe, '');\r\n\t\t},\r\n\r\n\t\tcreate : function(s, p, root) {\r\n\t\t\tvar t = this, sp, ns, cn, scn, c, de = 0;\r\n\r\n\t\t\t// Parse : <prefix> <class>:<super class>\r\n\t\t\ts = /^((static) )?([\\w.]+)(:([\\w.]+))?/.exec(s);\r\n\t\t\tcn = s[3].match(/(^|\\.)(\\w+)$/i)[2]; // Class name\r\n\r\n\t\t\t// Create namespace for new class\r\n\t\t\tns = t.createNS(s[3].replace(/\\.\\w+$/, ''), root);\r\n\r\n\t\t\t// Class already exists\r\n\t\t\tif (ns[cn])\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Make pure static class\r\n\t\t\tif (s[2] == 'static') {\r\n\t\t\t\tns[cn] = p;\r\n\r\n\t\t\t\tif (this.onCreate)\r\n\t\t\t\t\tthis.onCreate(s[2], s[3], ns[cn]);\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Create default constructor\r\n\t\t\tif (!p[cn]) {\r\n\t\t\t\tp[cn] = function() {};\r\n\t\t\t\tde = 1;\r\n\t\t\t}\r\n\r\n\t\t\t// Add constructor and methods\r\n\t\t\tns[cn] = p[cn];\r\n\t\t\tt.extend(ns[cn].prototype, p);\r\n\r\n\t\t\t// Extend\r\n\t\t\tif (s[5]) {\r\n\t\t\t\tsp = t.resolve(s[5]).prototype;\r\n\t\t\t\tscn = s[5].match(/\\.(\\w+)$/i)[1]; // Class name\r\n\r\n\t\t\t\t// Extend constructor\r\n\t\t\t\tc = ns[cn];\r\n\t\t\t\tif (de) {\r\n\t\t\t\t\t// Add passthrough constructor\r\n\t\t\t\t\tns[cn] = function() {\r\n\t\t\t\t\t\treturn sp[scn].apply(this, arguments);\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Add inherit constructor\r\n\t\t\t\t\tns[cn] = function() {\r\n\t\t\t\t\t\tthis.parent = sp[scn];\r\n\t\t\t\t\t\treturn c.apply(this, arguments);\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tns[cn].prototype[cn] = ns[cn];\r\n\r\n\t\t\t\t// Add super methods\r\n\t\t\t\tt.each(sp, function(f, n) {\r\n\t\t\t\t\tns[cn].prototype[n] = sp[n];\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Add overridden methods\r\n\t\t\t\tt.each(p, function(f, n) {\r\n\t\t\t\t\t// Extend methods if needed\r\n\t\t\t\t\tif (sp[n]) {\r\n\t\t\t\t\t\tns[cn].prototype[n] = function() {\r\n\t\t\t\t\t\t\tthis.parent = sp[n];\r\n\t\t\t\t\t\t\treturn f.apply(this, arguments);\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (n != cn)\r\n\t\t\t\t\t\t\tns[cn].prototype[n] = f;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Add static methods\r\n\t\t\tt.each(p['static'], function(f, n) {\r\n\t\t\t\tns[cn][n] = f;\r\n\t\t\t});\r\n\r\n\t\t\tif (this.onCreate)\r\n\t\t\t\tthis.onCreate(s[2], s[3], ns[cn].prototype);\r\n\t\t},\r\n\r\n\t\twalk : function(o, f, n, s) {\r\n\t\t\ts = s || this;\r\n\r\n\t\t\tif (o) {\r\n\t\t\t\tif (n)\r\n\t\t\t\t\to = o[n];\r\n\r\n\t\t\t\ttinymce.each(o, function(o, i) {\r\n\t\t\t\t\tif (f.call(s, o, i, n) === false)\r\n\t\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t\ttinymce.walk(o, f, n, s);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tcreateNS : function(n, o) {\r\n\t\t\tvar i, v;\r\n\r\n\t\t\to = o || win;\r\n\r\n\t\t\tn = n.split('.');\r\n\t\t\tfor (i=0; i<n.length; i++) {\r\n\t\t\t\tv = n[i];\r\n\r\n\t\t\t\tif (!o[v])\r\n\t\t\t\t\to[v] = {};\r\n\r\n\t\t\t\to = o[v];\r\n\t\t\t}\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\r\n\t\tresolve : function(n, o) {\r\n\t\t\tvar i, l;\r\n\r\n\t\t\to = o || win;\r\n\r\n\t\t\tn = n.split('.');\r\n\t\t\tfor (i = 0, l = n.length; i < l; i++) {\r\n\t\t\t\to = o[n[i]];\r\n\r\n\t\t\t\tif (!o)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\r\n\t\taddUnload : function(f, s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tf = {func : f, scope : s || this};\r\n\r\n\t\t\tif (!t.unloads) {\r\n\t\t\t\tfunction unload() {\r\n\t\t\t\t\tvar li = t.unloads, o, n;\r\n\r\n\t\t\t\t\tif (li) {\r\n\t\t\t\t\t\t// Call unload handlers\r\n\t\t\t\t\t\tfor (n in li) {\r\n\t\t\t\t\t\t\to = li[n];\r\n\r\n\t\t\t\t\t\t\tif (o && o.func)\r\n\t\t\t\t\t\t\t\to.func.call(o.scope, 1); // Send in one arg to distinct unload and user destroy\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Detach unload function\r\n\t\t\t\t\t\tif (win.detachEvent) {\r\n\t\t\t\t\t\t\twin.detachEvent('onbeforeunload', fakeUnload);\r\n\t\t\t\t\t\t\twin.detachEvent('onunload', unload);\r\n\t\t\t\t\t\t} else if (win.removeEventListener)\r\n\t\t\t\t\t\t\twin.removeEventListener('unload', unload, false);\r\n\r\n\t\t\t\t\t\t// Destroy references\r\n\t\t\t\t\t\tt.unloads = o = li = w = unload = 0;\r\n\r\n\t\t\t\t\t\t// Run garbarge collector on IE\r\n\t\t\t\t\t\tif (win.CollectGarbage)\r\n\t\t\t\t\t\t\tCollectGarbage();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tfunction fakeUnload() {\r\n\t\t\t\t\tvar d = document;\r\n\r\n\t\t\t\t\t// Is there things still loading, then do some magic\r\n\t\t\t\t\tif (d.readyState == 'interactive') {\r\n\t\t\t\t\t\tfunction stop() {\r\n\t\t\t\t\t\t\t// Prevent memory leak\r\n\t\t\t\t\t\t\td.detachEvent('onstop', stop);\r\n\r\n\t\t\t\t\t\t\t// Call unload handler\r\n\t\t\t\t\t\t\tif (unload)\r\n\t\t\t\t\t\t\t\tunload();\r\n\r\n\t\t\t\t\t\t\td = 0;\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t// Fire unload when the currently loading page is stopped\r\n\t\t\t\t\t\tif (d)\r\n\t\t\t\t\t\t\td.attachEvent('onstop', stop);\r\n\r\n\t\t\t\t\t\t// Remove onstop listener after a while to prevent the unload function\r\n\t\t\t\t\t\t// to execute if the user presses cancel in an onbeforeunload\r\n\t\t\t\t\t\t// confirm dialog and then presses the browser stop button\r\n\t\t\t\t\t\twin.setTimeout(function() {\r\n\t\t\t\t\t\t\tif (d)\r\n\t\t\t\t\t\t\t\td.detachEvent('onstop', stop);\r\n\t\t\t\t\t\t}, 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Attach unload handler\r\n\t\t\t\tif (win.attachEvent) {\r\n\t\t\t\t\twin.attachEvent('onunload', unload);\r\n\t\t\t\t\twin.attachEvent('onbeforeunload', fakeUnload);\r\n\t\t\t\t} else if (win.addEventListener)\r\n\t\t\t\t\twin.addEventListener('unload', unload, false);\r\n\r\n\t\t\t\t// Setup initial unload handler array\r\n\t\t\t\tt.unloads = [f];\r\n\t\t\t} else\r\n\t\t\t\tt.unloads.push(f);\r\n\r\n\t\t\treturn f;\r\n\t\t},\r\n\r\n\t\tremoveUnload : function(f) {\r\n\t\t\tvar u = this.unloads, r = null;\r\n\r\n\t\t\ttinymce.each(u, function(o, i) {\r\n\t\t\t\tif (o && o.func == f) {\r\n\t\t\t\t\tu.splice(i, 1);\r\n\t\t\t\t\tr = f;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn r;\r\n\t\t},\r\n\r\n\t\texplode : function(s, d) {\r\n\t\t\treturn s ? tinymce.map(s.split(d || ','), tinymce.trim) : s;\r\n\t\t},\r\n\r\n\t\t_addVer : function(u) {\r\n\t\t\tvar v;\r\n\r\n\t\t\tif (!this.query)\r\n\t\t\t\treturn u;\r\n\r\n\t\t\tv = (u.indexOf('?') == -1 ? '?' : '&') + this.query;\r\n\r\n\t\t\tif (u.indexOf('#') == -1)\r\n\t\t\t\treturn u + v;\r\n\r\n\t\t\treturn u.replace('#', v + '#');\r\n\t\t},\r\n\r\n\t\t// Fix function for IE 9 where regexps isn't working correctly\r\n\t\t// Todo: remove me once MS fixes the bug\r\n\t\t_replace : function(find, replace, str) {\r\n\t\t\t// On IE9 we have to fake $x replacement\r\n\t\t\tif (isRegExpBroken) {\r\n\t\t\t\treturn str.replace(find, function() {\r\n\t\t\t\t\tvar val = replace, args = arguments, i;\r\n\r\n\t\t\t\t\tfor (i = 0; i < args.length - 2; i++) {\r\n\t\t\t\t\t\tif (args[i] === undefined) {\r\n\t\t\t\t\t\t\tval = val.replace(new RegExp('\\\\$' + i, 'g'), '');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tval = val.replace(new RegExp('\\\\$' + i, 'g'), args[i]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn val;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn str.replace(find, replace);\r\n\t\t}\r\n\r\n\t\t};\r\n\r\n\t// Initialize the API\r\n\ttinymce._init();\r\n\r\n\t// Expose tinymce namespace to the global namespace (window)\r\n\twin.tinymce = win.tinyMCE = tinymce;\r\n\r\n\t// Describe the different namespaces\r\n\r\n\t})(window);\r\n\r\n\r\n\r\n(function() {\r\n\tif (!window.Prototype)\r\n\t\treturn alert(\"Load prototype first!\");\r\n\r\n\t// Patch in core NS functions\r\n\ttinymce.extend(tinymce, {\r\n\t\ttrim : function(s) {return s ? s.strip() : '';},\r\n\t\tinArray : function(a, v) {return a && a.indexOf ? a.indexOf(v) : -1;}\r\n\t});\r\n\r\n\t// Patch in functions in various clases\r\n\t// Add a \"#ifndefjquery\" statement around each core API function you add below\r\n\tvar patches = {\r\n\t\t'tinymce.util.JSON' : {\r\n\t\t\t/*serialize : function(o) {\r\n\t\t\t\treturn o.toJSON();\r\n\t\t\t}*/\r\n\t\t},\r\n\t};\r\n\r\n\t// Patch functions after a class is created\r\n\ttinymce.onCreate = function(ty, c, p) {\r\n\t\ttinymce.extend(p, patches[c]);\r\n\t};\r\n})();\r\n\r\n\r\ntinymce.create('tinymce.util.Dispatcher', {\r\n\tscope : null,\r\n\tlisteners : null,\r\n\r\n\tDispatcher : function(s) {\r\n\t\tthis.scope = s || this;\r\n\t\tthis.listeners = [];\r\n\t},\r\n\r\n\tadd : function(cb, s) {\r\n\t\tthis.listeners.push({cb : cb, scope : s || this.scope});\r\n\r\n\t\treturn cb;\r\n\t},\r\n\r\n\taddToTop : function(cb, s) {\r\n\t\tthis.listeners.unshift({cb : cb, scope : s || this.scope});\r\n\r\n\t\treturn cb;\r\n\t},\r\n\r\n\tremove : function(cb) {\r\n\t\tvar l = this.listeners, o = null;\r\n\r\n\t\ttinymce.each(l, function(c, i) {\r\n\t\t\tif (cb == c.cb) {\r\n\t\t\t\to = cb;\r\n\t\t\t\tl.splice(i, 1);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn o;\r\n\t},\r\n\r\n\tdispatch : function() {\r\n\t\tvar s, a = arguments, i, li = this.listeners, c;\r\n\r\n\t\t// Needs to be a real loop since the listener count might change while looping\r\n\t\t// And this is also more efficient\r\n\t\tfor (i = 0; i<li.length; i++) {\r\n\t\t\tc = li[i];\r\n\t\t\ts = c.cb.apply(c.scope, a);\r\n\r\n\t\t\tif (s === false)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn s;\r\n\t}\r\n\r\n\t});\r\n\r\n(function() {\r\n\tvar each = tinymce.each;\r\n\r\n\ttinymce.create('tinymce.util.URI', {\r\n\t\tURI : function(u, s) {\r\n\t\t\tvar t = this, o, a, b, base_url;\r\n\r\n\t\t\t// Trim whitespace\r\n\t\t\tu = tinymce.trim(u);\r\n\r\n\t\t\t// Default settings\r\n\t\t\ts = t.settings = s || {};\r\n\r\n\t\t\t// Strange app protocol that isn't http/https or local anchor\r\n\t\t\t// For example: mailto,skype,tel etc.\r\n\t\t\tif (/^([\\w\\-]+):([^\\/]{2})/i.test(u) || /^\\s*#/.test(u)) {\r\n\t\t\t\tt.source = u;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Absolute path with no host, fake host and protocol\r\n\t\t\tif (u.indexOf('/') === 0 && u.indexOf('//') !== 0)\r\n\t\t\t\tu = (s.base_uri ? s.base_uri.protocol || 'http' : 'http') + '://mce_host' + u;\r\n\r\n\t\t\t// Relative path http:// or protocol relative //path\r\n\t\t\tif (!/^[\\w-]*:?\\/\\//.test(u)) {\r\n\t\t\t\tbase_url = s.base_uri ? s.base_uri.path : new tinymce.util.URI(location.href).directory;\r\n\t\t\t\tu = ((s.base_uri && s.base_uri.protocol) || 'http') + '://mce_host' + t.toAbsPath(base_url, u);\r\n\t\t\t}\r\n\r\n\t\t\t// Parse URL (Credits goes to Steave, http://blog.stevenlevithan.com/archives/parseuri)\r\n\t\t\tu = u.replace(/@@/g, '(mce_at)'); // Zope 3 workaround, they use @@something\r\n\t\t\tu = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(u);\r\n\t\t\teach([\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"], function(v, i) {\r\n\t\t\t\tvar s = u[i];\r\n\r\n\t\t\t\t// Zope 3 workaround, they use @@something\r\n\t\t\t\tif (s)\r\n\t\t\t\t\ts = s.replace(/\\(mce_at\\)/g, '@@');\r\n\r\n\t\t\t\tt[v] = s;\r\n\t\t\t});\r\n\r\n\t\t\tif (b = s.base_uri) {\r\n\t\t\t\tif (!t.protocol)\r\n\t\t\t\t\tt.protocol = b.protocol;\r\n\r\n\t\t\t\tif (!t.userInfo)\r\n\t\t\t\t\tt.userInfo = b.userInfo;\r\n\r\n\t\t\t\tif (!t.port && t.host == 'mce_host')\r\n\t\t\t\t\tt.port = b.port;\r\n\r\n\t\t\t\tif (!t.host || t.host == 'mce_host')\r\n\t\t\t\t\tt.host = b.host;\r\n\r\n\t\t\t\tt.source = '';\r\n\t\t\t}\r\n\r\n\t\t\t//t.path = t.path || '/';\r\n\t\t},\r\n\r\n\t\tsetPath : function(p) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tp = /^(.*?)\\/?(\\w+)?$/.exec(p);\r\n\r\n\t\t\t// Update path parts\r\n\t\t\tt.path = p[0];\r\n\t\t\tt.directory = p[1];\r\n\t\t\tt.file = p[2];\r\n\r\n\t\t\t// Rebuild source\r\n\t\t\tt.source = '';\r\n\t\t\tt.getURI();\r\n\t\t},\r\n\r\n\t\ttoRelative : function(u) {\r\n\t\t\tvar t = this, o;\r\n\r\n\t\t\tif (u === \"./\")\r\n\t\t\t\treturn u;\r\n\r\n\t\t\tu = new tinymce.util.URI(u, {base_uri : t});\r\n\r\n\t\t\t// Not on same domain/port or protocol\r\n\t\t\tif ((u.host != 'mce_host' && t.host != u.host && u.host) || t.port != u.port || t.protocol != u.protocol)\r\n\t\t\t\treturn u.getURI();\r\n\r\n\t\t\to = t.toRelPath(t.path, u.path);\r\n\r\n\t\t\t// Add query\r\n\t\t\tif (u.query)\r\n\t\t\t\to += '?' + u.query;\r\n\r\n\t\t\t// Add anchor\r\n\t\t\tif (u.anchor)\r\n\t\t\t\to += '#' + u.anchor;\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\t\r\n\t\ttoAbsolute : function(u, nh) {\r\n\t\t\tvar u = new tinymce.util.URI(u, {base_uri : this});\r\n\r\n\t\t\treturn u.getURI(this.host == u.host && this.protocol == u.protocol ? nh : 0);\r\n\t\t},\r\n\r\n\t\ttoRelPath : function(base, path) {\r\n\t\t\tvar items, bp = 0, out = '', i, l;\r\n\r\n\t\t\t// Split the paths\r\n\t\t\tbase = base.substring(0, base.lastIndexOf('/'));\r\n\t\t\tbase = base.split('/');\r\n\t\t\titems = path.split('/');\r\n\r\n\t\t\tif (base.length >= items.length) {\r\n\t\t\t\tfor (i = 0, l = base.length; i < l; i++) {\r\n\t\t\t\t\tif (i >= items.length || base[i] != items[i]) {\r\n\t\t\t\t\t\tbp = i + 1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (base.length < items.length) {\r\n\t\t\t\tfor (i = 0, l = items.length; i < l; i++) {\r\n\t\t\t\t\tif (i >= base.length || base[i] != items[i]) {\r\n\t\t\t\t\t\tbp = i + 1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (bp == 1)\r\n\t\t\t\treturn path;\r\n\r\n\t\t\tfor (i = 0, l = base.length - (bp - 1); i < l; i++)\r\n\t\t\t\tout += \"../\";\r\n\r\n\t\t\tfor (i = bp - 1, l = items.length; i < l; i++) {\r\n\t\t\t\tif (i != bp - 1)\r\n\t\t\t\t\tout += \"/\" + items[i];\r\n\t\t\t\telse\r\n\t\t\t\t\tout += items[i];\r\n\t\t\t}\r\n\r\n\t\t\treturn out;\r\n\t\t},\r\n\r\n\t\ttoAbsPath : function(base, path) {\r\n\t\t\tvar i, nb = 0, o = [], tr, outPath;\r\n\r\n\t\t\t// Split paths\r\n\t\t\ttr = /\\/$/.test(path) ? '/' : '';\r\n\t\t\tbase = base.split('/');\r\n\t\t\tpath = path.split('/');\r\n\r\n\t\t\t// Remove empty chunks\r\n\t\t\teach(base, function(k) {\r\n\t\t\t\tif (k)\r\n\t\t\t\t\to.push(k);\r\n\t\t\t});\r\n\r\n\t\t\tbase = o;\r\n\r\n\t\t\t// Merge relURLParts chunks\r\n\t\t\tfor (i = path.length - 1, o = []; i >= 0; i--) {\r\n\t\t\t\t// Ignore empty or .\r\n\t\t\t\tif (path[i].length == 0 || path[i] == \".\")\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t// Is parent\r\n\t\t\t\tif (path[i] == '..') {\r\n\t\t\t\t\tnb++;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move up\r\n\t\t\t\tif (nb > 0) {\r\n\t\t\t\t\tnb--;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\to.push(path[i]);\r\n\t\t\t}\r\n\r\n\t\t\ti = base.length - nb;\r\n\r\n\t\t\t// If /a/b/c or /\r\n\t\t\tif (i <= 0)\r\n\t\t\t\toutPath = o.reverse().join('/');\r\n\t\t\telse\r\n\t\t\t\toutPath = base.slice(0, i).join('/') + '/' + o.reverse().join('/');\r\n\r\n\t\t\t// Add front / if it's needed\r\n\t\t\tif (outPath.indexOf('/') !== 0)\r\n\t\t\t\toutPath = '/' + outPath;\r\n\r\n\t\t\t// Add traling / if it's needed\r\n\t\t\tif (tr && outPath.lastIndexOf('/') !== outPath.length - 1)\r\n\t\t\t\toutPath += tr;\r\n\r\n\t\t\treturn outPath;\r\n\t\t},\r\n\r\n\t\tgetURI : function(nh) {\r\n\t\t\tvar s, t = this;\r\n\r\n\t\t\t// Rebuild source\r\n\t\t\tif (!t.source || nh) {\r\n\t\t\t\ts = '';\r\n\r\n\t\t\t\tif (!nh) {\r\n\t\t\t\t\tif (t.protocol)\r\n\t\t\t\t\t\ts += t.protocol + '://';\r\n\r\n\t\t\t\t\tif (t.userInfo)\r\n\t\t\t\t\t\ts += t.userInfo + '@';\r\n\r\n\t\t\t\t\tif (t.host)\r\n\t\t\t\t\t\ts += t.host;\r\n\r\n\t\t\t\t\tif (t.port)\r\n\t\t\t\t\t\ts += ':' + t.port;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (t.path)\r\n\t\t\t\t\ts += t.path;\r\n\r\n\t\t\t\tif (t.query)\r\n\t\t\t\t\ts += '?' + t.query;\r\n\r\n\t\t\t\tif (t.anchor)\r\n\t\t\t\t\ts += '#' + t.anchor;\r\n\r\n\t\t\t\tt.source = s;\r\n\t\t\t}\r\n\r\n\t\t\treturn t.source;\r\n\t\t}\r\n\t});\r\n})();\r\n\r\n(function() {\r\n\tvar each = tinymce.each;\r\n\r\n\ttinymce.create('static tinymce.util.Cookie', {\r\n\t\tgetHash : function(n) {\r\n\t\t\tvar v = this.get(n), h;\r\n\r\n\t\t\tif (v) {\r\n\t\t\t\teach(v.split('&'), function(v) {\r\n\t\t\t\t\tv = v.split('=');\r\n\t\t\t\t\th = h || {};\r\n\t\t\t\t\th[unescape(v[0])] = unescape(v[1]);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn h;\r\n\t\t},\r\n\r\n\t\tsetHash : function(n, v, e, p, d, s) {\r\n\t\t\tvar o = '';\r\n\r\n\t\t\teach(v, function(v, k) {\r\n\t\t\t\to += (!o ? '' : '&') + escape(k) + '=' + escape(v);\r\n\t\t\t});\r\n\r\n\t\t\tthis.set(n, o, e, p, d, s);\r\n\t\t},\r\n\r\n\t\tget : function(n) {\r\n\t\t\tvar c = document.cookie, e, p = n + \"=\", b;\r\n\r\n\t\t\t// Strict mode\r\n\t\t\tif (!c)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tb = c.indexOf(\"; \" + p);\r\n\r\n\t\t\tif (b == -1) {\r\n\t\t\t\tb = c.indexOf(p);\r\n\r\n\t\t\t\tif (b != 0)\r\n\t\t\t\t\treturn null;\r\n\t\t\t} else\r\n\t\t\t\tb += 2;\r\n\r\n\t\t\te = c.indexOf(\";\", b);\r\n\r\n\t\t\tif (e == -1)\r\n\t\t\t\te = c.length;\r\n\r\n\t\t\treturn unescape(c.substring(b + p.length, e));\r\n\t\t},\r\n\r\n\t\tset : function(n, v, e, p, d, s) {\r\n\t\t\tdocument.cookie = n + \"=\" + escape(v) +\r\n\t\t\t\t((e) ? \"; expires=\" + e.toUTCString() : \"\") +\r\n\t\t\t\t((p) ? \"; path=\" + escape(p) : \"\") +\r\n\t\t\t\t((d) ? \"; domain=\" + d : \"\") +\r\n\t\t\t\t((s) ? \"; secure\" : \"\");\r\n\t\t},\r\n\r\n\t\tremove : function(n, p) {\r\n\t\t\tvar d = new Date();\r\n\r\n\t\t\td.setTime(d.getTime() - 1000);\r\n\r\n\t\t\tthis.set(n, '', d, p, d);\r\n\t\t}\r\n\t});\r\n})();\r\n\r\n(function() {\r\n\tfunction serialize(o, quote) {\r\n\t\tvar i, v, t;\r\n\r\n\t\tquote = quote || '\"';\r\n\r\n\t\tif (o == null)\r\n\t\t\treturn 'null';\r\n\r\n\t\tt = typeof o;\r\n\r\n\t\tif (t == 'string') {\r\n\t\t\tv = '\\bb\\tt\\nn\\ff\\rr\\\"\"\\'\\'\\\\\\\\';\r\n\r\n\t\t\treturn quote + o.replace(/([\\u0080-\\uFFFF\\x00-\\x1f\\\"\\'\\\\])/g, function(a, b) {\r\n\t\t\t\t// Make sure single quotes never get encoded inside double quotes for JSON compatibility\r\n\t\t\t\tif (quote === '\"' && a === \"'\")\r\n\t\t\t\t\treturn a;\r\n\r\n\t\t\t\ti = v.indexOf(b);\r\n\r\n\t\t\t\tif (i + 1)\r\n\t\t\t\t\treturn '\\\\' + v.charAt(i + 1);\r\n\r\n\t\t\t\ta = b.charCodeAt().toString(16);\r\n\r\n\t\t\t\treturn '\\\\u' + '0000'.substring(a.length) + a;\r\n\t\t\t}) + quote;\r\n\t\t}\r\n\r\n\t\tif (t == 'object') {\r\n\t\t\tif (o.hasOwnProperty && o instanceof Array) {\r\n\t\t\t\t\tfor (i=0, v = '['; i<o.length; i++)\r\n\t\t\t\t\t\tv += (i > 0 ? ',' : '') + serialize(o[i], quote);\r\n\r\n\t\t\t\t\treturn v + ']';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tv = '{';\r\n\r\n\t\t\t\tfor (i in o) {\r\n\t\t\t\t\tif (o.hasOwnProperty(i)) {\r\n\t\t\t\t\t\tv += typeof o[i] != 'function' ? (v.length > 1 ? ',' + quote : quote) + i + quote +':' + serialize(o[i], quote) : '';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn v + '}';\r\n\t\t}\r\n\r\n\t\treturn '' + o;\r\n\t};\r\n\r\n\ttinymce.util.JSON = {\r\n\t\tserialize: serialize,\r\n\r\n\t\tparse: function(s) {\r\n\t\t\ttry {\r\n\t\t\t\treturn JSON.parse(s);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Ignore\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t};\r\n})();\r\n\r\ntinymce.create('static tinymce.util.XHR', {\r\n\tsend : function(o) {\r\n\t\tvar x, t, w = window, c = 0;\r\n\r\n\t\t// Default settings\r\n\t\to.scope = o.scope || this;\r\n\t\to.success_scope = o.success_scope || o.scope;\r\n\t\to.error_scope = o.error_scope || o.scope;\r\n\t\to.async = o.async === false ? false : true;\r\n\t\to.data = o.data || '';\r\n\r\n\t\tfunction get(s) {\r\n\t\t\tx = 0;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tx = new ActiveXObject(s);\r\n\t\t\t} catch (ex) {\r\n\t\t\t}\r\n\r\n\t\t\treturn x;\r\n\t\t};\r\n\r\n\t\tx = w.XMLHttpRequest ? new XMLHttpRequest() : get('Microsoft.XMLHTTP') || get('Msxml2.XMLHTTP');\r\n\r\n\t\tif (x) {\r\n\t\t\tif (x.overrideMimeType)\r\n\t\t\t\tx.overrideMimeType(o.content_type);\r\n\r\n\t\t\tx.open(o.type || (o.data ? 'POST' : 'GET'), o.url, o.async);\r\n\r\n\t\t\tif (o.content_type)\r\n\t\t\t\tx.setRequestHeader('Content-Type', o.content_type);\r\n\r\n\t\t\tx.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\r\n\r\n\t\t\tx.send(o.data);\r\n\r\n\t\t\tfunction ready() {\r\n\t\t\t\tif (!o.async || x.readyState == 4 || c++ > 10000) {\r\n\t\t\t\t\tif (o.success && c < 10000 && x.status == 200)\r\n\t\t\t\t\t\to.success.call(o.success_scope, '' + x.responseText, x, o);\r\n\t\t\t\t\telse if (o.error)\r\n\t\t\t\t\t\to.error.call(o.error_scope, c > 10000 ? 'TIMED_OUT' : 'GENERAL', x, o);\r\n\r\n\t\t\t\t\tx = null;\r\n\t\t\t\t} else\r\n\t\t\t\t\tw.setTimeout(ready, 10);\r\n\t\t\t};\r\n\r\n\t\t\t// Syncronous request\r\n\t\t\tif (!o.async)\r\n\t\t\t\treturn ready();\r\n\r\n\t\t\t// Wait for response, onReadyStateChange can not be used since it leaks memory in IE\r\n\t\t\tt = w.setTimeout(ready, 10);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n(function() {\r\n\tvar extend = tinymce.extend, JSON = tinymce.util.JSON, XHR = tinymce.util.XHR;\r\n\r\n\ttinymce.create('tinymce.util.JSONRequest', {\r\n\t\tJSONRequest : function(s) {\r\n\t\t\tthis.settings = extend({\r\n\t\t\t}, s);\r\n\t\t\tthis.count = 0;\r\n\t\t},\r\n\r\n\t\tsend : function(o) {\r\n\t\t\tvar ecb = o.error, scb = o.success;\r\n\r\n\t\t\to = extend(this.settings, o);\r\n\r\n\t\t\to.success = function(c, x) {\r\n\t\t\t\tc = JSON.parse(c);\r\n\r\n\t\t\t\tif (typeof(c) == 'undefined') {\r\n\t\t\t\t\tc = {\r\n\t\t\t\t\t\terror : 'JSON Parse error.'\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (c.error)\r\n\t\t\t\t\tecb.call(o.error_scope || o.scope, c.error, x);\r\n\t\t\t\telse\r\n\t\t\t\t\tscb.call(o.success_scope || o.scope, c.result);\r\n\t\t\t};\r\n\r\n\t\t\to.error = function(ty, x) {\r\n\t\t\t\tif (ecb)\r\n\t\t\t\t\tecb.call(o.error_scope || o.scope, ty, x);\r\n\t\t\t};\r\n\r\n\t\t\to.data = JSON.serialize({\r\n\t\t\t\tid : o.id || 'c' + (this.count++),\r\n\t\t\t\tmethod : o.method,\r\n\t\t\t\tparams : o.params\r\n\t\t\t});\r\n\r\n\t\t\t// JSON content type for Ruby on rails. Bug: #1883287\r\n\t\t\to.content_type = 'application/json';\r\n\r\n\t\t\tXHR.send(o);\r\n\t\t},\r\n\r\n\t\t'static' : {\r\n\t\t\tsendRPC : function(o) {\r\n\t\t\t\treturn new tinymce.util.JSONRequest().send(o);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}());\r\n(function(tinymce){\r\n\ttinymce.VK = {\r\n\t\tDELETE: 46,\r\n\t\tBACKSPACE: 8,\r\n\t\tENTER: 13,\r\n\t\tTAB: 9,\r\n        SPACEBAR: 32,\r\n\t\tUP: 38,\r\n\t\tDOWN: 40\r\n\t}\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar VK = tinymce.VK, BACKSPACE = VK.BACKSPACE, DELETE = VK.DELETE;\r\n\r\n\tfunction cleanupStylesWhenDeleting(ed) {\r\n\t\tvar dom = ed.dom, selection = ed.selection;\r\n\r\n\t\ted.onKeyDown.add(function(ed, e) {\r\n\t\t\tvar rng, blockElm, node, clonedSpan, isDelete;\r\n\r\n\t\t\tisDelete = e.keyCode == DELETE;\r\n\t\t\tif (isDelete || e.keyCode == BACKSPACE) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\trng = selection.getRng();\r\n\r\n\t\t\t\t// Find root block\r\n\t\t\t\tblockElm = dom.getParent(rng.startContainer, dom.isBlock);\r\n\r\n\t\t\t\t// On delete clone the root span of the next block element\r\n\t\t\t\tif (isDelete)\r\n\t\t\t\t\tblockElm = dom.getNext(blockElm, dom.isBlock);\r\n\r\n\t\t\t\t// Locate root span element and clone it since it would otherwise get merged by the \"apple-style-span\" on delete/backspace\r\n\t\t\t\tif (blockElm) {\r\n\t\t\t\t\tnode = blockElm.firstChild;\r\n\r\n\t\t\t\t\t// Ignore empty text nodes\r\n\t\t\t\t\twhile (node && node.nodeType == 3 && node.nodeValue.length == 0)\r\n\t\t\t\t\t\tnode = node.nextSibling;\r\n\r\n\t\t\t\t\tif (node && node.nodeName === 'SPAN') {\r\n\t\t\t\t\t\tclonedSpan = node.cloneNode(false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Do the backspace/delete actiopn\r\n\t\t\t\ted.getDoc().execCommand(isDelete ? 'ForwardDelete' : 'Delete', false, null);\r\n\r\n\t\t\t\t// Find all odd apple-style-spans\r\n\t\t\t\tblockElm = dom.getParent(rng.startContainer, dom.isBlock);\r\n\t\t\t\ttinymce.each(dom.select('span.Apple-style-span,font.Apple-style-span', blockElm), function(span) {\r\n\t\t\t\t\tvar bm = selection.getBookmark();\r\n\r\n\t\t\t\t\tif (clonedSpan) {\r\n\t\t\t\t\t\tdom.replace(clonedSpan.cloneNode(false), span, true);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdom.remove(span, true);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Restore the selection\r\n\t\t\t\t\tselection.moveToBookmark(bm);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tfunction emptyEditorWhenDeleting(ed) {\r\n\t\ted.onKeyUp.add(function(ed, e) {\r\n\t\t\tvar keyCode = e.keyCode;\r\n\r\n\t\t\tif (keyCode == DELETE || keyCode == BACKSPACE) {\r\n\t\t\t\tif (ed.dom.isEmpty(ed.getBody())) {\r\n\t\t\t\t\ted.setContent('', {format : 'raw'});\r\n\t\t\t\t\ted.nodeChanged();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tfunction inputMethodFocus(ed) {\r\n\t\ted.dom.bind(ed.getDoc(), 'focusin', function() {\r\n\t\t\ted.selection.setRng(ed.selection.getRng());\r\n\t\t});\r\n\t};\r\n\r\n\tfunction removeHrOnBackspace(ed) {\r\n\t\ted.onKeyDown.add(function(ed, e) {\r\n\t\t\tif (e.keyCode === BACKSPACE) {\r\n\t\t\t\tif (ed.selection.isCollapsed() && ed.selection.getRng(true).startOffset === 0) {\r\n\t\t\t\t\tvar node = ed.selection.getNode();\r\n\t\t\t\t\tvar previousSibling = node.previousSibling;\r\n\t\t\t\t\tif (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === \"hr\") {\r\n\t\t\t\t\t\ted.dom.remove(previousSibling);\r\n\t\t\t\t\t\ttinymce.dom.Event.cancel(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tfunction focusBody(ed) {\r\n\t\t// Fix for a focus bug in FF 3.x where the body element\r\n\t\t// wouldn't get proper focus if the user clicked on the HTML element\r\n\t\tif (!Range.prototype.getClientRects) { // Detect getClientRects got introduced in FF 4\r\n\t\t\ted.onMouseDown.add(function(ed, e) {\r\n\t\t\t\tif (e.target.nodeName === \"HTML\") {\r\n\t\t\t\t\tvar body = ed.getBody();\r\n\r\n\t\t\t\t\t// Blur the body it's focused but not correctly focused\r\n\t\t\t\t\tbody.blur();\r\n\r\n\t\t\t\t\t// Refocus the body after a little while\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\tbody.focus();\r\n\t\t\t\t\t}, 0);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tfunction selectControlElements(ed) {\r\n\t\ted.onClick.add(function(ed, e) {\r\n\t\t\te = e.target;\r\n\r\n\t\t\tif (/^(IMG|HR)$/.test(e.nodeName))\r\n\t\t\t\ted.selection.select(e);\r\n\r\n\t\t\tif (e.nodeName == 'A' && ed.dom.hasClass(e, 'mceItemAnchor'))\r\n\t\t\t\ted.selection.select(e);\r\n\r\n\t\t\ted.nodeChanged();\r\n\t\t});\r\n\t};\r\n\r\n\tfunction selectionChangeNodeChanged(ed) {\r\n\t\tvar lastRng, selectionTimer;\r\n\r\n\t\ted.dom.bind(ed.getDoc(), 'selectionchange', function() {\r\n\t\t\tif (selectionTimer) {\r\n\t\t\t\tclearTimeout(selectionTimer);\r\n\t\t\t\tselectionTimer = 0;\r\n\t\t\t}\r\n\r\n\t\t\tselectionTimer = window.setTimeout(function() {\r\n\t\t\t\tvar rng = ed.selection.getRng();\r\n\r\n\t\t\t\t// Compare the ranges to see if it was a real change or not\r\n\t\t\t\tif (!lastRng || !tinymce.dom.RangeUtils.compareRanges(rng, lastRng)) {\r\n\t\t\t\t\ted.nodeChanged();\r\n\t\t\t\t\tlastRng = rng;\r\n\t\t\t\t}\r\n\t\t\t}, 50);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction ensureBodyHasRoleApplication(ed) {\r\n\t\tdocument.body.setAttribute(\"role\", \"application\");\r\n\t}\r\n\r\n\ttinymce.create('tinymce.util.Quirks', {\r\n\t\tQuirks: function(ed) {\r\n\t\t\t// WebKit\r\n\t\t\tif (tinymce.isWebKit) {\r\n\t\t\t\tcleanupStylesWhenDeleting(ed);\r\n\t\t\t\temptyEditorWhenDeleting(ed);\r\n\t\t\t\tinputMethodFocus(ed);\r\n\t\t\t\tselectControlElements(ed);\r\n\r\n\t\t\t\t// iOS\r\n\t\t\t\tif (tinymce.isIDevice) {\r\n\t\t\t\t\tselectionChangeNodeChanged(ed);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// IE\r\n\t\t\tif (tinymce.isIE) {\r\n\t\t\t\tremoveHrOnBackspace(ed);\r\n\t\t\t\temptyEditorWhenDeleting(ed);\r\n\t\t\t\tensureBodyHasRoleApplication(ed);\r\n\t\t\t}\r\n\r\n\t\t\t// Gecko\r\n\t\t\tif (tinymce.isGecko) {\r\n\t\t\t\tremoveHrOnBackspace(ed);\r\n\t\t\t\tfocusBody(ed);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar namedEntities, baseEntities, reverseEntities,\r\n\t\tattrsCharsRegExp = /[&<>\\\"\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g,\r\n\t\ttextCharsRegExp = /[<>&\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g,\r\n\t\trawCharsRegExp = /[<>&\\\"\\']/g,\r\n\t\tentityRegExp = /&(#x|#)?([\\w]+);/g,\r\n\t\tasciiMap = {\r\n\t\t\t\t128 : \"\\u20AC\", 130 : \"\\u201A\", 131 : \"\\u0192\", 132 : \"\\u201E\", 133 : \"\\u2026\", 134 : \"\\u2020\",\r\n\t\t\t\t135 : \"\\u2021\", 136 : \"\\u02C6\", 137 : \"\\u2030\", 138 : \"\\u0160\", 139 : \"\\u2039\", 140 : \"\\u0152\",\r\n\t\t\t\t142 : \"\\u017D\", 145 : \"\\u2018\", 146 : \"\\u2019\", 147 : \"\\u201C\", 148 : \"\\u201D\", 149 : \"\\u2022\",\r\n\t\t\t\t150 : \"\\u2013\", 151 : \"\\u2014\", 152 : \"\\u02DC\", 153 : \"\\u2122\", 154 : \"\\u0161\", 155 : \"\\u203A\",\r\n\t\t\t\t156 : \"\\u0153\", 158 : \"\\u017E\", 159 : \"\\u0178\"\r\n\t\t};\r\n\r\n\t// Raw entities\r\n\tbaseEntities = {\r\n\t\t'\\\"' : '&quot;', // Needs to be escaped since the YUI compressor would otherwise break the code\r\n\t\t\"'\" : '&#39;',\r\n\t\t'<' : '&lt;',\r\n\t\t'>' : '&gt;',\r\n\t\t'&' : '&amp;'\r\n\t};\r\n\r\n\t// Reverse lookup table for raw entities\r\n\treverseEntities = {\r\n\t\t'&lt;' : '<',\r\n\t\t'&gt;' : '>',\r\n\t\t'&amp;' : '&',\r\n\t\t'&quot;' : '\"',\r\n\t\t'&apos;' : \"'\"\r\n\t};\r\n\r\n\t// Decodes text by using the browser\r\n\tfunction nativeDecode(text) {\r\n\t\tvar elm;\r\n\r\n\t\telm = document.createElement(\"div\");\r\n\t\telm.innerHTML = text;\r\n\r\n\t\treturn elm.textContent || elm.innerText || text;\r\n\t};\r\n\r\n\t// Build a two way lookup table for the entities\r\n\tfunction buildEntitiesLookup(items, radix) {\r\n\t\tvar i, chr, entity, lookup = {};\r\n\r\n\t\tif (items) {\r\n\t\t\titems = items.split(',');\r\n\t\t\tradix = radix || 10;\r\n\r\n\t\t\t// Build entities lookup table\r\n\t\t\tfor (i = 0; i < items.length; i += 2) {\r\n\t\t\t\tchr = String.fromCharCode(parseInt(items[i], radix));\r\n\r\n\t\t\t\t// Only add non base entities\r\n\t\t\t\tif (!baseEntities[chr]) {\r\n\t\t\t\t\tentity = '&' + items[i + 1] + ';';\r\n\t\t\t\t\tlookup[chr] = entity;\r\n\t\t\t\t\tlookup[entity] = chr;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn lookup;\r\n\t\t}\r\n\t};\r\n\r\n\t// Unpack entities lookup where the numbers are in radix 32 to reduce the size\r\n\tnamedEntities = buildEntitiesLookup(\r\n\t\t'50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' +\r\n\t\t'5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' +\r\n\t\t'5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' +\r\n\t\t'5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' +\r\n\t\t'68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' +\r\n\t\t'6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' +\r\n\t\t'6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' +\r\n\t\t'75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' +\r\n\t\t'7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' +\r\n\t\t'7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' +\r\n\t\t'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' +\r\n\t\t'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' +\r\n\t\t't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' +\r\n\t\t'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' +\r\n\t\t'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' +\r\n\t\t'81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' +\r\n\t\t'8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' +\r\n\t\t'8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' +\r\n\t\t'8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' +\r\n\t\t'8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' +\r\n\t\t'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' +\r\n\t\t'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' +\r\n\t\t'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' +\r\n\t\t'80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' +\r\n\t\t'811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro'\r\n\t, 32);\r\n\r\n\ttinymce.html = tinymce.html || {};\r\n\r\n\ttinymce.html.Entities = {\r\n\t\tencodeRaw : function(text, attr) {\r\n\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\r\n\t\t\t\treturn baseEntities[chr] || chr;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tencodeAllRaw : function(text) {\r\n\t\t\treturn ('' + text).replace(rawCharsRegExp, function(chr) {\r\n\t\t\t\treturn baseEntities[chr] || chr;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tencodeNumeric : function(text, attr) {\r\n\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\r\n\t\t\t\t// Multi byte sequence convert it to a single entity\r\n\t\t\t\tif (chr.length > 1)\r\n\t\t\t\t\treturn '&#' + (((chr.charCodeAt(0) - 0xD800) * 0x400) + (chr.charCodeAt(1) - 0xDC00) + 0x10000) + ';';\r\n\r\n\t\t\t\treturn baseEntities[chr] || '&#' + chr.charCodeAt(0) + ';';\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tencodeNamed : function(text, attr, entities) {\r\n\t\t\tentities = entities || namedEntities;\r\n\r\n\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\r\n\t\t\t\treturn baseEntities[chr] || entities[chr] || chr;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetEncodeFunc : function(name, entities) {\r\n\t\t\tvar Entities = tinymce.html.Entities;\r\n\r\n\t\t\tentities = buildEntitiesLookup(entities) || namedEntities;\r\n\r\n\t\t\tfunction encodeNamedAndNumeric(text, attr) {\r\n\t\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\r\n\t\t\t\t\treturn baseEntities[chr] || entities[chr] || '&#' + chr.charCodeAt(0) + ';' || chr;\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tfunction encodeCustomNamed(text, attr) {\r\n\t\t\t\treturn Entities.encodeNamed(text, attr, entities);\r\n\t\t\t};\r\n\r\n\t\t\t// Replace + with , to be compatible with previous TinyMCE versions\r\n\t\t\tname = tinymce.makeMap(name.replace(/\\+/g, ','));\r\n\r\n\t\t\t// Named and numeric encoder\r\n\t\t\tif (name.named && name.numeric)\r\n\t\t\t\treturn encodeNamedAndNumeric;\r\n\r\n\t\t\t// Named encoder\r\n\t\t\tif (name.named) {\r\n\t\t\t\t// Custom names\r\n\t\t\t\tif (entities)\r\n\t\t\t\t\treturn encodeCustomNamed;\r\n\r\n\t\t\t\treturn Entities.encodeNamed;\r\n\t\t\t}\r\n\r\n\t\t\t// Numeric\r\n\t\t\tif (name.numeric)\r\n\t\t\t\treturn Entities.encodeNumeric;\r\n\r\n\t\t\t// Raw encoder\r\n\t\t\treturn Entities.encodeRaw;\r\n\t\t},\r\n\r\n\t\tdecode : function(text) {\r\n\t\t\treturn text.replace(entityRegExp, function(all, numeric, value) {\r\n\t\t\t\tif (numeric) {\r\n\t\t\t\t\tvalue = parseInt(value, numeric.length === 2 ? 16 : 10);\r\n\r\n\t\t\t\t\t// Support upper UTF\r\n\t\t\t\t\tif (value > 0xFFFF) {\r\n\t\t\t\t\t\tvalue -= 0x10000;\r\n\r\n\t\t\t\t\t\treturn String.fromCharCode(0xD800 + (value >> 10), 0xDC00 + (value & 0x3FF));\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\treturn asciiMap[value] || String.fromCharCode(value);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn reverseEntities[all] || namedEntities[all] || nativeDecode(all);\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n})(tinymce);\r\n\r\ntinymce.html.Styles = function(settings, schema) {\r\n\tvar rgbRegExp = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*\\)/gi,\r\n\t\turlOrStrRegExp = /(?:url(?:(?:\\(\\s*\\\"([^\\\"]+)\\\"\\s*\\))|(?:\\(\\s*\\'([^\\']+)\\'\\s*\\))|(?:\\(\\s*([^)\\s]+)\\s*\\))))|(?:\\'([^\\']+)\\')|(?:\\\"([^\\\"]+)\\\")/gi,\r\n\t\tstyleRegExp = /\\s*([^:]+):\\s*([^;]+);?/g,\r\n\t\ttrimRightRegExp = /\\s+$/,\r\n\t\turlColorRegExp = /rgb/,\r\n\t\tundef, i, encodingLookup = {}, encodingItems;\r\n\r\n\tsettings = settings || {};\r\n\r\n\tencodingItems = '\\\\\" \\\\\\' \\\\; \\\\: ; : \\uFEFF'.split(' ');\r\n\tfor (i = 0; i < encodingItems.length; i++) {\r\n\t\tencodingLookup[encodingItems[i]] = '\\uFEFF' + i;\r\n\t\tencodingLookup['\\uFEFF' + i] = encodingItems[i];\r\n\t}\r\n\r\n\tfunction toHex(match, r, g, b) {\r\n\t\tfunction hex(val) {\r\n\t\t\tval = parseInt(val).toString(16);\r\n\r\n\t\t\treturn val.length > 1 ? val : '0' + val; // 0 -> 00\r\n\t\t};\r\n\r\n\t\treturn '#' + hex(r) + hex(g) + hex(b);\r\n\t};\r\n\r\n\treturn {\r\n\t\ttoHex : function(color) {\r\n\t\t\treturn color.replace(rgbRegExp, toHex);\r\n\t\t},\r\n\r\n\t\tparse : function(css) {\r\n\t\t\tvar styles = {}, matches, name, value, isEncoded, urlConverter = settings.url_converter, urlConverterScope = settings.url_converter_scope || this;\r\n\r\n\t\t\tfunction compress(prefix, suffix) {\r\n\t\t\t\tvar top, right, bottom, left;\r\n\r\n\t\t\t\t// Get values and check it needs compressing\r\n\t\t\t\ttop = styles[prefix + '-top' + suffix];\r\n\t\t\t\tif (!top)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tright = styles[prefix + '-right' + suffix];\r\n\t\t\t\tif (top != right)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tbottom = styles[prefix + '-bottom' + suffix];\r\n\t\t\t\tif (right != bottom)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tleft = styles[prefix + '-left' + suffix];\r\n\t\t\t\tif (bottom != left)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t// Compress\r\n\t\t\t\tstyles[prefix + suffix] = left;\r\n\t\t\t\tdelete styles[prefix + '-top' + suffix];\r\n\t\t\t\tdelete styles[prefix + '-right' + suffix];\r\n\t\t\t\tdelete styles[prefix + '-bottom' + suffix];\r\n\t\t\t\tdelete styles[prefix + '-left' + suffix];\r\n\t\t\t};\r\n\r\n\t\t\tfunction canCompress(key) {\r\n\t\t\t\tvar value = styles[key], i;\r\n\r\n\t\t\t\tif (!value || value.indexOf(' ') < 0)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tvalue = value.split(' ');\r\n\t\t\t\ti = value.length;\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tif (value[i] !== value[0])\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstyles[key] = value[0];\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t};\r\n\r\n\t\t\tfunction compress2(target, a, b, c) {\r\n\t\t\t\tif (!canCompress(a))\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tif (!canCompress(b))\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tif (!canCompress(c))\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t// Compress\r\n\t\t\t\tstyles[target] = styles[a] + ' ' + styles[b] + ' ' + styles[c];\r\n\t\t\t\tdelete styles[a];\r\n\t\t\t\tdelete styles[b];\r\n\t\t\t\tdelete styles[c];\r\n\t\t\t};\r\n\r\n\t\t\t// Encodes the specified string by replacing all \\\" \\' ; : with _<num>\r\n\t\t\tfunction encode(str) {\r\n\t\t\t\tisEncoded = true;\r\n\r\n\t\t\t\treturn encodingLookup[str];\r\n\t\t\t};\r\n\r\n\t\t\t// Decodes the specified string by replacing all _<num> with it's original value \\\" \\' etc\r\n\t\t\t// It will also decode the \\\" \\' if keep_slashes is set to fale or omitted\r\n\t\t\tfunction decode(str, keep_slashes) {\r\n\t\t\t\tif (isEncoded) {\r\n\t\t\t\t\tstr = str.replace(/\\uFEFF[0-9]/g, function(str) {\r\n\t\t\t\t\t\treturn encodingLookup[str];\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!keep_slashes)\r\n\t\t\t\t\tstr = str.replace(/\\\\([\\'\\\";:])/g, \"$1\");\r\n\r\n\t\t\t\treturn str;\r\n\t\t\t}\r\n\r\n\t\t\tif (css) {\r\n\t\t\t\t// Encode \\\" \\' % and ; and : inside strings so they don't interfere with the style parsing\r\n\t\t\t\tcss = css.replace(/\\\\[\\\"\\';:\\uFEFF]/g, encode).replace(/\\\"[^\\\"]+\\\"|\\'[^\\']+\\'/g, function(str) {\r\n\t\t\t\t\treturn str.replace(/[;:]/g, encode);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Parse styles\r\n\t\t\t\twhile (matches = styleRegExp.exec(css)) {\r\n\t\t\t\t\tname = matches[1].replace(trimRightRegExp, '').toLowerCase();\r\n\t\t\t\t\tvalue = matches[2].replace(trimRightRegExp, '');\r\n\r\n\t\t\t\t\tif (name && value.length > 0) {\r\n\t\t\t\t\t\t// Opera will produce 700 instead of bold in their style values\r\n\t\t\t\t\t\tif (name === 'font-weight' && value === '700')\r\n\t\t\t\t\t\t\tvalue = 'bold';\r\n\t\t\t\t\t\telse if (name === 'color' || name === 'background-color') // Lowercase colors like RED\r\n\t\t\t\t\t\t\tvalue = value.toLowerCase();\t\t\r\n\r\n\t\t\t\t\t\t// Convert RGB colors to HEX\r\n\t\t\t\t\t\tvalue = value.replace(rgbRegExp, toHex);\r\n\r\n\t\t\t\t\t\t// Convert URLs and force them into url('value') format\r\n\t\t\t\t\t\tvalue = value.replace(urlOrStrRegExp, function(match, url, url2, url3, str, str2) {\r\n\t\t\t\t\t\t\tstr = str || str2;\r\n\r\n\t\t\t\t\t\t\tif (str) {\r\n\t\t\t\t\t\t\t\tstr = decode(str);\r\n\r\n\t\t\t\t\t\t\t\t// Force strings into single quote format\r\n\t\t\t\t\t\t\t\treturn \"'\" + str.replace(/\\'/g, \"\\\\'\") + \"'\";\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\turl = decode(url || url2 || url3);\r\n\r\n\t\t\t\t\t\t\t// Convert the URL to relative/absolute depending on config\r\n\t\t\t\t\t\t\tif (urlConverter)\r\n\t\t\t\t\t\t\t\turl = urlConverter.call(urlConverterScope, url, 'style');\r\n\r\n\t\t\t\t\t\t\t// Output new URL format\r\n\t\t\t\t\t\t\treturn \"url('\" + url.replace(/\\'/g, \"\\\\'\") + \"')\";\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tstyles[name] = isEncoded ? decode(value, true) : value;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tstyleRegExp.lastIndex = matches.index + matches[0].length;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Compress the styles to reduce it's size for example IE will expand styles\r\n\t\t\t\tcompress(\"border\", \"\");\r\n\t\t\t\tcompress(\"border\", \"-width\");\r\n\t\t\t\tcompress(\"border\", \"-color\");\r\n\t\t\t\tcompress(\"border\", \"-style\");\r\n\t\t\t\tcompress(\"padding\", \"\");\r\n\t\t\t\tcompress(\"margin\", \"\");\r\n\t\t\t\tcompress2('border', 'border-width', 'border-style', 'border-color');\r\n\r\n\t\t\t\t// Remove pointless border, IE produces these\r\n\t\t\t\tif (styles.border === 'medium none')\r\n\t\t\t\t\tdelete styles.border;\r\n\t\t\t}\r\n\r\n\t\t\treturn styles;\r\n\t\t},\r\n\r\n\t\tserialize : function(styles, element_name) {\r\n\t\t\tvar css = '', name, value;\r\n\r\n\t\t\tfunction serializeStyles(name) {\r\n\t\t\t\tvar styleList, i, l, value;\r\n\r\n\t\t\t\tstyleList = schema.styles[name];\r\n\t\t\t\tif (styleList) {\r\n\t\t\t\t\tfor (i = 0, l = styleList.length; i < l; i++) {\r\n\t\t\t\t\t\tname = styleList[i];\r\n\t\t\t\t\t\tvalue = styles[name];\r\n\r\n\t\t\t\t\t\tif (value !== undef && value.length > 0)\r\n\t\t\t\t\t\t\tcss += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// Serialize styles according to schema\r\n\t\t\tif (element_name && schema && schema.styles) {\r\n\t\t\t\t// Serialize global styles and element specific styles\r\n\t\t\t\tserializeStyles('*');\r\n\t\t\t\tserializeStyles(element_name);\r\n\t\t\t} else {\r\n\t\t\t\t// Output the styles in the order they are inside the object\r\n\t\t\t\tfor (name in styles) {\r\n\t\t\t\t\tvalue = styles[name];\r\n\r\n\t\t\t\t\tif (value !== undef && value.length > 0)\r\n\t\t\t\t\t\tcss += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn css;\r\n\t\t}\r\n\t};\r\n};\r\n\r\n(function(tinymce) {\r\n\tvar transitional = {}, boolAttrMap, blockElementsMap, shortEndedElementsMap, nonEmptyElementsMap, customElementsMap = {},\r\n\t\tdefaultWhiteSpaceElementsMap, selfClosingElementsMap, makeMap = tinymce.makeMap, each = tinymce.each;\r\n\r\n\tfunction split(str, delim) {\r\n\t\treturn str.split(delim || ',');\r\n\t};\r\n\r\n\tfunction unpack(lookup, data) {\r\n\t\tvar key, elements = {};\r\n\r\n\t\tfunction replace(value) {\r\n\t\t\treturn value.replace(/[A-Z]+/g, function(key) {\r\n\t\t\t\treturn replace(lookup[key]);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Unpack lookup\r\n\t\tfor (key in lookup) {\r\n\t\t\tif (lookup.hasOwnProperty(key))\r\n\t\t\t\tlookup[key] = replace(lookup[key]);\r\n\t\t}\r\n\r\n\t\t// Unpack and parse data into object map\r\n\t\treplace(data).replace(/#/g, '#text').replace(/(\\w+)\\[([^\\]]+)\\]\\[([^\\]]*)\\]/g, function(str, name, attributes, children) {\r\n\t\t\tattributes = split(attributes, '|');\r\n\r\n\t\t\telements[name] = {\r\n\t\t\t\tattributes : makeMap(attributes),\r\n\t\t\t\tattributesOrder : attributes,\r\n\t\t\t\tchildren : makeMap(children, '|', {'#comment' : {}})\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn elements;\r\n\t};\r\n\r\n\t// Build a lookup table for block elements both lowercase and uppercase\r\n\tblockElementsMap = 'h1,h2,h3,h4,h5,h6,hr,p,div,address,pre,form,table,tbody,thead,tfoot,' + \r\n\t\t\t\t\t\t'th,tr,td,li,ol,ul,caption,blockquote,center,dl,dt,dd,dir,fieldset,' + \r\n\t\t\t\t\t\t'noscript,menu,isindex,samp,header,footer,article,section,hgroup';\r\n\tblockElementsMap = makeMap(blockElementsMap, ',', makeMap(blockElementsMap.toUpperCase()));\r\n\r\n\t// This is the XHTML 1.0 transitional elements with it's attributes and children packed to reduce it's size\r\n\ttransitional = unpack({\r\n\t\tZ : 'H|K|N|O|P',\r\n\t\tY : 'X|form|R|Q',\r\n\t\tZG : 'E|span|width|align|char|charoff|valign',\r\n\t\tX : 'p|T|div|U|W|isindex|fieldset|table',\r\n\t\tZF : 'E|align|char|charoff|valign',\r\n\t\tW : 'pre|hr|blockquote|address|center|noframes',\r\n\t\tZE : 'abbr|axis|headers|scope|rowspan|colspan|align|char|charoff|valign|nowrap|bgcolor|width|height',\r\n\t\tZD : '[E][S]',\r\n\t\tU : 'ul|ol|dl|menu|dir',\r\n\t\tZC : 'p|Y|div|U|W|table|br|span|bdo|object|applet|img|map|K|N|Q',\r\n\t\tT : 'h1|h2|h3|h4|h5|h6',\r\n\t\tZB : 'X|S|Q',\r\n\t\tS : 'R|P',\r\n\t\tZA : 'a|G|J|M|O|P',\r\n\t\tR : 'a|H|K|N|O',\r\n\t\tQ : 'noscript|P',\r\n\t\tP : 'ins|del|script',\r\n\t\tO : 'input|select|textarea|label|button',\r\n\t\tN : 'M|L',\r\n\t\tM : 'em|strong|dfn|code|q|samp|kbd|var|cite|abbr|acronym',\r\n\t\tL : 'sub|sup',\r\n\t\tK : 'J|I',\r\n\t\tJ : 'tt|i|b|u|s|strike',\r\n\t\tI : 'big|small|font|basefont',\r\n\t\tH : 'G|F',\r\n\t\tG : 'br|span|bdo',\r\n\t\tF : 'object|applet|img|map|iframe',\r\n\t\tE : 'A|B|C',\r\n\t\tD : 'accesskey|tabindex|onfocus|onblur',\r\n\t\tC : 'onclick|ondblclick|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup',\r\n\t\tB : 'lang|xml:lang|dir',\r\n\t\tA : 'id|class|style|title'\r\n\t}, 'script[id|charset|type|language|src|defer|xml:space][]' + \r\n\t\t'style[B|id|type|media|title|xml:space][]' + \r\n\t\t'object[E|declare|classid|codebase|data|type|codetype|archive|standby|width|height|usemap|name|tabindex|align|border|hspace|vspace][#|param|Y]' + \r\n\t\t'param[id|name|value|valuetype|type][]' + \r\n\t\t'p[E|align][#|S]' + \r\n\t\t'a[E|D|charset|type|name|href|hreflang|rel|rev|shape|coords|target][#|Z]' + \r\n\t\t'br[A|clear][]' + \r\n\t\t'span[E][#|S]' + \r\n\t\t'bdo[A|C|B][#|S]' + \r\n\t\t'applet[A|codebase|archive|code|object|alt|name|width|height|align|hspace|vspace][#|param|Y]' + \r\n\t\t'h1[E|align][#|S]' + \r\n\t\t'img[E|src|alt|name|longdesc|width|height|usemap|ismap|align|border|hspace|vspace][]' + \r\n\t\t'map[B|C|A|name][X|form|Q|area]' + \r\n\t\t'h2[E|align][#|S]' + \r\n\t\t'iframe[A|longdesc|name|src|frameborder|marginwidth|marginheight|scrolling|align|width|height][#|Y]' + \r\n\t\t'h3[E|align][#|S]' + \r\n\t\t'tt[E][#|S]' + \r\n\t\t'i[E][#|S]' + \r\n\t\t'b[E][#|S]' + \r\n\t\t'u[E][#|S]' + \r\n\t\t's[E][#|S]' + \r\n\t\t'strike[E][#|S]' + \r\n\t\t'big[E][#|S]' + \r\n\t\t'small[E][#|S]' + \r\n\t\t'font[A|B|size|color|face][#|S]' + \r\n\t\t'basefont[id|size|color|face][]' + \r\n\t\t'em[E][#|S]' + \r\n\t\t'strong[E][#|S]' + \r\n\t\t'dfn[E][#|S]' + \r\n\t\t'code[E][#|S]' + \r\n\t\t'q[E|cite][#|S]' + \r\n\t\t'samp[E][#|S]' + \r\n\t\t'kbd[E][#|S]' + \r\n\t\t'var[E][#|S]' + \r\n\t\t'cite[E][#|S]' + \r\n\t\t'abbr[E][#|S]' + \r\n\t\t'acronym[E][#|S]' + \r\n\t\t'sub[E][#|S]' + \r\n\t\t'sup[E][#|S]' + \r\n\t\t'input[E|D|type|name|value|checked|disabled|readonly|size|maxlength|src|alt|usemap|onselect|onchange|accept|align][]' + \r\n\t\t'select[E|name|size|multiple|disabled|tabindex|onfocus|onblur|onchange][optgroup|option]' + \r\n\t\t'optgroup[E|disabled|label][option]' + \r\n\t\t'option[E|selected|disabled|label|value][]' + \r\n\t\t'textarea[E|D|name|rows|cols|disabled|readonly|onselect|onchange][]' + \r\n\t\t'label[E|for|accesskey|onfocus|onblur][#|S]' + \r\n\t\t'button[E|D|name|value|type|disabled][#|p|T|div|U|W|table|G|object|applet|img|map|K|N|Q]' + \r\n\t\t'h4[E|align][#|S]' + \r\n\t\t'ins[E|cite|datetime][#|Y]' + \r\n\t\t'h5[E|align][#|S]' + \r\n\t\t'del[E|cite|datetime][#|Y]' + \r\n\t\t'h6[E|align][#|S]' + \r\n\t\t'div[E|align][#|Y]' + \r\n\t\t'ul[E|type|compact][li]' + \r\n\t\t'li[E|type|value][#|Y]' + \r\n\t\t'ol[E|type|compact|start][li]' + \r\n\t\t'dl[E|compact][dt|dd]' + \r\n\t\t'dt[E][#|S]' + \r\n\t\t'dd[E][#|Y]' + \r\n\t\t'menu[E|compact][li]' + \r\n\t\t'dir[E|compact][li]' + \r\n\t\t'pre[E|width|xml:space][#|ZA]' + \r\n\t\t'hr[E|align|noshade|size|width][]' + \r\n\t\t'blockquote[E|cite][#|Y]' + \r\n\t\t'address[E][#|S|p]' + \r\n\t\t'center[E][#|Y]' + \r\n\t\t'noframes[E][#|Y]' + \r\n\t\t'isindex[A|B|prompt][]' + \r\n\t\t'fieldset[E][#|legend|Y]' + \r\n\t\t'legend[E|accesskey|align][#|S]' + \r\n\t\t'table[E|summary|width|border|frame|rules|cellspacing|cellpadding|align|bgcolor][caption|col|colgroup|thead|tfoot|tbody|tr]' + \r\n\t\t'caption[E|align][#|S]' + \r\n\t\t'col[ZG][]' + \r\n\t\t'colgroup[ZG][col]' + \r\n\t\t'thead[ZF][tr]' + \r\n\t\t'tr[ZF|bgcolor][th|td]' + \r\n\t\t'th[E|ZE][#|Y]' + \r\n\t\t'form[E|action|method|name|enctype|onsubmit|onreset|accept|accept-charset|target][#|X|R|Q]' + \r\n\t\t'noscript[E][#|Y]' + \r\n\t\t'td[E|ZE][#|Y]' + \r\n\t\t'tfoot[ZF][tr]' + \r\n\t\t'tbody[ZF][tr]' + \r\n\t\t'area[E|D|shape|coords|href|nohref|alt|target][]' + \r\n\t\t'base[id|href|target][]' + \r\n\t\t'body[E|onload|onunload|background|bgcolor|text|link|vlink|alink][#|Y]'\r\n\t);\r\n\r\n\tboolAttrMap = makeMap('checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected,autoplay,loop,controls');\r\n\tshortEndedElementsMap = makeMap('area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed,source');\r\n\tnonEmptyElementsMap = tinymce.extend(makeMap('td,th,iframe,video,audio,object'), shortEndedElementsMap);\r\n\tdefaultWhiteSpaceElementsMap = makeMap('pre,script,style,textarea');\r\n\tselfClosingElementsMap = makeMap('colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr');\r\n\r\n\ttinymce.html.Schema = function(settings) {\r\n\t\tvar self = this, elements = {}, children = {}, patternElements = [], validStyles, whiteSpaceElementsMap;\r\n\r\n\t\tsettings = settings || {};\r\n\r\n\t\t// Allow all elements and attributes if verify_html is set to false\r\n\t\tif (settings.verify_html === false)\r\n\t\t\tsettings.valid_elements = '*[*]';\r\n\r\n\t\t// Build styles list\r\n\t\tif (settings.valid_styles) {\r\n\t\t\tvalidStyles = {};\r\n\r\n\t\t\t// Convert styles into a rule list\r\n\t\t\teach(settings.valid_styles, function(value, key) {\r\n\t\t\t\tvalidStyles[key] = tinymce.explode(value);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\twhiteSpaceElementsMap = settings.whitespace_elements ? makeMap(settings.whitespace_elements) : defaultWhiteSpaceElementsMap;\r\n\r\n\t\t// Converts a wildcard expression string to a regexp for example *a will become /.*a/.\r\n\t\tfunction patternToRegExp(str) {\r\n\t\t\treturn new RegExp('^' + str.replace(/([?+*])/g, '.$1') + '$');\r\n\t\t};\r\n\r\n\t\t// Parses the specified valid_elements string and adds to the current rules\r\n\t\t// This function is a bit hard to read since it's heavily optimized for speed\r\n\t\tfunction addValidElements(valid_elements) {\r\n\t\t\tvar ei, el, ai, al, yl, matches, element, attr, attrData, elementName, attrName, attrType, attributes, attributesOrder,\r\n\t\t\t\tprefix, outputName, globalAttributes, globalAttributesOrder, transElement, key, childKey, value,\r\n\t\t\t\telementRuleRegExp = /^([#+-])?([^\\[\\/]+)(?:\\/([^\\[]+))?(?:\\[([^\\]]+)\\])?$/,\r\n\t\t\t\tattrRuleRegExp = /^([!\\-])?(\\w+::\\w+|[^=:<]+)?(?:([=:<])(.*))?$/,\r\n\t\t\t\thasPatternsRegExp = /[*?+]/;\r\n\r\n\t\t\tif (valid_elements) {\r\n\t\t\t\t// Split valid elements into an array with rules\r\n\t\t\t\tvalid_elements = split(valid_elements);\r\n\r\n\t\t\t\tif (elements['@']) {\r\n\t\t\t\t\tglobalAttributes = elements['@'].attributes;\r\n\t\t\t\t\tglobalAttributesOrder = elements['@'].attributesOrder;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Loop all rules\r\n\t\t\t\tfor (ei = 0, el = valid_elements.length; ei < el; ei++) {\r\n\t\t\t\t\t// Parse element rule\r\n\t\t\t\t\tmatches = elementRuleRegExp.exec(valid_elements[ei]);\r\n\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\t// Setup local names for matches\r\n\t\t\t\t\t\tprefix = matches[1];\r\n\t\t\t\t\t\telementName = matches[2];\r\n\t\t\t\t\t\toutputName = matches[3];\r\n\t\t\t\t\t\tattrData = matches[4];\r\n\r\n\t\t\t\t\t\t// Create new attributes and attributesOrder\r\n\t\t\t\t\t\tattributes = {};\r\n\t\t\t\t\t\tattributesOrder = [];\r\n\r\n\t\t\t\t\t\t// Create the new element\r\n\t\t\t\t\t\telement = {\r\n\t\t\t\t\t\t\tattributes : attributes,\r\n\t\t\t\t\t\t\tattributesOrder : attributesOrder\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t// Padd empty elements prefix\r\n\t\t\t\t\t\tif (prefix === '#')\r\n\t\t\t\t\t\t\telement.paddEmpty = true;\r\n\r\n\t\t\t\t\t\t// Remove empty elements prefix\r\n\t\t\t\t\t\tif (prefix === '-')\r\n\t\t\t\t\t\t\telement.removeEmpty = true;\r\n\r\n\t\t\t\t\t\t// Copy attributes from global rule into current rule\r\n\t\t\t\t\t\tif (globalAttributes) {\r\n\t\t\t\t\t\t\tfor (key in globalAttributes)\r\n\t\t\t\t\t\t\t\tattributes[key] = globalAttributes[key];\r\n\r\n\t\t\t\t\t\t\tattributesOrder.push.apply(attributesOrder, globalAttributesOrder);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Attributes defined\r\n\t\t\t\t\t\tif (attrData) {\r\n\t\t\t\t\t\t\tattrData = split(attrData, '|');\r\n\t\t\t\t\t\t\tfor (ai = 0, al = attrData.length; ai < al; ai++) {\r\n\t\t\t\t\t\t\t\tmatches = attrRuleRegExp.exec(attrData[ai]);\r\n\t\t\t\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\t\t\t\tattr = {};\r\n\t\t\t\t\t\t\t\t\tattrType = matches[1];\r\n\t\t\t\t\t\t\t\t\tattrName = matches[2].replace(/::/g, ':');\r\n\t\t\t\t\t\t\t\t\tprefix = matches[3];\r\n\t\t\t\t\t\t\t\t\tvalue = matches[4];\r\n\r\n\t\t\t\t\t\t\t\t\t// Required\r\n\t\t\t\t\t\t\t\t\tif (attrType === '!') {\r\n\t\t\t\t\t\t\t\t\t\telement.attributesRequired = element.attributesRequired || [];\r\n\t\t\t\t\t\t\t\t\t\telement.attributesRequired.push(attrName);\r\n\t\t\t\t\t\t\t\t\t\tattr.required = true;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// Denied from global\r\n\t\t\t\t\t\t\t\t\tif (attrType === '-') {\r\n\t\t\t\t\t\t\t\t\t\tdelete attributes[attrName];\r\n\t\t\t\t\t\t\t\t\t\tattributesOrder.splice(tinymce.inArray(attributesOrder, attrName), 1);\r\n\t\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// Default value\r\n\t\t\t\t\t\t\t\t\tif (prefix) {\r\n\t\t\t\t\t\t\t\t\t\t// Default value\r\n\t\t\t\t\t\t\t\t\t\tif (prefix === '=') {\r\n\t\t\t\t\t\t\t\t\t\t\telement.attributesDefault = element.attributesDefault || [];\r\n\t\t\t\t\t\t\t\t\t\t\telement.attributesDefault.push({name: attrName, value: value});\r\n\t\t\t\t\t\t\t\t\t\t\tattr.defaultValue = value;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Forced value\r\n\t\t\t\t\t\t\t\t\t\tif (prefix === ':') {\r\n\t\t\t\t\t\t\t\t\t\t\telement.attributesForced = element.attributesForced || [];\r\n\t\t\t\t\t\t\t\t\t\t\telement.attributesForced.push({name: attrName, value: value});\r\n\t\t\t\t\t\t\t\t\t\t\tattr.forcedValue = value;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Required values\r\n\t\t\t\t\t\t\t\t\t\tif (prefix === '<')\r\n\t\t\t\t\t\t\t\t\t\t\tattr.validValues = makeMap(value, '?');\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// Check for attribute patterns\r\n\t\t\t\t\t\t\t\t\tif (hasPatternsRegExp.test(attrName)) {\r\n\t\t\t\t\t\t\t\t\t\telement.attributePatterns = element.attributePatterns || [];\r\n\t\t\t\t\t\t\t\t\t\tattr.pattern = patternToRegExp(attrName);\r\n\t\t\t\t\t\t\t\t\t\telement.attributePatterns.push(attr);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t// Add attribute to order list if it doesn't already exist\r\n\t\t\t\t\t\t\t\t\t\tif (!attributes[attrName])\r\n\t\t\t\t\t\t\t\t\t\t\tattributesOrder.push(attrName);\r\n\r\n\t\t\t\t\t\t\t\t\t\tattributes[attrName] = attr;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Global rule, store away these for later usage\r\n\t\t\t\t\t\tif (!globalAttributes && elementName == '@') {\r\n\t\t\t\t\t\t\tglobalAttributes = attributes;\r\n\t\t\t\t\t\t\tglobalAttributesOrder = attributesOrder;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Handle substitute elements such as b/strong\r\n\t\t\t\t\t\tif (outputName) {\r\n\t\t\t\t\t\t\telement.outputName = elementName;\r\n\t\t\t\t\t\t\telements[outputName] = element;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Add pattern or exact element\r\n\t\t\t\t\t\tif (hasPatternsRegExp.test(elementName)) {\r\n\t\t\t\t\t\t\telement.pattern = patternToRegExp(elementName);\r\n\t\t\t\t\t\t\tpatternElements.push(element);\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\telements[elementName] = element;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction setValidElements(valid_elements) {\r\n\t\t\telements = {};\r\n\t\t\tpatternElements = [];\r\n\r\n\t\t\taddValidElements(valid_elements);\r\n\r\n\t\t\teach(transitional, function(element, name) {\r\n\t\t\t\tchildren[name] = element.children;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Adds custom non HTML elements to the schema\r\n\t\tfunction addCustomElements(custom_elements) {\r\n\t\t\tvar customElementRegExp = /^(~)?(.+)$/;\r\n\r\n\t\t\tif (custom_elements) {\r\n\t\t\t\teach(split(custom_elements), function(rule) {\r\n\t\t\t\t\tvar matches = customElementRegExp.exec(rule),\r\n\t\t\t\t\t\tinline = matches[1] === '~',\r\n\t\t\t\t\t\tcloneName = inline ? 'span' : 'div',\r\n\t\t\t\t\t\tname = matches[2];\r\n\r\n\t\t\t\t\tchildren[name] = children[cloneName];\r\n\t\t\t\t\tcustomElementsMap[name] = cloneName;\r\n\r\n\t\t\t\t\t// If it's not marked as inline then add it to valid block elements\r\n\t\t\t\t\tif (!inline)\r\n\t\t\t\t\t\tblockElementsMap[name] = {};\r\n\r\n\t\t\t\t\t// Add custom elements at span/div positions\r\n\t\t\t\t\teach(children, function(element, child) {\r\n\t\t\t\t\t\tif (element[cloneName])\r\n\t\t\t\t\t\t\telement[name] = element[cloneName];\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Adds valid children to the schema object\r\n\t\tfunction addValidChildren(valid_children) {\r\n\t\t\tvar childRuleRegExp = /^([+\\-]?)(\\w+)\\[([^\\]]+)\\]$/;\r\n\r\n\t\t\tif (valid_children) {\r\n\t\t\t\teach(split(valid_children), function(rule) {\r\n\t\t\t\t\tvar matches = childRuleRegExp.exec(rule), parent, prefix;\r\n\r\n\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\tprefix = matches[1];\r\n\r\n\t\t\t\t\t\t// Add/remove items from default\r\n\t\t\t\t\t\tif (prefix)\r\n\t\t\t\t\t\t\tparent = children[matches[2]];\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tparent = children[matches[2]] = {'#comment' : {}};\r\n\r\n\t\t\t\t\t\tparent = children[matches[2]];\r\n\r\n\t\t\t\t\t\teach(split(matches[3], '|'), function(child) {\r\n\t\t\t\t\t\t\tif (prefix === '-')\r\n\t\t\t\t\t\t\t\tdelete parent[child];\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tparent[child] = {};\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction getElementRule(name) {\r\n\t\t\tvar element = elements[name], i;\r\n\r\n\t\t\t// Exact match found\r\n\t\t\tif (element)\r\n\t\t\t\treturn element;\r\n\r\n\t\t\t// No exact match then try the patterns\r\n\t\t\ti = patternElements.length;\r\n\t\t\twhile (i--) {\r\n\t\t\t\telement = patternElements[i];\r\n\r\n\t\t\t\tif (element.pattern.test(name))\r\n\t\t\t\t\treturn element;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif (!settings.valid_elements) {\r\n\t\t\t// No valid elements defined then clone the elements from the transitional spec\r\n\t\t\teach(transitional, function(element, name) {\r\n\t\t\t\telements[name] = {\r\n\t\t\t\t\tattributes : element.attributes,\r\n\t\t\t\t\tattributesOrder : element.attributesOrder\r\n\t\t\t\t};\r\n\r\n\t\t\t\tchildren[name] = element.children;\r\n\t\t\t});\r\n\r\n\t\t\t// Switch these\r\n\t\t\teach(split('strong/b,em/i'), function(item) {\r\n\t\t\t\titem = split(item, '/');\r\n\t\t\t\telements[item[1]].outputName = item[0];\r\n\t\t\t});\r\n\r\n\t\t\t// Add default alt attribute for images\r\n\t\t\telements.img.attributesDefault = [{name: 'alt', value: ''}];\r\n\r\n\t\t\t// Remove these if they are empty by default\r\n\t\t\teach(split('ol,ul,sub,sup,blockquote,span,font,a,table,tbody,tr'), function(name) {\r\n\t\t\t\telements[name].removeEmpty = true;\r\n\t\t\t});\r\n\r\n\t\t\t// Padd these by default\r\n\t\t\teach(split('p,h1,h2,h3,h4,h5,h6,th,td,pre,div,address,caption'), function(name) {\r\n\t\t\t\telements[name].paddEmpty = true;\r\n\t\t\t});\r\n\t\t} else\r\n\t\t\tsetValidElements(settings.valid_elements);\r\n\r\n\t\taddCustomElements(settings.custom_elements);\r\n\t\taddValidChildren(settings.valid_children);\r\n\t\taddValidElements(settings.extended_valid_elements);\r\n\r\n\t\t// Todo: Remove this when we fix list handling to be valid\r\n\t\taddValidChildren('+ol[ul|ol],+ul[ul|ol]');\r\n\r\n\t\t// If the user didn't allow span only allow internal spans\r\n\t\tif (!getElementRule('span'))\r\n\t\t\taddValidElements('span[!data-mce-type|*]');\r\n\r\n\t\t// Delete invalid elements\r\n\t\tif (settings.invalid_elements) {\r\n\t\t\ttinymce.each(tinymce.explode(settings.invalid_elements), function(item) {\r\n\t\t\t\tif (elements[item])\r\n\t\t\t\t\tdelete elements[item];\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tself.children = children;\r\n\r\n\t\tself.styles = validStyles;\r\n\r\n\t\tself.getBoolAttrs = function() {\r\n\t\t\treturn boolAttrMap;\r\n\t\t};\r\n\r\n\t\tself.getBlockElements = function() {\r\n\t\t\treturn blockElementsMap;\r\n\t\t};\r\n\r\n\t\tself.getShortEndedElements = function() {\r\n\t\t\treturn shortEndedElementsMap;\r\n\t\t};\r\n\r\n\t\tself.getSelfClosingElements = function() {\r\n\t\t\treturn selfClosingElementsMap;\r\n\t\t};\r\n\r\n\t\tself.getNonEmptyElements = function() {\r\n\t\t\treturn nonEmptyElementsMap;\r\n\t\t};\r\n\r\n\t\tself.getWhiteSpaceElements = function() {\r\n\t\t\treturn whiteSpaceElementsMap;\r\n\t\t};\r\n\r\n\t\tself.isValidChild = function(name, child) {\r\n\t\t\tvar parent = children[name];\r\n\r\n\t\t\treturn !!(parent && parent[child]);\r\n\t\t};\r\n\r\n\t\tself.getElementRule = getElementRule;\r\n\r\n\t\tself.getCustomElements = function() {\r\n\t\t\treturn customElementsMap;\r\n\t\t};\r\n\r\n\t\tself.addValidElements = addValidElements;\r\n\r\n\t\tself.setValidElements = setValidElements;\r\n\r\n\t\tself.addCustomElements = addCustomElements;\r\n\r\n\t\tself.addValidChildren = addValidChildren;\r\n\t};\r\n\r\n\t// Expose boolMap and blockElementMap as static properties for usage in DOMUtils\r\n\ttinymce.html.Schema.boolAttrMap = boolAttrMap;\r\n\ttinymce.html.Schema.blockElementsMap = blockElementsMap;\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\ttinymce.html.SaxParser = function(settings, schema) {\r\n\t\tvar self = this, noop = function() {};\r\n\r\n\t\tsettings = settings || {};\r\n\t\tself.schema = schema = schema || new tinymce.html.Schema();\r\n\r\n\t\tif (settings.fix_self_closing !== false)\r\n\t\t\tsettings.fix_self_closing = true;\r\n\r\n\t\t// Add handler functions from settings and setup default handlers\r\n\t\ttinymce.each('comment cdata text start end pi doctype'.split(' '), function(name) {\r\n\t\t\tif (name)\r\n\t\t\t\tself[name] = settings[name] || noop;\r\n\t\t});\r\n\r\n\t\tself.parse = function(html) {\r\n\t\t\tvar self = this, matches, index = 0, value, endRegExp, stack = [], attrList, i, text, name, isInternalElement, removeInternalElements,\r\n\t\t\t\tshortEndedElements, fillAttrsMap, isShortEnded, validate, elementRule, isValidElement, attr, attribsValue, invalidPrefixRegExp,\r\n\t\t\t\tvalidAttributesMap, validAttributePatterns, attributesRequired, attributesDefault, attributesForced, selfClosing,\r\n\t\t\t\ttokenRegExp, attrRegExp, specialElements, attrValue, idCount = 0, decode = tinymce.html.Entities.decode, fixSelfClosing, isIE;\r\n\r\n\t\t\tfunction processEndTag(name) {\r\n\t\t\t\tvar pos, i;\r\n\r\n\t\t\t\t// Find position of parent of the same type\r\n\t\t\t\tpos = stack.length;\r\n\t\t\t\twhile (pos--) {\r\n\t\t\t\t\tif (stack[pos].name === name)\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Found parent\r\n\t\t\t\tif (pos >= 0) {\r\n\t\t\t\t\t// Close all the open elements\r\n\t\t\t\t\tfor (i = stack.length - 1; i >= pos; i--) {\r\n\t\t\t\t\t\tname = stack[i];\r\n\r\n\t\t\t\t\t\tif (name.valid)\r\n\t\t\t\t\t\t\tself.end(name.name);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Remove the open elements from the stack\r\n\t\t\t\t\tstack.length = pos;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// Precompile RegExps and map objects\r\n\t\t\ttokenRegExp = new RegExp('<(?:' +\r\n\t\t\t\t'(?:!--([\\\\w\\\\W]*?)-->)|' + // Comment\r\n\t\t\t\t'(?:!\\\\[CDATA\\\\[([\\\\w\\\\W]*?)\\\\]\\\\]>)|' + // CDATA\r\n\t\t\t\t'(?:!DOCTYPE([\\\\w\\\\W]*?)>)|' + // DOCTYPE\r\n\t\t\t\t'(?:\\\\?([^\\\\s\\\\/<>]+) ?([\\\\w\\\\W]*?)[?/]>)|' + // PI\r\n\t\t\t\t'(?:\\\\/([^>]+)>)|' + // End element\r\n\t\t\t\t'(?:([^\\\\s\\\\/<>]+)((?:\\\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\\\/)>)' + // Start element\r\n\t\t\t')', 'g');\r\n\r\n\t\t\tattrRegExp = /([\\w:\\-]+)(?:\\s*=\\s*(?:(?:\\\"((?:\\\\.|[^\\\"])*)\\\")|(?:\\'((?:\\\\.|[^\\'])*)\\')|([^>\\s]+)))?/g;\r\n\t\t\tspecialElements = {\r\n\t\t\t\t'script' : /<\\/script[^>]*>/gi,\r\n\t\t\t\t'style' : /<\\/style[^>]*>/gi,\r\n\t\t\t\t'noscript' : /<\\/noscript[^>]*>/gi\r\n\t\t\t};\r\n\r\n\t\t\t// Setup lookup tables for empty elements and boolean attributes\r\n\t\t\tshortEndedElements = schema.getShortEndedElements();\r\n\t\t\tselfClosing = schema.getSelfClosingElements();\r\n\t\t\tfillAttrsMap = schema.getBoolAttrs();\r\n\t\t\tvalidate = settings.validate;\r\n\t\t\tremoveInternalElements = settings.remove_internals;\r\n\t\t\tfixSelfClosing = settings.fix_self_closing;\r\n\t\t\tisIE = tinymce.isIE;\r\n\t\t\tinvalidPrefixRegExp = /^:/;\r\n\r\n\t\t\twhile (matches = tokenRegExp.exec(html)) {\r\n\t\t\t\t// Text\r\n\t\t\t\tif (index < matches.index)\r\n\t\t\t\t\tself.text(decode(html.substr(index, matches.index - index)));\r\n\r\n\t\t\t\tif (value = matches[6]) { // End element\r\n\t\t\t\t\tvalue = value.toLowerCase();\r\n\r\n\t\t\t\t\t// IE will add a \":\" in front of elements it doesn't understand like custom elements or HTML5 elements\r\n\t\t\t\t\tif (isIE && invalidPrefixRegExp.test(value))\r\n\t\t\t\t\t\tvalue = value.substr(1);\r\n\r\n\t\t\t\t\tprocessEndTag(value);\r\n\t\t\t\t} else if (value = matches[7]) { // Start element\r\n\t\t\t\t\tvalue = value.toLowerCase();\r\n\r\n\t\t\t\t\t// IE will add a \":\" in front of elements it doesn't understand like custom elements or HTML5 elements\r\n\t\t\t\t\tif (isIE && invalidPrefixRegExp.test(value))\r\n\t\t\t\t\t\tvalue = value.substr(1);\r\n\r\n\t\t\t\t\tisShortEnded = value in shortEndedElements;\r\n\r\n\t\t\t\t\t// Is self closing tag for example an <li> after an open <li>\r\n\t\t\t\t\tif (fixSelfClosing && selfClosing[value] && stack.length > 0 && stack[stack.length - 1].name === value)\r\n\t\t\t\t\t\tprocessEndTag(value);\r\n\r\n\t\t\t\t\t// Validate element\r\n\t\t\t\t\tif (!validate || (elementRule = schema.getElementRule(value))) {\r\n\t\t\t\t\t\tisValidElement = true;\r\n\r\n\t\t\t\t\t\t// Grab attributes map and patters when validation is enabled\r\n\t\t\t\t\t\tif (validate) {\r\n\t\t\t\t\t\t\tvalidAttributesMap = elementRule.attributes;\r\n\t\t\t\t\t\t\tvalidAttributePatterns = elementRule.attributePatterns;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Parse attributes\r\n\t\t\t\t\t\tif (attribsValue = matches[8]) {\r\n\t\t\t\t\t\t\tisInternalElement = attribsValue.indexOf('data-mce-type') !== -1; // Check if the element is an internal element\r\n\r\n\t\t\t\t\t\t\t// If the element has internal attributes then remove it if we are told to do so\r\n\t\t\t\t\t\t\tif (isInternalElement && removeInternalElements)\r\n\t\t\t\t\t\t\t\tisValidElement = false;\r\n\r\n\t\t\t\t\t\t\tattrList = [];\r\n\t\t\t\t\t\t\tattrList.map = {};\r\n\r\n\t\t\t\t\t\t\tattribsValue.replace(attrRegExp, function(match, name, value, val2, val3) {\r\n\t\t\t\t\t\t\t\tvar attrRule, i;\r\n\r\n\t\t\t\t\t\t\t\tname = name.toLowerCase();\r\n\t\t\t\t\t\t\t\tvalue = name in fillAttrsMap ? name : decode(value || val2 || val3 || ''); // Handle boolean attribute than value attribute\r\n\r\n\t\t\t\t\t\t\t\t// Validate name and value\r\n\t\t\t\t\t\t\t\tif (validate && !isInternalElement && name.indexOf('data-') !== 0) {\r\n\t\t\t\t\t\t\t\t\tattrRule = validAttributesMap[name];\r\n\r\n\t\t\t\t\t\t\t\t\t// Find rule by pattern matching\r\n\t\t\t\t\t\t\t\t\tif (!attrRule && validAttributePatterns) {\r\n\t\t\t\t\t\t\t\t\t\ti = validAttributePatterns.length;\r\n\t\t\t\t\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\t\t\t\t\tattrRule = validAttributePatterns[i];\r\n\t\t\t\t\t\t\t\t\t\t\tif (attrRule.pattern.test(name))\r\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// No rule matched\r\n\t\t\t\t\t\t\t\t\t\tif (i === -1)\r\n\t\t\t\t\t\t\t\t\t\t\tattrRule = null;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// No attribute rule found\r\n\t\t\t\t\t\t\t\t\tif (!attrRule)\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\t\t// Validate value\r\n\t\t\t\t\t\t\t\t\tif (attrRule.validValues && !(value in attrRule.validValues))\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Add attribute to list and map\r\n\t\t\t\t\t\t\t\tattrList.map[name] = value;\r\n\t\t\t\t\t\t\t\tattrList.push({\r\n\t\t\t\t\t\t\t\t\tname: name,\r\n\t\t\t\t\t\t\t\t\tvalue: value\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tattrList = [];\r\n\t\t\t\t\t\t\tattrList.map = {};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Process attributes if validation is enabled\r\n\t\t\t\t\t\tif (validate && !isInternalElement) {\r\n\t\t\t\t\t\t\tattributesRequired = elementRule.attributesRequired;\r\n\t\t\t\t\t\t\tattributesDefault = elementRule.attributesDefault;\r\n\t\t\t\t\t\t\tattributesForced = elementRule.attributesForced;\r\n\r\n\t\t\t\t\t\t\t// Handle forced attributes\r\n\t\t\t\t\t\t\tif (attributesForced) {\r\n\t\t\t\t\t\t\t\ti = attributesForced.length;\r\n\t\t\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\t\t\tattr = attributesForced[i];\r\n\t\t\t\t\t\t\t\t\tname = attr.name;\r\n\t\t\t\t\t\t\t\t\tattrValue = attr.value;\r\n\r\n\t\t\t\t\t\t\t\t\tif (attrValue === '{$uid}')\r\n\t\t\t\t\t\t\t\t\t\tattrValue = 'mce_' + idCount++;\r\n\r\n\t\t\t\t\t\t\t\t\tattrList.map[name] = attrValue;\r\n\t\t\t\t\t\t\t\t\tattrList.push({name: name, value: attrValue});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Handle default attributes\r\n\t\t\t\t\t\t\tif (attributesDefault) {\r\n\t\t\t\t\t\t\t\ti = attributesDefault.length;\r\n\t\t\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\t\t\tattr = attributesDefault[i];\r\n\t\t\t\t\t\t\t\t\tname = attr.name;\r\n\r\n\t\t\t\t\t\t\t\t\tif (!(name in attrList.map)) {\r\n\t\t\t\t\t\t\t\t\t\tattrValue = attr.value;\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (attrValue === '{$uid}')\r\n\t\t\t\t\t\t\t\t\t\t\tattrValue = 'mce_' + idCount++;\r\n\r\n\t\t\t\t\t\t\t\t\t\tattrList.map[name] = attrValue;\r\n\t\t\t\t\t\t\t\t\t\tattrList.push({name: name, value: attrValue});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Handle required attributes\r\n\t\t\t\t\t\t\tif (attributesRequired) {\r\n\t\t\t\t\t\t\t\ti = attributesRequired.length;\r\n\t\t\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\t\t\tif (attributesRequired[i] in attrList.map)\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// None of the required attributes where found\r\n\t\t\t\t\t\t\t\tif (i === -1)\r\n\t\t\t\t\t\t\t\t\tisValidElement = false;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Invalidate element if it's marked as bogus\r\n\t\t\t\t\t\t\tif (attrList.map['data-mce-bogus'])\r\n\t\t\t\t\t\t\t\tisValidElement = false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (isValidElement)\r\n\t\t\t\t\t\t\tself.start(value, attrList, isShortEnded);\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tisValidElement = false;\r\n\r\n\t\t\t\t\t// Treat script, noscript and style a bit different since they may include code that looks like elements\r\n\t\t\t\t\tif (endRegExp = specialElements[value]) {\r\n\t\t\t\t\t\tendRegExp.lastIndex = index = matches.index + matches[0].length;\r\n\r\n\t\t\t\t\t\tif (matches = endRegExp.exec(html)) {\r\n\t\t\t\t\t\t\tif (isValidElement)\r\n\t\t\t\t\t\t\t\ttext = html.substr(index, matches.index - index);\r\n\r\n\t\t\t\t\t\t\tindex = matches.index + matches[0].length;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttext = html.substr(index);\r\n\t\t\t\t\t\t\tindex = html.length;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (isValidElement && text.length > 0)\r\n\t\t\t\t\t\t\tself.text(text, true);\r\n\r\n\t\t\t\t\t\tif (isValidElement)\r\n\t\t\t\t\t\t\tself.end(value);\r\n\r\n\t\t\t\t\t\ttokenRegExp.lastIndex = index;\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Push value on to stack\r\n\t\t\t\t\tif (!isShortEnded) {\r\n\t\t\t\t\t\tif (!attribsValue || attribsValue.indexOf('/') != attribsValue.length - 1)\r\n\t\t\t\t\t\t\tstack.push({name: value, valid: isValidElement});\r\n\t\t\t\t\t\telse if (isValidElement)\r\n\t\t\t\t\t\t\tself.end(value);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (value = matches[1]) { // Comment\r\n\t\t\t\t\tself.comment(value);\r\n\t\t\t\t} else if (value = matches[2]) { // CDATA\r\n\t\t\t\t\tself.cdata(value);\r\n\t\t\t\t} else if (value = matches[3]) { // DOCTYPE\r\n\t\t\t\t\tself.doctype(value);\r\n\t\t\t\t} else if (value = matches[4]) { // PI\r\n\t\t\t\t\tself.pi(value, matches[5]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tindex = matches.index + matches[0].length;\r\n\t\t\t}\r\n\r\n\t\t\t// Text\r\n\t\t\tif (index < html.length)\r\n\t\t\t\tself.text(decode(html.substr(index)));\r\n\r\n\t\t\t// Close any open elements\r\n\t\t\tfor (i = stack.length - 1; i >= 0; i--) {\r\n\t\t\t\tvalue = stack[i];\r\n\r\n\t\t\t\tif (value.valid)\r\n\t\t\t\t\tself.end(value.name);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar whiteSpaceRegExp = /^[ \\t\\r\\n]*$/, typeLookup = {\r\n\t\t'#text' : 3,\r\n\t\t'#comment' : 8,\r\n\t\t'#cdata' : 4,\r\n\t\t'#pi' : 7,\r\n\t\t'#doctype' : 10,\r\n\t\t'#document-fragment' : 11\r\n\t};\r\n\r\n\t// Walks the tree left/right\r\n\tfunction walk(node, root_node, prev) {\r\n\t\tvar sibling, parent, startName = prev ? 'lastChild' : 'firstChild', siblingName = prev ? 'prev' : 'next';\r\n\r\n\t\t// Walk into nodes if it has a start\r\n\t\tif (node[startName])\r\n\t\t\treturn node[startName];\r\n\r\n\t\t// Return the sibling if it has one\r\n\t\tif (node !== root_node) {\r\n\t\t\tsibling = node[siblingName];\r\n\r\n\t\t\tif (sibling)\r\n\t\t\t\treturn sibling;\r\n\r\n\t\t\t// Walk up the parents to look for siblings\r\n\t\t\tfor (parent = node.parent; parent && parent !== root_node; parent = parent.parent) {\r\n\t\t\t\tsibling = parent[siblingName];\r\n\r\n\t\t\t\tif (sibling)\r\n\t\t\t\t\treturn sibling;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tfunction Node(name, type) {\r\n\t\tthis.name = name;\r\n\t\tthis.type = type;\r\n\r\n\t\tif (type === 1) {\r\n\t\t\tthis.attributes = [];\r\n\t\t\tthis.attributes.map = {};\r\n\t\t}\r\n\t}\r\n\r\n\ttinymce.extend(Node.prototype, {\r\n\t\treplace : function(node) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (node.parent)\r\n\t\t\t\tnode.remove();\r\n\r\n\t\t\tself.insert(node, self);\r\n\t\t\tself.remove();\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\tattr : function(name, value) {\r\n\t\t\tvar self = this, attrs, i, undef;\r\n\r\n\t\t\tif (typeof name !== \"string\") {\r\n\t\t\t\tfor (i in name)\r\n\t\t\t\t\tself.attr(i, name[i]);\r\n\r\n\t\t\t\treturn self;\r\n\t\t\t}\r\n\r\n\t\t\tif (attrs = self.attributes) {\r\n\t\t\t\tif (value !== undef) {\r\n\t\t\t\t\t// Remove attribute\r\n\t\t\t\t\tif (value === null) {\r\n\t\t\t\t\t\tif (name in attrs.map) {\r\n\t\t\t\t\t\t\tdelete attrs.map[name];\r\n\r\n\t\t\t\t\t\t\ti = attrs.length;\r\n\t\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\t\tif (attrs[i].name === name) {\r\n\t\t\t\t\t\t\t\t\tattrs = attrs.splice(i, 1);\r\n\t\t\t\t\t\t\t\t\treturn self;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn self;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Set attribute\r\n\t\t\t\t\tif (name in attrs.map) {\r\n\t\t\t\t\t\t// Set attribute\r\n\t\t\t\t\t\ti = attrs.length;\r\n\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\tif (attrs[i].name === name) {\r\n\t\t\t\t\t\t\t\tattrs[i].value = value;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tattrs.push({name: name, value: value});\r\n\r\n\t\t\t\t\tattrs.map[name] = value;\r\n\r\n\t\t\t\t\treturn self;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn attrs.map[name];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tclone : function() {\r\n\t\t\tvar self = this, clone = new Node(self.name, self.type), i, l, selfAttrs, selfAttr, cloneAttrs;\r\n\r\n\t\t\t// Clone element attributes\r\n\t\t\tif (selfAttrs = self.attributes) {\r\n\t\t\t\tcloneAttrs = [];\r\n\t\t\t\tcloneAttrs.map = {};\r\n\r\n\t\t\t\tfor (i = 0, l = selfAttrs.length; i < l; i++) {\r\n\t\t\t\t\tselfAttr = selfAttrs[i];\r\n\r\n\t\t\t\t\t// Clone everything except id\r\n\t\t\t\t\tif (selfAttr.name !== 'id') {\r\n\t\t\t\t\t\tcloneAttrs[cloneAttrs.length] = {name: selfAttr.name, value: selfAttr.value};\r\n\t\t\t\t\t\tcloneAttrs.map[selfAttr.name] = selfAttr.value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclone.attributes = cloneAttrs;\r\n\t\t\t}\r\n\r\n\t\t\tclone.value = self.value;\r\n\t\t\tclone.shortEnded = self.shortEnded;\r\n\r\n\t\t\treturn clone;\r\n\t\t},\r\n\r\n\t\twrap : function(wrapper) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.parent.insert(wrapper, self);\r\n\t\t\twrapper.append(self);\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\tunwrap : function() {\r\n\t\t\tvar self = this, node, next;\r\n\r\n\t\t\tfor (node = self.firstChild; node; ) {\r\n\t\t\t\tnext = node.next;\r\n\t\t\t\tself.insert(node, self, true);\r\n\t\t\t\tnode = next;\r\n\t\t\t}\r\n\r\n\t\t\tself.remove();\r\n\t\t},\r\n\r\n\t\tremove : function() {\r\n\t\t\tvar self = this, parent = self.parent, next = self.next, prev = self.prev;\r\n\r\n\t\t\tif (parent) {\r\n\t\t\t\tif (parent.firstChild === self) {\r\n\t\t\t\t\tparent.firstChild = next;\r\n\r\n\t\t\t\t\tif (next)\r\n\t\t\t\t\t\tnext.prev = null;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tprev.next = next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (parent.lastChild === self) {\r\n\t\t\t\t\tparent.lastChild = prev;\r\n\r\n\t\t\t\t\tif (prev)\r\n\t\t\t\t\t\tprev.next = null;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnext.prev = prev;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.parent = self.next = self.prev = null;\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\tappend : function(node) {\r\n\t\t\tvar self = this, last;\r\n\r\n\t\t\tif (node.parent)\r\n\t\t\t\tnode.remove();\r\n\r\n\t\t\tlast = self.lastChild;\r\n\t\t\tif (last) {\r\n\t\t\t\tlast.next = node;\r\n\t\t\t\tnode.prev = last;\r\n\t\t\t\tself.lastChild = node;\r\n\t\t\t} else\r\n\t\t\t\tself.lastChild = self.firstChild = node;\r\n\r\n\t\t\tnode.parent = self;\r\n\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\tinsert : function(node, ref_node, before) {\r\n\t\t\tvar parent;\r\n\r\n\t\t\tif (node.parent)\r\n\t\t\t\tnode.remove();\r\n\r\n\t\t\tparent = ref_node.parent || this;\r\n\r\n\t\t\tif (before) {\r\n\t\t\t\tif (ref_node === parent.firstChild)\r\n\t\t\t\t\tparent.firstChild = node;\r\n\t\t\t\telse\r\n\t\t\t\t\tref_node.prev.next = node;\r\n\r\n\t\t\t\tnode.prev = ref_node.prev;\r\n\t\t\t\tnode.next = ref_node;\r\n\t\t\t\tref_node.prev = node;\r\n\t\t\t} else {\r\n\t\t\t\tif (ref_node === parent.lastChild)\r\n\t\t\t\t\tparent.lastChild = node;\r\n\t\t\t\telse\r\n\t\t\t\t\tref_node.next.prev = node;\r\n\r\n\t\t\t\tnode.next = ref_node.next;\r\n\t\t\t\tnode.prev = ref_node;\r\n\t\t\t\tref_node.next = node;\r\n\t\t\t}\r\n\r\n\t\t\tnode.parent = parent;\r\n\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\tgetAll : function(name) {\r\n\t\t\tvar self = this, node, collection = [];\r\n\r\n\t\t\tfor (node = self.firstChild; node; node = walk(node, self)) {\r\n\t\t\t\tif (node.name === name)\r\n\t\t\t\t\tcollection.push(node);\r\n\t\t\t}\r\n\r\n\t\t\treturn collection;\r\n\t\t},\r\n\r\n\t\tempty : function() {\r\n\t\t\tvar self = this, nodes, i, node;\r\n\r\n\t\t\t// Remove all children\r\n\t\t\tif (self.firstChild) {\r\n\t\t\t\tnodes = [];\r\n\r\n\t\t\t\t// Collect the children\r\n\t\t\t\tfor (node = self.firstChild; node; node = walk(node, self))\r\n\t\t\t\t\tnodes.push(node);\r\n\r\n\t\t\t\t// Remove the children\r\n\t\t\t\ti = nodes.length;\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\tnode.parent = node.firstChild = node.lastChild = node.next = node.prev = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tself.firstChild = self.lastChild = null;\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\tisEmpty : function(elements) {\r\n\t\t\tvar self = this, node = self.firstChild, i, name;\r\n\r\n\t\t\tif (node) {\r\n\t\t\t\tdo {\r\n\t\t\t\t\tif (node.type === 1) {\r\n\t\t\t\t\t\t// Ignore bogus elements\r\n\t\t\t\t\t\tif (node.attributes.map['data-mce-bogus'])\r\n\t\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\t// Keep empty elements like <img />\r\n\t\t\t\t\t\tif (elements[node.name])\r\n\t\t\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t\t\t// Keep elements with data attributes or name attribute like <a name=\"1\"></a>\r\n\t\t\t\t\t\ti = node.attributes.length;\r\n\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\tname = node.attributes[i].name;\r\n\t\t\t\t\t\t\tif (name === \"name\" || name.indexOf('data-') === 0)\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Keep non whitespace text nodes\r\n\t\t\t\t\tif ((node.type === 3 && !whiteSpaceRegExp.test(node.value)))\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t} while (node = walk(node, self));\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\twalk : function(prev) {\r\n\t\t\treturn walk(this, null, prev);\r\n\t\t}\r\n\t});\r\n\r\n\ttinymce.extend(Node, {\r\n\t\tcreate : function(name, attrs) {\r\n\t\t\tvar node, attrName;\r\n\r\n\t\t\t// Create node\r\n\t\t\tnode = new Node(name, typeLookup[name] || 1);\r\n\r\n\t\t\t// Add attributes if needed\r\n\t\t\tif (attrs) {\r\n\t\t\t\tfor (attrName in attrs)\r\n\t\t\t\t\tnode.attr(attrName, attrs[attrName]);\r\n\t\t\t}\r\n\r\n\t\t\treturn node;\r\n\t\t}\r\n\t});\r\n\r\n\ttinymce.html.Node = Node;\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar Node = tinymce.html.Node;\r\n\r\n\ttinymce.html.DomParser = function(settings, schema) {\r\n\t\tvar self = this, nodeFilters = {}, attributeFilters = [], matchedNodes = {}, matchedAttributes = {};\r\n\r\n\t\tsettings = settings || {};\r\n\t\tsettings.validate = \"validate\" in settings ? settings.validate : true;\r\n\t\tsettings.root_name = settings.root_name || 'body';\r\n\t\tself.schema = schema = schema || new tinymce.html.Schema();\r\n\r\n\t\tfunction fixInvalidChildren(nodes) {\r\n\t\t\tvar ni, node, parent, parents, newParent, currentNode, tempNode, childNode, i,\r\n\t\t\t\tchildClone, nonEmptyElements, nonSplitableElements, sibling, nextNode;\r\n\r\n\t\t\tnonSplitableElements = tinymce.makeMap('tr,td,th,tbody,thead,tfoot,table');\r\n\t\t\tnonEmptyElements = schema.getNonEmptyElements();\r\n\r\n\t\t\tfor (ni = 0; ni < nodes.length; ni++) {\r\n\t\t\t\tnode = nodes[ni];\r\n\r\n\t\t\t\t// Already removed\r\n\t\t\t\tif (!node.parent)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t// Get list of all parent nodes until we find a valid parent to stick the child into\r\n\t\t\t\tparents = [node];\r\n\t\t\t\tfor (parent = node.parent; parent && !schema.isValidChild(parent.name, node.name) && !nonSplitableElements[parent.name]; parent = parent.parent)\r\n\t\t\t\t\tparents.push(parent);\r\n\r\n\t\t\t\t// Found a suitable parent\r\n\t\t\t\tif (parent && parents.length > 1) {\r\n\t\t\t\t\t// Reverse the array since it makes looping easier\r\n\t\t\t\t\tparents.reverse();\r\n\r\n\t\t\t\t\t// Clone the related parent and insert that after the moved node\r\n\t\t\t\t\tnewParent = currentNode = self.filterNode(parents[0].clone());\r\n\r\n\t\t\t\t\t// Start cloning and moving children on the left side of the target node\r\n\t\t\t\t\tfor (i = 0; i < parents.length - 1; i++) {\r\n\t\t\t\t\t\tif (schema.isValidChild(currentNode.name, parents[i].name)) {\r\n\t\t\t\t\t\t\ttempNode = self.filterNode(parents[i].clone());\r\n\t\t\t\t\t\t\tcurrentNode.append(tempNode);\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\ttempNode = currentNode;\r\n\r\n\t\t\t\t\t\tfor (childNode = parents[i].firstChild; childNode && childNode != parents[i + 1]; ) {\r\n\t\t\t\t\t\t\tnextNode = childNode.next;\r\n\t\t\t\t\t\t\ttempNode.append(childNode);\r\n\t\t\t\t\t\t\tchildNode = nextNode;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tcurrentNode = tempNode;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!newParent.isEmpty(nonEmptyElements)) {\r\n\t\t\t\t\t\tparent.insert(newParent, parents[0], true);\r\n\t\t\t\t\t\tparent.insert(node, newParent);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tparent.insert(node, parents[0], true);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if the element is empty by looking through it's contents and special treatment for <p><br /></p>\r\n\t\t\t\t\tparent = parents[0];\r\n\t\t\t\t\tif (parent.isEmpty(nonEmptyElements) || parent.firstChild === parent.lastChild && parent.firstChild.name === 'br') {\r\n\t\t\t\t\t\tparent.empty().remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (node.parent) {\r\n\t\t\t\t\t// If it's an LI try to find a UL/OL for it or wrap it\r\n\t\t\t\t\tif (node.name === 'li') {\r\n\t\t\t\t\t\tsibling = node.prev;\r\n\t\t\t\t\t\tif (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {\r\n\t\t\t\t\t\t\tsibling.append(node);\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tsibling = node.next;\r\n\t\t\t\t\t\tif (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {\r\n\t\t\t\t\t\t\tsibling.insert(node, sibling.firstChild, true);\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnode.wrap(self.filterNode(new Node('ul', 1)));\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Try wrapping the element in a DIV\r\n\t\t\t\t\tif (schema.isValidChild(node.parent.name, 'div') && schema.isValidChild('div', node.name)) {\r\n\t\t\t\t\t\tnode.wrap(self.filterNode(new Node('div', 1)));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// We failed wrapping it, then remove or unwrap it\r\n\t\t\t\t\t\tif (node.name === 'style' || node.name === 'script')\r\n\t\t\t\t\t\t\tnode.empty().remove();\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tnode.unwrap();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tself.filterNode = function(node) {\r\n\t\t\tvar i, name, list;\r\n\r\n\t\t\t// Run element filters\r\n\t\t\tif (name in nodeFilters) {\r\n\t\t\t\tlist = matchedNodes[name];\r\n\r\n\t\t\t\tif (list)\r\n\t\t\t\t\tlist.push(node);\r\n\t\t\t\telse\r\n\t\t\t\t\tmatchedNodes[name] = [node];\r\n\t\t\t}\r\n\r\n\t\t\t// Run attribute filters\r\n\t\t\ti = attributeFilters.length;\r\n\t\t\twhile (i--) {\r\n\t\t\t\tname = attributeFilters[i].name;\r\n\r\n\t\t\t\tif (name in node.attributes.map) {\r\n\t\t\t\t\tlist = matchedAttributes[name];\r\n\r\n\t\t\t\t\tif (list)\r\n\t\t\t\t\t\tlist.push(node);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tmatchedAttributes[name] = [node];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn node;\r\n\t\t};\r\n\r\n\t\tself.addNodeFilter = function(name, callback) {\r\n\t\t\ttinymce.each(tinymce.explode(name), function(name) {\r\n\t\t\t\tvar list = nodeFilters[name];\r\n\r\n\t\t\t\tif (!list)\r\n\t\t\t\t\tnodeFilters[name] = list = [];\r\n\r\n\t\t\t\tlist.push(callback);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tself.addAttributeFilter = function(name, callback) {\r\n\t\t\ttinymce.each(tinymce.explode(name), function(name) {\r\n\t\t\t\tvar i;\r\n\r\n\t\t\t\tfor (i = 0; i < attributeFilters.length; i++) {\r\n\t\t\t\t\tif (attributeFilters[i].name === name) {\r\n\t\t\t\t\t\tattributeFilters[i].callbacks.push(callback);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tattributeFilters.push({name: name, callbacks: [callback]});\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tself.parse = function(html, args) {\r\n\t\t\tvar parser, rootNode, node, nodes, i, l, fi, fl, list, name, validate,\r\n\t\t\t\tblockElements, startWhiteSpaceRegExp, invalidChildren = [],\r\n\t\t\t\tendWhiteSpaceRegExp, allWhiteSpaceRegExp, whiteSpaceElements, children, nonEmptyElements, rootBlockName;\r\n\r\n\t\t\targs = args || {};\r\n\t\t\tmatchedNodes = {};\r\n\t\t\tmatchedAttributes = {};\r\n\t\t\tblockElements = tinymce.extend(tinymce.makeMap('script,style,head,html,body,title,meta,param'), schema.getBlockElements());\r\n\t\t\tnonEmptyElements = schema.getNonEmptyElements();\r\n\t\t\tchildren = schema.children;\r\n\t\t\tvalidate = settings.validate;\r\n\t\t\trootBlockName = \"forced_root_block\" in args ? args.forced_root_block : settings.forced_root_block;\r\n\r\n\t\t\twhiteSpaceElements = schema.getWhiteSpaceElements();\r\n\t\t\tstartWhiteSpaceRegExp = /^[ \\t\\r\\n]+/;\r\n\t\t\tendWhiteSpaceRegExp = /[ \\t\\r\\n]+$/;\r\n\t\t\tallWhiteSpaceRegExp = /[ \\t\\r\\n]+/g;\r\n\r\n\t\t\tfunction addRootBlocks() {\r\n\t\t\t\tvar node = rootNode.firstChild, next, rootBlockNode;\r\n\r\n\t\t\t\twhile (node) {\r\n\t\t\t\t\tnext = node.next;\r\n\r\n\t\t\t\t\tif (node.type == 3 || (node.type == 1 && node.name !== 'p' && !blockElements[node.name] && !node.attr('data-mce-type'))) {\r\n\t\t\t\t\t\tif (!rootBlockNode) {\r\n\t\t\t\t\t\t\t// Create a new root block element\r\n\t\t\t\t\t\t\trootBlockNode = createNode(rootBlockName, 1);\r\n\t\t\t\t\t\t\trootNode.insert(rootBlockNode, node);\r\n\t\t\t\t\t\t\trootBlockNode.append(node);\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\trootBlockNode.append(node);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trootBlockNode = null;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode = next;\r\n\t\t\t\t};\r\n\t\t\t};\r\n\r\n\t\t\tfunction createNode(name, type) {\r\n\t\t\t\tvar node = new Node(name, type), list;\r\n\r\n\t\t\t\tif (name in nodeFilters) {\r\n\t\t\t\t\tlist = matchedNodes[name];\r\n\r\n\t\t\t\t\tif (list)\r\n\t\t\t\t\t\tlist.push(node);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tmatchedNodes[name] = [node];\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node;\r\n\t\t\t};\r\n\r\n\t\t\tfunction removeWhitespaceBefore(node) {\r\n\t\t\t\tvar textNode, textVal, sibling;\r\n\r\n\t\t\t\tfor (textNode = node.prev; textNode && textNode.type === 3; ) {\r\n\t\t\t\t\ttextVal = textNode.value.replace(endWhiteSpaceRegExp, '');\r\n\r\n\t\t\t\t\tif (textVal.length > 0) {\r\n\t\t\t\t\t\ttextNode.value = textVal;\r\n\t\t\t\t\t\ttextNode = textNode.prev;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsibling = textNode.prev;\r\n\t\t\t\t\t\ttextNode.remove();\r\n\t\t\t\t\t\ttextNode = sibling;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tparser = new tinymce.html.SaxParser({\r\n\t\t\t\tvalidate : validate,\r\n\t\t\t\tfix_self_closing : !validate, // Let the DOM parser handle <li> in <li> or <p> in <p> for better results\r\n\r\n\t\t\t\tcdata: function(text) {\r\n\t\t\t\t\tnode.append(createNode('#cdata', 4)).value = text;\r\n\t\t\t\t},\r\n\r\n\t\t\t\ttext: function(text, raw) {\r\n\t\t\t\t\tvar textNode;\r\n\r\n\t\t\t\t\t// Trim all redundant whitespace on non white space elements\r\n\t\t\t\t\tif (!whiteSpaceElements[node.name]) {\r\n\t\t\t\t\t\ttext = text.replace(allWhiteSpaceRegExp, ' ');\r\n\r\n\t\t\t\t\t\tif (node.lastChild && blockElements[node.lastChild.name])\r\n\t\t\t\t\t\t\ttext = text.replace(startWhiteSpaceRegExp, '');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Do we need to create the node\r\n\t\t\t\t\tif (text.length !== 0) {\r\n\t\t\t\t\t\ttextNode = createNode('#text', 3);\r\n\t\t\t\t\t\ttextNode.raw = !!raw;\r\n\t\t\t\t\t\tnode.append(textNode).value = text;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\tcomment: function(text) {\r\n\t\t\t\t\tnode.append(createNode('#comment', 8)).value = text;\r\n\t\t\t\t},\r\n\r\n\t\t\t\tpi: function(name, text) {\r\n\t\t\t\t\tnode.append(createNode(name, 7)).value = text;\r\n\t\t\t\t\tremoveWhitespaceBefore(node);\r\n\t\t\t\t},\r\n\r\n\t\t\t\tdoctype: function(text) {\r\n\t\t\t\t\tvar newNode;\r\n\t\t\r\n\t\t\t\t\tnewNode = node.append(createNode('#doctype', 10));\r\n\t\t\t\t\tnewNode.value = text;\r\n\t\t\t\t\tremoveWhitespaceBefore(node);\r\n\t\t\t\t},\r\n\r\n\t\t\t\tstart: function(name, attrs, empty) {\r\n\t\t\t\t\tvar newNode, attrFiltersLen, elementRule, textNode, attrName, text, sibling, parent;\r\n\r\n\t\t\t\t\telementRule = validate ? schema.getElementRule(name) : {};\r\n\t\t\t\t\tif (elementRule) {\r\n\t\t\t\t\t\tnewNode = createNode(elementRule.outputName || name, 1);\r\n\t\t\t\t\t\tnewNode.attributes = attrs;\r\n\t\t\t\t\t\tnewNode.shortEnded = empty;\r\n\r\n\t\t\t\t\t\tnode.append(newNode);\r\n\r\n\t\t\t\t\t\t// Check if node is valid child of the parent node is the child is\r\n\t\t\t\t\t\t// unknown we don't collect it since it's probably a custom element\r\n\t\t\t\t\t\tparent = children[node.name];\r\n\t\t\t\t\t\tif (parent && children[newNode.name] && !parent[newNode.name])\r\n\t\t\t\t\t\t\tinvalidChildren.push(newNode);\r\n\r\n\t\t\t\t\t\tattrFiltersLen = attributeFilters.length;\r\n\t\t\t\t\t\twhile (attrFiltersLen--) {\r\n\t\t\t\t\t\t\tattrName = attributeFilters[attrFiltersLen].name;\r\n\r\n\t\t\t\t\t\t\tif (attrName in attrs.map) {\r\n\t\t\t\t\t\t\t\tlist = matchedAttributes[attrName];\r\n\r\n\t\t\t\t\t\t\t\tif (list)\r\n\t\t\t\t\t\t\t\t\tlist.push(newNode);\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tmatchedAttributes[attrName] = [newNode];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Trim whitespace before block\r\n\t\t\t\t\t\tif (blockElements[name])\r\n\t\t\t\t\t\t\tremoveWhitespaceBefore(newNode);\r\n\r\n\t\t\t\t\t\t// Change current node if the element wasn't empty i.e not <br /> or <img />\r\n\t\t\t\t\t\tif (!empty)\r\n\t\t\t\t\t\t\tnode = newNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\tend: function(name) {\r\n\t\t\t\t\tvar textNode, elementRule, text, sibling, tempNode;\r\n\r\n\t\t\t\t\telementRule = validate ? schema.getElementRule(name) : {};\r\n\t\t\t\t\tif (elementRule) {\r\n\t\t\t\t\t\tif (blockElements[name]) {\r\n\t\t\t\t\t\t\tif (!whiteSpaceElements[node.name]) {\r\n\t\t\t\t\t\t\t\t// Trim whitespace at beginning of block\r\n\t\t\t\t\t\t\t\tfor (textNode = node.firstChild; textNode && textNode.type === 3; ) {\r\n\t\t\t\t\t\t\t\t\ttext = textNode.value.replace(startWhiteSpaceRegExp, '');\r\n\r\n\t\t\t\t\t\t\t\t\tif (text.length > 0) {\r\n\t\t\t\t\t\t\t\t\t\ttextNode.value = text;\r\n\t\t\t\t\t\t\t\t\t\ttextNode = textNode.next;\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tsibling = textNode.next;\r\n\t\t\t\t\t\t\t\t\t\ttextNode.remove();\r\n\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Trim whitespace at end of block\r\n\t\t\t\t\t\t\t\tfor (textNode = node.lastChild; textNode && textNode.type === 3; ) {\r\n\t\t\t\t\t\t\t\t\ttext = textNode.value.replace(endWhiteSpaceRegExp, '');\r\n\r\n\t\t\t\t\t\t\t\t\tif (text.length > 0) {\r\n\t\t\t\t\t\t\t\t\t\ttextNode.value = text;\r\n\t\t\t\t\t\t\t\t\t\ttextNode = textNode.prev;\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tsibling = textNode.prev;\r\n\t\t\t\t\t\t\t\t\t\ttextNode.remove();\r\n\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Trim start white space\r\n\t\t\t\t\t\t\ttextNode = node.prev;\r\n\t\t\t\t\t\t\tif (textNode && textNode.type === 3) {\r\n\t\t\t\t\t\t\t\ttext = textNode.value.replace(startWhiteSpaceRegExp, '');\r\n\r\n\t\t\t\t\t\t\t\tif (text.length > 0)\r\n\t\t\t\t\t\t\t\t\ttextNode.value = text;\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\ttextNode.remove();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Handle empty nodes\r\n\t\t\t\t\t\tif (elementRule.removeEmpty || elementRule.paddEmpty) {\r\n\t\t\t\t\t\t\tif (node.isEmpty(nonEmptyElements)) {\r\n\t\t\t\t\t\t\t\tif (elementRule.paddEmpty)\r\n\t\t\t\t\t\t\t\t\tnode.empty().append(new Node('#text', '3')).value = '\\u00a0';\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t// Leave nodes that have a name like <a name=\"name\">\r\n\t\t\t\t\t\t\t\t\tif (!node.attributes.map.name) {\r\n\t\t\t\t\t\t\t\t\t\ttempNode = node.parent;\r\n\t\t\t\t\t\t\t\t\t\tnode.empty().remove();\r\n\t\t\t\t\t\t\t\t\t\tnode = tempNode;\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnode = node.parent;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, schema);\r\n\r\n\t\t\trootNode = node = new Node(args.context || settings.root_name, 11);\r\n\r\n\t\t\tparser.parse(html);\r\n\r\n\t\t\t// Fix invalid children or report invalid children in a contextual parsing\r\n\t\t\tif (validate && invalidChildren.length) {\r\n\t\t\t\tif (!args.context)\r\n\t\t\t\t\tfixInvalidChildren(invalidChildren);\r\n\t\t\t\telse\r\n\t\t\t\t\targs.invalid = true;\r\n\t\t\t}\r\n\r\n\t\t\t// Wrap nodes in the root into block elements if the root is body\r\n\t\t\tif (rootBlockName && rootNode.name == 'body')\r\n\t\t\t\taddRootBlocks();\r\n\r\n\t\t\t// Run filters only when the contents is valid\r\n\t\t\tif (!args.invalid) {\r\n\t\t\t\t// Run node filters\r\n\t\t\t\tfor (name in matchedNodes) {\r\n\t\t\t\t\tlist = nodeFilters[name];\r\n\t\t\t\t\tnodes = matchedNodes[name];\r\n\r\n\t\t\t\t\t// Remove already removed children\r\n\t\t\t\t\tfi = nodes.length;\r\n\t\t\t\t\twhile (fi--) {\r\n\t\t\t\t\t\tif (!nodes[fi].parent)\r\n\t\t\t\t\t\t\tnodes.splice(fi, 1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (i = 0, l = list.length; i < l; i++)\r\n\t\t\t\t\t\tlist[i](nodes, name, args);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Run attribute filters\r\n\t\t\t\tfor (i = 0, l = attributeFilters.length; i < l; i++) {\r\n\t\t\t\t\tlist = attributeFilters[i];\r\n\r\n\t\t\t\t\tif (list.name in matchedAttributes) {\r\n\t\t\t\t\t\tnodes = matchedAttributes[list.name];\r\n\r\n\t\t\t\t\t\t// Remove already removed children\r\n\t\t\t\t\t\tfi = nodes.length;\r\n\t\t\t\t\t\twhile (fi--) {\r\n\t\t\t\t\t\t\tif (!nodes[fi].parent)\r\n\t\t\t\t\t\t\t\tnodes.splice(fi, 1);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor (fi = 0, fl = list.callbacks.length; fi < fl; fi++)\r\n\t\t\t\t\t\t\tlist.callbacks[fi](nodes, list.name, args);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn rootNode;\r\n\t\t};\r\n\r\n\t\t// Remove <br> at end of block elements Gecko and WebKit injects BR elements to\r\n\t\t// make it possible to place the caret inside empty blocks. This logic tries to remove\r\n\t\t// these elements and keep br elements that where intended to be there intact\r\n\t\tif (settings.remove_trailing_brs) {\r\n\t\t\tself.addNodeFilter('br', function(nodes, name) {\r\n\t\t\t\tvar i, l = nodes.length, node, blockElements = schema.getBlockElements(),\r\n\t\t\t\t\tnonEmptyElements = schema.getNonEmptyElements(), parent, prev, prevName;\r\n\r\n\t\t\t\t// Remove brs from body element as well\r\n\t\t\t\tblockElements.body = 1;\r\n\r\n\t\t\t\t// Must loop forwards since it will otherwise remove all brs in <p>a<br><br><br></p>\r\n\t\t\t\tfor (i = 0; i < l; i++) {\r\n\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\tparent = node.parent;\r\n\r\n\t\t\t\t\tif (blockElements[node.parent.name] && node === parent.lastChild) {\r\n\t\t\t\t\t\t// Loop all nodes to the right of the current node and check for other BR elements\r\n\t\t\t\t\t\t// excluding bookmarks since they are invisible\r\n\t\t\t\t\t\tprev = node.prev;\r\n\t\t\t\t\t\twhile (prev) {\r\n\t\t\t\t\t\t\tprevName = prev.name;\r\n\r\n\t\t\t\t\t\t\t// Ignore bookmarks\r\n\t\t\t\t\t\t\tif (prevName !== \"span\" || prev.attr('data-mce-type') !== 'bookmark') {\r\n\t\t\t\t\t\t\t\t// Found a non BR element\r\n\t\t\t\t\t\t\t\tif (prevName !== \"br\")\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\r\n\t\t\t\t\t\t\t\t// Found another br it's a <br><br> structure then don't remove anything\r\n\t\t\t\t\t\t\t\tif (prevName === 'br') {\r\n\t\t\t\t\t\t\t\t\tnode = null;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tprev = prev.prev;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (node) {\r\n\t\t\t\t\t\t\tnode.remove();\r\n\r\n\t\t\t\t\t\t\t// Is the parent to be considered empty after we removed the BR\r\n\t\t\t\t\t\t\tif (parent.isEmpty(nonEmptyElements)) {\r\n\t\t\t\t\t\t\t\telementRule = schema.getElementRule(parent.name);\r\n\r\n\t\t\t\t\t\t\t\t// Remove or padd the element depending on schema rule\r\n\t\t\t\t\t\t\t\tif (elementRule) {\r\n\t\t\t\t\t\t\t\t  if (elementRule.removeEmpty)\r\n\t\t\t\t\t\t\t\t\t  parent.remove();\r\n\t\t\t\t\t\t\t\t  else if (elementRule.paddEmpty)\r\n\t\t\t\t\t\t\t\t\t  parent.empty().append(new tinymce.html.Node('#text', 3)).value = '\\u00a0';\r\n\t\t\t\t\t\t\t  }\r\n              }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n})(tinymce);\r\n\r\ntinymce.html.Writer = function(settings) {\r\n\tvar html = [], indent, indentBefore, indentAfter, encode, htmlOutput;\r\n\r\n\tsettings = settings || {};\r\n\tindent = settings.indent;\r\n\tindentBefore = tinymce.makeMap(settings.indent_before || '');\r\n\tindentAfter = tinymce.makeMap(settings.indent_after || '');\r\n\tencode = tinymce.html.Entities.getEncodeFunc(settings.entity_encoding || 'raw', settings.entities);\r\n\thtmlOutput = settings.element_format == \"html\";\r\n\r\n\treturn {\r\n\t\tstart: function(name, attrs, empty) {\r\n\t\t\tvar i, l, attr, value;\r\n\r\n\t\t\tif (indent && indentBefore[name] && html.length > 0) {\r\n\t\t\t\tvalue = html[html.length - 1];\r\n\r\n\t\t\t\tif (value.length > 0 && value !== '\\n')\r\n\t\t\t\t\thtml.push('\\n');\r\n\t\t\t}\r\n\r\n\t\t\thtml.push('<', name);\r\n\r\n\t\t\tif (attrs) {\r\n\t\t\t\tfor (i = 0, l = attrs.length; i < l; i++) {\r\n\t\t\t\t\tattr = attrs[i];\r\n\t\t\t\t\thtml.push(' ', attr.name, '=\"', encode(attr.value, true), '\"');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!empty || htmlOutput)\r\n\t\t\t\thtml[html.length] = '>';\r\n\t\t\telse\r\n\t\t\t\thtml[html.length] = ' />';\r\n\r\n\t\t\tif (empty && indent && indentAfter[name] && html.length > 0) {\r\n\t\t\t\tvalue = html[html.length - 1];\r\n\r\n\t\t\t\tif (value.length > 0 && value !== '\\n')\r\n\t\t\t\t\thtml.push('\\n');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tend: function(name) {\r\n\t\t\tvar value;\r\n\r\n\t\t\t/*if (indent && indentBefore[name] && html.length > 0) {\r\n\t\t\t\tvalue = html[html.length - 1];\r\n\r\n\t\t\t\tif (value.length > 0 && value !== '\\n')\r\n\t\t\t\t\thtml.push('\\n');\r\n\t\t\t}*/\r\n\r\n\t\t\thtml.push('</', name, '>');\r\n\r\n\t\t\tif (indent && indentAfter[name] && html.length > 0) {\r\n\t\t\t\tvalue = html[html.length - 1];\r\n\r\n\t\t\t\tif (value.length > 0 && value !== '\\n')\r\n\t\t\t\t\thtml.push('\\n');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\ttext: function(text, raw) {\r\n\t\t\tif (text.length > 0)\r\n\t\t\t\thtml[html.length] = raw ? text : encode(text);\r\n\t\t},\r\n\r\n\t\tcdata: function(text) {\r\n\t\t\thtml.push('<![CDATA[', text, ']]>');\r\n\t\t},\r\n\r\n\t\tcomment: function(text) {\r\n\t\t\thtml.push('<!--', text, '-->');\r\n\t\t},\r\n\r\n\t\tpi: function(name, text) {\r\n\t\t\tif (text)\r\n\t\t\t\thtml.push('<?', name, ' ', text, '?>');\r\n\t\t\telse\r\n\t\t\t\thtml.push('<?', name, '?>');\r\n\r\n\t\t\tif (indent)\r\n\t\t\t\thtml.push('\\n');\r\n\t\t},\r\n\r\n\t\tdoctype: function(text) {\r\n\t\t\thtml.push('<!DOCTYPE', text, '>', indent ? '\\n' : '');\r\n\t\t},\r\n\r\n\t\treset: function() {\r\n\t\t\thtml.length = 0;\r\n\t\t},\r\n\r\n\t\tgetContent: function() {\r\n\t\t\treturn html.join('').replace(/\\n$/, '');\r\n\t\t}\r\n\t};\r\n};\r\n\r\n(function(tinymce) {\r\n\ttinymce.html.Serializer = function(settings, schema) {\r\n\t\tvar self = this, writer = new tinymce.html.Writer(settings);\r\n\r\n\t\tsettings = settings || {};\r\n\t\tsettings.validate = \"validate\" in settings ? settings.validate : true;\r\n\r\n\t\tself.schema = schema = schema || new tinymce.html.Schema();\r\n\t\tself.writer = writer;\r\n\r\n\t\tself.serialize = function(node) {\r\n\t\t\tvar handlers, validate;\r\n\r\n\t\t\tvalidate = settings.validate;\r\n\r\n\t\t\thandlers = {\r\n\t\t\t\t// #text\r\n\t\t\t\t3: function(node, raw) {\r\n\t\t\t\t\twriter.text(node.value, node.raw);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// #comment\r\n\t\t\t\t8: function(node) {\r\n\t\t\t\t\twriter.comment(node.value);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// Processing instruction\r\n\t\t\t\t7: function(node) {\r\n\t\t\t\t\twriter.pi(node.name, node.value);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// Doctype\r\n\t\t\t\t10: function(node) {\r\n\t\t\t\t\twriter.doctype(node.value);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// CDATA\r\n\t\t\t\t4: function(node) {\r\n\t\t\t\t\twriter.cdata(node.value);\r\n\t\t\t\t},\r\n\r\n \t\t\t\t// Document fragment\r\n\t\t\t\t11: function(node) {\r\n\t\t\t\t\tif ((node = node.firstChild)) {\r\n\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\twalk(node);\r\n\t\t\t\t\t\t} while (node = node.next);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\twriter.reset();\r\n\r\n\t\t\tfunction walk(node) {\r\n\t\t\t\tvar handler = handlers[node.type], name, isEmpty, attrs, attrName, attrValue, sortedAttrs, i, l, elementRule;\r\n\r\n\t\t\t\tif (!handler) {\r\n\t\t\t\t\tname = node.name;\r\n\t\t\t\t\tisEmpty = node.shortEnded;\r\n\t\t\t\t\tattrs = node.attributes;\r\n\r\n\t\t\t\t\t// Sort attributes\r\n\t\t\t\t\tif (validate && attrs && attrs.length > 1) {\r\n\t\t\t\t\t\tsortedAttrs = [];\r\n\t\t\t\t\t\tsortedAttrs.map = {};\r\n\r\n\t\t\t\t\t\telementRule = schema.getElementRule(node.name);\r\n\t\t\t\t\t\tfor (i = 0, l = elementRule.attributesOrder.length; i < l; i++) {\r\n\t\t\t\t\t\t\tattrName = elementRule.attributesOrder[i];\r\n\r\n\t\t\t\t\t\t\tif (attrName in attrs.map) {\r\n\t\t\t\t\t\t\t\tattrValue = attrs.map[attrName];\r\n\t\t\t\t\t\t\t\tsortedAttrs.map[attrName] = attrValue;\r\n\t\t\t\t\t\t\t\tsortedAttrs.push({name: attrName, value: attrValue});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor (i = 0, l = attrs.length; i < l; i++) {\r\n\t\t\t\t\t\t\tattrName = attrs[i].name;\r\n\r\n\t\t\t\t\t\t\tif (!(attrName in sortedAttrs.map)) {\r\n\t\t\t\t\t\t\t\tattrValue = attrs.map[attrName];\r\n\t\t\t\t\t\t\t\tsortedAttrs.map[attrName] = attrValue;\r\n\t\t\t\t\t\t\t\tsortedAttrs.push({name: attrName, value: attrValue});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tattrs = sortedAttrs;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twriter.start(node.name, attrs, isEmpty);\r\n\r\n\t\t\t\t\tif (!isEmpty) {\r\n\t\t\t\t\t\tif ((node = node.firstChild)) {\r\n\t\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\t\twalk(node);\r\n\t\t\t\t\t\t\t} while (node = node.next);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\twriter.end(name);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else\r\n\t\t\t\t\thandler(node);\r\n\t\t\t}\r\n\r\n\t\t\t// Serialize element and treat all non elements as fragments\r\n\t\t\tif (node.type == 1 && !settings.inner)\r\n\t\t\t\twalk(node);\r\n\t\t\telse\r\n\t\t\t\thandlers[11](node);\r\n\r\n\t\t\treturn writer.getContent();\r\n\t\t};\r\n\t}\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\t// Shorten names\r\n\tvar each = tinymce.each,\r\n\t\tis = tinymce.is,\r\n\t\tisWebKit = tinymce.isWebKit,\r\n\t\tisIE = tinymce.isIE,\r\n\t\tEntities = tinymce.html.Entities,\r\n\t\tsimpleSelectorRe = /^([a-z0-9],?)+$/i,\r\n\t\tblockElementsMap = tinymce.html.Schema.blockElementsMap,\r\n\t\twhiteSpaceRegExp = /^[ \\t\\r\\n]*$/;\r\n\r\n\ttinymce.create('tinymce.dom.DOMUtils', {\r\n\t\tdoc : null,\r\n\t\troot : null,\r\n\t\tfiles : null,\r\n\t\tpixelStyles : /^(top|left|bottom|right|width|height|borderWidth)$/,\r\n\t\tprops : {\r\n\t\t\t\"for\" : \"htmlFor\",\r\n\t\t\t\"class\" : \"className\",\r\n\t\t\tclassName : \"className\",\r\n\t\t\tchecked : \"checked\",\r\n\t\t\tdisabled : \"disabled\",\r\n\t\t\tmaxlength : \"maxLength\",\r\n\t\t\treadonly : \"readOnly\",\r\n\t\t\tselected : \"selected\",\r\n\t\t\tvalue : \"value\",\r\n\t\t\tid : \"id\",\r\n\t\t\tname : \"name\",\r\n\t\t\ttype : \"type\"\r\n\t\t},\r\n\r\n\t\tDOMUtils : function(d, s) {\r\n\t\t\tvar t = this, globalStyle, name;\r\n\r\n\t\t\tt.doc = d;\r\n\t\t\tt.win = window;\r\n\t\t\tt.files = {};\r\n\t\t\tt.cssFlicker = false;\r\n\t\t\tt.counter = 0;\r\n\t\t\tt.stdMode = !tinymce.isIE || d.documentMode >= 8;\r\n\t\t\tt.boxModel = !tinymce.isIE || d.compatMode == \"CSS1Compat\" || t.stdMode;\r\n\t\t\tt.hasOuterHTML = \"outerHTML\" in d.createElement(\"a\");\r\n\r\n\t\t\tt.settings = s = tinymce.extend({\r\n\t\t\t\tkeep_values : false,\r\n\t\t\t\thex_colors : 1\r\n\t\t\t}, s);\r\n\t\t\t\r\n\t\t\tt.schema = s.schema;\r\n\t\t\tt.styles = new tinymce.html.Styles({\r\n\t\t\t\turl_converter : s.url_converter,\r\n\t\t\t\turl_converter_scope : s.url_converter_scope\r\n\t\t\t}, s.schema);\r\n\r\n\t\t\t// Fix IE6SP2 flicker and check it failed for pre SP2\r\n\t\t\tif (tinymce.isIE6) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\td.execCommand('BackgroundImageCache', false, true);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tt.cssFlicker = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (isIE && s.schema) {\r\n\t\t\t\t// Add missing HTML 4/5 elements to IE\r\n\t\t\t\t('abbr article aside audio canvas ' +\r\n\t\t\t\t'details figcaption figure footer ' +\r\n\t\t\t\t'header hgroup mark menu meter nav ' +\r\n\t\t\t\t'output progress section summary ' +\r\n\t\t\t\t'time video').replace(/\\w+/g, function(name) {\r\n\t\t\t\t\td.createElement(name);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Create all custom elements\r\n\t\t\t\tfor (name in s.schema.getCustomElements()) {\r\n\t\t\t\t\td.createElement(name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttinymce.addUnload(t.destroy, t);\r\n\t\t},\r\n\r\n\t\tgetRoot : function() {\r\n\t\t\tvar t = this, s = t.settings;\r\n\r\n\t\t\treturn (s && t.get(s.root_element)) || t.doc.body;\r\n\t\t},\r\n\r\n\t\tgetViewPort : function(w) {\r\n\t\t\tvar d, b;\r\n\r\n\t\t\tw = !w ? this.win : w;\r\n\t\t\td = w.document;\r\n\t\t\tb = this.boxModel ? d.documentElement : d.body;\r\n\r\n\t\t\t// Returns viewport size excluding scrollbars\r\n\t\t\treturn {\r\n\t\t\t\tx : w.pageXOffset || b.scrollLeft,\r\n\t\t\t\ty : w.pageYOffset || b.scrollTop,\r\n\t\t\t\tw : w.innerWidth || b.clientWidth,\r\n\t\t\t\th : w.innerHeight || b.clientHeight\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\tgetRect : function(e) {\r\n\t\t\tvar p, t = this, sr;\r\n\r\n\t\t\te = t.get(e);\r\n\t\t\tp = t.getPos(e);\r\n\t\t\tsr = t.getSize(e);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tx : p.x,\r\n\t\t\t\ty : p.y,\r\n\t\t\t\tw : sr.w,\r\n\t\t\t\th : sr.h\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\tgetSize : function(e) {\r\n\t\t\tvar t = this, w, h;\r\n\r\n\t\t\te = t.get(e);\r\n\t\t\tw = t.getStyle(e, 'width');\r\n\t\t\th = t.getStyle(e, 'height');\r\n\r\n\t\t\t// Non pixel value, then force offset/clientWidth\r\n\t\t\tif (w.indexOf('px') === -1)\r\n\t\t\t\tw = 0;\r\n\r\n\t\t\t// Non pixel value, then force offset/clientWidth\r\n\t\t\tif (h.indexOf('px') === -1)\r\n\t\t\t\th = 0;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tw : parseInt(w) || e.offsetWidth || e.clientWidth,\r\n\t\t\t\th : parseInt(h) || e.offsetHeight || e.clientHeight\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\tgetParent : function(n, f, r) {\r\n\t\t\treturn this.getParents(n, f, r, false);\r\n\t\t},\r\n\r\n\t\tgetParents : function(n, f, r, c) {\r\n\t\t\tvar t = this, na, se = t.settings, o = [];\r\n\r\n\t\t\tn = t.get(n);\r\n\t\t\tc = c === undefined;\r\n\r\n\t\t\tif (se.strict_root)\r\n\t\t\t\tr = r || t.getRoot();\r\n\r\n\t\t\t// Wrap node name as func\r\n\t\t\tif (is(f, 'string')) {\r\n\t\t\t\tna = f;\r\n\r\n\t\t\t\tif (f === '*') {\r\n\t\t\t\t\tf = function(n) {return n.nodeType == 1;};\r\n\t\t\t\t} else {\r\n\t\t\t\t\tf = function(n) {\r\n\t\t\t\t\t\treturn t.is(n, na);\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\twhile (n) {\r\n\t\t\t\tif (n == r || !n.nodeType || n.nodeType === 9)\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tif (!f || f(n)) {\r\n\t\t\t\t\tif (c)\r\n\t\t\t\t\t\to.push(n);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\treturn n;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tn = n.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\treturn c ? o : null;\r\n\t\t},\r\n\r\n\t\tget : function(e) {\r\n\t\t\tvar n;\r\n\r\n\t\t\tif (e && this.doc && typeof(e) == 'string') {\r\n\t\t\t\tn = e;\r\n\t\t\t\te = this.doc.getElementById(e);\r\n\r\n\t\t\t\t// IE and Opera returns meta elements when they match the specified input ID, but getElementsByName seems to do the trick\r\n\t\t\t\tif (e && e.id !== n)\r\n\t\t\t\t\treturn this.doc.getElementsByName(n)[1];\r\n\t\t\t}\r\n\r\n\t\t\treturn e;\r\n\t\t},\r\n\r\n\t\tgetNext : function(node, selector) {\r\n\t\t\treturn this._findSib(node, selector, 'nextSibling');\r\n\t\t},\r\n\r\n\t\tgetPrev : function(node, selector) {\r\n\t\t\treturn this._findSib(node, selector, 'previousSibling');\r\n\t\t},\r\n\r\n\r\n\t\tselect : function(pa, s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\treturn tinymce.dom.Sizzle(pa, t.get(s) || t.get(t.settings.root_element) || t.doc, []);\r\n\t\t},\r\n\r\n\t\tis : function(n, selector) {\r\n\t\t\tvar i;\r\n\r\n\t\t\t// If it isn't an array then try to do some simple selectors instead of Sizzle for to boost performance\r\n\t\t\tif (n.length === undefined) {\r\n\t\t\t\t// Simple all selector\r\n\t\t\t\tif (selector === '*')\r\n\t\t\t\t\treturn n.nodeType == 1;\r\n\r\n\t\t\t\t// Simple selector just elements\r\n\t\t\t\tif (simpleSelectorRe.test(selector)) {\r\n\t\t\t\t\tselector = selector.toLowerCase().split(/,/);\r\n\t\t\t\t\tn = n.nodeName.toLowerCase();\r\n\r\n\t\t\t\t\tfor (i = selector.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\tif (selector[i] == n)\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn tinymce.dom.Sizzle.matches(selector, n.nodeType ? [n] : n).length > 0;\r\n\t\t},\r\n\r\n\r\n\t\tadd : function(p, n, a, h, c) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\treturn this.run(p, function(p) {\r\n\t\t\t\tvar e, k;\r\n\r\n\t\t\t\te = is(n, 'string') ? t.doc.createElement(n) : n;\r\n\t\t\t\tt.setAttribs(e, a);\r\n\r\n\t\t\t\tif (h) {\r\n\t\t\t\t\tif (h.nodeType)\r\n\t\t\t\t\t\te.appendChild(h);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tt.setHTML(e, h);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn !c ? p.appendChild(e) : e;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tcreate : function(n, a, h) {\r\n\t\t\treturn this.add(this.doc.createElement(n), n, a, h, 1);\r\n\t\t},\r\n\r\n\t\tcreateHTML : function(n, a, h) {\r\n\t\t\tvar o = '', t = this, k;\r\n\r\n\t\t\to += '<' + n;\r\n\r\n\t\t\tfor (k in a) {\r\n\t\t\t\tif (a.hasOwnProperty(k))\r\n\t\t\t\t\to += ' ' + k + '=\"' + t.encode(a[k]) + '\"';\r\n\t\t\t}\r\n\r\n\t\t\t// A call to tinymce.is doesn't work for some odd reason on IE9 possible bug inside their JS runtime\r\n\t\t\tif (typeof(h) != \"undefined\")\r\n\t\t\t\treturn o + '>' + h + '</' + n + '>';\r\n\r\n\t\t\treturn o + ' />';\r\n\t\t},\r\n\r\n\t\tremove : function(node, keep_children) {\r\n\t\t\treturn this.run(node, function(node) {\r\n\t\t\t\tvar child, parent = node.parentNode;\r\n\r\n\t\t\t\tif (!parent)\r\n\t\t\t\t\treturn null;\r\n\r\n\t\t\t\tif (keep_children) {\r\n\t\t\t\t\twhile (child = node.firstChild) {\r\n\t\t\t\t\t\t// IE 8 will crash if you don't remove completely empty text nodes\r\n\t\t\t\t\t\tif (!tinymce.isIE || child.nodeType !== 3 || child.nodeValue)\r\n\t\t\t\t\t\t\tparent.insertBefore(child, node);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tnode.removeChild(child);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn parent.removeChild(node);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tsetStyle : function(n, na, v) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\treturn t.run(n, function(e) {\r\n\t\t\t\tvar s, i;\r\n\r\n\t\t\t\ts = e.style;\r\n\r\n\t\t\t\t// Camelcase it, if needed\r\n\t\t\t\tna = na.replace(/-(\\D)/g, function(a, b){\r\n\t\t\t\t\treturn b.toUpperCase();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Default px suffix on these\r\n\t\t\t\tif (t.pixelStyles.test(na) && (tinymce.is(v, 'number') || /^[\\-0-9\\.]+$/.test(v)))\r\n\t\t\t\t\tv += 'px';\r\n\r\n\t\t\t\tswitch (na) {\r\n\t\t\t\t\tcase 'opacity':\r\n\t\t\t\t\t\t// IE specific opacity\r\n\t\t\t\t\t\tif (isIE) {\r\n\t\t\t\t\t\t\ts.filter = v === '' ? '' : \"alpha(opacity=\" + (v * 100) + \")\";\r\n\r\n\t\t\t\t\t\t\tif (!n.currentStyle || !n.currentStyle.hasLayout)\r\n\t\t\t\t\t\t\t\ts.display = 'inline-block';\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Fix for older browsers\r\n\t\t\t\t\t\ts[na] = s['-moz-opacity'] = s['-khtml-opacity'] = v || '';\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'float':\r\n\t\t\t\t\t\tisIE ? s.styleFloat = v : s.cssFloat = v;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\ts[na] = v || '';\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Force update of the style data\r\n\t\t\t\tif (t.settings.update_styles)\r\n\t\t\t\t\tt.setAttrib(e, 'data-mce-style');\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetStyle : function(n, na, c) {\r\n\t\t\tn = this.get(n);\r\n\r\n\t\t\tif (!n)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Gecko\r\n\t\t\tif (this.doc.defaultView && c) {\r\n\t\t\t\t// Remove camelcase\r\n\t\t\t\tna = na.replace(/[A-Z]/g, function(a){\r\n\t\t\t\t\treturn '-' + a;\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\treturn this.doc.defaultView.getComputedStyle(n, null).getPropertyValue(na);\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Old safari might fail\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Camelcase it, if needed\r\n\t\t\tna = na.replace(/-(\\D)/g, function(a, b){\r\n\t\t\t\treturn b.toUpperCase();\r\n\t\t\t});\r\n\r\n\t\t\tif (na == 'float')\r\n\t\t\t\tna = isIE ? 'styleFloat' : 'cssFloat';\r\n\r\n\t\t\t// IE & Opera\r\n\t\t\tif (n.currentStyle && c)\r\n\t\t\t\treturn n.currentStyle[na];\r\n\r\n\t\t\treturn n.style ? n.style[na] : undefined;\r\n\t\t},\r\n\r\n\t\tsetStyles : function(e, o) {\r\n\t\t\tvar t = this, s = t.settings, ol;\r\n\r\n\t\t\tol = s.update_styles;\r\n\t\t\ts.update_styles = 0;\r\n\r\n\t\t\teach(o, function(v, n) {\r\n\t\t\t\tt.setStyle(e, n, v);\r\n\t\t\t});\r\n\r\n\t\t\t// Update style info\r\n\t\t\ts.update_styles = ol;\r\n\t\t\tif (s.update_styles)\r\n\t\t\t\tt.setAttrib(e, s.cssText);\r\n\t\t},\r\n\r\n\t\tremoveAllAttribs: function(e) {\r\n\t\t\treturn this.run(e, function(e) {\r\n\t\t\t\tvar i, attrs = e.attributes;\r\n\t\t\t\tfor (i = attrs.length - 1; i >= 0; i--) {\r\n\t\t\t\t\te.removeAttributeNode(attrs.item(i));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tsetAttrib : function(e, n, v) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\t// Whats the point\r\n\t\t\tif (!e || !n)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Strict XML mode\r\n\t\t\tif (t.settings.strict)\r\n\t\t\t\tn = n.toLowerCase();\r\n\r\n\t\t\treturn this.run(e, function(e) {\r\n\t\t\t\tvar s = t.settings;\r\n\t\t\t\tif (v !== null) {\r\n\t\t\t\t\tswitch (n) {\r\n\t\t\t\t\t\tcase \"style\":\r\n\t\t\t\t\t\t\tif (!is(v, 'string')) {\r\n\t\t\t\t\t\t\t\teach(v, function(v, n) {\r\n\t\t\t\t\t\t\t\t\tt.setStyle(e, n, v);\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// No mce_style for elements with these since they might get resized by the user\r\n\t\t\t\t\t\t\tif (s.keep_values) {\r\n\t\t\t\t\t\t\t\tif (v && !t._isRes(v))\r\n\t\t\t\t\t\t\t\t\te.setAttribute('data-mce-style', v, 2);\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\te.removeAttribute('data-mce-style', 2);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\te.style.cssText = v;\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase \"class\":\r\n\t\t\t\t\t\t\te.className = v || ''; // Fix IE null bug\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase \"src\":\r\n\t\t\t\t\t\tcase \"href\":\r\n\t\t\t\t\t\t\tif (s.keep_values) {\r\n\t\t\t\t\t\t\t\tif (s.url_converter)\r\n\t\t\t\t\t\t\t\t\tv = s.url_converter.call(s.url_converter_scope || t, v, n, e);\r\n\r\n\t\t\t\t\t\t\t\tt.setAttrib(e, 'data-mce-' + n, v, 2);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase \"shape\":\r\n\t\t\t\t\t\t\te.setAttribute('data-mce-style', v);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (is(v) && v !== null && v.length !== 0)\r\n\t\t\t\t\te.setAttribute(n, '' + v, 2);\r\n\t\t\t\telse\r\n\t\t\t\t\te.removeAttribute(n, 2);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tsetAttribs : function(e, o) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\treturn this.run(e, function(e) {\r\n\t\t\t\teach(o, function(v, n) {\r\n\t\t\t\t\tt.setAttrib(e, n, v);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetAttrib : function(e, n, dv) {\r\n\t\t\tvar v, t = this, undef;\r\n\r\n\t\t\te = t.get(e);\r\n\r\n\t\t\tif (!e || e.nodeType !== 1)\r\n\t\t\t\treturn dv === undef ? false : dv;\r\n\r\n\t\t\tif (!is(dv))\r\n\t\t\t\tdv = '';\r\n\r\n\t\t\t// Try the mce variant for these\r\n\t\t\tif (/^(src|href|style|coords|shape)$/.test(n)) {\r\n\t\t\t\tv = e.getAttribute(\"data-mce-\" + n);\r\n\r\n\t\t\t\tif (v)\r\n\t\t\t\t\treturn v;\r\n\t\t\t}\r\n\r\n\t\t\tif (isIE && t.props[n]) {\r\n\t\t\t\tv = e[t.props[n]];\r\n\t\t\t\tv = v && v.nodeValue ? v.nodeValue : v;\r\n\t\t\t}\r\n\r\n\t\t\tif (!v)\r\n\t\t\t\tv = e.getAttribute(n, 2);\r\n\r\n\t\t\t// Check boolean attribs\r\n\t\t\tif (/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noshade|nowrap|readonly|selected)$/.test(n)) {\r\n\t\t\t\tif (e[t.props[n]] === true && v === '')\r\n\t\t\t\t\treturn n;\r\n\r\n\t\t\t\treturn v ? n : '';\r\n\t\t\t}\r\n\r\n\t\t\t// Inner input elements will override attributes on form elements\r\n\t\t\tif (e.nodeName === \"FORM\" && e.getAttributeNode(n))\r\n\t\t\t\treturn e.getAttributeNode(n).nodeValue;\r\n\r\n\t\t\tif (n === 'style') {\r\n\t\t\t\tv = v || e.style.cssText;\r\n\r\n\t\t\t\tif (v) {\r\n\t\t\t\t\tv = t.serializeStyle(t.parseStyle(v), e.nodeName);\r\n\r\n\t\t\t\t\tif (t.settings.keep_values && !t._isRes(v))\r\n\t\t\t\t\t\te.setAttribute('data-mce-style', v);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remove Apple and WebKit stuff\r\n\t\t\tif (isWebKit && n === \"class\" && v)\r\n\t\t\t\tv = v.replace(/(apple|webkit)\\-[a-z\\-]+/gi, '');\r\n\r\n\t\t\t// Handle IE issues\r\n\t\t\tif (isIE) {\r\n\t\t\t\tswitch (n) {\r\n\t\t\t\t\tcase 'rowspan':\r\n\t\t\t\t\tcase 'colspan':\r\n\t\t\t\t\t\t// IE returns 1 as default value\r\n\t\t\t\t\t\tif (v === 1)\r\n\t\t\t\t\t\t\tv = '';\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'size':\r\n\t\t\t\t\t\t// IE returns +0 as default value for size\r\n\t\t\t\t\t\tif (v === '+0' || v === 20 || v === 0)\r\n\t\t\t\t\t\t\tv = '';\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'width':\r\n\t\t\t\t\tcase 'height':\r\n\t\t\t\t\tcase 'vspace':\r\n\t\t\t\t\tcase 'checked':\r\n\t\t\t\t\tcase 'disabled':\r\n\t\t\t\t\tcase 'readonly':\r\n\t\t\t\t\t\tif (v === 0)\r\n\t\t\t\t\t\t\tv = '';\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'hspace':\r\n\t\t\t\t\t\t// IE returns -1 as default value\r\n\t\t\t\t\t\tif (v === -1)\r\n\t\t\t\t\t\t\tv = '';\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'maxlength':\r\n\t\t\t\t\tcase 'tabindex':\r\n\t\t\t\t\t\t// IE returns default value\r\n\t\t\t\t\t\tif (v === 32768 || v === 2147483647 || v === '32768')\r\n\t\t\t\t\t\t\tv = '';\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'multiple':\r\n\t\t\t\t\tcase 'compact':\r\n\t\t\t\t\tcase 'noshade':\r\n\t\t\t\t\tcase 'nowrap':\r\n\t\t\t\t\t\tif (v === 65535)\r\n\t\t\t\t\t\t\treturn n;\r\n\r\n\t\t\t\t\t\treturn dv;\r\n\r\n\t\t\t\t\tcase 'shape':\r\n\t\t\t\t\t\tv = v.toLowerCase();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t// IE has odd anonymous function for event attributes\r\n\t\t\t\t\t\tif (n.indexOf('on') === 0 && v)\r\n\t\t\t\t\t\t\tv = tinymce._replace(/^function\\s+\\w+\\(\\)\\s+\\{\\s+(.*)\\s+\\}$/, '$1', '' + v);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn (v !== undef && v !== null && v !== '') ? '' + v : dv;\r\n\t\t},\r\n\r\n\t\tgetPos : function(n, ro) {\r\n\t\t\tvar t = this, x = 0, y = 0, e, d = t.doc, r;\r\n\r\n\t\t\tn = t.get(n);\r\n\t\t\tro = ro || d.body;\r\n\r\n\t\t\tif (n) {\r\n\t\t\t\t// Use getBoundingClientRect if it exists since it's faster than looping offset nodes\r\n\t\t\t\tif (n.getBoundingClientRect) {\r\n\t\t\t\t\tn = n.getBoundingClientRect();\r\n\t\t\t\t\te = t.boxModel ? d.documentElement : d.body;\r\n\r\n\t\t\t\t\t// Add scroll offsets from documentElement or body since IE with the wrong box model will use d.body and so do WebKit\r\n\t\t\t\t\t// Also remove the body/documentelement clientTop/clientLeft on IE 6, 7 since they offset the position\r\n\t\t\t\t\tx = n.left + (d.documentElement.scrollLeft || d.body.scrollLeft) - e.clientTop;\r\n\t\t\t\t\ty = n.top + (d.documentElement.scrollTop || d.body.scrollTop) - e.clientLeft;\r\n\r\n\t\t\t\t\treturn {x : x, y : y};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tr = n;\r\n\t\t\t\twhile (r && r != ro && r.nodeType) {\r\n\t\t\t\t\tx += r.offsetLeft || 0;\r\n\t\t\t\t\ty += r.offsetTop || 0;\r\n\t\t\t\t\tr = r.offsetParent;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tr = n.parentNode;\r\n\t\t\t\twhile (r && r != ro && r.nodeType) {\r\n\t\t\t\t\tx -= r.scrollLeft || 0;\r\n\t\t\t\t\ty -= r.scrollTop || 0;\r\n\t\t\t\t\tr = r.parentNode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn {x : x, y : y};\r\n\t\t},\r\n\r\n\t\tparseStyle : function(st) {\r\n\t\t\treturn this.styles.parse(st);\r\n\t\t},\r\n\r\n\t\tserializeStyle : function(o, name) {\r\n\t\t\treturn this.styles.serialize(o, name);\r\n\t\t},\r\n\r\n\t\tloadCSS : function(u) {\r\n\t\t\tvar t = this, d = t.doc, head;\r\n\r\n\t\t\tif (!u)\r\n\t\t\t\tu = '';\r\n\r\n\t\t\thead = t.select('head')[0];\r\n\r\n\t\t\teach(u.split(','), function(u) {\r\n\t\t\t\tvar link;\r\n\r\n\t\t\t\tif (t.files[u])\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tt.files[u] = true;\r\n\t\t\t\tlink = t.create('link', {rel : 'stylesheet', href : tinymce._addVer(u)});\r\n\r\n\t\t\t\t// IE 8 has a bug where dynamically loading stylesheets would produce a 1 item remaining bug\r\n\t\t\t\t// This fix seems to resolve that issue by realcing the document ones a stylesheet finishes loading\r\n\t\t\t\t// It's ugly but it seems to work fine.\r\n\t\t\t\tif (isIE && d.documentMode && d.recalc) {\r\n\t\t\t\t\tlink.onload = function() {\r\n\t\t\t\t\t\tif (d.recalc)\r\n\t\t\t\t\t\t\td.recalc();\r\n\r\n\t\t\t\t\t\tlink.onload = null;\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\thead.appendChild(link);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\taddClass : function(e, c) {\r\n\t\t\treturn this.run(e, function(e) {\r\n\t\t\t\tvar o;\r\n\r\n\t\t\t\tif (!c)\r\n\t\t\t\t\treturn 0;\r\n\r\n\t\t\t\tif (this.hasClass(e, c))\r\n\t\t\t\t\treturn e.className;\r\n\r\n\t\t\t\to = this.removeClass(e, c);\r\n\r\n\t\t\t\treturn e.className = (o != '' ? (o + ' ') : '') + c;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tremoveClass : function(e, c) {\r\n\t\t\tvar t = this, re;\r\n\r\n\t\t\treturn t.run(e, function(e) {\r\n\t\t\t\tvar v;\r\n\r\n\t\t\t\tif (t.hasClass(e, c)) {\r\n\t\t\t\t\tif (!re)\r\n\t\t\t\t\t\tre = new RegExp(\"(^|\\\\s+)\" + c + \"(\\\\s+|$)\", \"g\");\r\n\r\n\t\t\t\t\tv = e.className.replace(re, ' ');\r\n\t\t\t\t\tv = tinymce.trim(v != ' ' ? v : '');\r\n\r\n\t\t\t\t\te.className = v;\r\n\r\n\t\t\t\t\t// Empty class attr\r\n\t\t\t\t\tif (!v) {\r\n\t\t\t\t\t\te.removeAttribute('class');\r\n\t\t\t\t\t\te.removeAttribute('className');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn v;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn e.className;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\thasClass : function(n, c) {\r\n\t\t\tn = this.get(n);\r\n\r\n\t\t\tif (!n || !c)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\treturn (' ' + n.className + ' ').indexOf(' ' + c + ' ') !== -1;\r\n\t\t},\r\n\r\n\t\tshow : function(e) {\r\n\t\t\treturn this.setStyle(e, 'display', 'block');\r\n\t\t},\r\n\r\n\t\thide : function(e) {\r\n\t\t\treturn this.setStyle(e, 'display', 'none');\r\n\t\t},\r\n\r\n\t\tisHidden : function(e) {\r\n\t\t\te = this.get(e);\r\n\r\n\t\t\treturn !e || e.style.display == 'none' || this.getStyle(e, 'display') == 'none';\r\n\t\t},\r\n\r\n\t\tuniqueId : function(p) {\r\n\t\t\treturn (!p ? 'mce_' : p) + (this.counter++);\r\n\t\t},\r\n\r\n\t\tsetHTML : function(element, html) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\treturn self.run(element, function(element) {\r\n\t\t\t\tif (isIE) {\r\n\t\t\t\t\t// Remove all child nodes, IE keeps empty text nodes in DOM\r\n\t\t\t\t\twhile (element.firstChild)\r\n\t\t\t\t\t\telement.removeChild(element.firstChild);\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// IE will remove comments from the beginning\r\n\t\t\t\t\t\t// unless you padd the contents with something\r\n\t\t\t\t\t\telement.innerHTML = '<br />' + html;\r\n\t\t\t\t\t\telement.removeChild(element.firstChild);\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// IE sometimes produces an unknown runtime error on innerHTML if it's an block element within a block element for example a div inside a p\r\n\t\t\t\t\t\t// This seems to fix this problem\r\n\r\n\t\t\t\t\t\t// Create new div with HTML contents and a BR infront to keep comments\r\n\t\t\t\t\t\telement = self.create('div');\r\n\t\t\t\t\t\telement.innerHTML = '<br />' + html;\r\n\r\n\t\t\t\t\t\t// Add all children from div to target\r\n\t\t\t\t\t\teach (element.childNodes, function(node, i) {\r\n\t\t\t\t\t\t\t// Skip br element\r\n\t\t\t\t\t\t\tif (i)\r\n\t\t\t\t\t\t\t\telement.appendChild(node);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else\r\n\t\t\t\t\telement.innerHTML = html;\r\n\r\n\t\t\t\treturn html;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetOuterHTML : function(elm) {\r\n\t\t\tvar doc, self = this;\r\n\r\n\t\t\telm = self.get(elm);\r\n\r\n\t\t\tif (!elm)\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tif (elm.nodeType === 1 && self.hasOuterHTML)\r\n\t\t\t\treturn elm.outerHTML;\r\n\r\n\t\t\tdoc = (elm.ownerDocument || self.doc).createElement(\"body\");\r\n\t\t\tdoc.appendChild(elm.cloneNode(true));\r\n\r\n\t\t\treturn doc.innerHTML;\r\n\t\t},\r\n\r\n\t\tsetOuterHTML : function(e, h, d) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tfunction setHTML(e, h, d) {\r\n\t\t\t\tvar n, tp;\r\n\r\n\t\t\t\ttp = d.createElement(\"body\");\r\n\t\t\t\ttp.innerHTML = h;\r\n\r\n\t\t\t\tn = tp.lastChild;\r\n\t\t\t\twhile (n) {\r\n\t\t\t\t\tt.insertAfter(n.cloneNode(true), e);\r\n\t\t\t\t\tn = n.previousSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt.remove(e);\r\n\t\t\t};\r\n\r\n\t\t\treturn this.run(e, function(e) {\r\n\t\t\t\te = t.get(e);\r\n\r\n\t\t\t\t// Only set HTML on elements\r\n\t\t\t\tif (e.nodeType == 1) {\r\n\t\t\t\t\td = d || e.ownerDocument || t.doc;\r\n\r\n\t\t\t\t\tif (isIE) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t// Try outerHTML for IE it sometimes produces an unknown runtime error\r\n\t\t\t\t\t\t\tif (isIE && e.nodeType == 1)\r\n\t\t\t\t\t\t\t\te.outerHTML = h;\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tsetHTML(e, h, d);\r\n\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\t// Fix for unknown runtime error\r\n\t\t\t\t\t\t\tsetHTML(e, h, d);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tsetHTML(e, h, d);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tdecode : Entities.decode,\r\n\r\n\t\tencode : Entities.encodeAllRaw,\r\n\r\n\t\tinsertAfter : function(node, reference_node) {\r\n\t\t\treference_node = this.get(reference_node);\r\n\r\n\t\t\treturn this.run(node, function(node) {\r\n\t\t\t\tvar parent, nextSibling;\r\n\r\n\t\t\t\tparent = reference_node.parentNode;\r\n\t\t\t\tnextSibling = reference_node.nextSibling;\r\n\r\n\t\t\t\tif (nextSibling)\r\n\t\t\t\t\tparent.insertBefore(node, nextSibling);\r\n\t\t\t\telse\r\n\t\t\t\t\tparent.appendChild(node);\r\n\r\n\t\t\t\treturn node;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tisBlock : function(node) {\r\n\t\t\tvar type = node.nodeType;\r\n\r\n\t\t\t// If it's a node then check the type and use the nodeName\r\n\t\t\tif (type)\r\n\t\t\t\treturn !!(type === 1 && blockElementsMap[node.nodeName]);\r\n\r\n\t\t\treturn !!blockElementsMap[node];\r\n\t\t},\r\n\r\n\t\treplace : function(n, o, k) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (is(o, 'array'))\r\n\t\t\t\tn = n.cloneNode(true);\r\n\r\n\t\t\treturn t.run(o, function(o) {\r\n\t\t\t\tif (k) {\r\n\t\t\t\t\teach(tinymce.grep(o.childNodes), function(c) {\r\n\t\t\t\t\t\tn.appendChild(c);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn o.parentNode.replaceChild(n, o);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\trename : function(elm, name) {\r\n\t\t\tvar t = this, newElm;\r\n\r\n\t\t\tif (elm.nodeName != name.toUpperCase()) {\r\n\t\t\t\t// Rename block element\r\n\t\t\t\tnewElm = t.create(name);\r\n\r\n\t\t\t\t// Copy attribs to new block\r\n\t\t\t\teach(t.getAttribs(elm), function(attr_node) {\r\n\t\t\t\t\tt.setAttrib(newElm, attr_node.nodeName, t.getAttrib(elm, attr_node.nodeName));\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Replace block\r\n\t\t\t\tt.replace(newElm, elm, 1);\r\n\t\t\t}\r\n\r\n\t\t\treturn newElm || elm;\r\n\t\t},\r\n\r\n\t\tfindCommonAncestor : function(a, b) {\r\n\t\t\tvar ps = a, pe;\r\n\r\n\t\t\twhile (ps) {\r\n\t\t\t\tpe = b;\r\n\r\n\t\t\t\twhile (pe && ps != pe)\r\n\t\t\t\t\tpe = pe.parentNode;\r\n\r\n\t\t\t\tif (ps == pe)\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tps = ps.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tif (!ps && a.ownerDocument)\r\n\t\t\t\treturn a.ownerDocument.documentElement;\r\n\r\n\t\t\treturn ps;\r\n\t\t},\r\n\r\n\t\ttoHex : function(s) {\r\n\t\t\tvar c = /^\\s*rgb\\s*?\\(\\s*?([0-9]+)\\s*?,\\s*?([0-9]+)\\s*?,\\s*?([0-9]+)\\s*?\\)\\s*$/i.exec(s);\r\n\r\n\t\t\tfunction hex(s) {\r\n\t\t\t\ts = parseInt(s).toString(16);\r\n\r\n\t\t\t\treturn s.length > 1 ? s : '0' + s; // 0 -> 00\r\n\t\t\t};\r\n\r\n\t\t\tif (c) {\r\n\t\t\t\ts = '#' + hex(c[1]) + hex(c[2]) + hex(c[3]);\r\n\r\n\t\t\t\treturn s;\r\n\t\t\t}\r\n\r\n\t\t\treturn s;\r\n\t\t},\r\n\r\n\t\tgetClasses : function() {\r\n\t\t\tvar t = this, cl = [], i, lo = {}, f = t.settings.class_filter, ov;\r\n\r\n\t\t\tif (t.classes)\r\n\t\t\t\treturn t.classes;\r\n\r\n\t\t\tfunction addClasses(s) {\r\n\t\t\t\t// IE style imports\r\n\t\t\t\teach(s.imports, function(r) {\r\n\t\t\t\t\taddClasses(r);\r\n\t\t\t\t});\r\n\r\n\t\t\t\teach(s.cssRules || s.rules, function(r) {\r\n\t\t\t\t\t// Real type or fake it on IE\r\n\t\t\t\t\tswitch (r.type || 1) {\r\n\t\t\t\t\t\t// Rule\r\n\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\tif (r.selectorText) {\r\n\t\t\t\t\t\t\t\teach(r.selectorText.split(','), function(v) {\r\n\t\t\t\t\t\t\t\t\tv = v.replace(/^\\s*|\\s*$|^\\s\\./g, \"\");\r\n\r\n\t\t\t\t\t\t\t\t\t// Is internal or it doesn't contain a class\r\n\t\t\t\t\t\t\t\t\tif (/\\.mce/.test(v) || !/\\.[\\w\\-]+$/.test(v))\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\t\t// Remove everything but class name\r\n\t\t\t\t\t\t\t\t\tov = v;\r\n\t\t\t\t\t\t\t\t\tv = tinymce._replace(/.*\\.([a-z0-9_\\-]+).*/i, '$1', v);\r\n\r\n\t\t\t\t\t\t\t\t\t// Filter classes\r\n\t\t\t\t\t\t\t\t\tif (f && !(v = f(v, ov)))\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\t\tif (!lo[v]) {\r\n\t\t\t\t\t\t\t\t\t\tcl.push({'class' : v});\r\n\t\t\t\t\t\t\t\t\t\tlo[v] = 1;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t// Import\r\n\t\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t\taddClasses(r.styleSheet);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\ttry {\r\n\t\t\t\teach(t.doc.styleSheets, addClasses);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Ignore\r\n\t\t\t}\r\n\r\n\t\t\tif (cl.length > 0)\r\n\t\t\t\tt.classes = cl;\r\n\r\n\t\t\treturn cl;\r\n\t\t},\r\n\r\n\t\trun : function(e, f, s) {\r\n\t\t\tvar t = this, o;\r\n\r\n\t\t\tif (t.doc && typeof(e) === 'string')\r\n\t\t\t\te = t.get(e);\r\n\r\n\t\t\tif (!e)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\ts = s || this;\r\n\t\t\tif (!e.nodeType && (e.length || e.length === 0)) {\r\n\t\t\t\to = [];\r\n\r\n\t\t\t\teach(e, function(e, i) {\r\n\t\t\t\t\tif (e) {\r\n\t\t\t\t\t\tif (typeof(e) == 'string')\r\n\t\t\t\t\t\t\te = t.doc.getElementById(e);\r\n\r\n\t\t\t\t\t\to.push(f.call(s, e, i));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn o;\r\n\t\t\t}\r\n\r\n\t\t\treturn f.call(s, e);\r\n\t\t},\r\n\r\n\t\tgetAttribs : function(n) {\r\n\t\t\tvar o;\r\n\r\n\t\t\tn = this.get(n);\r\n\r\n\t\t\tif (!n)\r\n\t\t\t\treturn [];\r\n\r\n\t\t\tif (isIE) {\r\n\t\t\t\to = [];\r\n\r\n\t\t\t\t// Object will throw exception in IE\r\n\t\t\t\tif (n.nodeName == 'OBJECT')\r\n\t\t\t\t\treturn n.attributes;\r\n\r\n\t\t\t\t// IE doesn't keep the selected attribute if you clone option elements\r\n\t\t\t\tif (n.nodeName === 'OPTION' && this.getAttrib(n, 'selected'))\r\n\t\t\t\t\to.push({specified : 1, nodeName : 'selected'});\r\n\r\n\t\t\t\t// It's crazy that this is faster in IE but it's because it returns all attributes all the time\r\n\t\t\t\tn.cloneNode(false).outerHTML.replace(/<\\/?[\\w:\\-]+ ?|=[\\\"][^\\\"]+\\\"|=\\'[^\\']+\\'|=[\\w\\-]+|>/gi, '').replace(/[\\w:\\-]+/gi, function(a) {\r\n\t\t\t\t\to.push({specified : 1, nodeName : a});\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn o;\r\n\t\t\t}\r\n\r\n\t\t\treturn n.attributes;\r\n\t\t},\r\n\r\n\t\tisEmpty : function(node, elements) {\r\n\t\t\tvar self = this, i, attributes, type, walker, name, parentNode;\r\n\r\n\t\t\tnode = node.firstChild;\r\n\t\t\tif (node) {\r\n\t\t\t\twalker = new tinymce.dom.TreeWalker(node);\r\n\t\t\t\telements = elements || self.schema ? self.schema.getNonEmptyElements() : null;\r\n\r\n\t\t\t\tdo {\r\n\t\t\t\t\ttype = node.nodeType;\r\n\r\n\t\t\t\t\tif (type === 1) {\r\n\t\t\t\t\t\t// Ignore bogus elements\r\n\t\t\t\t\t\tif (node.getAttribute('data-mce-bogus'))\r\n\t\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\t// Keep empty elements like <img />\r\n\t\t\t\t\t\tname = node.nodeName.toLowerCase();\r\n\t\t\t\t\t\tif (elements && elements[name]) {\r\n\t\t\t\t\t\t\t// Ignore single BR elements in blocks like <p><br /></p>\r\n\t\t\t\t\t\t\tparentNode = node.parentNode;\r\n\t\t\t\t\t\t\tif (name === 'br' && self.isBlock(parentNode) && parentNode.firstChild === node && parentNode.lastChild === node) {\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Keep elements with data-bookmark attributes or name attribute like <a name=\"1\"></a>\r\n\t\t\t\t\t\tattributes = self.getAttribs(node);\r\n\t\t\t\t\t\ti = node.attributes.length;\r\n\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\tname = node.attributes[i].nodeName;\r\n\t\t\t\t\t\t\tif (name === \"name\" || name === 'data-mce-bookmark')\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Keep non whitespace text nodes\r\n\t\t\t\t\tif ((type === 3 && !whiteSpaceRegExp.test(node.nodeValue)))\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t} while (node = walker.next());\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\tdestroy : function(s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (t.events)\r\n\t\t\t\tt.events.destroy();\r\n\r\n\t\t\tt.win = t.doc = t.root = t.events = null;\r\n\r\n\t\t\t// Manual destroy then remove unload handler\r\n\t\t\tif (!s)\r\n\t\t\t\ttinymce.removeUnload(t.destroy);\r\n\t\t},\r\n\r\n\t\tcreateRng : function() {\r\n\t\t\tvar d = this.doc;\r\n\r\n\t\t\treturn d.createRange ? d.createRange() : new tinymce.dom.Range(this);\r\n\t\t},\r\n\r\n\t\tnodeIndex : function(node, normalized) {\r\n\t\t\tvar idx = 0, lastNodeType, lastNode, nodeType;\r\n\r\n\t\t\tif (node) {\r\n\t\t\t\tfor (lastNodeType = node.nodeType, node = node.previousSibling, lastNode = node; node; node = node.previousSibling) {\r\n\t\t\t\t\tnodeType = node.nodeType;\r\n\r\n\t\t\t\t\t// Normalize text nodes\r\n\t\t\t\t\tif (normalized && nodeType == 3) {\r\n\t\t\t\t\t\tif (nodeType == lastNodeType || !node.nodeValue.length)\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tidx++;\r\n\t\t\t\t\tlastNodeType = nodeType;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn idx;\r\n\t\t},\r\n\r\n\t\tsplit : function(pe, e, re) {\r\n\t\t\tvar t = this, r = t.createRng(), bef, aft, pa;\r\n\r\n\t\t\t// W3C valid browsers tend to leave empty nodes to the left/right side of the contents, this makes sense\r\n\t\t\t// but we don't want that in our code since it serves no purpose for the end user\r\n\t\t\t// For example if this is chopped:\r\n\t\t\t//   <p>text 1<span><b>CHOP</b></span>text 2</p>\r\n\t\t\t// would produce:\r\n\t\t\t//   <p>text 1<span></span></p><b>CHOP</b><p><span></span>text 2</p>\r\n\t\t\t// this function will then trim of empty edges and produce:\r\n\t\t\t//   <p>text 1</p><b>CHOP</b><p>text 2</p>\r\n\t\t\tfunction trim(node) {\r\n\t\t\t\tvar i, children = node.childNodes, type = node.nodeType;\r\n\r\n\t\t\t\tif (type == 1 && node.getAttribute('data-mce-type') == 'bookmark')\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tfor (i = children.length - 1; i >= 0; i--)\r\n\t\t\t\t\ttrim(children[i]);\r\n\r\n\t\t\t\tif (type != 9) {\r\n\t\t\t\t\t// Keep non whitespace text nodes\r\n\t\t\t\t\tif (type == 3 && node.nodeValue.length > 0) {\r\n\t\t\t\t\t\t// If parent element isn't a block or there isn't any useful contents for example \"<p>   </p>\"\r\n\t\t\t\t\t\tif (!t.isBlock(node.parentNode) || tinymce.trim(node.nodeValue).length > 0)\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t} else if (type == 1) {\r\n\t\t\t\t\t\t// If the only child is a bookmark then move it up\r\n\t\t\t\t\t\tchildren = node.childNodes;\r\n\t\t\t\t\t\tif (children.length == 1 && children[0] && children[0].nodeType == 1 && children[0].getAttribute('data-mce-type') == 'bookmark')\r\n\t\t\t\t\t\t\tnode.parentNode.insertBefore(children[0], node);\r\n\r\n\t\t\t\t\t\t// Keep non empty elements or img, hr etc\r\n\t\t\t\t\t\tif (children.length || /^(br|hr|input|img)$/i.test(node.nodeName))\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tt.remove(node);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node;\r\n\t\t\t};\r\n\r\n\t\t\tif (pe && e) {\r\n\t\t\t\t// Get before chunk\r\n\t\t\t\tr.setStart(pe.parentNode, t.nodeIndex(pe));\r\n\t\t\t\tr.setEnd(e.parentNode, t.nodeIndex(e));\r\n\t\t\t\tbef = r.extractContents();\r\n\r\n\t\t\t\t// Get after chunk\r\n\t\t\t\tr = t.createRng();\r\n\t\t\t\tr.setStart(e.parentNode, t.nodeIndex(e) + 1);\r\n\t\t\t\tr.setEnd(pe.parentNode, t.nodeIndex(pe) + 1);\r\n\t\t\t\taft = r.extractContents();\r\n\r\n\t\t\t\t// Insert before chunk\r\n\t\t\t\tpa = pe.parentNode;\r\n\t\t\t\tpa.insertBefore(trim(bef), pe);\r\n\r\n\t\t\t\t// Insert middle chunk\r\n\t\t\t\tif (re)\r\n\t\t\t\t\tpa.replaceChild(re, e);\r\n\t\t\t\telse\r\n\t\t\t\t\tpa.insertBefore(e, pe);\r\n\r\n\t\t\t\t// Insert after chunk\r\n\t\t\t\tpa.insertBefore(trim(aft), pe);\r\n\t\t\t\tt.remove(pe);\r\n\r\n\t\t\t\treturn re || e;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tbind : function(target, name, func, scope) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (!t.events)\r\n\t\t\t\tt.events = new tinymce.dom.EventUtils();\r\n\r\n\t\t\treturn t.events.add(target, name, func, scope || this);\r\n\t\t},\r\n\r\n\t\tunbind : function(target, name, func) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (!t.events)\r\n\t\t\t\tt.events = new tinymce.dom.EventUtils();\r\n\r\n\t\t\treturn t.events.remove(target, name, func);\r\n\t\t},\r\n\r\n\r\n\t\t_findSib : function(node, selector, name) {\r\n\t\t\tvar t = this, f = selector;\r\n\r\n\t\t\tif (node) {\r\n\t\t\t\t// If expression make a function of it using is\r\n\t\t\t\tif (is(f, 'string')) {\r\n\t\t\t\t\tf = function(node) {\r\n\t\t\t\t\t\treturn t.is(node, selector);\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Loop all siblings\r\n\t\t\t\tfor (node = node[name]; node; node = node[name]) {\r\n\t\t\t\t\tif (f(node))\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\t_isRes : function(c) {\r\n\t\t\t// Is live resizble element\r\n\t\t\treturn /^(top|left|bottom|right|width|height)/i.test(c) || /;\\s*(top|left|bottom|right|width|height)/i.test(c);\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\twalk : function(n, f, s) {\r\n\t\t\tvar d = this.doc, w;\r\n\r\n\t\t\tif (d.createTreeWalker) {\r\n\t\t\t\tw = d.createTreeWalker(n, NodeFilter.SHOW_TEXT, null, false);\r\n\r\n\t\t\t\twhile ((n = w.nextNode()) != null)\r\n\t\t\t\t\tf.call(s || this, n);\r\n\t\t\t} else\r\n\t\t\t\ttinymce.walk(n, f, 'childNodes', s);\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\t/*\r\n\t\ttoRGB : function(s) {\r\n\t\t\tvar c = /^\\s*?#([0-9A-F]{2})([0-9A-F]{1,2})([0-9A-F]{2})?\\s*?$/.exec(s);\r\n\r\n\t\t\tif (c) {\r\n\t\t\t\t// #FFF -> #FFFFFF\r\n\t\t\t\tif (!is(c[3]))\r\n\t\t\t\t\tc[3] = c[2] = c[1];\r\n\r\n\t\t\t\treturn \"rgb(\" + parseInt(c[1], 16) + \",\" + parseInt(c[2], 16) + \",\" + parseInt(c[3], 16) + \")\";\r\n\t\t\t}\r\n\r\n\t\t\treturn s;\r\n\t\t}\r\n\t\t*/\r\n\t});\r\n\r\n\ttinymce.DOM = new tinymce.dom.DOMUtils(document, {process_html : 0});\r\n})(tinymce);\r\n\r\n(function(ns) {\r\n\t// Range constructor\r\n\tfunction Range(dom) {\r\n\t\tvar t = this,\r\n\t\t\tdoc = dom.doc,\r\n\t\t\tEXTRACT = 0,\r\n\t\t\tCLONE = 1,\r\n\t\t\tDELETE = 2,\r\n\t\t\tTRUE = true,\r\n\t\t\tFALSE = false,\r\n\t\t\tSTART_OFFSET = 'startOffset',\r\n\t\t\tSTART_CONTAINER = 'startContainer',\r\n\t\t\tEND_CONTAINER = 'endContainer',\r\n\t\t\tEND_OFFSET = 'endOffset',\r\n\t\t\textend = tinymce.extend,\r\n\t\t\tnodeIndex = dom.nodeIndex;\r\n\r\n\t\textend(t, {\r\n\t\t\t// Inital states\r\n\t\t\tstartContainer : doc,\r\n\t\t\tstartOffset : 0,\r\n\t\t\tendContainer : doc,\r\n\t\t\tendOffset : 0,\r\n\t\t\tcollapsed : TRUE,\r\n\t\t\tcommonAncestorContainer : doc,\r\n\r\n\t\t\t// Range constants\r\n\t\t\tSTART_TO_START : 0,\r\n\t\t\tSTART_TO_END : 1,\r\n\t\t\tEND_TO_END : 2,\r\n\t\t\tEND_TO_START : 3,\r\n\r\n\t\t\t// Public methods\r\n\t\t\tsetStart : setStart,\r\n\t\t\tsetEnd : setEnd,\r\n\t\t\tsetStartBefore : setStartBefore,\r\n\t\t\tsetStartAfter : setStartAfter,\r\n\t\t\tsetEndBefore : setEndBefore,\r\n\t\t\tsetEndAfter : setEndAfter,\r\n\t\t\tcollapse : collapse,\r\n\t\t\tselectNode : selectNode,\r\n\t\t\tselectNodeContents : selectNodeContents,\r\n\t\t\tcompareBoundaryPoints : compareBoundaryPoints,\r\n\t\t\tdeleteContents : deleteContents,\r\n\t\t\textractContents : extractContents,\r\n\t\t\tcloneContents : cloneContents,\r\n\t\t\tinsertNode : insertNode,\r\n\t\t\tsurroundContents : surroundContents,\r\n\t\t\tcloneRange : cloneRange\r\n\t\t});\r\n\r\n\t\tfunction setStart(n, o) {\r\n\t\t\t_setEndPoint(TRUE, n, o);\r\n\t\t};\r\n\r\n\t\tfunction setEnd(n, o) {\r\n\t\t\t_setEndPoint(FALSE, n, o);\r\n\t\t};\r\n\r\n\t\tfunction setStartBefore(n) {\r\n\t\t\tsetStart(n.parentNode, nodeIndex(n));\r\n\t\t};\r\n\r\n\t\tfunction setStartAfter(n) {\r\n\t\t\tsetStart(n.parentNode, nodeIndex(n) + 1);\r\n\t\t};\r\n\r\n\t\tfunction setEndBefore(n) {\r\n\t\t\tsetEnd(n.parentNode, nodeIndex(n));\r\n\t\t};\r\n\r\n\t\tfunction setEndAfter(n) {\r\n\t\t\tsetEnd(n.parentNode, nodeIndex(n) + 1);\r\n\t\t};\r\n\r\n\t\tfunction collapse(ts) {\r\n\t\t\tif (ts) {\r\n\t\t\t\tt[END_CONTAINER] = t[START_CONTAINER];\r\n\t\t\t\tt[END_OFFSET] = t[START_OFFSET];\r\n\t\t\t} else {\r\n\t\t\t\tt[START_CONTAINER] = t[END_CONTAINER];\r\n\t\t\t\tt[START_OFFSET] = t[END_OFFSET];\r\n\t\t\t}\r\n\r\n\t\t\tt.collapsed = TRUE;\r\n\t\t};\r\n\r\n\t\tfunction selectNode(n) {\r\n\t\t\tsetStartBefore(n);\r\n\t\t\tsetEndAfter(n);\r\n\t\t};\r\n\r\n\t\tfunction selectNodeContents(n) {\r\n\t\t\tsetStart(n, 0);\r\n\t\t\tsetEnd(n, n.nodeType === 1 ? n.childNodes.length : n.nodeValue.length);\r\n\t\t};\r\n\r\n\t\tfunction compareBoundaryPoints(h, r) {\r\n\t\t\tvar sc = t[START_CONTAINER], so = t[START_OFFSET], ec = t[END_CONTAINER], eo = t[END_OFFSET],\r\n\t\t\trsc = r.startContainer, rso = r.startOffset, rec = r.endContainer, reo = r.endOffset;\r\n\r\n\t\t\t// Check START_TO_START\r\n\t\t\tif (h === 0)\r\n\t\t\t\treturn _compareBoundaryPoints(sc, so, rsc, rso);\r\n\t\r\n\t\t\t// Check START_TO_END\r\n\t\t\tif (h === 1)\r\n\t\t\t\treturn _compareBoundaryPoints(ec, eo, rsc, rso);\r\n\t\r\n\t\t\t// Check END_TO_END\r\n\t\t\tif (h === 2)\r\n\t\t\t\treturn _compareBoundaryPoints(ec, eo, rec, reo);\r\n\t\r\n\t\t\t// Check END_TO_START\r\n\t\t\tif (h === 3) \r\n\t\t\t\treturn _compareBoundaryPoints(sc, so, rec, reo);\r\n\t\t};\r\n\r\n\t\tfunction deleteContents() {\r\n\t\t\t_traverse(DELETE);\r\n\t\t};\r\n\r\n\t\tfunction extractContents() {\r\n\t\t\treturn _traverse(EXTRACT);\r\n\t\t};\r\n\r\n\t\tfunction cloneContents() {\r\n\t\t\treturn _traverse(CLONE);\r\n\t\t};\r\n\r\n\t\tfunction insertNode(n) {\r\n\t\t\tvar startContainer = this[START_CONTAINER],\r\n\t\t\t\tstartOffset = this[START_OFFSET], nn, o;\r\n\r\n\t\t\t// Node is TEXT_NODE or CDATA\r\n\t\t\tif ((startContainer.nodeType === 3 || startContainer.nodeType === 4) && startContainer.nodeValue) {\r\n\t\t\t\tif (!startOffset) {\r\n\t\t\t\t\t// At the start of text\r\n\t\t\t\t\tstartContainer.parentNode.insertBefore(n, startContainer);\r\n\t\t\t\t} else if (startOffset >= startContainer.nodeValue.length) {\r\n\t\t\t\t\t// At the end of text\r\n\t\t\t\t\tdom.insertAfter(n, startContainer);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Middle, need to split\r\n\t\t\t\t\tnn = startContainer.splitText(startOffset);\r\n\t\t\t\t\tstartContainer.parentNode.insertBefore(n, nn);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Insert element node\r\n\t\t\t\tif (startContainer.childNodes.length > 0)\r\n\t\t\t\t\to = startContainer.childNodes[startOffset];\r\n\r\n\t\t\t\tif (o)\r\n\t\t\t\t\tstartContainer.insertBefore(n, o);\r\n\t\t\t\telse\r\n\t\t\t\t\tstartContainer.appendChild(n);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction surroundContents(n) {\r\n\t\t\tvar f = t.extractContents();\r\n\r\n\t\t\tt.insertNode(n);\r\n\t\t\tn.appendChild(f);\r\n\t\t\tt.selectNode(n);\r\n\t\t};\r\n\r\n\t\tfunction cloneRange() {\r\n\t\t\treturn extend(new Range(dom), {\r\n\t\t\t\tstartContainer : t[START_CONTAINER],\r\n\t\t\t\tstartOffset : t[START_OFFSET],\r\n\t\t\t\tendContainer : t[END_CONTAINER],\r\n\t\t\t\tendOffset : t[END_OFFSET],\r\n\t\t\t\tcollapsed : t.collapsed,\r\n\t\t\t\tcommonAncestorContainer : t.commonAncestorContainer\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Private methods\r\n\r\n\t\tfunction _getSelectedNode(container, offset) {\r\n\t\t\tvar child;\r\n\r\n\t\t\tif (container.nodeType == 3 /* TEXT_NODE */)\r\n\t\t\t\treturn container;\r\n\r\n\t\t\tif (offset < 0)\r\n\t\t\t\treturn container;\r\n\r\n\t\t\tchild = container.firstChild;\r\n\t\t\twhile (child && offset > 0) {\r\n\t\t\t\t--offset;\r\n\t\t\t\tchild = child.nextSibling;\r\n\t\t\t}\r\n\r\n\t\t\tif (child)\r\n\t\t\t\treturn child;\r\n\r\n\t\t\treturn container;\r\n\t\t};\r\n\r\n\t\tfunction _isCollapsed() {\r\n\t\t\treturn (t[START_CONTAINER] == t[END_CONTAINER] && t[START_OFFSET] == t[END_OFFSET]);\r\n\t\t};\r\n\r\n\t\tfunction _compareBoundaryPoints(containerA, offsetA, containerB, offsetB) {\r\n\t\t\tvar c, offsetC, n, cmnRoot, childA, childB;\r\n\t\t\t\r\n\t\t\t// In the first case the boundary-points have the same container. A is before B\r\n\t\t\t// if its offset is less than the offset of B, A is equal to B if its offset is\r\n\t\t\t// equal to the offset of B, and A is after B if its offset is greater than the\r\n\t\t\t// offset of B.\r\n\t\t\tif (containerA == containerB) {\r\n\t\t\t\tif (offsetA == offsetB)\r\n\t\t\t\t\treturn 0; // equal\r\n\r\n\t\t\t\tif (offsetA < offsetB)\r\n\t\t\t\t\treturn -1; // before\r\n\r\n\t\t\t\treturn 1; // after\r\n\t\t\t}\r\n\r\n\t\t\t// In the second case a child node C of the container of A is an ancestor\r\n\t\t\t// container of B. In this case, A is before B if the offset of A is less than or\r\n\t\t\t// equal to the index of the child node C and A is after B otherwise.\r\n\t\t\tc = containerB;\r\n\t\t\twhile (c && c.parentNode != containerA)\r\n\t\t\t\tc = c.parentNode;\r\n\r\n\t\t\tif (c) {\r\n\t\t\t\toffsetC = 0;\r\n\t\t\t\tn = containerA.firstChild;\r\n\r\n\t\t\t\twhile (n != c && offsetC < offsetA) {\r\n\t\t\t\t\toffsetC++;\r\n\t\t\t\t\tn = n.nextSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (offsetA <= offsetC)\r\n\t\t\t\t\treturn -1; // before\r\n\r\n\t\t\t\treturn 1; // after\r\n\t\t\t}\r\n\r\n\t\t\t// In the third case a child node C of the container of B is an ancestor container\r\n\t\t\t// of A. In this case, A is before B if the index of the child node C is less than\r\n\t\t\t// the offset of B and A is after B otherwise.\r\n\t\t\tc = containerA;\r\n\t\t\twhile (c && c.parentNode != containerB) {\r\n\t\t\t\tc = c.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tif (c) {\r\n\t\t\t\toffsetC = 0;\r\n\t\t\t\tn = containerB.firstChild;\r\n\r\n\t\t\t\twhile (n != c && offsetC < offsetB) {\r\n\t\t\t\t\toffsetC++;\r\n\t\t\t\t\tn = n.nextSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (offsetC < offsetB)\r\n\t\t\t\t\treturn -1; // before\r\n\r\n\t\t\t\treturn 1; // after\r\n\t\t\t}\r\n\r\n\t\t\t// In the fourth case, none of three other cases hold: the containers of A and B\r\n\t\t\t// are siblings or descendants of sibling nodes. In this case, A is before B if\r\n\t\t\t// the container of A is before the container of B in a pre-order traversal of the\r\n\t\t\t// Ranges' context tree and A is after B otherwise.\r\n\t\t\tcmnRoot = dom.findCommonAncestor(containerA, containerB);\r\n\t\t\tchildA = containerA;\r\n\r\n\t\t\twhile (childA && childA.parentNode != cmnRoot)\r\n\t\t\t\tchildA = childA.parentNode;\r\n\r\n\t\t\tif (!childA)\r\n\t\t\t\tchildA = cmnRoot;\r\n\r\n\t\t\tchildB = containerB;\r\n\t\t\twhile (childB && childB.parentNode != cmnRoot)\r\n\t\t\t\tchildB = childB.parentNode;\r\n\r\n\t\t\tif (!childB)\r\n\t\t\t\tchildB = cmnRoot;\r\n\r\n\t\t\tif (childA == childB)\r\n\t\t\t\treturn 0; // equal\r\n\r\n\t\t\tn = cmnRoot.firstChild;\r\n\t\t\twhile (n) {\r\n\t\t\t\tif (n == childA)\r\n\t\t\t\t\treturn -1; // before\r\n\r\n\t\t\t\tif (n == childB)\r\n\t\t\t\t\treturn 1; // after\r\n\r\n\t\t\t\tn = n.nextSibling;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction _setEndPoint(st, n, o) {\r\n\t\t\tvar ec, sc;\r\n\r\n\t\t\tif (st) {\r\n\t\t\t\tt[START_CONTAINER] = n;\r\n\t\t\t\tt[START_OFFSET] = o;\r\n\t\t\t} else {\r\n\t\t\t\tt[END_CONTAINER] = n;\r\n\t\t\t\tt[END_OFFSET] = o;\r\n\t\t\t}\r\n\r\n\t\t\t// If one boundary-point of a Range is set to have a root container\r\n\t\t\t// other than the current one for the Range, the Range is collapsed to\r\n\t\t\t// the new position. This enforces the restriction that both boundary-\r\n\t\t\t// points of a Range must have the same root container.\r\n\t\t\tec = t[END_CONTAINER];\r\n\t\t\twhile (ec.parentNode)\r\n\t\t\t\tec = ec.parentNode;\r\n\r\n\t\t\tsc = t[START_CONTAINER];\r\n\t\t\twhile (sc.parentNode)\r\n\t\t\t\tsc = sc.parentNode;\r\n\r\n\t\t\tif (sc == ec) {\r\n\t\t\t\t// The start position of a Range is guaranteed to never be after the\r\n\t\t\t\t// end position. To enforce this restriction, if the start is set to\r\n\t\t\t\t// be at a position after the end, the Range is collapsed to that\r\n\t\t\t\t// position.\r\n\t\t\t\tif (_compareBoundaryPoints(t[START_CONTAINER], t[START_OFFSET], t[END_CONTAINER], t[END_OFFSET]) > 0)\r\n\t\t\t\t\tt.collapse(st);\r\n\t\t\t} else\r\n\t\t\t\tt.collapse(st);\r\n\r\n\t\t\tt.collapsed = _isCollapsed();\r\n\t\t\tt.commonAncestorContainer = dom.findCommonAncestor(t[START_CONTAINER], t[END_CONTAINER]);\r\n\t\t};\r\n\r\n\t\tfunction _traverse(how) {\r\n\t\t\tvar c, endContainerDepth = 0, startContainerDepth = 0, p, depthDiff, startNode, endNode, sp, ep;\r\n\r\n\t\t\tif (t[START_CONTAINER] == t[END_CONTAINER])\r\n\t\t\t\treturn _traverseSameContainer(how);\r\n\r\n\t\t\tfor (c = t[END_CONTAINER], p = c.parentNode; p; c = p, p = p.parentNode) {\r\n\t\t\t\tif (p == t[START_CONTAINER])\r\n\t\t\t\t\treturn _traverseCommonStartContainer(c, how);\r\n\r\n\t\t\t\t++endContainerDepth;\r\n\t\t\t}\r\n\r\n\t\t\tfor (c = t[START_CONTAINER], p = c.parentNode; p; c = p, p = p.parentNode) {\r\n\t\t\t\tif (p == t[END_CONTAINER])\r\n\t\t\t\t\treturn _traverseCommonEndContainer(c, how);\r\n\r\n\t\t\t\t++startContainerDepth;\r\n\t\t\t}\r\n\r\n\t\t\tdepthDiff = startContainerDepth - endContainerDepth;\r\n\r\n\t\t\tstartNode = t[START_CONTAINER];\r\n\t\t\twhile (depthDiff > 0) {\r\n\t\t\t\tstartNode = startNode.parentNode;\r\n\t\t\t\tdepthDiff--;\r\n\t\t\t}\r\n\r\n\t\t\tendNode = t[END_CONTAINER];\r\n\t\t\twhile (depthDiff < 0) {\r\n\t\t\t\tendNode = endNode.parentNode;\r\n\t\t\t\tdepthDiff++;\r\n\t\t\t}\r\n\r\n\t\t\t// ascend the ancestor hierarchy until we have a common parent.\r\n\t\t\tfor (sp = startNode.parentNode, ep = endNode.parentNode; sp != ep; sp = sp.parentNode, ep = ep.parentNode) {\r\n\t\t\t\tstartNode = sp;\r\n\t\t\t\tendNode = ep;\r\n\t\t\t}\r\n\r\n\t\t\treturn _traverseCommonAncestors(startNode, endNode, how);\r\n\t\t};\r\n\r\n\t\t function _traverseSameContainer(how) {\r\n\t\t\tvar frag, s, sub, n, cnt, sibling, xferNode;\r\n\r\n\t\t\tif (how != DELETE)\r\n\t\t\t\tfrag = doc.createDocumentFragment();\r\n\r\n\t\t\t// If selection is empty, just return the fragment\r\n\t\t\tif (t[START_OFFSET] == t[END_OFFSET])\r\n\t\t\t\treturn frag;\r\n\r\n\t\t\t// Text node needs special case handling\r\n\t\t\tif (t[START_CONTAINER].nodeType == 3 /* TEXT_NODE */) {\r\n\t\t\t\t// get the substring\r\n\t\t\t\ts = t[START_CONTAINER].nodeValue;\r\n\t\t\t\tsub = s.substring(t[START_OFFSET], t[END_OFFSET]);\r\n\r\n\t\t\t\t// set the original text node to its new value\r\n\t\t\t\tif (how != CLONE) {\r\n\t\t\t\t\tt[START_CONTAINER].deleteData(t[START_OFFSET], t[END_OFFSET] - t[START_OFFSET]);\r\n\r\n\t\t\t\t\t// Nothing is partially selected, so collapse to start point\r\n\t\t\t\t\tt.collapse(TRUE);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (how == DELETE)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tfrag.appendChild(doc.createTextNode(sub));\r\n\t\t\t\treturn frag;\r\n\t\t\t}\r\n\r\n\t\t\t// Copy nodes between the start/end offsets.\r\n\t\t\tn = _getSelectedNode(t[START_CONTAINER], t[START_OFFSET]);\r\n\t\t\tcnt = t[END_OFFSET] - t[START_OFFSET];\r\n\r\n\t\t\twhile (cnt > 0) {\r\n\t\t\t\tsibling = n.nextSibling;\r\n\t\t\t\txferNode = _traverseFullySelected(n, how);\r\n\r\n\t\t\t\tif (frag)\r\n\t\t\t\t\tfrag.appendChild( xferNode );\r\n\r\n\t\t\t\t--cnt;\r\n\t\t\t\tn = sibling;\r\n\t\t\t}\r\n\r\n\t\t\t// Nothing is partially selected, so collapse to start point\r\n\t\t\tif (how != CLONE)\r\n\t\t\t\tt.collapse(TRUE);\r\n\r\n\t\t\treturn frag;\r\n\t\t};\r\n\r\n\t\tfunction _traverseCommonStartContainer(endAncestor, how) {\r\n\t\t\tvar frag, n, endIdx, cnt, sibling, xferNode;\r\n\r\n\t\t\tif (how != DELETE)\r\n\t\t\t\tfrag = doc.createDocumentFragment();\r\n\r\n\t\t\tn = _traverseRightBoundary(endAncestor, how);\r\n\r\n\t\t\tif (frag)\r\n\t\t\t\tfrag.appendChild(n);\r\n\r\n\t\t\tendIdx = nodeIndex(endAncestor);\r\n\t\t\tcnt = endIdx - t[START_OFFSET];\r\n\r\n\t\t\tif (cnt <= 0) {\r\n\t\t\t\t// Collapse to just before the endAncestor, which\r\n\t\t\t\t// is partially selected.\r\n\t\t\t\tif (how != CLONE) {\r\n\t\t\t\t\tt.setEndBefore(endAncestor);\r\n\t\t\t\t\tt.collapse(FALSE);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn frag;\r\n\t\t\t}\r\n\r\n\t\t\tn = endAncestor.previousSibling;\r\n\t\t\twhile (cnt > 0) {\r\n\t\t\t\tsibling = n.previousSibling;\r\n\t\t\t\txferNode = _traverseFullySelected(n, how);\r\n\r\n\t\t\t\tif (frag)\r\n\t\t\t\t\tfrag.insertBefore(xferNode, frag.firstChild);\r\n\r\n\t\t\t\t--cnt;\r\n\t\t\t\tn = sibling;\r\n\t\t\t}\r\n\r\n\t\t\t// Collapse to just before the endAncestor, which\r\n\t\t\t// is partially selected.\r\n\t\t\tif (how != CLONE) {\r\n\t\t\t\tt.setEndBefore(endAncestor);\r\n\t\t\t\tt.collapse(FALSE);\r\n\t\t\t}\r\n\r\n\t\t\treturn frag;\r\n\t\t};\r\n\r\n\t\tfunction _traverseCommonEndContainer(startAncestor, how) {\r\n\t\t\tvar frag, startIdx, n, cnt, sibling, xferNode;\r\n\r\n\t\t\tif (how != DELETE)\r\n\t\t\t\tfrag = doc.createDocumentFragment();\r\n\r\n\t\t\tn = _traverseLeftBoundary(startAncestor, how);\r\n\t\t\tif (frag)\r\n\t\t\t\tfrag.appendChild(n);\r\n\r\n\t\t\tstartIdx = nodeIndex(startAncestor);\r\n\t\t\t++startIdx; // Because we already traversed it\r\n\r\n\t\t\tcnt = t[END_OFFSET] - startIdx;\r\n\t\t\tn = startAncestor.nextSibling;\r\n\t\t\twhile (cnt > 0) {\r\n\t\t\t\tsibling = n.nextSibling;\r\n\t\t\t\txferNode = _traverseFullySelected(n, how);\r\n\r\n\t\t\t\tif (frag)\r\n\t\t\t\t\tfrag.appendChild(xferNode);\r\n\r\n\t\t\t\t--cnt;\r\n\t\t\t\tn = sibling;\r\n\t\t\t}\r\n\r\n\t\t\tif (how != CLONE) {\r\n\t\t\t\tt.setStartAfter(startAncestor);\r\n\t\t\t\tt.collapse(TRUE);\r\n\t\t\t}\r\n\r\n\t\t\treturn frag;\r\n\t\t};\r\n\r\n\t\tfunction _traverseCommonAncestors(startAncestor, endAncestor, how) {\r\n\t\t\tvar n, frag, commonParent, startOffset, endOffset, cnt, sibling, nextSibling;\r\n\r\n\t\t\tif (how != DELETE)\r\n\t\t\t\tfrag = doc.createDocumentFragment();\r\n\r\n\t\t\tn = _traverseLeftBoundary(startAncestor, how);\r\n\t\t\tif (frag)\r\n\t\t\t\tfrag.appendChild(n);\r\n\r\n\t\t\tcommonParent = startAncestor.parentNode;\r\n\t\t\tstartOffset = nodeIndex(startAncestor);\r\n\t\t\tendOffset = nodeIndex(endAncestor);\r\n\t\t\t++startOffset;\r\n\r\n\t\t\tcnt = endOffset - startOffset;\r\n\t\t\tsibling = startAncestor.nextSibling;\r\n\r\n\t\t\twhile (cnt > 0) {\r\n\t\t\t\tnextSibling = sibling.nextSibling;\r\n\t\t\t\tn = _traverseFullySelected(sibling, how);\r\n\r\n\t\t\t\tif (frag)\r\n\t\t\t\t\tfrag.appendChild(n);\r\n\r\n\t\t\t\tsibling = nextSibling;\r\n\t\t\t\t--cnt;\r\n\t\t\t}\r\n\r\n\t\t\tn = _traverseRightBoundary(endAncestor, how);\r\n\r\n\t\t\tif (frag)\r\n\t\t\t\tfrag.appendChild(n);\r\n\r\n\t\t\tif (how != CLONE) {\r\n\t\t\t\tt.setStartAfter(startAncestor);\r\n\t\t\t\tt.collapse(TRUE);\r\n\t\t\t}\r\n\r\n\t\t\treturn frag;\r\n\t\t};\r\n\r\n\t\tfunction _traverseRightBoundary(root, how) {\r\n\t\t\tvar next = _getSelectedNode(t[END_CONTAINER], t[END_OFFSET] - 1), parent, clonedParent, prevSibling, clonedChild, clonedGrandParent, isFullySelected = next != t[END_CONTAINER];\r\n\r\n\t\t\tif (next == root)\r\n\t\t\t\treturn _traverseNode(next, isFullySelected, FALSE, how);\r\n\r\n\t\t\tparent = next.parentNode;\r\n\t\t\tclonedParent = _traverseNode(parent, FALSE, FALSE, how);\r\n\r\n\t\t\twhile (parent) {\r\n\t\t\t\twhile (next) {\r\n\t\t\t\t\tprevSibling = next.previousSibling;\r\n\t\t\t\t\tclonedChild = _traverseNode(next, isFullySelected, FALSE, how);\r\n\r\n\t\t\t\t\tif (how != DELETE)\r\n\t\t\t\t\t\tclonedParent.insertBefore(clonedChild, clonedParent.firstChild);\r\n\r\n\t\t\t\t\tisFullySelected = TRUE;\r\n\t\t\t\t\tnext = prevSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (parent == root)\r\n\t\t\t\t\treturn clonedParent;\r\n\r\n\t\t\t\tnext = parent.previousSibling;\r\n\t\t\t\tparent = parent.parentNode;\r\n\r\n\t\t\t\tclonedGrandParent = _traverseNode(parent, FALSE, FALSE, how);\r\n\r\n\t\t\t\tif (how != DELETE)\r\n\t\t\t\t\tclonedGrandParent.appendChild(clonedParent);\r\n\r\n\t\t\t\tclonedParent = clonedGrandParent;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction _traverseLeftBoundary(root, how) {\r\n\t\t\tvar next = _getSelectedNode(t[START_CONTAINER], t[START_OFFSET]), isFullySelected = next != t[START_CONTAINER], parent, clonedParent, nextSibling, clonedChild, clonedGrandParent;\r\n\r\n\t\t\tif (next == root)\r\n\t\t\t\treturn _traverseNode(next, isFullySelected, TRUE, how);\r\n\r\n\t\t\tparent = next.parentNode;\r\n\t\t\tclonedParent = _traverseNode(parent, FALSE, TRUE, how);\r\n\r\n\t\t\twhile (parent) {\r\n\t\t\t\twhile (next) {\r\n\t\t\t\t\tnextSibling = next.nextSibling;\r\n\t\t\t\t\tclonedChild = _traverseNode(next, isFullySelected, TRUE, how);\r\n\r\n\t\t\t\t\tif (how != DELETE)\r\n\t\t\t\t\t\tclonedParent.appendChild(clonedChild);\r\n\r\n\t\t\t\t\tisFullySelected = TRUE;\r\n\t\t\t\t\tnext = nextSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (parent == root)\r\n\t\t\t\t\treturn clonedParent;\r\n\r\n\t\t\t\tnext = parent.nextSibling;\r\n\t\t\t\tparent = parent.parentNode;\r\n\r\n\t\t\t\tclonedGrandParent = _traverseNode(parent, FALSE, TRUE, how);\r\n\r\n\t\t\t\tif (how != DELETE)\r\n\t\t\t\t\tclonedGrandParent.appendChild(clonedParent);\r\n\r\n\t\t\t\tclonedParent = clonedGrandParent;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction _traverseNode(n, isFullySelected, isLeft, how) {\r\n\t\t\tvar txtValue, newNodeValue, oldNodeValue, offset, newNode;\r\n\r\n\t\t\tif (isFullySelected)\r\n\t\t\t\treturn _traverseFullySelected(n, how);\r\n\r\n\t\t\tif (n.nodeType == 3 /* TEXT_NODE */) {\r\n\t\t\t\ttxtValue = n.nodeValue;\r\n\r\n\t\t\t\tif (isLeft) {\r\n\t\t\t\t\toffset = t[START_OFFSET];\r\n\t\t\t\t\tnewNodeValue = txtValue.substring(offset);\r\n\t\t\t\t\toldNodeValue = txtValue.substring(0, offset);\r\n\t\t\t\t} else {\r\n\t\t\t\t\toffset = t[END_OFFSET];\r\n\t\t\t\t\tnewNodeValue = txtValue.substring(0, offset);\r\n\t\t\t\t\toldNodeValue = txtValue.substring(offset);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (how != CLONE)\r\n\t\t\t\t\tn.nodeValue = oldNodeValue;\r\n\r\n\t\t\t\tif (how == DELETE)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tnewNode = n.cloneNode(FALSE);\r\n\t\t\t\tnewNode.nodeValue = newNodeValue;\r\n\r\n\t\t\t\treturn newNode;\r\n\t\t\t}\r\n\r\n\t\t\tif (how == DELETE)\r\n\t\t\t\treturn;\r\n\r\n\t\t\treturn n.cloneNode(FALSE);\r\n\t\t};\r\n\r\n\t\tfunction _traverseFullySelected(n, how) {\r\n\t\t\tif (how != DELETE)\r\n\t\t\t\treturn how == CLONE ? n.cloneNode(TRUE) : n;\r\n\r\n\t\t\tn.parentNode.removeChild(n);\r\n\t\t};\r\n\t};\r\n\r\n\tns.Range = Range;\r\n})(tinymce.dom);\r\n\r\n(function() {\r\n\tfunction Selection(selection) {\r\n\t\tvar self = this, dom = selection.dom, TRUE = true, FALSE = false;\r\n\r\n\t\tfunction getPosition(rng, start) {\r\n\t\t\tvar checkRng, startIndex = 0, endIndex, inside,\r\n\t\t\t\tchildren, child, offset, index, position = -1, parent;\r\n\r\n\t\t\t// Setup test range, collapse it and get the parent\r\n\t\t\tcheckRng = rng.duplicate();\r\n\t\t\tcheckRng.collapse(start);\r\n\t\t\tparent = checkRng.parentElement();\r\n\r\n\t\t\t// Check if the selection is within the right document\r\n\t\t\tif (parent.ownerDocument !== selection.dom.doc)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// IE will report non editable elements as it's parent so look for an editable one\r\n\t\t\twhile (parent.contentEditable === \"false\") {\r\n\t\t\t\tparent = parent.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\t// If parent doesn't have any children then return that we are inside the element\r\n\t\t\tif (!parent.hasChildNodes()) {\r\n\t\t\t\treturn {node : parent, inside : 1};\r\n\t\t\t}\r\n\r\n\t\t\t// Setup node list and endIndex\r\n\t\t\tchildren = parent.children;\r\n\t\t\tendIndex = children.length - 1;\r\n\r\n\t\t\t// Perform a binary search for the position\r\n\t\t\twhile (startIndex <= endIndex) {\r\n\t\t\t\tindex = Math.floor((startIndex + endIndex) / 2);\r\n\r\n\t\t\t\t// Move selection to node and compare the ranges\r\n\t\t\t\tchild = children[index];\r\n\t\t\t\tcheckRng.moveToElementText(child);\r\n\t\t\t\tposition = checkRng.compareEndPoints(start ? 'StartToStart' : 'EndToEnd', rng);\r\n\r\n\t\t\t\t// Before/after or an exact match\r\n\t\t\t\tif (position > 0) {\r\n\t\t\t\t\tendIndex = index - 1;\r\n\t\t\t\t} else if (position < 0) {\r\n\t\t\t\t\tstartIndex = index + 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn {node : child};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Check if child position is before or we didn't find a position\r\n\t\t\tif (position < 0) {\r\n\t\t\t\t// No element child was found use the parent element and the offset inside that\r\n\t\t\t\tif (!child) {\r\n\t\t\t\t\tcheckRng.moveToElementText(parent);\r\n\t\t\t\t\tcheckRng.collapse(true);\r\n\t\t\t\t\tchild = parent;\r\n\t\t\t\t\tinside = true;\r\n\t\t\t\t} else\r\n\t\t\t\t\tcheckRng.collapse(false);\r\n\r\n\t\t\t\tcheckRng.setEndPoint(start ? 'EndToStart' : 'EndToEnd', rng);\r\n\r\n\t\t\t\t// Fix for edge case: <div style=\"width: 100px; height:100px;\"><table>..</table>ab|c</div>\r\n\t\t\t\tif (checkRng.compareEndPoints(start ? 'StartToStart' : 'StartToEnd', rng) > 0) {\r\n\t\t\t\t\tcheckRng = rng.duplicate();\r\n\t\t\t\t\tcheckRng.collapse(start);\r\n\r\n\t\t\t\t\toffset = -1;\r\n\t\t\t\t\twhile (parent == checkRng.parentElement()) {\r\n\t\t\t\t\t\tif (checkRng.move('character', -1) == 0)\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\toffset++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\toffset = offset || checkRng.text.replace('\\r\\n', ' ').length;\r\n\t\t\t} else {\r\n\t\t\t\t// Child position is after the selection endpoint\r\n\t\t\t\tcheckRng.collapse(true);\r\n\t\t\t\tcheckRng.setEndPoint(start ? 'StartToStart' : 'StartToEnd', rng);\r\n\r\n\t\t\t\t// Get the length of the text to find where the endpoint is relative to it's container\r\n\t\t\t\toffset = checkRng.text.replace('\\r\\n', ' ').length;\r\n\t\t\t}\r\n\r\n\t\t\treturn {node : child, position : position, offset : offset, inside : inside};\r\n\t\t};\r\n\r\n\t\t// Returns a W3C DOM compatible range object by using the IE Range API\r\n\t\tfunction getRange() {\r\n\t\t\tvar ieRange = selection.getRng(), domRange = dom.createRng(), element, collapsed, tmpRange, element2, bookmark, fail;\r\n\r\n\t\t\t// If selection is outside the current document just return an empty range\r\n\t\t\telement = ieRange.item ? ieRange.item(0) : ieRange.parentElement();\r\n\t\t\tif (element.ownerDocument != dom.doc)\r\n\t\t\t\treturn domRange;\r\n\r\n\t\t\tcollapsed = selection.isCollapsed();\r\n\r\n\t\t\t// Handle control selection\r\n\t\t\tif (ieRange.item) {\r\n\t\t\t\tdomRange.setStart(element.parentNode, dom.nodeIndex(element));\r\n\t\t\t\tdomRange.setEnd(domRange.startContainer, domRange.startOffset + 1);\r\n\r\n\t\t\t\treturn domRange;\r\n\t\t\t}\r\n\r\n\t\t\tfunction findEndPoint(start) {\r\n\t\t\t\tvar endPoint = getPosition(ieRange, start), container, offset, textNodeOffset = 0, sibling, undef, nodeValue;\r\n\r\n\t\t\t\tcontainer = endPoint.node;\r\n\t\t\t\toffset = endPoint.offset;\r\n\r\n\t\t\t\tif (endPoint.inside && !container.hasChildNodes()) {\r\n\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](container, 0);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (offset === undef) {\r\n\t\t\t\t\tdomRange[start ? 'setStartBefore' : 'setEndAfter'](container);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (endPoint.position < 0) {\r\n\t\t\t\t\tsibling = endPoint.inside ? container.firstChild : container.nextSibling;\r\n\r\n\t\t\t\t\tif (!sibling) {\r\n\t\t\t\t\t\tdomRange[start ? 'setStartAfter' : 'setEndAfter'](container);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!offset) {\r\n\t\t\t\t\t\tif (sibling.nodeType == 3)\r\n\t\t\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](sibling, 0);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tdomRange[start ? 'setStartBefore' : 'setEndBefore'](sibling);\r\n\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Find the text node and offset\r\n\t\t\t\t\twhile (sibling) {\r\n\t\t\t\t\t\tnodeValue = sibling.nodeValue;\r\n\t\t\t\t\t\ttextNodeOffset += nodeValue.length;\r\n\r\n\t\t\t\t\t\t// We are at or passed the position we where looking for\r\n\t\t\t\t\t\tif (textNodeOffset >= offset) {\r\n\t\t\t\t\t\t\tcontainer = sibling;\r\n\t\t\t\t\t\t\ttextNodeOffset -= offset;\r\n\t\t\t\t\t\t\ttextNodeOffset = nodeValue.length - textNodeOffset;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tsibling = sibling.nextSibling;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Find the text node and offset\r\n\t\t\t\t\tsibling = container.previousSibling;\r\n\r\n\t\t\t\t\tif (!sibling)\r\n\t\t\t\t\t\treturn domRange[start ? 'setStartBefore' : 'setEndBefore'](container);\r\n\r\n\t\t\t\t\t// If there isn't any text to loop then use the first position\r\n\t\t\t\t\tif (!offset) {\r\n\t\t\t\t\t\tif (container.nodeType == 3)\r\n\t\t\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](sibling, container.nodeValue.length);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tdomRange[start ? 'setStartAfter' : 'setEndAfter'](sibling);\r\n\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twhile (sibling) {\r\n\t\t\t\t\t\ttextNodeOffset += sibling.nodeValue.length;\r\n\r\n\t\t\t\t\t\t// We are at or passed the position we where looking for\r\n\t\t\t\t\t\tif (textNodeOffset >= offset) {\r\n\t\t\t\t\t\t\tcontainer = sibling;\r\n\t\t\t\t\t\t\ttextNodeOffset -= offset;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tsibling = sibling.previousSibling;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](container, textNodeOffset);\r\n\t\t\t};\r\n\r\n\t\t\ttry {\r\n\t\t\t\t// Find start point\r\n\t\t\t\tfindEndPoint(true);\r\n\r\n\t\t\t\t// Find end point if needed\r\n\t\t\t\tif (!collapsed)\r\n\t\t\t\t\tfindEndPoint();\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// IE has a nasty bug where text nodes might throw \"invalid argument\" when you\r\n\t\t\t\t// access the nodeValue or other properties of text nodes. This seems to happend when\r\n\t\t\t\t// text nodes are split into two nodes by a delete/backspace call. So lets detect it and try to fix it.\r\n\t\t\t\tif (ex.number == -2147024809) {\r\n\t\t\t\t\t// Get the current selection\r\n\t\t\t\t\tbookmark = self.getBookmark(2);\r\n\r\n\t\t\t\t\t// Get start element\r\n\t\t\t\t\ttmpRange = ieRange.duplicate();\r\n\t\t\t\t\ttmpRange.collapse(true);\r\n\t\t\t\t\telement = tmpRange.parentElement();\r\n\r\n\t\t\t\t\t// Get end element\r\n\t\t\t\t\tif (!collapsed) {\r\n\t\t\t\t\t\ttmpRange = ieRange.duplicate();\r\n\t\t\t\t\t\ttmpRange.collapse(false);\r\n\t\t\t\t\t\telement2 = tmpRange.parentElement();\r\n\t\t\t\t\t\telement2.innerHTML = element2.innerHTML;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Remove the broken elements\r\n\t\t\t\t\telement.innerHTML = element.innerHTML;\r\n\r\n\t\t\t\t\t// Restore the selection\r\n\t\t\t\t\tself.moveToBookmark(bookmark);\r\n\r\n\t\t\t\t\t// Since the range has moved we need to re-get it\r\n\t\t\t\t\tieRange = selection.getRng();\r\n\r\n\t\t\t\t\t// Find start point\r\n\t\t\t\t\tfindEndPoint(true);\r\n\r\n\t\t\t\t\t// Find end point if needed\r\n\t\t\t\t\tif (!collapsed)\r\n\t\t\t\t\t\tfindEndPoint();\r\n\t\t\t\t} else\r\n\t\t\t\t\tthrow ex; // Throw other errors\r\n\t\t\t}\r\n\r\n\t\t\treturn domRange;\r\n\t\t};\r\n\r\n\t\tthis.getBookmark = function(type) {\r\n\t\t\tvar rng = selection.getRng(), start, end, bookmark = {};\r\n\r\n\t\t\tfunction getIndexes(node) {\r\n\t\t\t\tvar node, parent, root, children, i, indexes = [];\r\n\r\n\t\t\t\tparent = node.parentNode;\r\n\t\t\t\troot = dom.getRoot().parentNode;\r\n\r\n\t\t\t\twhile (parent != root && parent.nodeType !== 9) {\r\n\t\t\t\t\tchildren = parent.children;\r\n\r\n\t\t\t\t\ti = children.length;\r\n\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\tif (node === children[i]) {\r\n\t\t\t\t\t\t\tindexes.push(i);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode = parent;\r\n\t\t\t\t\tparent = parent.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn indexes;\r\n\t\t\t};\r\n\r\n\t\t\tfunction getBookmarkEndPoint(start) {\r\n\t\t\t\tvar position;\r\n\r\n\t\t\t\tposition = getPosition(rng, start);\r\n\t\t\t\tif (position) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tposition : position.position,\r\n\t\t\t\t\t\toffset : position.offset,\r\n\t\t\t\t\t\tindexes : getIndexes(position.node),\r\n\t\t\t\t\t\tinside : position.inside\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// Non ubstructive bookmark\r\n\t\t\tif (type === 2) {\r\n\t\t\t\t// Handle text selection\r\n\t\t\t\tif (!rng.item) {\r\n\t\t\t\t\tbookmark.start = getBookmarkEndPoint(true);\r\n\r\n\t\t\t\t\tif (!selection.isCollapsed())\r\n\t\t\t\t\t\tbookmark.end = getBookmarkEndPoint();\r\n\t\t\t\t} else\r\n\t\t\t\t\tbookmark.start = {ctrl : true, indexes : getIndexes(rng.item(0))};\r\n\t\t\t}\r\n\r\n\t\t\treturn bookmark;\r\n\t\t};\r\n\r\n\t\tthis.moveToBookmark = function(bookmark) {\r\n\t\t\tvar rng, body = dom.doc.body;\r\n\r\n\t\t\tfunction resolveIndexes(indexes) {\r\n\t\t\t\tvar node, i, idx, children;\r\n\r\n\t\t\t\tnode = dom.getRoot();\r\n\t\t\t\tfor (i = indexes.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tchildren = node.children;\r\n\t\t\t\t\tidx = indexes[i];\r\n\r\n\t\t\t\t\tif (idx <= children.length - 1) {\r\n\t\t\t\t\t\tnode = children[idx];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node;\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tfunction setBookmarkEndPoint(start) {\r\n\t\t\t\tvar endPoint = bookmark[start ? 'start' : 'end'], moveLeft, moveRng, undef;\r\n\r\n\t\t\t\tif (endPoint) {\r\n\t\t\t\t\tmoveLeft = endPoint.position > 0;\r\n\r\n\t\t\t\t\tmoveRng = body.createTextRange();\r\n\t\t\t\t\tmoveRng.moveToElementText(resolveIndexes(endPoint.indexes));\r\n\r\n\t\t\t\t\toffset = endPoint.offset;\r\n\t\t\t\t\tif (offset !== undef) {\r\n\t\t\t\t\t\tmoveRng.collapse(endPoint.inside || moveLeft);\r\n\t\t\t\t\t\tmoveRng.moveStart('character', moveLeft ? -offset : offset);\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tmoveRng.collapse(start);\r\n\r\n\t\t\t\t\trng.setEndPoint(start ? 'StartToStart' : 'EndToStart', moveRng);\r\n\r\n\t\t\t\t\tif (start)\r\n\t\t\t\t\t\trng.collapse(true);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif (bookmark.start) {\r\n\t\t\t\tif (bookmark.start.ctrl) {\r\n\t\t\t\t\trng = body.createControlRange();\r\n\t\t\t\t\trng.addElement(resolveIndexes(bookmark.start.indexes));\r\n\t\t\t\t\trng.select();\r\n\t\t\t\t} else {\r\n\t\t\t\t\trng = body.createTextRange();\r\n\t\t\t\t\tsetBookmarkEndPoint(true);\r\n\t\t\t\t\tsetBookmarkEndPoint();\r\n\t\t\t\t\trng.select();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.addRange = function(rng) {\r\n\t\t\tvar ieRng, ctrlRng, startContainer, startOffset, endContainer, endOffset, doc = selection.dom.doc, body = doc.body;\r\n\r\n\t\t\tfunction setEndPoint(start) {\r\n\t\t\t\tvar container, offset, marker, tmpRng, nodes;\r\n\r\n\t\t\t\tmarker = dom.create('a');\r\n\t\t\t\tcontainer = start ? startContainer : endContainer;\r\n\t\t\t\toffset = start ? startOffset : endOffset;\r\n\t\t\t\ttmpRng = ieRng.duplicate();\r\n\r\n\t\t\t\tif (container == doc || container == doc.documentElement) {\r\n\t\t\t\t\tcontainer = body;\r\n\t\t\t\t\toffset = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (container.nodeType == 3) {\r\n\t\t\t\t\tcontainer.parentNode.insertBefore(marker, container);\r\n\t\t\t\t\ttmpRng.moveToElementText(marker);\r\n\t\t\t\t\ttmpRng.moveStart('character', offset);\r\n\t\t\t\t\tdom.remove(marker);\r\n\t\t\t\t\tieRng.setEndPoint(start ? 'StartToStart' : 'EndToEnd', tmpRng);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnodes = container.childNodes;\r\n\r\n\t\t\t\t\tif (nodes.length) {\r\n\t\t\t\t\t\tif (offset >= nodes.length) {\r\n\t\t\t\t\t\t\tdom.insertAfter(marker, nodes[nodes.length - 1]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcontainer.insertBefore(marker, nodes[offset]);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttmpRng.moveToElementText(marker);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Empty node selection for example <div>|</div>\r\n\t\t\t\t\t\tmarker = doc.createTextNode('\\uFEFF');\r\n\t\t\t\t\t\tcontainer.appendChild(marker);\r\n\t\t\t\t\t\ttmpRng.moveToElementText(marker.parentNode);\r\n\t\t\t\t\t\ttmpRng.collapse(TRUE);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tieRng.setEndPoint(start ? 'StartToStart' : 'EndToEnd', tmpRng);\r\n\t\t\t\t\tdom.remove(marker);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Setup some shorter versions\r\n\t\t\tstartContainer = rng.startContainer;\r\n\t\t\tstartOffset = rng.startOffset;\r\n\t\t\tendContainer = rng.endContainer;\r\n\t\t\tendOffset = rng.endOffset;\r\n\t\t\tieRng = body.createTextRange();\r\n\r\n\t\t\t// If single element selection then try making a control selection out of it\r\n\t\t\tif (startContainer == endContainer && startContainer.nodeType == 1 && startOffset == endOffset - 1) {\r\n\t\t\t\tif (startOffset == endOffset - 1) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tctrlRng = body.createControlRange();\r\n\t\t\t\t\t\tctrlRng.addElement(startContainer.childNodes[startOffset]);\r\n\t\t\t\t\t\tctrlRng.select();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// Ignore\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Set start/end point of selection\r\n\t\t\tsetEndPoint(true);\r\n\t\t\tsetEndPoint();\r\n\r\n\t\t\t// Select the new range and scroll it into view\r\n\t\t\tieRng.select();\r\n\t\t};\r\n\r\n\t\t// Expose range method\r\n\t\tthis.getRangeAt = getRange;\r\n\t};\r\n\r\n\t// Expose the selection object\r\n\ttinymce.dom.TridentSelection = Selection;\r\n})();\r\n\r\n\r\n/*\r\n * Sizzle CSS Selector Engine - v1.0\r\n *  Copyright 2009, The Dojo Foundation\r\n *  Released under the MIT, BSD, and GPL Licenses.\r\n *  More information: http://sizzlejs.com/\r\n */\r\n(function(){\r\n\r\nvar chunker = /((?:\\((?:\\([^()]+\\)|[^()]+)+\\)|\\[(?:\\[[^\\[\\]]*\\]|['\"][^'\"]*['\"]|[^\\[\\]'\"]+)+\\]|\\\\.|[^ >+~,(\\[\\\\]+)+|[>+~])(\\s*,\\s*)?((?:.|\\r|\\n)*)/g,\r\n\tdone = 0,\r\n\ttoString = Object.prototype.toString,\r\n\thasDuplicate = false,\r\n\tbaseHasDuplicate = true;\r\n\r\n// Here we check if the JavaScript engine is using some sort of\r\n// optimization where it does not always call our comparision\r\n// function. If that is the case, discard the hasDuplicate value.\r\n//   Thus far that includes Google Chrome.\r\n[0, 0].sort(function(){\r\n\tbaseHasDuplicate = false;\r\n\treturn 0;\r\n});\r\n\r\nvar Sizzle = function(selector, context, results, seed) {\r\n\tresults = results || [];\r\n\tcontext = context || document;\r\n\r\n\tvar origContext = context;\r\n\r\n\tif ( context.nodeType !== 1 && context.nodeType !== 9 ) {\r\n\t\treturn [];\r\n\t}\r\n\t\r\n\tif ( !selector || typeof selector !== \"string\" ) {\r\n\t\treturn results;\r\n\t}\r\n\r\n\tvar parts = [], m, set, checkSet, extra, prune = true, contextXML = Sizzle.isXML(context),\r\n\t\tsoFar = selector, ret, cur, pop, i;\r\n\t\r\n\t// Reset the position of the chunker regexp (start from head)\r\n\tdo {\r\n\t\tchunker.exec(\"\");\r\n\t\tm = chunker.exec(soFar);\r\n\r\n\t\tif ( m ) {\r\n\t\t\tsoFar = m[3];\r\n\t\t\r\n\t\t\tparts.push( m[1] );\r\n\t\t\r\n\t\t\tif ( m[2] ) {\r\n\t\t\t\textra = m[3];\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t} while ( m );\r\n\r\n\tif ( parts.length > 1 && origPOS.exec( selector ) ) {\r\n\t\tif ( parts.length === 2 && Expr.relative[ parts[0] ] ) {\r\n\t\t\tset = posProcess( parts[0] + parts[1], context );\r\n\t\t} else {\r\n\t\t\tset = Expr.relative[ parts[0] ] ?\r\n\t\t\t\t[ context ] :\r\n\t\t\t\tSizzle( parts.shift(), context );\r\n\r\n\t\t\twhile ( parts.length ) {\r\n\t\t\t\tselector = parts.shift();\r\n\r\n\t\t\t\tif ( Expr.relative[ selector ] ) {\r\n\t\t\t\t\tselector += parts.shift();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tset = posProcess( selector, set );\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\t// Take a shortcut and set the context if the root selector is an ID\r\n\t\t// (but not if it'll be faster if the inner selector is an ID)\r\n\t\tif ( !seed && parts.length > 1 && context.nodeType === 9 && !contextXML &&\r\n\t\t\t\tExpr.match.ID.test(parts[0]) && !Expr.match.ID.test(parts[parts.length - 1]) ) {\r\n\t\t\tret = Sizzle.find( parts.shift(), context, contextXML );\r\n\t\t\tcontext = ret.expr ? Sizzle.filter( ret.expr, ret.set )[0] : ret.set[0];\r\n\t\t}\r\n\r\n\t\tif ( context ) {\r\n\t\t\tret = seed ?\r\n\t\t\t\t{ expr: parts.pop(), set: makeArray(seed) } :\r\n\t\t\t\tSizzle.find( parts.pop(), parts.length === 1 && (parts[0] === \"~\" || parts[0] === \"+\") && context.parentNode ? context.parentNode : context, contextXML );\r\n\t\t\tset = ret.expr ? Sizzle.filter( ret.expr, ret.set ) : ret.set;\r\n\r\n\t\t\tif ( parts.length > 0 ) {\r\n\t\t\t\tcheckSet = makeArray(set);\r\n\t\t\t} else {\r\n\t\t\t\tprune = false;\r\n\t\t\t}\r\n\r\n\t\t\twhile ( parts.length ) {\r\n\t\t\t\tcur = parts.pop();\r\n\t\t\t\tpop = cur;\r\n\r\n\t\t\t\tif ( !Expr.relative[ cur ] ) {\r\n\t\t\t\t\tcur = \"\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpop = parts.pop();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( pop == null ) {\r\n\t\t\t\t\tpop = context;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tExpr.relative[ cur ]( checkSet, pop, contextXML );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcheckSet = parts = [];\r\n\t\t}\r\n\t}\r\n\r\n\tif ( !checkSet ) {\r\n\t\tcheckSet = set;\r\n\t}\r\n\r\n\tif ( !checkSet ) {\r\n\t\tSizzle.error( cur || selector );\r\n\t}\r\n\r\n\tif ( toString.call(checkSet) === \"[object Array]\" ) {\r\n\t\tif ( !prune ) {\r\n\t\t\tresults.push.apply( results, checkSet );\r\n\t\t} else if ( context && context.nodeType === 1 ) {\r\n\t\t\tfor ( i = 0; checkSet[i] != null; i++ ) {\r\n\t\t\t\tif ( checkSet[i] && (checkSet[i] === true || checkSet[i].nodeType === 1 && Sizzle.contains(context, checkSet[i])) ) {\r\n\t\t\t\t\tresults.push( set[i] );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor ( i = 0; checkSet[i] != null; i++ ) {\r\n\t\t\t\tif ( checkSet[i] && checkSet[i].nodeType === 1 ) {\r\n\t\t\t\t\tresults.push( set[i] );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tmakeArray( checkSet, results );\r\n\t}\r\n\r\n\tif ( extra ) {\r\n\t\tSizzle( extra, origContext, results, seed );\r\n\t\tSizzle.uniqueSort( results );\r\n\t}\r\n\r\n\treturn results;\r\n};\r\n\r\nSizzle.uniqueSort = function(results){\r\n\tif ( sortOrder ) {\r\n\t\thasDuplicate = baseHasDuplicate;\r\n\t\tresults.sort(sortOrder);\r\n\r\n\t\tif ( hasDuplicate ) {\r\n\t\t\tfor ( var i = 1; i < results.length; i++ ) {\r\n\t\t\t\tif ( results[i] === results[i-1] ) {\r\n\t\t\t\t\tresults.splice(i--, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn results;\r\n};\r\n\r\nSizzle.matches = function(expr, set){\r\n\treturn Sizzle(expr, null, null, set);\r\n};\r\n\r\nSizzle.find = function(expr, context, isXML){\r\n\tvar set;\r\n\r\n\tif ( !expr ) {\r\n\t\treturn [];\r\n\t}\r\n\r\n\tfor ( var i = 0, l = Expr.order.length; i < l; i++ ) {\r\n\t\tvar type = Expr.order[i], match;\r\n\t\t\r\n\t\tif ( (match = Expr.leftMatch[ type ].exec( expr )) ) {\r\n\t\t\tvar left = match[1];\r\n\t\t\tmatch.splice(1,1);\r\n\r\n\t\t\tif ( left.substr( left.length - 1 ) !== \"\\\\\" ) {\r\n\t\t\t\tmatch[1] = (match[1] || \"\").replace(/\\\\/g, \"\");\r\n\t\t\t\tset = Expr.find[ type ]( match, context, isXML );\r\n\t\t\t\tif ( set != null ) {\r\n\t\t\t\t\texpr = expr.replace( Expr.match[ type ], \"\" );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif ( !set ) {\r\n\t\tset = context.getElementsByTagName(\"*\");\r\n\t}\r\n\r\n\treturn {set: set, expr: expr};\r\n};\r\n\r\nSizzle.filter = function(expr, set, inplace, not){\r\n\tvar old = expr, result = [], curLoop = set, match, anyFound,\r\n\t\tisXMLFilter = set && set[0] && Sizzle.isXML(set[0]);\r\n\r\n\twhile ( expr && set.length ) {\r\n\t\tfor ( var type in Expr.filter ) {\r\n\t\t\tif ( (match = Expr.leftMatch[ type ].exec( expr )) != null && match[2] ) {\r\n\t\t\t\tvar filter = Expr.filter[ type ], found, item, left = match[1];\r\n\t\t\t\tanyFound = false;\r\n\r\n\t\t\t\tmatch.splice(1,1);\r\n\r\n\t\t\t\tif ( left.substr( left.length - 1 ) === \"\\\\\" ) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( curLoop === result ) {\r\n\t\t\t\t\tresult = [];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( Expr.preFilter[ type ] ) {\r\n\t\t\t\t\tmatch = Expr.preFilter[ type ]( match, curLoop, inplace, result, not, isXMLFilter );\r\n\r\n\t\t\t\t\tif ( !match ) {\r\n\t\t\t\t\t\tanyFound = found = true;\r\n\t\t\t\t\t} else if ( match === true ) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( match ) {\r\n\t\t\t\t\tfor ( var i = 0; (item = curLoop[i]) != null; i++ ) {\r\n\t\t\t\t\t\tif ( item ) {\r\n\t\t\t\t\t\t\tfound = filter( item, match, i, curLoop );\r\n\t\t\t\t\t\t\tvar pass = not ^ !!found;\r\n\r\n\t\t\t\t\t\t\tif ( inplace && found != null ) {\r\n\t\t\t\t\t\t\t\tif ( pass ) {\r\n\t\t\t\t\t\t\t\t\tanyFound = true;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tcurLoop[i] = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if ( pass ) {\r\n\t\t\t\t\t\t\t\tresult.push( item );\r\n\t\t\t\t\t\t\t\tanyFound = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( found !== undefined ) {\r\n\t\t\t\t\tif ( !inplace ) {\r\n\t\t\t\t\t\tcurLoop = result;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\texpr = expr.replace( Expr.match[ type ], \"\" );\r\n\r\n\t\t\t\t\tif ( !anyFound ) {\r\n\t\t\t\t\t\treturn [];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Improper expression\r\n\t\tif ( expr === old ) {\r\n\t\t\tif ( anyFound == null ) {\r\n\t\t\t\tSizzle.error( expr );\r\n\t\t\t} else {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\told = expr;\r\n\t}\r\n\r\n\treturn curLoop;\r\n};\r\n\r\nSizzle.error = function( msg ) {\r\n\tthrow \"Syntax error, unrecognized expression: \" + msg;\r\n};\r\n\r\nvar Expr = Sizzle.selectors = {\r\n\torder: [ \"ID\", \"NAME\", \"TAG\" ],\r\n\tmatch: {\r\n\t\tID: /#((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)/,\r\n\t\tCLASS: /\\.((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)/,\r\n\t\tNAME: /\\[name=['\"]*((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)['\"]*\\]/,\r\n\t\tATTR: /\\[\\s*((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)\\s*(?:(\\S?=)\\s*(['\"]*)(.*?)\\3|)\\s*\\]/,\r\n\t\tTAG: /^((?:[\\w\\u00c0-\\uFFFF\\*\\-]|\\\\.)+)/,\r\n\t\tCHILD: /:(only|nth|last|first)-child(?:\\((even|odd|[\\dn+\\-]*)\\))?/,\r\n\t\tPOS: /:(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\))?(?=[^\\-]|$)/,\r\n\t\tPSEUDO: /:((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)(?:\\((['\"]?)((?:\\([^\\)]+\\)|[^\\(\\)]*)+)\\2\\))?/\r\n\t},\r\n\tleftMatch: {},\r\n\tattrMap: {\r\n\t\t\"class\": \"className\",\r\n\t\t\"for\": \"htmlFor\"\r\n\t},\r\n\tattrHandle: {\r\n\t\thref: function(elem){\r\n\t\t\treturn elem.getAttribute(\"href\");\r\n\t\t}\r\n\t},\r\n\trelative: {\r\n\t\t\"+\": function(checkSet, part){\r\n\t\t\tvar isPartStr = typeof part === \"string\",\r\n\t\t\t\tisTag = isPartStr && !/\\W/.test(part),\r\n\t\t\t\tisPartStrNotTag = isPartStr && !isTag;\r\n\r\n\t\t\tif ( isTag ) {\r\n\t\t\t\tpart = part.toLowerCase();\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var i = 0, l = checkSet.length, elem; i < l; i++ ) {\r\n\t\t\t\tif ( (elem = checkSet[i]) ) {\r\n\t\t\t\t\twhile ( (elem = elem.previousSibling) && elem.nodeType !== 1 ) {}\r\n\r\n\t\t\t\t\tcheckSet[i] = isPartStrNotTag || elem && elem.nodeName.toLowerCase() === part ?\r\n\t\t\t\t\t\telem || false :\r\n\t\t\t\t\t\telem === part;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( isPartStrNotTag ) {\r\n\t\t\t\tSizzle.filter( part, checkSet, true );\r\n\t\t\t}\r\n\t\t},\r\n\t\t\">\": function(checkSet, part){\r\n\t\t\tvar isPartStr = typeof part === \"string\",\r\n\t\t\t\telem, i = 0, l = checkSet.length;\r\n\r\n\t\t\tif ( isPartStr && !/\\W/.test(part) ) {\r\n\t\t\t\tpart = part.toLowerCase();\r\n\r\n\t\t\t\tfor ( ; i < l; i++ ) {\r\n\t\t\t\t\telem = checkSet[i];\r\n\t\t\t\t\tif ( elem ) {\r\n\t\t\t\t\t\tvar parent = elem.parentNode;\r\n\t\t\t\t\t\tcheckSet[i] = parent.nodeName.toLowerCase() === part ? parent : false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor ( ; i < l; i++ ) {\r\n\t\t\t\t\telem = checkSet[i];\r\n\t\t\t\t\tif ( elem ) {\r\n\t\t\t\t\t\tcheckSet[i] = isPartStr ?\r\n\t\t\t\t\t\t\telem.parentNode :\r\n\t\t\t\t\t\t\telem.parentNode === part;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( isPartStr ) {\r\n\t\t\t\t\tSizzle.filter( part, checkSet, true );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"\": function(checkSet, part, isXML){\r\n\t\t\tvar doneName = done++, checkFn = dirCheck, nodeCheck;\r\n\r\n\t\t\tif ( typeof part === \"string\" && !/\\W/.test(part) ) {\r\n\t\t\t\tpart = part.toLowerCase();\r\n\t\t\t\tnodeCheck = part;\r\n\t\t\t\tcheckFn = dirNodeCheck;\r\n\t\t\t}\r\n\r\n\t\t\tcheckFn(\"parentNode\", part, doneName, checkSet, nodeCheck, isXML);\r\n\t\t},\r\n\t\t\"~\": function(checkSet, part, isXML){\r\n\t\t\tvar doneName = done++, checkFn = dirCheck, nodeCheck;\r\n\r\n\t\t\tif ( typeof part === \"string\" && !/\\W/.test(part) ) {\r\n\t\t\t\tpart = part.toLowerCase();\r\n\t\t\t\tnodeCheck = part;\r\n\t\t\t\tcheckFn = dirNodeCheck;\r\n\t\t\t}\r\n\r\n\t\t\tcheckFn(\"previousSibling\", part, doneName, checkSet, nodeCheck, isXML);\r\n\t\t}\r\n\t},\r\n\tfind: {\r\n\t\tID: function(match, context, isXML){\r\n\t\t\tif ( typeof context.getElementById !== \"undefined\" && !isXML ) {\r\n\t\t\t\tvar m = context.getElementById(match[1]);\r\n\t\t\t\treturn m ? [m] : [];\r\n\t\t\t}\r\n\t\t},\r\n\t\tNAME: function(match, context){\r\n\t\t\tif ( typeof context.getElementsByName !== \"undefined\" ) {\r\n\t\t\t\tvar ret = [], results = context.getElementsByName(match[1]);\r\n\r\n\t\t\t\tfor ( var i = 0, l = results.length; i < l; i++ ) {\r\n\t\t\t\t\tif ( results[i].getAttribute(\"name\") === match[1] ) {\r\n\t\t\t\t\t\tret.push( results[i] );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn ret.length === 0 ? null : ret;\r\n\t\t\t}\r\n\t\t},\r\n\t\tTAG: function(match, context){\r\n\t\t\treturn context.getElementsByTagName(match[1]);\r\n\t\t}\r\n\t},\r\n\tpreFilter: {\r\n\t\tCLASS: function(match, curLoop, inplace, result, not, isXML){\r\n\t\t\tmatch = \" \" + match[1].replace(/\\\\/g, \"\") + \" \";\r\n\r\n\t\t\tif ( isXML ) {\r\n\t\t\t\treturn match;\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var i = 0, elem; (elem = curLoop[i]) != null; i++ ) {\r\n\t\t\t\tif ( elem ) {\r\n\t\t\t\t\tif ( not ^ (elem.className && (\" \" + elem.className + \" \").replace(/[\\t\\n]/g, \" \").indexOf(match) >= 0) ) {\r\n\t\t\t\t\t\tif ( !inplace ) {\r\n\t\t\t\t\t\t\tresult.push( elem );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if ( inplace ) {\r\n\t\t\t\t\t\tcurLoop[i] = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\tID: function(match){\r\n\t\t\treturn match[1].replace(/\\\\/g, \"\");\r\n\t\t},\r\n\t\tTAG: function(match, curLoop){\r\n\t\t\treturn match[1].toLowerCase();\r\n\t\t},\r\n\t\tCHILD: function(match){\r\n\t\t\tif ( match[1] === \"nth\" ) {\r\n\t\t\t\t// parse equations like 'even', 'odd', '5', '2n', '3n+2', '4n-1', '-n+6'\r\n\t\t\t\tvar test = /(-?)(\\d*)n((?:\\+|-)?\\d*)/.exec(\r\n\t\t\t\t\tmatch[2] === \"even\" && \"2n\" || match[2] === \"odd\" && \"2n+1\" ||\r\n\t\t\t\t\t!/\\D/.test( match[2] ) && \"0n+\" + match[2] || match[2]);\r\n\r\n\t\t\t\t// calculate the numbers (first)n+(last) including if they are negative\r\n\t\t\t\tmatch[2] = (test[1] + (test[2] || 1)) - 0;\r\n\t\t\t\tmatch[3] = test[3] - 0;\r\n\t\t\t}\r\n\r\n\t\t\t// TODO: Move to normal caching system\r\n\t\t\tmatch[0] = done++;\r\n\r\n\t\t\treturn match;\r\n\t\t},\r\n\t\tATTR: function(match, curLoop, inplace, result, not, isXML){\r\n\t\t\tvar name = match[1].replace(/\\\\/g, \"\");\r\n\t\t\t\r\n\t\t\tif ( !isXML && Expr.attrMap[name] ) {\r\n\t\t\t\tmatch[1] = Expr.attrMap[name];\r\n\t\t\t}\r\n\r\n\t\t\tif ( match[2] === \"~=\" ) {\r\n\t\t\t\tmatch[4] = \" \" + match[4] + \" \";\r\n\t\t\t}\r\n\r\n\t\t\treturn match;\r\n\t\t},\r\n\t\tPSEUDO: function(match, curLoop, inplace, result, not){\r\n\t\t\tif ( match[1] === \"not\" ) {\r\n\t\t\t\t// If we're dealing with a complex expression, or a simple one\r\n\t\t\t\tif ( ( chunker.exec(match[3]) || \"\" ).length > 1 || /^\\w/.test(match[3]) ) {\r\n\t\t\t\t\tmatch[3] = Sizzle(match[3], null, null, curLoop);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar ret = Sizzle.filter(match[3], curLoop, inplace, true ^ not);\r\n\t\t\t\t\tif ( !inplace ) {\r\n\t\t\t\t\t\tresult.push.apply( result, ret );\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t} else if ( Expr.match.POS.test( match[0] ) || Expr.match.CHILD.test( match[0] ) ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn match;\r\n\t\t},\r\n\t\tPOS: function(match){\r\n\t\t\tmatch.unshift( true );\r\n\t\t\treturn match;\r\n\t\t}\r\n\t},\r\n\tfilters: {\r\n\t\tenabled: function(elem){\r\n\t\t\treturn elem.disabled === false && elem.type !== \"hidden\";\r\n\t\t},\r\n\t\tdisabled: function(elem){\r\n\t\t\treturn elem.disabled === true;\r\n\t\t},\r\n\t\tchecked: function(elem){\r\n\t\t\treturn elem.checked === true;\r\n\t\t},\r\n\t\tselected: function(elem){\r\n\t\t\t// Accessing this property makes selected-by-default\r\n\t\t\t// options in Safari work properly\r\n\t\t\telem.parentNode.selectedIndex;\r\n\t\t\treturn elem.selected === true;\r\n\t\t},\r\n\t\tparent: function(elem){\r\n\t\t\treturn !!elem.firstChild;\r\n\t\t},\r\n\t\tempty: function(elem){\r\n\t\t\treturn !elem.firstChild;\r\n\t\t},\r\n\t\thas: function(elem, i, match){\r\n\t\t\treturn !!Sizzle( match[3], elem ).length;\r\n\t\t},\r\n\t\theader: function(elem){\r\n\t\t\treturn (/h\\d/i).test( elem.nodeName );\r\n\t\t},\r\n\t\ttext: function(elem){\r\n\t\t\treturn \"text\" === elem.type;\r\n\t\t},\r\n\t\tradio: function(elem){\r\n\t\t\treturn \"radio\" === elem.type;\r\n\t\t},\r\n\t\tcheckbox: function(elem){\r\n\t\t\treturn \"checkbox\" === elem.type;\r\n\t\t},\r\n\t\tfile: function(elem){\r\n\t\t\treturn \"file\" === elem.type;\r\n\t\t},\r\n\t\tpassword: function(elem){\r\n\t\t\treturn \"password\" === elem.type;\r\n\t\t},\r\n\t\tsubmit: function(elem){\r\n\t\t\treturn \"submit\" === elem.type;\r\n\t\t},\r\n\t\timage: function(elem){\r\n\t\t\treturn \"image\" === elem.type;\r\n\t\t},\r\n\t\treset: function(elem){\r\n\t\t\treturn \"reset\" === elem.type;\r\n\t\t},\r\n\t\tbutton: function(elem){\r\n\t\t\treturn \"button\" === elem.type || elem.nodeName.toLowerCase() === \"button\";\r\n\t\t},\r\n\t\tinput: function(elem){\r\n\t\t\treturn (/input|select|textarea|button/i).test(elem.nodeName);\r\n\t\t}\r\n\t},\r\n\tsetFilters: {\r\n\t\tfirst: function(elem, i){\r\n\t\t\treturn i === 0;\r\n\t\t},\r\n\t\tlast: function(elem, i, match, array){\r\n\t\t\treturn i === array.length - 1;\r\n\t\t},\r\n\t\teven: function(elem, i){\r\n\t\t\treturn i % 2 === 0;\r\n\t\t},\r\n\t\todd: function(elem, i){\r\n\t\t\treturn i % 2 === 1;\r\n\t\t},\r\n\t\tlt: function(elem, i, match){\r\n\t\t\treturn i < match[3] - 0;\r\n\t\t},\r\n\t\tgt: function(elem, i, match){\r\n\t\t\treturn i > match[3] - 0;\r\n\t\t},\r\n\t\tnth: function(elem, i, match){\r\n\t\t\treturn match[3] - 0 === i;\r\n\t\t},\r\n\t\teq: function(elem, i, match){\r\n\t\t\treturn match[3] - 0 === i;\r\n\t\t}\r\n\t},\r\n\tfilter: {\r\n\t\tPSEUDO: function(elem, match, i, array){\r\n\t\t\tvar name = match[1], filter = Expr.filters[ name ];\r\n\r\n\t\t\tif ( filter ) {\r\n\t\t\t\treturn filter( elem, i, match, array );\r\n\t\t\t} else if ( name === \"contains\" ) {\r\n\t\t\t\treturn (elem.textContent || elem.innerText || Sizzle.getText([ elem ]) || \"\").indexOf(match[3]) >= 0;\r\n\t\t\t} else if ( name === \"not\" ) {\r\n\t\t\t\tvar not = match[3];\r\n\r\n\t\t\t\tfor ( var j = 0, l = not.length; j < l; j++ ) {\r\n\t\t\t\t\tif ( not[j] === elem ) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\tSizzle.error( \"Syntax error, unrecognized expression: \" + name );\r\n\t\t\t}\r\n\t\t},\r\n\t\tCHILD: function(elem, match){\r\n\t\t\tvar type = match[1], node = elem;\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'only':\r\n\t\t\t\tcase 'first':\r\n\t\t\t\t\twhile ( (node = node.previousSibling) )\t {\r\n\t\t\t\t\t\tif ( node.nodeType === 1 ) { \r\n\t\t\t\t\t\t\treturn false; \r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( type === \"first\" ) { \r\n\t\t\t\t\t\treturn true; \r\n\t\t\t\t\t}\r\n\t\t\t\t\tnode = elem;\r\n\t\t\t\tcase 'last':\r\n\t\t\t\t\twhile ( (node = node.nextSibling) )\t {\r\n\t\t\t\t\t\tif ( node.nodeType === 1 ) { \r\n\t\t\t\t\t\t\treturn false; \r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\tcase 'nth':\r\n\t\t\t\t\tvar first = match[2], last = match[3];\r\n\r\n\t\t\t\t\tif ( first === 1 && last === 0 ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar doneName = match[0],\r\n\t\t\t\t\t\tparent = elem.parentNode;\r\n\t\r\n\t\t\t\t\tif ( parent && (parent.sizcache !== doneName || !elem.nodeIndex) ) {\r\n\t\t\t\t\t\tvar count = 0;\r\n\t\t\t\t\t\tfor ( node = parent.firstChild; node; node = node.nextSibling ) {\r\n\t\t\t\t\t\t\tif ( node.nodeType === 1 ) {\r\n\t\t\t\t\t\t\t\tnode.nodeIndex = ++count;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} \r\n\t\t\t\t\t\tparent.sizcache = doneName;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar diff = elem.nodeIndex - last;\r\n\t\t\t\t\tif ( first === 0 ) {\r\n\t\t\t\t\t\treturn diff === 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn ( diff % first === 0 && diff / first >= 0 );\r\n\t\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tID: function(elem, match){\r\n\t\t\treturn elem.nodeType === 1 && elem.getAttribute(\"id\") === match;\r\n\t\t},\r\n\t\tTAG: function(elem, match){\r\n\t\t\treturn (match === \"*\" && elem.nodeType === 1) || elem.nodeName.toLowerCase() === match;\r\n\t\t},\r\n\t\tCLASS: function(elem, match){\r\n\t\t\treturn (\" \" + (elem.className || elem.getAttribute(\"class\")) + \" \")\r\n\t\t\t\t.indexOf( match ) > -1;\r\n\t\t},\r\n\t\tATTR: function(elem, match){\r\n\t\t\tvar name = match[1],\r\n\t\t\t\tresult = Expr.attrHandle[ name ] ?\r\n\t\t\t\t\tExpr.attrHandle[ name ]( elem ) :\r\n\t\t\t\t\telem[ name ] != null ?\r\n\t\t\t\t\t\telem[ name ] :\r\n\t\t\t\t\t\telem.getAttribute( name ),\r\n\t\t\t\tvalue = result + \"\",\r\n\t\t\t\ttype = match[2],\r\n\t\t\t\tcheck = match[4];\r\n\r\n\t\t\treturn result == null ?\r\n\t\t\t\ttype === \"!=\" :\r\n\t\t\t\ttype === \"=\" ?\r\n\t\t\t\tvalue === check :\r\n\t\t\t\ttype === \"*=\" ?\r\n\t\t\t\tvalue.indexOf(check) >= 0 :\r\n\t\t\t\ttype === \"~=\" ?\r\n\t\t\t\t(\" \" + value + \" \").indexOf(check) >= 0 :\r\n\t\t\t\t!check ?\r\n\t\t\t\tvalue && result !== false :\r\n\t\t\t\ttype === \"!=\" ?\r\n\t\t\t\tvalue !== check :\r\n\t\t\t\ttype === \"^=\" ?\r\n\t\t\t\tvalue.indexOf(check) === 0 :\r\n\t\t\t\ttype === \"$=\" ?\r\n\t\t\t\tvalue.substr(value.length - check.length) === check :\r\n\t\t\t\ttype === \"|=\" ?\r\n\t\t\t\tvalue === check || value.substr(0, check.length + 1) === check + \"-\" :\r\n\t\t\t\tfalse;\r\n\t\t},\r\n\t\tPOS: function(elem, match, i, array){\r\n\t\t\tvar name = match[2], filter = Expr.setFilters[ name ];\r\n\r\n\t\t\tif ( filter ) {\r\n\t\t\t\treturn filter( elem, i, match, array );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nvar origPOS = Expr.match.POS,\r\n\tfescape = function(all, num){\r\n\t\treturn \"\\\\\" + (num - 0 + 1);\r\n\t};\r\n\r\nfor ( var type in Expr.match ) {\r\n\tExpr.match[ type ] = new RegExp( Expr.match[ type ].source + (/(?![^\\[]*\\])(?![^\\(]*\\))/.source) );\r\n\tExpr.leftMatch[ type ] = new RegExp( /(^(?:.|\\r|\\n)*?)/.source + Expr.match[ type ].source.replace(/\\\\(\\d+)/g, fescape) );\r\n}\r\n\r\nvar makeArray = function(array, results) {\r\n\tarray = Array.prototype.slice.call( array, 0 );\r\n\r\n\tif ( results ) {\r\n\t\tresults.push.apply( results, array );\r\n\t\treturn results;\r\n\t}\r\n\t\r\n\treturn array;\r\n};\r\n\r\n// Perform a simple check to determine if the browser is capable of\r\n// converting a NodeList to an array using builtin methods.\r\n// Also verifies that the returned array holds DOM nodes\r\n// (which is not the case in the Blackberry browser)\r\ntry {\r\n\tArray.prototype.slice.call( document.documentElement.childNodes, 0 )[0].nodeType;\r\n\r\n// Provide a fallback method if it does not work\r\n} catch(e){\r\n\tmakeArray = function(array, results) {\r\n\t\tvar ret = results || [], i = 0;\r\n\r\n\t\tif ( toString.call(array) === \"[object Array]\" ) {\r\n\t\t\tArray.prototype.push.apply( ret, array );\r\n\t\t} else {\r\n\t\t\tif ( typeof array.length === \"number\" ) {\r\n\t\t\t\tfor ( var l = array.length; i < l; i++ ) {\r\n\t\t\t\t\tret.push( array[i] );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor ( ; array[i]; i++ ) {\r\n\t\t\t\t\tret.push( array[i] );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn ret;\r\n\t};\r\n}\r\n\r\nvar sortOrder;\r\n\r\nif ( document.documentElement.compareDocumentPosition ) {\r\n\tsortOrder = function( a, b ) {\r\n\t\tif ( !a.compareDocumentPosition || !b.compareDocumentPosition ) {\r\n\t\t\tif ( a == b ) {\r\n\t\t\t\thasDuplicate = true;\r\n\t\t\t}\r\n\t\t\treturn a.compareDocumentPosition ? -1 : 1;\r\n\t\t}\r\n\r\n\t\tvar ret = a.compareDocumentPosition(b) & 4 ? -1 : a === b ? 0 : 1;\r\n\t\tif ( ret === 0 ) {\r\n\t\t\thasDuplicate = true;\r\n\t\t}\r\n\t\treturn ret;\r\n\t};\r\n} else if ( \"sourceIndex\" in document.documentElement ) {\r\n\tsortOrder = function( a, b ) {\r\n\t\tif ( !a.sourceIndex || !b.sourceIndex ) {\r\n\t\t\tif ( a == b ) {\r\n\t\t\t\thasDuplicate = true;\r\n\t\t\t}\r\n\t\t\treturn a.sourceIndex ? -1 : 1;\r\n\t\t}\r\n\r\n\t\tvar ret = a.sourceIndex - b.sourceIndex;\r\n\t\tif ( ret === 0 ) {\r\n\t\t\thasDuplicate = true;\r\n\t\t}\r\n\t\treturn ret;\r\n\t};\r\n} else if ( document.createRange ) {\r\n\tsortOrder = function( a, b ) {\r\n\t\tif ( !a.ownerDocument || !b.ownerDocument ) {\r\n\t\t\tif ( a == b ) {\r\n\t\t\t\thasDuplicate = true;\r\n\t\t\t}\r\n\t\t\treturn a.ownerDocument ? -1 : 1;\r\n\t\t}\r\n\r\n\t\tvar aRange = a.ownerDocument.createRange(), bRange = b.ownerDocument.createRange();\r\n\t\taRange.setStart(a, 0);\r\n\t\taRange.setEnd(a, 0);\r\n\t\tbRange.setStart(b, 0);\r\n\t\tbRange.setEnd(b, 0);\r\n\t\tvar ret = aRange.compareBoundaryPoints(Range.START_TO_END, bRange);\r\n\t\tif ( ret === 0 ) {\r\n\t\t\thasDuplicate = true;\r\n\t\t}\r\n\t\treturn ret;\r\n\t};\r\n}\r\n\r\n// Utility function for retreiving the text value of an array of DOM nodes\r\nSizzle.getText = function( elems ) {\r\n\tvar ret = \"\", elem;\r\n\r\n\tfor ( var i = 0; elems[i]; i++ ) {\r\n\t\telem = elems[i];\r\n\r\n\t\t// Get the text from text nodes and CDATA nodes\r\n\t\tif ( elem.nodeType === 3 || elem.nodeType === 4 ) {\r\n\t\t\tret += elem.nodeValue;\r\n\r\n\t\t// Traverse everything else, except comment nodes\r\n\t\t} else if ( elem.nodeType !== 8 ) {\r\n\t\t\tret += Sizzle.getText( elem.childNodes );\r\n\t\t}\r\n\t}\r\n\r\n\treturn ret;\r\n};\r\n\r\n// Check to see if the browser returns elements by name when\r\n// querying by getElementById (and provide a workaround)\r\n(function(){\r\n\t// We're going to inject a fake input element with a specified name\r\n\tvar form = document.createElement(\"div\"),\r\n\t\tid = \"script\" + (new Date()).getTime();\r\n\tform.innerHTML = \"<a name='\" + id + \"'/>\";\r\n\r\n\t// Inject it into the root element, check its status, and remove it quickly\r\n\tvar root = document.documentElement;\r\n\troot.insertBefore( form, root.firstChild );\r\n\r\n\t// The workaround has to do additional checks after a getElementById\r\n\t// Which slows things down for other browsers (hence the branching)\r\n\tif ( document.getElementById( id ) ) {\r\n\t\tExpr.find.ID = function(match, context, isXML){\r\n\t\t\tif ( typeof context.getElementById !== \"undefined\" && !isXML ) {\r\n\t\t\t\tvar m = context.getElementById(match[1]);\r\n\t\t\t\treturn m ? m.id === match[1] || typeof m.getAttributeNode !== \"undefined\" && m.getAttributeNode(\"id\").nodeValue === match[1] ? [m] : undefined : [];\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tExpr.filter.ID = function(elem, match){\r\n\t\t\tvar node = typeof elem.getAttributeNode !== \"undefined\" && elem.getAttributeNode(\"id\");\r\n\t\t\treturn elem.nodeType === 1 && node && node.nodeValue === match;\r\n\t\t};\r\n\t}\r\n\r\n\troot.removeChild( form );\r\n\troot = form = null; // release memory in IE\r\n})();\r\n\r\n(function(){\r\n\t// Check to see if the browser returns only elements\r\n\t// when doing getElementsByTagName(\"*\")\r\n\r\n\t// Create a fake element\r\n\tvar div = document.createElement(\"div\");\r\n\tdiv.appendChild( document.createComment(\"\") );\r\n\r\n\t// Make sure no comments are found\r\n\tif ( div.getElementsByTagName(\"*\").length > 0 ) {\r\n\t\tExpr.find.TAG = function(match, context){\r\n\t\t\tvar results = context.getElementsByTagName(match[1]);\r\n\r\n\t\t\t// Filter out possible comments\r\n\t\t\tif ( match[1] === \"*\" ) {\r\n\t\t\t\tvar tmp = [];\r\n\r\n\t\t\t\tfor ( var i = 0; results[i]; i++ ) {\r\n\t\t\t\t\tif ( results[i].nodeType === 1 ) {\r\n\t\t\t\t\t\ttmp.push( results[i] );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresults = tmp;\r\n\t\t\t}\r\n\r\n\t\t\treturn results;\r\n\t\t};\r\n\t}\r\n\r\n\t// Check to see if an attribute returns normalized href attributes\r\n\tdiv.innerHTML = \"<a href='#'></a>\";\r\n\tif ( div.firstChild && typeof div.firstChild.getAttribute !== \"undefined\" &&\r\n\t\t\tdiv.firstChild.getAttribute(\"href\") !== \"#\" ) {\r\n\t\tExpr.attrHandle.href = function(elem){\r\n\t\t\treturn elem.getAttribute(\"href\", 2);\r\n\t\t};\r\n\t}\r\n\r\n\tdiv = null; // release memory in IE\r\n})();\r\n\r\nif ( document.querySelectorAll ) {\r\n\t(function(){\r\n\t\tvar oldSizzle = Sizzle, div = document.createElement(\"div\");\r\n\t\tdiv.innerHTML = \"<p class='TEST'></p>\";\r\n\r\n\t\t// Safari can't handle uppercase or unicode characters when\r\n\t\t// in quirks mode.\r\n\t\tif ( div.querySelectorAll && div.querySelectorAll(\".TEST\").length === 0 ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\tSizzle = function(query, context, extra, seed){\r\n\t\t\tcontext = context || document;\r\n\r\n\t\t\t// Only use querySelectorAll on non-XML documents\r\n\t\t\t// (ID selectors don't work in non-HTML documents)\r\n\t\t\tif ( !seed && context.nodeType === 9 && !Sizzle.isXML(context) ) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\treturn makeArray( context.querySelectorAll(query), extra );\r\n\t\t\t\t} catch(e){}\r\n\t\t\t}\r\n\t\t\r\n\t\t\treturn oldSizzle(query, context, extra, seed);\r\n\t\t};\r\n\r\n\t\tfor ( var prop in oldSizzle ) {\r\n\t\t\tSizzle[ prop ] = oldSizzle[ prop ];\r\n\t\t}\r\n\r\n\t\tdiv = null; // release memory in IE\r\n\t})();\r\n}\r\n\r\n(function(){\r\n\tvar div = document.createElement(\"div\");\r\n\r\n\tdiv.innerHTML = \"<div class='test e'></div><div class='test'></div>\";\r\n\r\n\t// Opera can't find a second classname (in 9.6)\r\n\t// Also, make sure that getElementsByClassName actually exists\r\n\tif ( !div.getElementsByClassName || div.getElementsByClassName(\"e\").length === 0 ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Safari caches class attributes, doesn't catch changes (in 3.2)\r\n\tdiv.lastChild.className = \"e\";\r\n\r\n\tif ( div.getElementsByClassName(\"e\").length === 1 ) {\r\n\t\treturn;\r\n\t}\r\n\t\r\n\tExpr.order.splice(1, 0, \"CLASS\");\r\n\tExpr.find.CLASS = function(match, context, isXML) {\r\n\t\tif ( typeof context.getElementsByClassName !== \"undefined\" && !isXML ) {\r\n\t\t\treturn context.getElementsByClassName(match[1]);\r\n\t\t}\r\n\t};\r\n\r\n\tdiv = null; // release memory in IE\r\n})();\r\n\r\nfunction dirNodeCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {\r\n\tfor ( var i = 0, l = checkSet.length; i < l; i++ ) {\r\n\t\tvar elem = checkSet[i];\r\n\t\tif ( elem ) {\r\n\t\t\telem = elem[dir];\r\n\t\t\tvar match = false;\r\n\r\n\t\t\twhile ( elem ) {\r\n\t\t\t\tif ( elem.sizcache === doneName ) {\r\n\t\t\t\t\tmatch = checkSet[elem.sizset];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( elem.nodeType === 1 && !isXML ){\r\n\t\t\t\t\telem.sizcache = doneName;\r\n\t\t\t\t\telem.sizset = i;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( elem.nodeName.toLowerCase() === cur ) {\r\n\t\t\t\t\tmatch = elem;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\telem = elem[dir];\r\n\t\t\t}\r\n\r\n\t\t\tcheckSet[i] = match;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction dirCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {\r\n\tfor ( var i = 0, l = checkSet.length; i < l; i++ ) {\r\n\t\tvar elem = checkSet[i];\r\n\t\tif ( elem ) {\r\n\t\t\telem = elem[dir];\r\n\t\t\tvar match = false;\r\n\r\n\t\t\twhile ( elem ) {\r\n\t\t\t\tif ( elem.sizcache === doneName ) {\r\n\t\t\t\t\tmatch = checkSet[elem.sizset];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( elem.nodeType === 1 ) {\r\n\t\t\t\t\tif ( !isXML ) {\r\n\t\t\t\t\t\telem.sizcache = doneName;\r\n\t\t\t\t\t\telem.sizset = i;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( typeof cur !== \"string\" ) {\r\n\t\t\t\t\t\tif ( elem === cur ) {\r\n\t\t\t\t\t\t\tmatch = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( Sizzle.filter( cur, [elem] ).length > 0 ) {\r\n\t\t\t\t\t\tmatch = elem;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\telem = elem[dir];\r\n\t\t\t}\r\n\r\n\t\t\tcheckSet[i] = match;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nSizzle.contains = document.compareDocumentPosition ? function(a, b){\r\n\treturn !!(a.compareDocumentPosition(b) & 16);\r\n} : function(a, b){\r\n\treturn a !== b && (a.contains ? a.contains(b) : true);\r\n};\r\n\r\nSizzle.isXML = function(elem){\r\n\t// documentElement is verified for cases where it doesn't yet exist\r\n\t// (such as loading iframes in IE - #4833) \r\n\tvar documentElement = (elem ? elem.ownerDocument || elem : 0).documentElement;\r\n\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\r\n};\r\n\r\nvar posProcess = function(selector, context){\r\n\tvar tmpSet = [], later = \"\", match,\r\n\t\troot = context.nodeType ? [context] : context;\r\n\r\n\t// Position selectors must be done after the filter\r\n\t// And so must :not(positional) so we move all PSEUDOs to the end\r\n\twhile ( (match = Expr.match.PSEUDO.exec( selector )) ) {\r\n\t\tlater += match[0];\r\n\t\tselector = selector.replace( Expr.match.PSEUDO, \"\" );\r\n\t}\r\n\r\n\tselector = Expr.relative[selector] ? selector + \"*\" : selector;\r\n\r\n\tfor ( var i = 0, l = root.length; i < l; i++ ) {\r\n\t\tSizzle( selector, root[i], tmpSet );\r\n\t}\r\n\r\n\treturn Sizzle.filter( later, tmpSet );\r\n};\r\n\r\n// EXPOSE\r\n\r\nwindow.tinymce.dom.Sizzle = Sizzle;\r\n\r\n})();\r\n\r\n\r\n(function(tinymce) {\r\n\t// Shorten names\r\n\tvar each = tinymce.each, DOM = tinymce.DOM, isIE = tinymce.isIE, isWebKit = tinymce.isWebKit, Event;\r\n\r\n\ttinymce.create('tinymce.dom.EventUtils', {\r\n\t\tEventUtils : function() {\r\n\t\t\tthis.inits = [];\r\n\t\t\tthis.events = [];\r\n\t\t},\r\n\r\n\t\tadd : function(o, n, f, s) {\r\n\t\t\tvar cb, t = this, el = t.events, r;\r\n\r\n\t\t\tif (n instanceof Array) {\r\n\t\t\t\tr = [];\r\n\r\n\t\t\t\teach(n, function(n) {\r\n\t\t\t\t\tr.push(t.add(o, n, f, s));\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn r;\r\n\t\t\t}\r\n\r\n\t\t\t// Handle array\r\n\t\t\tif (o && o.hasOwnProperty && o instanceof Array) {\r\n\t\t\t\tr = [];\r\n\r\n\t\t\t\teach(o, function(o) {\r\n\t\t\t\t\to = DOM.get(o);\r\n\t\t\t\t\tr.push(t.add(o, n, f, s));\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn r;\r\n\t\t\t}\r\n\r\n\t\t\to = DOM.get(o);\r\n\r\n\t\t\tif (!o)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Setup event callback\r\n\t\t\tcb = function(e) {\r\n\t\t\t\t// Is all events disabled\r\n\t\t\t\tif (t.disabled)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\te = e || window.event;\r\n\r\n\t\t\t\t// Patch in target, preventDefault and stopPropagation in IE it's W3C valid\r\n\t\t\t\tif (e && isIE) {\r\n\t\t\t\t\tif (!e.target)\r\n\t\t\t\t\t\te.target = e.srcElement;\r\n\r\n\t\t\t\t\t// Patch in preventDefault, stopPropagation methods for W3C compatibility\r\n\t\t\t\t\ttinymce.extend(e, t._stoppers);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!s)\r\n\t\t\t\t\treturn f(e);\r\n\r\n\t\t\t\treturn f.call(s, e);\r\n\t\t\t};\r\n\r\n\t\t\tif (n == 'unload') {\r\n\t\t\t\ttinymce.unloads.unshift({func : cb});\r\n\t\t\t\treturn cb;\r\n\t\t\t}\r\n\r\n\t\t\tif (n == 'init') {\r\n\t\t\t\tif (t.domLoaded)\r\n\t\t\t\t\tcb();\r\n\t\t\t\telse\r\n\t\t\t\t\tt.inits.push(cb);\r\n\r\n\t\t\t\treturn cb;\r\n\t\t\t}\r\n\r\n\t\t\t// Store away listener reference\r\n\t\t\tel.push({\r\n\t\t\t\tobj : o,\r\n\t\t\t\tname : n,\r\n\t\t\t\tfunc : f,\r\n\t\t\t\tcfunc : cb,\r\n\t\t\t\tscope : s\r\n\t\t\t});\r\n\r\n\t\t\tt._add(o, n, cb);\r\n\r\n\t\t\treturn f;\r\n\t\t},\r\n\r\n\t\tremove : function(o, n, f) {\r\n\t\t\tvar t = this, a = t.events, s = false, r;\r\n\r\n\t\t\t// Handle array\r\n\t\t\tif (o && o.hasOwnProperty && o instanceof Array) {\r\n\t\t\t\tr = [];\r\n\r\n\t\t\t\teach(o, function(o) {\r\n\t\t\t\t\to = DOM.get(o);\r\n\t\t\t\t\tr.push(t.remove(o, n, f));\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn r;\r\n\t\t\t}\r\n\r\n\t\t\to = DOM.get(o);\r\n\r\n\t\t\teach(a, function(e, i) {\r\n\t\t\t\tif (e.obj == o && e.name == n && (!f || (e.func == f || e.cfunc == f))) {\r\n\t\t\t\t\ta.splice(i, 1);\r\n\t\t\t\t\tt._remove(o, n, e.cfunc);\r\n\t\t\t\t\ts = true;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn s;\r\n\t\t},\r\n\r\n\t\tclear : function(o) {\r\n\t\t\tvar t = this, a = t.events, i, e;\r\n\r\n\t\t\tif (o) {\r\n\t\t\t\to = DOM.get(o);\r\n\r\n\t\t\t\tfor (i = a.length - 1; i >= 0; i--) {\r\n\t\t\t\t\te = a[i];\r\n\r\n\t\t\t\t\tif (e.obj === o) {\r\n\t\t\t\t\t\tt._remove(e.obj, e.name, e.cfunc);\r\n\t\t\t\t\t\te.obj = e.cfunc = null;\r\n\t\t\t\t\t\ta.splice(i, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tcancel : function(e) {\r\n\t\t\tif (!e)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tthis.stop(e);\r\n\r\n\t\t\treturn this.prevent(e);\r\n\t\t},\r\n\r\n\t\tstop : function(e) {\r\n\t\t\tif (e.stopPropagation)\r\n\t\t\t\te.stopPropagation();\r\n\t\t\telse\r\n\t\t\t\te.cancelBubble = true;\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tprevent : function(e) {\r\n\t\t\tif (e.preventDefault)\r\n\t\t\t\te.preventDefault();\r\n\t\t\telse\r\n\t\t\t\te.returnValue = false;\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tdestroy : function() {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\teach(t.events, function(e, i) {\r\n\t\t\t\tt._remove(e.obj, e.name, e.cfunc);\r\n\t\t\t\te.obj = e.cfunc = null;\r\n\t\t\t});\r\n\r\n\t\t\tt.events = [];\r\n\t\t\tt = null;\r\n\t\t},\r\n\r\n\t\t_add : function(o, n, f) {\r\n\t\t\tif (o.attachEvent)\r\n\t\t\t\to.attachEvent('on' + n, f);\r\n\t\t\telse if (o.addEventListener)\r\n\t\t\t\to.addEventListener(n, f, false);\r\n\t\t\telse\r\n\t\t\t\to['on' + n] = f;\r\n\t\t},\r\n\r\n\t\t_remove : function(o, n, f) {\r\n\t\t\tif (o) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (o.detachEvent)\r\n\t\t\t\t\t\to.detachEvent('on' + n, f);\r\n\t\t\t\t\telse if (o.removeEventListener)\r\n\t\t\t\t\t\to.removeEventListener(n, f, false);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\to['on' + n] = null;\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Might fail with permission denined on IE so we just ignore that\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_pageInit : function(win) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\t// Keep it from running more than once\r\n\t\t\tif (t.domLoaded)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tt.domLoaded = true;\r\n\r\n\t\t\teach(t.inits, function(c) {\r\n\t\t\t\tc();\r\n\t\t\t});\r\n\r\n\t\t\tt.inits = [];\r\n\t\t},\r\n\r\n\t\t_wait : function(win) {\r\n\t\t\tvar t = this, doc = win.document;\r\n\r\n\t\t\t// No need since the document is already loaded\r\n\t\t\tif (win.tinyMCE_GZ && tinyMCE_GZ.loaded) {\r\n\t\t\t\tt.domLoaded = 1;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Use IE method\r\n\t\t\tif (doc.attachEvent) {\r\n\t\t\t\tdoc.attachEvent(\"onreadystatechange\", function() {\r\n\t\t\t\t\tif (doc.readyState === \"complete\") {\r\n\t\t\t\t\t\tdoc.detachEvent(\"onreadystatechange\", arguments.callee);\r\n\t\t\t\t\t\tt._pageInit(win);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (doc.documentElement.doScroll && win == win.top) {\r\n\t\t\t\t\t(function() {\r\n\t\t\t\t\t\tif (t.domLoaded)\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t// If IE is used, use the trick by Diego Perini licensed under MIT by request to the author.\r\n\t\t\t\t\t\t\t// http://javascript.nwbox.com/IEContentLoaded/\r\n\t\t\t\t\t\t\tdoc.documentElement.doScroll(\"left\");\r\n\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\tsetTimeout(arguments.callee, 0);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tt._pageInit(win);\r\n\t\t\t\t\t})();\r\n\t\t\t\t}\r\n\t\t\t} else if (doc.addEventListener) {\r\n\t\t\t\tt._add(win, 'DOMContentLoaded', function() {\r\n\t\t\t\t\tt._pageInit(win);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tt._add(win, 'load', function() {\r\n\t\t\t\tt._pageInit(win);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_stoppers : {\r\n\t\t\tpreventDefault : function() {\r\n\t\t\t\tthis.returnValue = false;\r\n\t\t\t},\r\n\r\n\t\t\tstopPropagation : function() {\r\n\t\t\t\tthis.cancelBubble = true;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tEvent = tinymce.dom.Event = new tinymce.dom.EventUtils();\r\n\r\n\t// Dispatch DOM content loaded event for IE and Safari\r\n\tEvent._wait(window);\r\n\r\n\ttinymce.addUnload(function() {\r\n\t\tEvent.destroy();\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\ttinymce.dom.Element = function(id, settings) {\r\n\t\tvar t = this, dom, el;\r\n\r\n\t\tt.settings = settings = settings || {};\r\n\t\tt.id = id;\r\n\t\tt.dom = dom = settings.dom || tinymce.DOM;\r\n\r\n\t\t// Only IE leaks DOM references, this is a lot faster\r\n\t\tif (!tinymce.isIE)\r\n\t\t\tel = dom.get(t.id);\r\n\r\n\t\ttinymce.each(\r\n\t\t\t\t('getPos,getRect,getParent,add,setStyle,getStyle,setStyles,' + \r\n\t\t\t\t'setAttrib,setAttribs,getAttrib,addClass,removeClass,' + \r\n\t\t\t\t'hasClass,getOuterHTML,setOuterHTML,remove,show,hide,' + \r\n\t\t\t\t'isHidden,setHTML,get').split(/,/)\r\n\t\t\t, function(k) {\r\n\t\t\t\tt[k] = function() {\r\n\t\t\t\t\tvar a = [id], i;\r\n\r\n\t\t\t\t\tfor (i = 0; i < arguments.length; i++)\r\n\t\t\t\t\t\ta.push(arguments[i]);\r\n\r\n\t\t\t\t\ta = dom[k].apply(dom, a);\r\n\t\t\t\t\tt.update(k);\r\n\r\n\t\t\t\t\treturn a;\r\n\t\t\t\t};\r\n\t\t});\r\n\r\n\t\ttinymce.extend(t, {\r\n\t\t\ton : function(n, f, s) {\r\n\t\t\t\treturn tinymce.dom.Event.add(t.id, n, f, s);\r\n\t\t\t},\r\n\r\n\t\t\tgetXY : function() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx : parseInt(t.getStyle('left')),\r\n\t\t\t\t\ty : parseInt(t.getStyle('top'))\r\n\t\t\t\t};\r\n\t\t\t},\r\n\r\n\t\t\tgetSize : function() {\r\n\t\t\t\tvar n = dom.get(t.id);\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tw : parseInt(t.getStyle('width') || n.clientWidth),\r\n\t\t\t\t\th : parseInt(t.getStyle('height') || n.clientHeight)\r\n\t\t\t\t};\r\n\t\t\t},\r\n\r\n\t\t\tmoveTo : function(x, y) {\r\n\t\t\t\tt.setStyles({left : x, top : y});\r\n\t\t\t},\r\n\r\n\t\t\tmoveBy : function(x, y) {\r\n\t\t\t\tvar p = t.getXY();\r\n\r\n\t\t\t\tt.moveTo(p.x + x, p.y + y);\r\n\t\t\t},\r\n\r\n\t\t\tresizeTo : function(w, h) {\r\n\t\t\t\tt.setStyles({width : w, height : h});\r\n\t\t\t},\r\n\r\n\t\t\tresizeBy : function(w, h) {\r\n\t\t\t\tvar s = t.getSize();\r\n\r\n\t\t\t\tt.resizeTo(s.w + w, s.h + h);\r\n\t\t\t},\r\n\r\n\t\t\tupdate : function(k) {\r\n\t\t\t\tvar b;\r\n\r\n\t\t\t\tif (tinymce.isIE6 && settings.blocker) {\r\n\t\t\t\t\tk = k || '';\r\n\r\n\t\t\t\t\t// Ignore getters\r\n\t\t\t\t\tif (k.indexOf('get') === 0 || k.indexOf('has') === 0 || k.indexOf('is') === 0)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t// Remove blocker on remove\r\n\t\t\t\t\tif (k == 'remove') {\r\n\t\t\t\t\t\tdom.remove(t.blocker);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!t.blocker) {\r\n\t\t\t\t\t\tt.blocker = dom.uniqueId();\r\n\t\t\t\t\t\tb = dom.add(settings.container || dom.getRoot(), 'iframe', {id : t.blocker, style : 'position:absolute;', frameBorder : 0, src : 'javascript:\"\"'});\r\n\t\t\t\t\t\tdom.setStyle(b, 'opacity', 0);\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tb = dom.get(t.blocker);\r\n\r\n\t\t\t\t\tdom.setStyles(b, {\r\n\t\t\t\t\t\tleft : t.getStyle('left', 1),\r\n\t\t\t\t\t\ttop : t.getStyle('top', 1),\r\n\t\t\t\t\t\twidth : t.getStyle('width', 1),\r\n\t\t\t\t\t\theight : t.getStyle('height', 1),\r\n\t\t\t\t\t\tdisplay : t.getStyle('display', 1),\r\n\t\t\t\t\t\tzIndex : parseInt(t.getStyle('zIndex', 1) || 0) - 1\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tfunction trimNl(s) {\r\n\t\treturn s.replace(/[\\n\\r]+/g, '');\r\n\t};\r\n\r\n\t// Shorten names\r\n\tvar is = tinymce.is, isIE = tinymce.isIE, each = tinymce.each;\r\n\r\n\ttinymce.create('tinymce.dom.Selection', {\r\n\t\tSelection : function(dom, win, serializer) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.dom = dom;\r\n\t\t\tt.win = win;\r\n\t\t\tt.serializer = serializer;\r\n\r\n\t\t\t// Add events\r\n\t\t\teach([\r\n\t\t\t\t'onBeforeSetContent',\r\n\r\n\t\t\t\t'onBeforeGetContent',\r\n\r\n\t\t\t\t'onSetContent',\r\n\r\n\t\t\t\t'onGetContent'\r\n\t\t\t], function(e) {\r\n\t\t\t\tt[e] = new tinymce.util.Dispatcher(t);\r\n\t\t\t});\r\n\r\n\t\t\t// No W3C Range support\r\n\t\t\tif (!t.win.getSelection)\r\n\t\t\t\tt.tridentSel = new tinymce.dom.TridentSelection(t);\r\n\r\n\t\t\tif (tinymce.isIE && dom.boxModel)\r\n\t\t\t\tthis._fixIESelection();\r\n\r\n\t\t\t// Prevent leaks\r\n\t\t\ttinymce.addUnload(t.destroy, t);\r\n\t\t},\r\n\r\n\t\tsetCursorLocation: function(node, offset) {\r\n\t\t\tvar t = this; var r = t.dom.createRng();\r\n\t\t\tr.setStart(node, offset);\r\n\t\t\tr.setEnd(node, offset);\r\n\t\t\tt.setRng(r);\r\n\t\t\tt.collapse(false);\r\n\t\t},\r\n\t\tgetContent : function(s) {\r\n\t\t\tvar t = this, r = t.getRng(), e = t.dom.create(\"body\"), se = t.getSel(), wb, wa, n;\r\n\r\n\t\t\ts = s || {};\r\n\t\t\twb = wa = '';\r\n\t\t\ts.get = true;\r\n\t\t\ts.format = s.format || 'html';\r\n\t\t\ts.forced_root_block = '';\r\n\t\t\tt.onBeforeGetContent.dispatch(t, s);\r\n\r\n\t\t\tif (s.format == 'text')\r\n\t\t\t\treturn t.isCollapsed() ? '' : (r.text || (se.toString ? se.toString() : ''));\r\n\r\n\t\t\tif (r.cloneContents) {\r\n\t\t\t\tn = r.cloneContents();\r\n\r\n\t\t\t\tif (n)\r\n\t\t\t\t\te.appendChild(n);\r\n\t\t\t} else if (is(r.item) || is(r.htmlText)) {\r\n\t\t\t\t// IE will produce invalid markup if elements are present that\r\n\t\t\t\t// it doesn't understand like custom elements or HTML5 elements.\r\n\t\t\t\t// Adding a BR in front of the contents and then remoiving it seems to fix it though.\r\n\t\t\t\te.innerHTML = '<br>' + (r.item ? r.item(0).outerHTML : r.htmlText);\r\n\t\t\t\te.removeChild(e.firstChild);\r\n\t\t\t} else\r\n\t\t\t\te.innerHTML = r.toString();\r\n\r\n\t\t\t// Keep whitespace before and after\r\n\t\t\tif (/^\\s/.test(e.innerHTML))\r\n\t\t\t\twb = ' ';\r\n\r\n\t\t\tif (/\\s+$/.test(e.innerHTML))\r\n\t\t\t\twa = ' ';\r\n\r\n\t\t\ts.getInner = true;\r\n\r\n\t\t\ts.content = t.isCollapsed() ? '' : wb + t.serializer.serialize(e, s) + wa;\r\n\t\t\tt.onGetContent.dispatch(t, s);\r\n\r\n\t\t\treturn s.content;\r\n\t\t},\r\n\r\n\t\tsetContent : function(content, args) {\r\n\t\t\tvar self = this, rng = self.getRng(), caretNode, doc = self.win.document, frag, temp;\r\n\r\n\t\t\targs = args || {format : 'html'};\r\n\t\t\targs.set = true;\r\n\t\t\tcontent = args.content = content;\r\n\r\n\t\t\t// Dispatch before set content event\r\n\t\t\tif (!args.no_events)\r\n\t\t\t\tself.onBeforeSetContent.dispatch(self, args);\r\n\r\n\t\t\tcontent = args.content;\r\n\r\n\t\t\tif (rng.insertNode) {\r\n\t\t\t\t// Make caret marker since insertNode places the caret in the beginning of text after insert\r\n\t\t\t\tcontent += '<span id=\"__caret\">_</span>';\r\n\r\n\t\t\t\t// Delete and insert new node\r\n\t\t\t\tif (rng.startContainer == doc && rng.endContainer == doc) {\r\n\t\t\t\t\t// WebKit will fail if the body is empty since the range is then invalid and it can't insert contents\r\n\t\t\t\t\tdoc.body.innerHTML = content;\r\n\t\t\t\t} else {\r\n\t\t\t\t\trng.deleteContents();\r\n\r\n\t\t\t\t\tif (doc.body.childNodes.length == 0) {\r\n\t\t\t\t\t\tdoc.body.innerHTML = content;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// createContextualFragment doesn't exists in IE 9 DOMRanges\r\n\t\t\t\t\t\tif (rng.createContextualFragment) {\r\n\t\t\t\t\t\t\trng.insertNode(rng.createContextualFragment(content));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Fake createContextualFragment call in IE 9\r\n\t\t\t\t\t\t\tfrag = doc.createDocumentFragment();\r\n\t\t\t\t\t\t\ttemp = doc.createElement('div');\r\n\r\n\t\t\t\t\t\t\tfrag.appendChild(temp);\r\n\t\t\t\t\t\t\ttemp.outerHTML = content;\r\n\r\n\t\t\t\t\t\t\trng.insertNode(frag);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move to caret marker\r\n\t\t\t\tcaretNode = self.dom.get('__caret');\r\n\r\n\t\t\t\t// Make sure we wrap it compleatly, Opera fails with a simple select call\r\n\t\t\t\trng = doc.createRange();\r\n\t\t\t\trng.setStartBefore(caretNode);\r\n\t\t\t\trng.setEndBefore(caretNode);\r\n\t\t\t\tself.setRng(rng);\r\n\r\n\t\t\t\t// Remove the caret position\r\n\t\t\t\tself.dom.remove('__caret');\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tself.setRng(rng);\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Might fail on Opera for some odd reason\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (rng.item) {\r\n\t\t\t\t\t// Delete content and get caret text selection\r\n\t\t\t\t\tdoc.execCommand('Delete', false, null);\r\n\t\t\t\t\trng = self.getRng();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Explorer removes spaces from the beginning of pasted contents\r\n\t\t\t\tif (/^\\s+/.test(content)) {\r\n\t\t\t\t\trng.pasteHTML('<span id=\"__mce_tmp\">_</span>' + content);\r\n\t\t\t\t\tself.dom.remove('__mce_tmp');\r\n\t\t\t\t} else\r\n\t\t\t\t\trng.pasteHTML(content);\r\n\t\t\t}\r\n\r\n\t\t\t// Dispatch set content event\r\n\t\t\tif (!args.no_events)\r\n\t\t\t\tself.onSetContent.dispatch(self, args);\r\n\t\t},\r\n\r\n\t\tgetStart : function() {\r\n\t\t\tvar rng = this.getRng(), startElement, parentElement, checkRng, node;\r\n\r\n\t\t\tif (rng.duplicate || rng.item) {\r\n\t\t\t\t// Control selection, return first item\r\n\t\t\t\tif (rng.item)\r\n\t\t\t\t\treturn rng.item(0);\r\n\r\n\t\t\t\t// Get start element\r\n\t\t\t\tcheckRng = rng.duplicate();\r\n\t\t\t\tcheckRng.collapse(1);\r\n\t\t\t\tstartElement = checkRng.parentElement();\r\n\r\n\t\t\t\t// Check if range parent is inside the start element, then return the inner parent element\r\n\t\t\t\t// This will fix issues when a single element is selected, IE would otherwise return the wrong start element\r\n\t\t\t\tparentElement = node = rng.parentElement();\r\n\t\t\t\twhile (node = node.parentNode) {\r\n\t\t\t\t\tif (node == startElement) {\r\n\t\t\t\t\t\tstartElement = parentElement;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn startElement;\r\n\t\t\t} else {\r\n\t\t\t\tstartElement = rng.startContainer;\r\n\r\n\t\t\t\tif (startElement.nodeType == 1 && startElement.hasChildNodes())\r\n\t\t\t\t\tstartElement = startElement.childNodes[Math.min(startElement.childNodes.length - 1, rng.startOffset)];\r\n\r\n\t\t\t\tif (startElement && startElement.nodeType == 3)\r\n\t\t\t\t\treturn startElement.parentNode;\r\n\r\n\t\t\t\treturn startElement;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetEnd : function() {\r\n\t\t\tvar t = this, r = t.getRng(), e, eo;\r\n\r\n\t\t\tif (r.duplicate || r.item) {\r\n\t\t\t\tif (r.item)\r\n\t\t\t\t\treturn r.item(0);\r\n\r\n\t\t\t\tr = r.duplicate();\r\n\t\t\t\tr.collapse(0);\r\n\t\t\t\te = r.parentElement();\r\n\r\n\t\t\t\tif (e && e.nodeName == 'BODY')\r\n\t\t\t\t\treturn e.lastChild || e;\r\n\r\n\t\t\t\treturn e;\r\n\t\t\t} else {\r\n\t\t\t\te = r.endContainer;\r\n\t\t\t\teo = r.endOffset;\r\n\r\n\t\t\t\tif (e.nodeType == 1 && e.hasChildNodes())\r\n\t\t\t\t\te = e.childNodes[eo > 0 ? eo - 1 : eo];\r\n\r\n\t\t\t\tif (e && e.nodeType == 3)\r\n\t\t\t\t\treturn e.parentNode;\r\n\r\n\t\t\t\treturn e;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetBookmark : function(type, normalized) {\r\n\t\t\tvar t = this, dom = t.dom, rng, rng2, id, collapsed, name, element, index, chr = '\\uFEFF', styles;\r\n\r\n\t\t\tfunction findIndex(name, element) {\r\n\t\t\t\tvar index = 0;\r\n\r\n\t\t\t\teach(dom.select(name), function(node, i) {\r\n\t\t\t\t\tif (node == element)\r\n\t\t\t\t\t\tindex = i;\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn index;\r\n\t\t\t};\r\n\r\n\t\t\tif (type == 2) {\r\n\t\t\t\tfunction getLocation() {\r\n\t\t\t\t\tvar rng = t.getRng(true), root = dom.getRoot(), bookmark = {};\r\n\r\n\t\t\t\t\tfunction getPoint(rng, start) {\r\n\t\t\t\t\t\tvar container = rng[start ? 'startContainer' : 'endContainer'],\r\n\t\t\t\t\t\t\toffset = rng[start ? 'startOffset' : 'endOffset'], point = [], node, childNodes, after = 0;\r\n\r\n\t\t\t\t\t\tif (container.nodeType == 3) {\r\n\t\t\t\t\t\t\tif (normalized) {\r\n\t\t\t\t\t\t\t\tfor (node = container.previousSibling; node && node.nodeType == 3; node = node.previousSibling)\r\n\t\t\t\t\t\t\t\t\toffset += node.nodeValue.length;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tpoint.push(offset);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tchildNodes = container.childNodes;\r\n\r\n\t\t\t\t\t\t\tif (offset >= childNodes.length && childNodes.length) {\r\n\t\t\t\t\t\t\t\tafter = 1;\r\n\t\t\t\t\t\t\t\toffset = Math.max(0, childNodes.length - 1);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tpoint.push(t.dom.nodeIndex(childNodes[offset], normalized) + after);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor (; container && container != root; container = container.parentNode)\r\n\t\t\t\t\t\t\tpoint.push(t.dom.nodeIndex(container, normalized));\r\n\r\n\t\t\t\t\t\treturn point;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tbookmark.start = getPoint(rng, true);\r\n\r\n\t\t\t\t\tif (!t.isCollapsed())\r\n\t\t\t\t\t\tbookmark.end = getPoint(rng);\r\n\r\n\t\t\t\t\treturn bookmark;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (t.tridentSel)\r\n\t\t\t\t\treturn t.tridentSel.getBookmark(type);\r\n\r\n\t\t\t\treturn getLocation();\r\n\t\t\t}\r\n\r\n\t\t\t// Handle simple range\r\n\t\t\tif (type)\r\n\t\t\t\treturn {rng : t.getRng()};\r\n\r\n\t\t\trng = t.getRng();\r\n\t\t\tid = dom.uniqueId();\r\n\t\t\tcollapsed = tinyMCE.activeEditor.selection.isCollapsed();\r\n\t\t\tstyles = 'overflow:hidden;line-height:0px';\r\n\r\n\t\t\t// Explorer method\r\n\t\t\tif (rng.duplicate || rng.item) {\r\n\t\t\t\t// Text selection\r\n\t\t\t\tif (!rng.item) {\r\n\t\t\t\t\trng2 = rng.duplicate();\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// Insert start marker\r\n\t\t\t\t\t\trng.collapse();\r\n\t\t\t\t\t\trng.pasteHTML('<span data-mce-type=\"bookmark\" id=\"' + id + '_start\" style=\"' + styles + '\">' + chr + '</span>');\r\n\r\n\t\t\t\t\t\t// Insert end marker\r\n\t\t\t\t\t\tif (!collapsed) {\r\n\t\t\t\t\t\t\trng2.collapse(false);\r\n\r\n\t\t\t\t\t\t\t// Detect the empty space after block elements in IE and move the end back one character <p></p>] becomes <p>]</p>\r\n\t\t\t\t\t\t\trng.moveToElementText(rng2.parentElement());\r\n\t\t\t\t\t\t\tif (rng.compareEndPoints('StartToEnd', rng2) == 0)\r\n\t\t\t\t\t\t\t\trng2.move('character', -1);\r\n\r\n\t\t\t\t\t\t\trng2.pasteHTML('<span data-mce-type=\"bookmark\" id=\"' + id + '_end\" style=\"' + styles + '\">' + chr + '</span>');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// IE might throw unspecified error so lets ignore it\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Control selection\r\n\t\t\t\t\telement = rng.item(0);\r\n\t\t\t\t\tname = element.nodeName;\r\n\r\n\t\t\t\t\treturn {name : name, index : findIndex(name, element)};\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\telement = t.getNode();\r\n\t\t\t\tname = element.nodeName;\r\n\t\t\t\tif (name == 'IMG')\r\n\t\t\t\t\treturn {name : name, index : findIndex(name, element)};\r\n\r\n\t\t\t\t// W3C method\r\n\t\t\t\trng2 = rng.cloneRange();\r\n\r\n\t\t\t\t// Insert end marker\r\n\t\t\t\tif (!collapsed) {\r\n\t\t\t\t\trng2.collapse(false);\r\n\t\t\t\t\trng2.insertNode(dom.create('span', {'data-mce-type' : \"bookmark\", id : id + '_end', style : styles}, chr));\r\n\t\t\t\t}\r\n\r\n\t\t\t\trng.collapse(true);\r\n\t\t\t\trng.insertNode(dom.create('span', {'data-mce-type' : \"bookmark\", id : id + '_start', style : styles}, chr));\r\n\t\t\t}\r\n\r\n\t\t\tt.moveToBookmark({id : id, keep : 1});\r\n\r\n\t\t\treturn {id : id};\r\n\t\t},\r\n\r\n\t\tmoveToBookmark : function(bookmark) {\r\n\t\t\tvar t = this, dom = t.dom, marker1, marker2, rng, root, startContainer, endContainer, startOffset, endOffset;\r\n\r\n\t\t\tif (bookmark) {\r\n\t\t\t\tif (bookmark.start) {\r\n\t\t\t\t\trng = dom.createRng();\r\n\t\t\t\t\troot = dom.getRoot();\r\n\r\n\t\t\t\t\tfunction setEndPoint(start) {\r\n\t\t\t\t\t\tvar point = bookmark[start ? 'start' : 'end'], i, node, offset, children;\r\n\r\n\t\t\t\t\t\tif (point) {\r\n\t\t\t\t\t\t\toffset = point[0];\r\n\r\n\t\t\t\t\t\t\t// Find container node\r\n\t\t\t\t\t\t\tfor (node = root, i = point.length - 1; i >= 1; i--) {\r\n\t\t\t\t\t\t\t\tchildren = node.childNodes;\r\n\r\n\t\t\t\t\t\t\t\tif (point[i] > children.length - 1)\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\tnode = children[point[i]];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Move text offset to best suitable location\r\n\t\t\t\t\t\t\tif (node.nodeType === 3)\r\n\t\t\t\t\t\t\t\toffset = Math.min(point[0], node.nodeValue.length);\r\n\r\n\t\t\t\t\t\t\t// Move element offset to best suitable location\r\n\t\t\t\t\t\t\tif (node.nodeType === 1)\r\n\t\t\t\t\t\t\t\toffset = Math.min(point[0], node.childNodes.length);\r\n\r\n\t\t\t\t\t\t\t// Set offset within container node\r\n\t\t\t\t\t\t\tif (start)\r\n\t\t\t\t\t\t\t\trng.setStart(node, offset);\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\trng.setEnd(node, offset);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tif (t.tridentSel)\r\n\t\t\t\t\t\treturn t.tridentSel.moveToBookmark(bookmark);\r\n\r\n\t\t\t\t\tif (setEndPoint(true) && setEndPoint()) {\r\n\t\t\t\t\t\tt.setRng(rng);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (bookmark.id) {\r\n\t\t\t\t\tfunction restoreEndPoint(suffix) {\r\n\t\t\t\t\t\tvar marker = dom.get(bookmark.id + '_' + suffix), node, idx, next, prev, keep = bookmark.keep;\r\n\r\n\t\t\t\t\t\tif (marker) {\r\n\t\t\t\t\t\t\tnode = marker.parentNode;\r\n\r\n\t\t\t\t\t\t\tif (suffix == 'start') {\r\n\t\t\t\t\t\t\t\tif (!keep) {\r\n\t\t\t\t\t\t\t\t\tidx = dom.nodeIndex(marker);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tnode = marker.firstChild;\r\n\t\t\t\t\t\t\t\t\tidx = 1;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tstartContainer = endContainer = node;\r\n\t\t\t\t\t\t\t\tstartOffset = endOffset = idx;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (!keep) {\r\n\t\t\t\t\t\t\t\t\tidx = dom.nodeIndex(marker);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tnode = marker.firstChild;\r\n\t\t\t\t\t\t\t\t\tidx = 1;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tendContainer = node;\r\n\t\t\t\t\t\t\t\tendOffset = idx;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (!keep) {\r\n\t\t\t\t\t\t\t\tprev = marker.previousSibling;\r\n\t\t\t\t\t\t\t\tnext = marker.nextSibling;\r\n\r\n\t\t\t\t\t\t\t\t// Remove all marker text nodes\r\n\t\t\t\t\t\t\t\teach(tinymce.grep(marker.childNodes), function(node) {\r\n\t\t\t\t\t\t\t\t\tif (node.nodeType == 3)\r\n\t\t\t\t\t\t\t\t\t\tnode.nodeValue = node.nodeValue.replace(/\\uFEFF/g, '');\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t// Remove marker but keep children if for example contents where inserted into the marker\r\n\t\t\t\t\t\t\t\t// Also remove duplicated instances of the marker for example by a split operation or by WebKit auto split on paste feature\r\n\t\t\t\t\t\t\t\twhile (marker = dom.get(bookmark.id + '_' + suffix))\r\n\t\t\t\t\t\t\t\t\tdom.remove(marker, 1);\r\n\r\n\t\t\t\t\t\t\t\t// If siblings are text nodes then merge them unless it's Opera since it some how removes the node\r\n\t\t\t\t\t\t\t\t// and we are sniffing since adding a lot of detection code for a browser with 3% of the market isn't worth the effort. Sorry, Opera but it's just a fact\r\n\t\t\t\t\t\t\t\tif (prev && next && prev.nodeType == next.nodeType && prev.nodeType == 3 && !tinymce.isOpera) {\r\n\t\t\t\t\t\t\t\t\tidx = prev.nodeValue.length;\r\n\t\t\t\t\t\t\t\t\tprev.appendData(next.nodeValue);\r\n\t\t\t\t\t\t\t\t\tdom.remove(next);\r\n\r\n\t\t\t\t\t\t\t\t\tif (suffix == 'start') {\r\n\t\t\t\t\t\t\t\t\t\tstartContainer = endContainer = prev;\r\n\t\t\t\t\t\t\t\t\t\tstartOffset = endOffset = idx;\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tendContainer = prev;\r\n\t\t\t\t\t\t\t\t\t\tendOffset = idx;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tfunction addBogus(node) {\r\n\t\t\t\t\t\t// Adds a bogus BR element for empty block elements or just a space on IE since it renders BR elements incorrectly\r\n\t\t\t\t\t\tif (dom.isBlock(node) && !node.innerHTML)\r\n\t\t\t\t\t\t\tnode.innerHTML = !isIE ? '<br data-mce-bogus=\"1\" />' : ' ';\r\n\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// Restore start/end points\r\n\t\t\t\t\trestoreEndPoint('start');\r\n\t\t\t\t\trestoreEndPoint('end');\r\n\r\n\t\t\t\t\tif (startContainer) {\r\n\t\t\t\t\t\trng = dom.createRng();\r\n\t\t\t\t\t\trng.setStart(addBogus(startContainer), startOffset);\r\n\t\t\t\t\t\trng.setEnd(addBogus(endContainer), endOffset);\r\n\t\t\t\t\t\tt.setRng(rng);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (bookmark.name) {\r\n\t\t\t\t\tt.select(dom.select(bookmark.name)[bookmark.index]);\r\n\t\t\t\t} else if (bookmark.rng)\r\n\t\t\t\t\tt.setRng(bookmark.rng);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tselect : function(node, content) {\r\n\t\t\tvar t = this, dom = t.dom, rng = dom.createRng(), idx;\r\n\r\n\t\t\tif (node) {\r\n\t\t\t\tidx = dom.nodeIndex(node);\r\n\t\t\t\trng.setStart(node.parentNode, idx);\r\n\t\t\t\trng.setEnd(node.parentNode, idx + 1);\r\n\r\n\t\t\t\t// Find first/last text node or BR element\r\n\t\t\t\tif (content) {\r\n\t\t\t\t\tfunction setPoint(node, start) {\r\n\t\t\t\t\t\tvar walker = new tinymce.dom.TreeWalker(node, node);\r\n\r\n\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\t// Text node\r\n\t\t\t\t\t\t\tif (node.nodeType == 3 && tinymce.trim(node.nodeValue).length != 0) {\r\n\t\t\t\t\t\t\t\tif (start)\r\n\t\t\t\t\t\t\t\t\trng.setStart(node, 0);\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\trng.setEnd(node, node.nodeValue.length);\r\n\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// BR element\r\n\t\t\t\t\t\t\tif (node.nodeName == 'BR') {\r\n\t\t\t\t\t\t\t\tif (start)\r\n\t\t\t\t\t\t\t\t\trng.setStartBefore(node);\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\trng.setEndBefore(node);\r\n\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} while (node = (start ? walker.next() : walker.prev()));\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tsetPoint(node, 1);\r\n\t\t\t\t\tsetPoint(node);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt.setRng(rng);\r\n\t\t\t}\r\n\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\tisCollapsed : function() {\r\n\t\t\tvar t = this, r = t.getRng(), s = t.getSel();\r\n\r\n\t\t\tif (!r || r.item)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tif (r.compareEndPoints)\r\n\t\t\t\treturn r.compareEndPoints('StartToEnd', r) === 0;\r\n\r\n\t\t\treturn !s || r.collapsed;\r\n\t\t},\r\n\r\n\t\tcollapse : function(to_start) {\r\n\t\t\tvar self = this, rng = self.getRng(), node;\r\n\r\n\t\t\t// Control range on IE\r\n\t\t\tif (rng.item) {\r\n\t\t\t\tnode = rng.item(0);\r\n\t\t\t\trng = self.win.document.body.createTextRange();\r\n\t\t\t\trng.moveToElementText(node);\r\n\t\t\t}\r\n\r\n\t\t\trng.collapse(!!to_start);\r\n\t\t\tself.setRng(rng);\r\n\t\t},\r\n\r\n\t\tgetSel : function() {\r\n\t\t\tvar t = this, w = this.win;\r\n\r\n\t\t\treturn w.getSelection ? w.getSelection() : w.document.selection;\r\n\t\t},\r\n\r\n\t\tgetRng : function(w3c) {\r\n\t\t\tvar t = this, s, r, elm, doc = t.win.document;\r\n\r\n\t\t\t// Found tridentSel object then we need to use that one\r\n\t\t\tif (w3c && t.tridentSel)\r\n\t\t\t\treturn t.tridentSel.getRangeAt(0);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tif (s = t.getSel())\r\n\t\t\t\t\tr = s.rangeCount > 0 ? s.getRangeAt(0) : (s.createRange ? s.createRange() : doc.createRange());\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// IE throws unspecified error here if TinyMCE is placed in a frame/iframe\r\n\t\t\t}\r\n\r\n\t\t\t// We have W3C ranges and it's IE then fake control selection since IE9 doesn't handle that correctly yet\r\n\t\t\tif (tinymce.isIE && r && r.setStart && doc.selection.createRange().item) {\r\n\t\t\t\telm = doc.selection.createRange().item(0);\r\n\t\t\t\tr = doc.createRange();\r\n\t\t\t\tr.setStartBefore(elm);\r\n\t\t\t\tr.setEndAfter(elm);\r\n\t\t\t}\r\n\r\n\t\t\t// No range found then create an empty one\r\n\t\t\t// This can occur when the editor is placed in a hidden container element on Gecko\r\n\t\t\t// Or on IE when there was an exception\r\n\t\t\tif (!r)\r\n\t\t\t\tr = doc.createRange ? doc.createRange() : doc.body.createTextRange();\r\n\r\n\t\t\tif (t.selectedRange && t.explicitRange) {\r\n\t\t\t\tif (r.compareBoundaryPoints(r.START_TO_START, t.selectedRange) === 0 && r.compareBoundaryPoints(r.END_TO_END, t.selectedRange) === 0) {\r\n\t\t\t\t\t// Safari, Opera and Chrome only ever select text which causes the range to change.\r\n\t\t\t\t\t// This lets us use the originally set range if the selection hasn't been changed by the user.\r\n\t\t\t\t\tr = t.explicitRange;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tt.selectedRange = null;\r\n\t\t\t\t\tt.explicitRange = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn r;\r\n\t\t},\r\n\r\n\t\tsetRng : function(r) {\r\n\t\t\tvar s, t = this;\r\n\t\t\t\r\n\t\t\tif (!t.tridentSel) {\r\n\t\t\t\ts = t.getSel();\r\n\r\n\t\t\t\tif (s) {\r\n\t\t\t\t\tt.explicitRange = r;\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\ts.removeAllRanges();\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// IE9 might throw errors here don't know why\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ts.addRange(r);\r\n\t\t\t\t\tt.selectedRange = s.getRangeAt(0);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Is W3C Range\r\n\t\t\t\tif (r.cloneRange) {\r\n\t\t\t\t\tt.tridentSel.addRange(r);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Is IE specific range\r\n\t\t\t\ttry {\r\n\t\t\t\t\tr.select();\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Needed for some odd IE bug #1843306\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tsetNode : function(n) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.setContent(t.dom.getOuterHTML(n));\r\n\r\n\t\t\treturn n;\r\n\t\t},\r\n\r\n\t\tgetNode : function() {\r\n\t\t\tvar t = this, rng = t.getRng(), sel = t.getSel(), elm, start = rng.startContainer, end = rng.endContainer;\r\n\r\n\t\t\t// Range maybe lost after the editor is made visible again\r\n\t\t\tif (!rng)\r\n\t\t\t\treturn t.dom.getRoot();\r\n\r\n\t\t\tif (rng.setStart) {\r\n\t\t\t\telm = rng.commonAncestorContainer;\r\n\r\n\t\t\t\t// Handle selection a image or other control like element such as anchors\r\n\t\t\t\tif (!rng.collapsed) {\r\n\t\t\t\t\tif (rng.startContainer == rng.endContainer) {\r\n\t\t\t\t\t\tif (rng.endOffset - rng.startOffset < 2) {\r\n\t\t\t\t\t\t\tif (rng.startContainer.hasChildNodes())\r\n\t\t\t\t\t\t\t\telm = rng.startContainer.childNodes[rng.startOffset];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// If the anchor node is a element instead of a text node then return this element\r\n\t\t\t\t\t//if (tinymce.isWebKit && sel.anchorNode && sel.anchorNode.nodeType == 1) \r\n\t\t\t\t\t//\treturn sel.anchorNode.childNodes[sel.anchorOffset];\r\n\r\n\t\t\t\t\t// Handle cases where the selection is immediately wrapped around a node and return that node instead of it's parent.\r\n\t\t\t\t\t// This happens when you double click an underlined word in FireFox.\r\n\t\t\t\t\tif (start.nodeType === 3 && end.nodeType === 3) {\r\n\t\t\t\t\t\tfunction skipEmptyTextNodes(n, forwards) {\r\n\t\t\t\t\t\t\tvar orig = n;\r\n\t\t\t\t\t\t\twhile (n && n.nodeType === 3 && n.length === 0) {\r\n\t\t\t\t\t\t\t\tn = forwards ? n.nextSibling : n.previousSibling;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn n || orig;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (start.length === rng.startOffset) {\r\n\t\t\t\t\t\t\tstart = skipEmptyTextNodes(start.nextSibling, true);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tstart = start.parentNode;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (rng.endOffset === 0) {\r\n\t\t\t\t\t\t\tend = skipEmptyTextNodes(end.previousSibling, false);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tend = end.parentNode;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (start && start === end)\r\n\t\t\t\t\t\t\treturn start;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (elm && elm.nodeType == 3)\r\n\t\t\t\t\treturn elm.parentNode;\r\n\r\n\t\t\t\treturn elm;\r\n\t\t\t}\r\n\r\n\t\t\treturn rng.item ? rng.item(0) : rng.parentElement();\r\n\t\t},\r\n\r\n\t\tgetSelectedBlocks : function(st, en) {\r\n\t\t\tvar t = this, dom = t.dom, sb, eb, n, bl = [];\r\n\r\n\t\t\tsb = dom.getParent(st || t.getStart(), dom.isBlock);\r\n\t\t\teb = dom.getParent(en || t.getEnd(), dom.isBlock);\r\n\r\n\t\t\tif (sb)\r\n\t\t\t\tbl.push(sb);\r\n\r\n\t\t\tif (sb && eb && sb != eb) {\r\n\t\t\t\tn = sb;\r\n\r\n\t\t\t\tvar walker = new tinymce.dom.TreeWalker(sb, dom.getRoot());\r\n\t\t\t\twhile ((n = walker.next()) && n != eb) {\r\n\t\t\t\t\tif (dom.isBlock(n))\r\n\t\t\t\t\t\tbl.push(n);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (eb && sb != eb)\r\n\t\t\t\tbl.push(eb);\r\n\r\n\t\t\treturn bl;\r\n\t\t},\r\n\r\n\t\tnormalize : function() {\r\n\t\t\tvar self = this, rng, normalized;\r\n\r\n\t\t\t// Normalize only on non IE browsers for now\r\n\t\t\tif (tinymce.isIE)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tfunction normalizeEndPoint(start) {\r\n\t\t\t\tvar container, offset, walker, dom = self.dom, body = dom.getRoot(), node;\r\n\r\n\t\t\t\tcontainer = rng[(start ? 'start' : 'end') + 'Container'];\r\n\t\t\t\toffset = rng[(start ? 'start' : 'end') + 'Offset'];\r\n\r\n\t\t\t\t// If the container is a document move it to the body element\r\n\t\t\t\tif (container.nodeType === 9) {\r\n\t\t\t\t\tcontainer = container.body;\r\n\t\t\t\t\toffset = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If the container is body try move it into the closest text node or position\r\n\t\t\t\t// TODO: Add more logic here to handle element selection cases\r\n\t\t\t\tif (container === body) {\r\n\t\t\t\t\t// Resolve the index\r\n\t\t\t\t\tif (container.hasChildNodes()) {\r\n\t\t\t\t\t\tcontainer = container.childNodes[Math.min(!start && offset > 0 ? offset - 1 : offset, container.childNodes.length - 1)];\r\n\t\t\t\t\t\toffset = 0;\r\n\r\n\t\t\t\t\t\t// Don't walk into elements that doesn't have any child nodes like a IMG\r\n\t\t\t\t\t\tif (container.hasChildNodes()) {\r\n\t\t\t\t\t\t\t// Walk the DOM to find a text node to place the caret at or a BR\r\n\t\t\t\t\t\t\tnode = container;\r\n\t\t\t\t\t\t\twalker = new tinymce.dom.TreeWalker(container, body);\r\n\t\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\t\t// Found a text node use that position\r\n\t\t\t\t\t\t\t\tif (node.nodeType === 3) {\r\n\t\t\t\t\t\t\t\t\toffset = start ? 0 : node.nodeValue.length - 1;\r\n\t\t\t\t\t\t\t\t\tcontainer = node;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Found a BR element that we can place the caret before\r\n\t\t\t\t\t\t\t\tif (node.nodeName === 'BR') {\r\n\t\t\t\t\t\t\t\t\toffset = dom.nodeIndex(node);\r\n\t\t\t\t\t\t\t\t\tcontainer = node.parentNode;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} while (node = (start ? walker.next() : walker.prev()));\r\n\r\n\t\t\t\t\t\t\tnormalized = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set endpoint if it was normalized\r\n\t\t\t\tif (normalized)\r\n\t\t\t\t\trng['set' + (start ? 'Start' : 'End')](container, offset);\r\n\t\t\t};\r\n\r\n\t\t\trng = self.getRng();\r\n\r\n\t\t\t// Normalize the end points\r\n\t\t\tnormalizeEndPoint(true);\r\n\t\t\t\r\n\t\t\tif (rng.collapsed)\r\n\t\t\t\tnormalizeEndPoint();\r\n\r\n\t\t\t// Set the selection if it was normalized\r\n\t\t\tif (normalized) {\r\n\t\t\t\t//console.log(self.dom.dumpRng(rng));\r\n\t\t\t\tself.setRng(rng);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdestroy : function(s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.win = null;\r\n\r\n\t\t\t// Manual destroy then remove unload handler\r\n\t\t\tif (!s)\r\n\t\t\t\ttinymce.removeUnload(t.destroy);\r\n\t\t},\r\n\r\n\t\t// IE has an issue where you can't select/move the caret by clicking outside the body if the document is in standards mode\r\n\t\t_fixIESelection : function() {\r\n\t\t\tvar dom = this.dom, doc = dom.doc, body = doc.body, started, startRng, htmlElm;\r\n\r\n\t\t\t// Make HTML element unselectable since we are going to handle selection by hand\r\n\t\t\tdoc.documentElement.unselectable = true;\r\n\r\n\t\t\t// Return range from point or null if it failed\r\n\t\t\tfunction rngFromPoint(x, y) {\r\n\t\t\t\tvar rng = body.createTextRange();\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\trng.moveToPoint(x, y);\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// IE sometimes throws and exception, so lets just ignore it\r\n\t\t\t\t\trng = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn rng;\r\n\t\t\t};\r\n\r\n\t\t\t// Fires while the selection is changing\r\n\t\t\tfunction selectionChange(e) {\r\n\t\t\t\tvar pointRng;\r\n\r\n\t\t\t\t// Check if the button is down or not\r\n\t\t\t\tif (e.button) {\r\n\t\t\t\t\t// Create range from mouse position\r\n\t\t\t\t\tpointRng = rngFromPoint(e.x, e.y);\r\n\r\n\t\t\t\t\tif (pointRng) {\r\n\t\t\t\t\t\t// Check if pointRange is before/after selection then change the endPoint\r\n\t\t\t\t\t\tif (pointRng.compareEndPoints('StartToStart', startRng) > 0)\r\n\t\t\t\t\t\t\tpointRng.setEndPoint('StartToStart', startRng);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tpointRng.setEndPoint('EndToEnd', startRng);\r\n\r\n\t\t\t\t\t\tpointRng.select();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else\r\n\t\t\t\t\tendSelection();\r\n\t\t\t}\r\n\r\n\t\t\t// Removes listeners\r\n\t\t\tfunction endSelection() {\r\n\t\t\t\tvar rng = doc.selection.createRange();\r\n\r\n\t\t\t\t// If the range is collapsed then use the last start range\r\n\t\t\t\tif (startRng && !rng.item && rng.compareEndPoints('StartToEnd', rng) === 0)\r\n\t\t\t\t\tstartRng.select();\r\n\r\n\t\t\t\tdom.unbind(doc, 'mouseup', endSelection);\r\n\t\t\t\tdom.unbind(doc, 'mousemove', selectionChange);\r\n\t\t\t\tstartRng = started = 0;\r\n\t\t\t};\r\n\r\n\t\t\t// Detect when user selects outside BODY\r\n\t\t\tdom.bind(doc, ['mousedown', 'contextmenu'], function(e) {\r\n\t\t\t\tif (e.target.nodeName === 'HTML') {\r\n\t\t\t\t\tif (started)\r\n\t\t\t\t\t\tendSelection();\r\n\r\n\t\t\t\t\t// Detect vertical scrollbar, since IE will fire a mousedown on the scrollbar and have target set as HTML\r\n\t\t\t\t\thtmlElm = doc.documentElement;\r\n\t\t\t\t\tif (htmlElm.scrollHeight > htmlElm.clientHeight)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tstarted = 1;\r\n\t\t\t\t\t// Setup start position\r\n\t\t\t\t\tstartRng = rngFromPoint(e.x, e.y);\r\n\t\t\t\t\tif (startRng) {\r\n\t\t\t\t\t\t// Listen for selection change events\r\n\t\t\t\t\t\tdom.bind(doc, 'mouseup', endSelection);\r\n\t\t\t\t\t\tdom.bind(doc, 'mousemove', selectionChange);\r\n\r\n\t\t\t\t\t\tdom.win.focus();\r\n\t\t\t\t\t\tstartRng.select();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\ttinymce.dom.Serializer = function(settings, dom, schema) {\r\n\t\tvar onPreProcess, onPostProcess, isIE = tinymce.isIE, each = tinymce.each, htmlParser;\r\n\r\n\t\t// Support the old apply_source_formatting option\r\n\t\tif (!settings.apply_source_formatting)\r\n\t\t\tsettings.indent = false;\r\n\r\n\t\tsettings.remove_trailing_brs = true;\r\n\r\n\t\t// Default DOM and Schema if they are undefined\r\n\t\tdom = dom || tinymce.DOM;\r\n\t\tschema = schema || new tinymce.html.Schema(settings);\r\n\t\tsettings.entity_encoding = settings.entity_encoding || 'named';\r\n\r\n\t\tonPreProcess = new tinymce.util.Dispatcher(self);\r\n\r\n\t\tonPostProcess = new tinymce.util.Dispatcher(self);\r\n\r\n\t\thtmlParser = new tinymce.html.DomParser(settings, schema);\r\n\r\n\t\t// Convert move data-mce-src, data-mce-href and data-mce-style into nodes or process them if needed\r\n\t\thtmlParser.addAttributeFilter('src,href,style', function(nodes, name) {\r\n\t\t\tvar i = nodes.length, node, value, internalName = 'data-mce-' + name, urlConverter = settings.url_converter, urlConverterScope = settings.url_converter_scope, undef;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnode = nodes[i];\r\n\r\n\t\t\t\tvalue = node.attributes.map[internalName];\r\n\t\t\t\tif (value !== undef) {\r\n\t\t\t\t\t// Set external name to internal value and remove internal\r\n\t\t\t\t\tnode.attr(name, value.length > 0 ? value : null);\r\n\t\t\t\t\tnode.attr(internalName, null);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// No internal attribute found then convert the value we have in the DOM\r\n\t\t\t\t\tvalue = node.attributes.map[name];\r\n\r\n\t\t\t\t\tif (name === \"style\")\r\n\t\t\t\t\t\tvalue = dom.serializeStyle(dom.parseStyle(value), node.name);\r\n\t\t\t\t\telse if (urlConverter)\r\n\t\t\t\t\t\tvalue = urlConverter.call(urlConverterScope, value, name, node.name);\r\n\r\n\t\t\t\t\tnode.attr(name, value.length > 0 ? value : null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Remove internal classes mceItem<..>\r\n\t\thtmlParser.addAttributeFilter('class', function(nodes, name) {\r\n\t\t\tvar i = nodes.length, node, value;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnode = nodes[i];\r\n\t\t\t\tvalue = node.attr('class').replace(/\\s*mce(Item\\w+|Selected)\\s*/g, '');\r\n\t\t\t\tnode.attr('class', value.length > 0 ? value : null);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Remove bookmark elements\r\n\t\thtmlParser.addAttributeFilter('data-mce-type', function(nodes, name, args) {\r\n\t\t\tvar i = nodes.length, node;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnode = nodes[i];\r\n\r\n\t\t\t\tif (node.attributes.map['data-mce-type'] === 'bookmark' && !args.cleanup)\r\n\t\t\t\t\tnode.remove();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Force script into CDATA sections and remove the mce- prefix also add comments around styles\r\n\t\thtmlParser.addNodeFilter('script,style', function(nodes, name) {\r\n\t\t\tvar i = nodes.length, node, value;\r\n\r\n\t\t\tfunction trim(value) {\r\n\t\t\t\treturn value.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g, '\\n')\r\n\t\t\t\t\t\t.replace(/^[\\r\\n]*|[\\r\\n]*$/g, '')\r\n\t\t\t\t\t\t.replace(/^\\s*(\\/\\/\\s*<!--|\\/\\/\\s*<!\\[CDATA\\[|<!--|<!\\[CDATA\\[)[\\r\\n]*/g, '')\r\n\t\t\t\t\t\t.replace(/\\s*(\\/\\/\\s*\\]\\]>|\\/\\/\\s*-->|\\]\\]>|-->|\\]\\]-->)\\s*$/g, '');\r\n\t\t\t};\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnode = nodes[i];\r\n\t\t\t\tvalue = node.firstChild ? node.firstChild.value : '';\r\n\r\n\t\t\t\tif (name === \"script\") {\r\n\t\t\t\t\t// Remove mce- prefix from script elements\r\n\t\t\t\t\tnode.attr('type', (node.attr('type') || 'text/javascript').replace(/^mce\\-/, ''));\r\n\r\n\t\t\t\t\tif (value.length > 0)\r\n\t\t\t\t\t\tnode.firstChild.value = '// <![CDATA[\\n' + trim(value) + '\\n// ]]>';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (value.length > 0)\r\n\t\t\t\t\t\tnode.firstChild.value = '<!--\\n' + trim(value) + '\\n-->';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Convert comments to cdata and handle protected comments\r\n\t\thtmlParser.addNodeFilter('#comment', function(nodes, name) {\r\n\t\t\tvar i = nodes.length, node;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnode = nodes[i];\r\n\r\n\t\t\t\tif (node.value.indexOf('[CDATA[') === 0) {\r\n\t\t\t\t\tnode.name = '#cdata';\r\n\t\t\t\t\tnode.type = 4;\r\n\t\t\t\t\tnode.value = node.value.replace(/^\\[CDATA\\[|\\]\\]$/g, '');\r\n\t\t\t\t} else if (node.value.indexOf('mce:protected ') === 0) {\r\n\t\t\t\t\tnode.name = \"#text\";\r\n\t\t\t\t\tnode.type = 3;\r\n\t\t\t\t\tnode.raw = true;\r\n\t\t\t\t\tnode.value = unescape(node.value).substr(14);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\thtmlParser.addNodeFilter('xml:namespace,input', function(nodes, name) {\r\n\t\t\tvar i = nodes.length, node;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnode = nodes[i];\r\n\t\t\t\tif (node.type === 7)\r\n\t\t\t\t\tnode.remove();\r\n\t\t\t\telse if (node.type === 1) {\r\n\t\t\t\t\tif (name === \"input\" && !(\"type\" in node.attributes.map))\r\n\t\t\t\t\t\tnode.attr('type', 'text');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Fix list elements, TODO: Replace this later\r\n\t\tif (settings.fix_list_elements) {\r\n\t\t\thtmlParser.addNodeFilter('ul,ol', function(nodes, name) {\r\n\t\t\t\tvar i = nodes.length, node, parentNode;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\tparentNode = node.parent;\r\n\r\n\t\t\t\t\tif (parentNode.name === 'ul' || parentNode.name === 'ol') {\r\n\t\t\t\t\t\tif (node.prev && node.prev.name === 'li') {\r\n\t\t\t\t\t\t\tnode.prev.append(node);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Remove internal data attributes\r\n\t\thtmlParser.addAttributeFilter('data-mce-src,data-mce-href,data-mce-style', function(nodes, name) {\r\n\t\t\tvar i = nodes.length;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnodes[i].attr(name, null);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Return public methods\r\n\t\treturn {\r\n\t\t\tschema : schema,\r\n\r\n\t\t\taddNodeFilter : htmlParser.addNodeFilter,\r\n\r\n\t\t\taddAttributeFilter : htmlParser.addAttributeFilter,\r\n\r\n\t\t\tonPreProcess : onPreProcess,\r\n\r\n\t\t\tonPostProcess : onPostProcess,\r\n\r\n\t\t\tserialize : function(node, args) {\r\n\t\t\t\tvar impl, doc, oldDoc, htmlSerializer, content;\r\n\r\n\t\t\t\t// Explorer won't clone contents of script and style and the\r\n\t\t\t\t// selected index of select elements are cleared on a clone operation.\r\n\t\t\t\tif (isIE && dom.select('script,style,select,map').length > 0) {\r\n\t\t\t\t\tcontent = node.innerHTML;\r\n\t\t\t\t\tnode = node.cloneNode(false);\r\n\t\t\t\t\tdom.setHTML(node, content);\r\n\t\t\t\t} else\r\n\t\t\t\t\tnode = node.cloneNode(true);\r\n\r\n\t\t\t\t// Nodes needs to be attached to something in WebKit/Opera\r\n\t\t\t\t// Older builds of Opera crashes if you attach the node to an document created dynamically\r\n\t\t\t\t// and since we can't feature detect a crash we need to sniff the acutal build number\r\n\t\t\t\t// This fix will make DOM ranges and make Sizzle happy!\r\n\t\t\t\timpl = node.ownerDocument.implementation;\r\n\t\t\t\tif (impl.createHTMLDocument) {\r\n\t\t\t\t\t// Create an empty HTML document\r\n\t\t\t\t\tdoc = impl.createHTMLDocument(\"\");\r\n\r\n\t\t\t\t\t// Add the element or it's children if it's a body element to the new document\r\n\t\t\t\t\teach(node.nodeName == 'BODY' ? node.childNodes : [node], function(node) {\r\n\t\t\t\t\t\tdoc.body.appendChild(doc.importNode(node, true));\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Grab first child or body element for serialization\r\n\t\t\t\t\tif (node.nodeName != 'BODY')\r\n\t\t\t\t\t\tnode = doc.body.firstChild;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tnode = doc.body;\r\n\r\n\t\t\t\t\t// set the new document in DOMUtils so createElement etc works\r\n\t\t\t\t\toldDoc = dom.doc;\r\n\t\t\t\t\tdom.doc = doc;\r\n\t\t\t\t}\r\n\r\n\t\t\t\targs = args || {};\r\n\t\t\t\targs.format = args.format || 'html';\r\n\r\n\t\t\t\t// Pre process\r\n\t\t\t\tif (!args.no_events) {\r\n\t\t\t\t\targs.node = node;\r\n\t\t\t\t\tonPreProcess.dispatch(self, args);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Setup serializer\r\n\t\t\t\thtmlSerializer = new tinymce.html.Serializer(settings, schema);\r\n\r\n\t\t\t\t// Parse and serialize HTML\r\n\t\t\t\targs.content = htmlSerializer.serialize(\r\n\t\t\t\t\thtmlParser.parse(args.getInner ? node.innerHTML : tinymce.trim(dom.getOuterHTML(node), args), args)\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Replace all BOM characters for now until we can find a better solution\r\n\t\t\t\tif (!args.cleanup)\r\n\t\t\t\t\targs.content = args.content.replace(/\\uFEFF|\\u200B/g, '');\r\n\r\n\t\t\t\t// Post process\r\n\t\t\t\tif (!args.no_events)\r\n\t\t\t\t\tonPostProcess.dispatch(self, args);\r\n\r\n\t\t\t\t// Restore the old document if it was changed\r\n\t\t\t\tif (oldDoc)\r\n\t\t\t\t\tdom.doc = oldDoc;\r\n\r\n\t\t\t\targs.node = null;\r\n\r\n\t\t\t\treturn args.content;\r\n\t\t\t},\r\n\r\n\t\t\taddRules : function(rules) {\r\n\t\t\t\tschema.addValidElements(rules);\r\n\t\t\t},\r\n\r\n\t\t\tsetRules : function(rules) {\r\n\t\t\t\tschema.setValidElements(rules);\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n})(tinymce);\r\n(function(tinymce) {\r\n\ttinymce.dom.ScriptLoader = function(settings) {\r\n\t\tvar QUEUED = 0,\r\n\t\t\tLOADING = 1,\r\n\t\t\tLOADED = 2,\r\n\t\t\tstates = {},\r\n\t\t\tqueue = [],\r\n\t\t\tscriptLoadedCallbacks = {},\r\n\t\t\tqueueLoadedCallbacks = [],\r\n\t\t\tloading = 0,\r\n\t\t\tundefined;\r\n\r\n\t\tfunction loadScript(url, callback) {\r\n\t\t\tvar t = this, dom = tinymce.DOM, elm, uri, loc, id;\r\n\r\n\t\t\t// Execute callback when script is loaded\r\n\t\t\tfunction done() {\r\n\t\t\t\tdom.remove(id);\r\n\r\n\t\t\t\tif (elm)\r\n\t\t\t\t\telm.onreadystatechange = elm.onload = elm = null;\r\n\r\n\t\t\t\tcallback();\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tfunction error() {\r\n\t\t\t\t// Report the error so it's easier for people to spot loading errors\r\n\t\t\t\tif (typeof(console) !== \"undefined\" && console.log)\r\n\t\t\t\t\tconsole.log(\"Failed to load: \" + url);\r\n\r\n\t\t\t\t// We can't mark it as done if there is a load error since\r\n\t\t\t\t// A) We don't want to produce 404 errors on the server and\r\n\t\t\t\t// B) the onerror event won't fire on all browsers.\r\n\t\t\t\t// done();\r\n\t\t\t};\r\n\r\n\t\t\tid = dom.uniqueId();\r\n\r\n\t\t\tif (tinymce.isIE6) {\r\n\t\t\t\turi = new tinymce.util.URI(url);\r\n\t\t\t\tloc = location;\r\n\r\n\t\t\t\t// If script is from same domain and we\r\n\t\t\t\t// use IE 6 then use XHR since it's more reliable\r\n\t\t\t\tif (uri.host == loc.hostname && uri.port == loc.port && (uri.protocol + ':') == loc.protocol && uri.protocol.toLowerCase() != 'file') {\r\n\t\t\t\t\ttinymce.util.XHR.send({\r\n\t\t\t\t\t\turl : tinymce._addVer(uri.getURI()),\r\n\t\t\t\t\t\tsuccess : function(content) {\r\n\t\t\t\t\t\t\t// Create new temp script element\r\n\t\t\t\t\t\t\tvar script = dom.create('script', {\r\n\t\t\t\t\t\t\t\ttype : 'text/javascript'\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t// Evaluate script in global scope\r\n\t\t\t\t\t\t\tscript.text = content;\r\n\t\t\t\t\t\t\tdocument.getElementsByTagName('head')[0].appendChild(script);\r\n\t\t\t\t\t\t\tdom.remove(script);\r\n\r\n\t\t\t\t\t\t\tdone();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\terror : error\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Create new script element\r\n\t\t\telm = dom.create('script', {\r\n\t\t\t\tid : id,\r\n\t\t\t\ttype : 'text/javascript',\r\n\t\t\t\tsrc : tinymce._addVer(url)\r\n\t\t\t});\r\n\r\n\t\t\t// Add onload listener for non IE browsers since IE9\r\n\t\t\t// fires onload event before the script is parsed and executed\r\n\t\t\tif (!tinymce.isIE)\r\n\t\t\t\telm.onload = done;\r\n\r\n\t\t\t// Add onerror event will get fired on some browsers but not all of them\r\n\t\t\telm.onerror = error;\r\n\r\n\t\t\t// Opera 9.60 doesn't seem to fire the onreadystate event at correctly\r\n\t\t\tif (!tinymce.isOpera) {\r\n\t\t\t\telm.onreadystatechange = function() {\r\n\t\t\t\t\tvar state = elm.readyState;\r\n\r\n\t\t\t\t\t// Loaded state is passed on IE 6 however there\r\n\t\t\t\t\t// are known issues with this method but we can't use\r\n\t\t\t\t\t// XHR in a cross domain loading\r\n\t\t\t\t\tif (state == 'complete' || state == 'loaded')\r\n\t\t\t\t\t\tdone();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// Most browsers support this feature so we report errors\r\n\t\t\t// for those at least to help users track their missing plugins etc\r\n\t\t\t// todo: Removed since it produced error if the document is unloaded by navigating away, re-add it as an option\r\n\t\t\t/*elm.onerror = function() {\r\n\t\t\t\talert('Failed to load: ' + url);\r\n\t\t\t};*/\r\n\r\n\t\t\t// Add script to document\r\n\t\t\t(document.getElementsByTagName('head')[0] || document.body).appendChild(elm);\r\n\t\t};\r\n\r\n\t\tthis.isDone = function(url) {\r\n\t\t\treturn states[url] == LOADED;\r\n\t\t};\r\n\r\n\t\tthis.markDone = function(url) {\r\n\t\t\tstates[url] = LOADED;\r\n\t\t};\r\n\r\n\t\tthis.add = this.load = function(url, callback, scope) {\r\n\t\t\tvar item, state = states[url];\r\n\r\n\t\t\t// Add url to load queue\r\n\t\t\tif (state == undefined) {\r\n\t\t\t\tqueue.push(url);\r\n\t\t\t\tstates[url] = QUEUED;\r\n\t\t\t}\r\n\r\n\t\t\tif (callback) {\r\n\t\t\t\t// Store away callback for later execution\r\n\t\t\t\tif (!scriptLoadedCallbacks[url])\r\n\t\t\t\t\tscriptLoadedCallbacks[url] = [];\r\n\r\n\t\t\t\tscriptLoadedCallbacks[url].push({\r\n\t\t\t\t\tfunc : callback,\r\n\t\t\t\t\tscope : scope || this\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.loadQueue = function(callback, scope) {\r\n\t\t\tthis.loadScripts(queue, callback, scope);\r\n\t\t};\r\n\r\n\t\tthis.loadScripts = function(scripts, callback, scope) {\r\n\t\t\tvar loadScripts;\r\n\r\n\t\t\tfunction execScriptLoadedCallbacks(url) {\r\n\t\t\t\t// Execute URL callback functions\r\n\t\t\t\ttinymce.each(scriptLoadedCallbacks[url], function(callback) {\r\n\t\t\t\t\tcallback.func.call(callback.scope);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tscriptLoadedCallbacks[url] = undefined;\r\n\t\t\t};\r\n\r\n\t\t\tqueueLoadedCallbacks.push({\r\n\t\t\t\tfunc : callback,\r\n\t\t\t\tscope : scope || this\r\n\t\t\t});\r\n\r\n\t\t\tloadScripts = function() {\r\n\t\t\t\tvar loadingScripts = tinymce.grep(scripts);\r\n\r\n\t\t\t\t// Current scripts has been handled\r\n\t\t\t\tscripts.length = 0;\r\n\r\n\t\t\t\t// Load scripts that needs to be loaded\r\n\t\t\t\ttinymce.each(loadingScripts, function(url) {\r\n\t\t\t\t\t// Script is already loaded then execute script callbacks directly\r\n\t\t\t\t\tif (states[url] == LOADED) {\r\n\t\t\t\t\t\texecScriptLoadedCallbacks(url);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Is script not loading then start loading it\r\n\t\t\t\t\tif (states[url] != LOADING) {\r\n\t\t\t\t\t\tstates[url] = LOADING;\r\n\t\t\t\t\t\tloading++;\r\n\r\n\t\t\t\t\t\tloadScript(url, function() {\r\n\t\t\t\t\t\t\tstates[url] = LOADED;\r\n\t\t\t\t\t\t\tloading--;\r\n\r\n\t\t\t\t\t\t\texecScriptLoadedCallbacks(url);\r\n\r\n\t\t\t\t\t\t\t// Load more scripts if they where added by the recently loaded script\r\n\t\t\t\t\t\t\tloadScripts();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// No scripts are currently loading then execute all pending queue loaded callbacks\r\n\t\t\t\tif (!loading) {\r\n\t\t\t\t\ttinymce.each(queueLoadedCallbacks, function(callback) {\r\n\t\t\t\t\t\tcallback.func.call(callback.scope);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tqueueLoadedCallbacks.length = 0;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tloadScripts();\r\n\t\t};\r\n\t};\r\n\r\n\t// Global script loader\r\n\ttinymce.ScriptLoader = new tinymce.dom.ScriptLoader();\r\n})(tinymce);\r\n\r\ntinymce.dom.TreeWalker = function(start_node, root_node) {\r\n\tvar node = start_node;\r\n\r\n\tfunction findSibling(node, start_name, sibling_name, shallow) {\r\n\t\tvar sibling, parent;\r\n\r\n\t\tif (node) {\r\n\t\t\t// Walk into nodes if it has a start\r\n\t\t\tif (!shallow && node[start_name])\r\n\t\t\t\treturn node[start_name];\r\n\r\n\t\t\t// Return the sibling if it has one\r\n\t\t\tif (node != root_node) {\r\n\t\t\t\tsibling = node[sibling_name];\r\n\t\t\t\tif (sibling)\r\n\t\t\t\t\treturn sibling;\r\n\r\n\t\t\t\t// Walk up the parents to look for siblings\r\n\t\t\t\tfor (parent = node.parentNode; parent && parent != root_node; parent = parent.parentNode) {\r\n\t\t\t\t\tsibling = parent[sibling_name];\r\n\t\t\t\t\tif (sibling)\r\n\t\t\t\t\t\treturn sibling;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis.current = function() {\r\n\t\treturn node;\r\n\t};\r\n\r\n\tthis.next = function(shallow) {\r\n\t\treturn (node = findSibling(node, 'firstChild', 'nextSibling', shallow));\r\n\t};\r\n\r\n\tthis.prev = function(shallow) {\r\n\t\treturn (node = findSibling(node, 'lastChild', 'previousSibling', shallow));\r\n\t};\r\n};\r\n\r\n(function(tinymce) {\r\n\ttinymce.dom.RangeUtils = function(dom) {\r\n\t\tvar INVISIBLE_CHAR = '\\uFEFF';\r\n\r\n\t\tthis.walk = function(rng, callback) {\r\n\t\t\tvar startContainer = rng.startContainer,\r\n\t\t\t\tstartOffset = rng.startOffset,\r\n\t\t\t\tendContainer = rng.endContainer,\r\n\t\t\t\tendOffset = rng.endOffset,\r\n\t\t\t\tancestor, startPoint,\r\n\t\t\t\tendPoint, node, parent, siblings, nodes;\r\n\r\n\t\t\t// Handle table cell selection the table plugin enables\r\n\t\t\t// you to fake select table cells and perform formatting actions on them\r\n\t\t\tnodes = dom.select('td.mceSelected,th.mceSelected');\r\n\t\t\tif (nodes.length > 0) {\r\n\t\t\t\ttinymce.each(nodes, function(node) {\r\n\t\t\t\t\tcallback([node]);\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tfunction exclude(nodes) {\r\n\t\t\t\tvar node;\r\n\r\n\t\t\t\t// First node is excluded\r\n\t\t\t\tnode = nodes[0];\r\n\t\t\t\tif (node.nodeType === 3 && node === startContainer && startOffset >= node.nodeValue.length) {\r\n\t\t\t\t\tnodes.splice(0, 1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Last node is excluded\r\n\t\t\t\tnode = nodes[nodes.length - 1];\r\n\t\t\t\tif (endOffset === 0 && nodes.length > 0 && node === endContainer && node.nodeType === 3) {\r\n\t\t\t\t\tnodes.splice(nodes.length - 1, 1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn nodes;\r\n\t\t\t};\r\n\r\n\t\t\tfunction collectSiblings(node, name, end_node) {\r\n\t\t\t\tvar siblings = [];\r\n\r\n\t\t\t\tfor (; node && node != end_node; node = node[name])\r\n\t\t\t\t\tsiblings.push(node);\r\n\r\n\t\t\t\treturn siblings;\r\n\t\t\t};\r\n\r\n\t\t\tfunction findEndPoint(node, root) {\r\n\t\t\t\tdo {\r\n\t\t\t\t\tif (node.parentNode == root)\r\n\t\t\t\t\t\treturn node;\r\n\r\n\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t} while(node);\r\n\t\t\t};\r\n\r\n\t\t\tfunction walkBoundary(start_node, end_node, next) {\r\n\t\t\t\tvar siblingName = next ? 'nextSibling' : 'previousSibling';\r\n\r\n\t\t\t\tfor (node = start_node, parent = node.parentNode; node && node != end_node; node = parent) {\r\n\t\t\t\t\tparent = node.parentNode;\r\n\t\t\t\t\tsiblings = collectSiblings(node == start_node ? node : node[siblingName], siblingName);\r\n\r\n\t\t\t\t\tif (siblings.length) {\r\n\t\t\t\t\t\tif (!next)\r\n\t\t\t\t\t\t\tsiblings.reverse();\r\n\r\n\t\t\t\t\t\tcallback(exclude(siblings));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// If index based start position then resolve it\r\n\t\t\tif (startContainer.nodeType == 1 && startContainer.hasChildNodes())\r\n\t\t\t\tstartContainer = startContainer.childNodes[startOffset];\r\n\r\n\t\t\t// If index based end position then resolve it\r\n\t\t\tif (endContainer.nodeType == 1 && endContainer.hasChildNodes())\r\n\t\t\t\tendContainer = endContainer.childNodes[Math.min(endOffset - 1, endContainer.childNodes.length - 1)];\r\n\r\n\t\t\t// Same container\r\n\t\t\tif (startContainer == endContainer)\r\n\t\t\t\treturn callback(exclude([startContainer]));\r\n\r\n\t\t\t// Find common ancestor and end points\r\n\t\t\tancestor = dom.findCommonAncestor(startContainer, endContainer);\r\n\t\t\t\t\r\n\t\t\t// Process left side\r\n\t\t\tfor (node = startContainer; node; node = node.parentNode) {\r\n\t\t\t\tif (node === endContainer)\r\n\t\t\t\t\treturn walkBoundary(startContainer, ancestor, true);\r\n\r\n\t\t\t\tif (node === ancestor)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\t// Process right side\r\n\t\t\tfor (node = endContainer; node; node = node.parentNode) {\r\n\t\t\t\tif (node === startContainer)\r\n\t\t\t\t\treturn walkBoundary(endContainer, ancestor);\r\n\r\n\t\t\t\tif (node === ancestor)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\t// Find start/end point\r\n\t\t\tstartPoint = findEndPoint(startContainer, ancestor) || startContainer;\r\n\t\t\tendPoint = findEndPoint(endContainer, ancestor) || endContainer;\r\n\r\n\t\t\t// Walk left leaf\r\n\t\t\twalkBoundary(startContainer, startPoint, true);\r\n\r\n\t\t\t// Walk the middle from start to end point\r\n\t\t\tsiblings = collectSiblings(\r\n\t\t\t\tstartPoint == startContainer ? startPoint : startPoint.nextSibling,\r\n\t\t\t\t'nextSibling',\r\n\t\t\t\tendPoint == endContainer ? endPoint.nextSibling : endPoint\r\n\t\t\t);\r\n\r\n\t\t\tif (siblings.length)\r\n\t\t\t\tcallback(exclude(siblings));\r\n\r\n\t\t\t// Walk right leaf\r\n\t\t\twalkBoundary(endContainer, endPoint);\r\n\t\t};\r\n\r\n\t\tthis.split = function(rng) {\r\n\t\t\tvar startContainer = rng.startContainer,\r\n\t\t\t\tstartOffset = rng.startOffset,\r\n\t\t\t\tendContainer = rng.endContainer,\r\n\t\t\t\tendOffset = rng.endOffset;\r\n\r\n\t\t\tfunction splitText(node, offset) {\r\n\t\t\t\treturn node.splitText(offset);\r\n\t\t\t};\r\n\r\n\t\t\t// Handle single text node\r\n\t\t\tif (startContainer == endContainer && startContainer.nodeType == 3) {\r\n\t\t\t\tif (startOffset > 0 && startOffset < startContainer.nodeValue.length) {\r\n\t\t\t\t\tendContainer = splitText(startContainer, startOffset);\r\n\t\t\t\t\tstartContainer = endContainer.previousSibling;\r\n\r\n\t\t\t\t\tif (endOffset > startOffset) {\r\n\t\t\t\t\t\tendOffset = endOffset - startOffset;\r\n\t\t\t\t\t\tstartContainer = endContainer = splitText(endContainer, endOffset).previousSibling;\r\n\t\t\t\t\t\tendOffset = endContainer.nodeValue.length;\r\n\t\t\t\t\t\tstartOffset = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tendOffset = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Split startContainer text node if needed\r\n\t\t\t\tif (startContainer.nodeType == 3 && startOffset > 0 && startOffset < startContainer.nodeValue.length) {\r\n\t\t\t\t\tstartContainer = splitText(startContainer, startOffset);\r\n\t\t\t\t\tstartOffset = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Split endContainer text node if needed\r\n\t\t\t\tif (endContainer.nodeType == 3 && endOffset > 0 && endOffset < endContainer.nodeValue.length) {\r\n\t\t\t\t\tendContainer = splitText(endContainer, endOffset).previousSibling;\r\n\t\t\t\t\tendOffset = endContainer.nodeValue.length;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tstartContainer : startContainer,\r\n\t\t\t\tstartOffset : startOffset,\r\n\t\t\t\tendContainer : endContainer,\r\n\t\t\t\tendOffset : endOffset\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t};\r\n\r\n\ttinymce.dom.RangeUtils.compareRanges = function(rng1, rng2) {\r\n\t\tif (rng1 && rng2) {\r\n\t\t\t// Compare native IE ranges\r\n\t\t\tif (rng1.item || rng1.duplicate) {\r\n\t\t\t\t// Both are control ranges and the selected element matches\r\n\t\t\t\tif (rng1.item && rng2.item && rng1.item(0) === rng2.item(0))\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\t// Both are text ranges and the range matches\r\n\t\t\t\tif (rng1.isEqual && rng2.isEqual && rng2.isEqual(rng1))\r\n\t\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\t// Compare w3c ranges\r\n\t\t\t\treturn rng1.startContainer == rng2.startContainer && rng1.startOffset == rng2.startOffset;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t};\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar Event = tinymce.dom.Event, each = tinymce.each;\r\n\r\n\ttinymce.create('tinymce.ui.KeyboardNavigation', {\r\n\t\tKeyboardNavigation: function(settings, dom) {\r\n\t\t\tvar t = this, root = settings.root, items = settings.items,\r\n\t\t\t\t\tenableUpDown = settings.enableUpDown, enableLeftRight = settings.enableLeftRight || !settings.enableUpDown,\r\n\t\t\t\t\texcludeFromTabOrder = settings.excludeFromTabOrder,\r\n\t\t\t\t\titemFocussed, itemBlurred, rootKeydown, rootFocussed, focussedId;\r\n\r\n\t\t\tdom = dom || tinymce.DOM;\r\n\r\n\t\t\titemFocussed = function(evt) {\r\n\t\t\t\tfocussedId = evt.target.id;\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\titemBlurred = function(evt) {\r\n\t\t\t\tdom.setAttrib(evt.target.id, 'tabindex', '-1');\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\trootFocussed = function(evt) {\r\n\t\t\t\tvar item = dom.get(focussedId);\r\n\t\t\t\tdom.setAttrib(item, 'tabindex', '0');\r\n\t\t\t\titem.focus();\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tt.focus = function() {\r\n\t\t\t\tdom.get(focussedId).focus();\r\n\t\t\t};\r\n\r\n\t\t\tt.destroy = function() {\r\n\t\t\t\teach(items, function(item) {\r\n\t\t\t\t\tdom.unbind(dom.get(item.id), 'focus', itemFocussed);\r\n\t\t\t\t\tdom.unbind(dom.get(item.id), 'blur', itemBlurred);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tdom.unbind(dom.get(root), 'focus', rootFocussed);\r\n\t\t\t\tdom.unbind(dom.get(root), 'keydown', rootKeydown);\r\n\r\n\t\t\t\titems = dom = root = t.focus = itemFocussed = itemBlurred = rootKeydown = rootFocussed = null;\r\n\t\t\t\tt.destroy = function() {};\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tt.moveFocus = function(dir, evt) {\r\n\t\t\t\tvar idx = -1, controls = t.controls, newFocus;\r\n\r\n\t\t\t\tif (!focussedId)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\teach(items, function(item, index) {\r\n\t\t\t\t\tif (item.id === focussedId) {\r\n\t\t\t\t\t\tidx = index;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tidx += dir;\r\n\t\t\t\tif (idx < 0) {\r\n\t\t\t\t\tidx = items.length - 1;\r\n\t\t\t\t} else if (idx >= items.length) {\r\n\t\t\t\t\tidx = 0;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tnewFocus = items[idx];\r\n\t\t\t\tdom.setAttrib(focussedId, 'tabindex', '-1');\r\n\t\t\t\tdom.setAttrib(newFocus.id, 'tabindex', '0');\r\n\t\t\t\tdom.get(newFocus.id).focus();\r\n\r\n\t\t\t\tif (settings.actOnFocus) {\r\n\t\t\t\t\tsettings.onAction(newFocus.id);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (evt)\r\n\t\t\t\t\tEvent.cancel(evt);\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\trootKeydown = function(evt) {\r\n\t\t\t\tvar DOM_VK_LEFT = 37, DOM_VK_RIGHT = 39, DOM_VK_UP = 38, DOM_VK_DOWN = 40, DOM_VK_ESCAPE = 27, DOM_VK_ENTER = 14, DOM_VK_RETURN = 13, DOM_VK_SPACE = 32;\r\n\t\t\t\t\r\n\t\t\t\tswitch (evt.keyCode) {\r\n\t\t\t\t\tcase DOM_VK_LEFT:\r\n\t\t\t\t\t\tif (enableLeftRight) t.moveFocus(-1);\r\n\t\t\t\t\t\tbreak;\r\n\t\r\n\t\t\t\t\tcase DOM_VK_RIGHT:\r\n\t\t\t\t\t\tif (enableLeftRight) t.moveFocus(1);\r\n\t\t\t\t\t\tbreak;\r\n\t\r\n\t\t\t\t\tcase DOM_VK_UP:\r\n\t\t\t\t\t\tif (enableUpDown) t.moveFocus(-1);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase DOM_VK_DOWN:\r\n\t\t\t\t\t\tif (enableUpDown) t.moveFocus(1);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase DOM_VK_ESCAPE:\r\n\t\t\t\t\t\tif (settings.onCancel) {\r\n\t\t\t\t\t\t\tsettings.onCancel();\r\n\t\t\t\t\t\t\tEvent.cancel(evt);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase DOM_VK_ENTER:\r\n\t\t\t\t\tcase DOM_VK_RETURN:\r\n\t\t\t\t\tcase DOM_VK_SPACE:\r\n\t\t\t\t\t\tif (settings.onAction) {\r\n\t\t\t\t\t\t\tsettings.onAction(focussedId);\r\n\t\t\t\t\t\t\tEvent.cancel(evt);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// Set up state and listeners for each item.\r\n\t\t\teach(items, function(item, idx) {\r\n\t\t\t\tvar tabindex;\r\n\r\n\t\t\t\tif (!item.id) {\r\n\t\t\t\t\titem.id = dom.uniqueId('_mce_item_');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (excludeFromTabOrder) {\r\n\t\t\t\t\tdom.bind(item.id, 'blur', itemBlurred);\r\n\t\t\t\t\ttabindex = '-1';\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttabindex = (idx === 0 ? '0' : '-1');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdom.setAttrib(item.id, 'tabindex', tabindex);\r\n\t\t\t\tdom.bind(dom.get(item.id), 'focus', itemFocussed);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t// Setup initial state for root element.\r\n\t\t\tif (items[0]){\r\n\t\t\t\tfocussedId = items[0].id;\r\n\t\t\t}\r\n\r\n\t\t\tdom.setAttrib(root, 'tabindex', '-1');\r\n\t\t\t\r\n\t\t\t// Setup listeners for root element.\r\n\t\t\tdom.bind(dom.get(root), 'focus', rootFocussed);\r\n\t\t\tdom.bind(dom.get(root), 'keydown', rootKeydown);\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\t// Shorten class names\r\n\tvar DOM = tinymce.DOM, is = tinymce.is;\r\n\r\n\ttinymce.create('tinymce.ui.Control', {\r\n\t\tControl : function(id, s, editor) {\r\n\t\t\tthis.id = id;\r\n\t\t\tthis.settings = s = s || {};\r\n\t\t\tthis.rendered = false;\r\n\t\t\tthis.onRender = new tinymce.util.Dispatcher(this);\r\n\t\t\tthis.classPrefix = '';\r\n\t\t\tthis.scope = s.scope || this;\r\n\t\t\tthis.disabled = 0;\r\n\t\t\tthis.active = 0;\r\n\t\t\tthis.editor = editor;\r\n\t\t},\r\n\t\t\r\n\t\tsetAriaProperty : function(property, value) {\r\n\t\t\tvar element = DOM.get(this.id + '_aria') || DOM.get(this.id);\r\n\t\t\tif (element) {\r\n\t\t\t\tDOM.setAttrib(element, 'aria-' + property, !!value);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tfocus : function() {\r\n\t\t\tDOM.get(this.id).focus();\r\n\t\t},\r\n\r\n\t\tsetDisabled : function(s) {\r\n\t\t\tif (s != this.disabled) {\r\n\t\t\t\tthis.setAriaProperty('disabled', s);\r\n\r\n\t\t\t\tthis.setState('Disabled', s);\r\n\t\t\t\tthis.setState('Enabled', !s);\r\n\t\t\t\tthis.disabled = s;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tisDisabled : function() {\r\n\t\t\treturn this.disabled;\r\n\t\t},\r\n\r\n\t\tsetActive : function(s) {\r\n\t\t\tif (s != this.active) {\r\n\t\t\t\tthis.setState('Active', s);\r\n\t\t\t\tthis.active = s;\r\n\t\t\t\tthis.setAriaProperty('pressed', s);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tisActive : function() {\r\n\t\t\treturn this.active;\r\n\t\t},\r\n\r\n\t\tsetState : function(c, s) {\r\n\t\t\tvar n = DOM.get(this.id);\r\n\r\n\t\t\tc = this.classPrefix + c;\r\n\r\n\t\t\tif (s)\r\n\t\t\t\tDOM.addClass(n, c);\r\n\t\t\telse\r\n\t\t\t\tDOM.removeClass(n, c);\r\n\t\t},\r\n\r\n\t\tisRendered : function() {\r\n\t\t\treturn this.rendered;\r\n\t\t},\r\n\r\n\t\trenderHTML : function() {\r\n\t\t},\r\n\r\n\t\trenderTo : function(n) {\r\n\t\t\tDOM.setHTML(n, this.renderHTML());\r\n\t\t},\r\n\r\n\t\tpostRender : function() {\r\n\t\t\tvar t = this, b;\r\n\r\n\t\t\t// Set pending states\r\n\t\t\tif (is(t.disabled)) {\r\n\t\t\t\tb = t.disabled;\r\n\t\t\t\tt.disabled = -1;\r\n\t\t\t\tt.setDisabled(b);\r\n\t\t\t}\r\n\r\n\t\t\tif (is(t.active)) {\r\n\t\t\t\tb = t.active;\r\n\t\t\t\tt.active = -1;\r\n\t\t\t\tt.setActive(b);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tremove : function() {\r\n\t\t\tDOM.remove(this.id);\r\n\t\t\tthis.destroy();\r\n\t\t},\r\n\r\n\t\tdestroy : function() {\r\n\t\t\ttinymce.dom.Event.clear(this.id);\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\ntinymce.create('tinymce.ui.Container:tinymce.ui.Control', {\r\n\tContainer : function(id, s, editor) {\r\n\t\tthis.parent(id, s, editor);\r\n\r\n\t\tthis.controls = [];\r\n\r\n\t\tthis.lookup = {};\r\n\t},\r\n\r\n\tadd : function(c) {\r\n\t\tthis.lookup[c.id] = c;\r\n\t\tthis.controls.push(c);\r\n\r\n\t\treturn c;\r\n\t},\r\n\r\n\tget : function(n) {\r\n\t\treturn this.lookup[n];\r\n\t}\r\n});\r\n\r\n\r\ntinymce.create('tinymce.ui.Separator:tinymce.ui.Control', {\r\n\tSeparator : function(id, s) {\r\n\t\tthis.parent(id, s);\r\n\t\tthis.classPrefix = 'mceSeparator';\r\n\t\tthis.setDisabled(true);\r\n\t},\r\n\r\n\trenderHTML : function() {\r\n\t\treturn tinymce.DOM.createHTML('span', {'class' : this.classPrefix, role : 'separator', 'aria-orientation' : 'vertical', tabindex : '-1'});\r\n\t}\r\n});\r\n\r\n(function(tinymce) {\r\n\tvar is = tinymce.is, DOM = tinymce.DOM, each = tinymce.each, walk = tinymce.walk;\r\n\r\n\ttinymce.create('tinymce.ui.MenuItem:tinymce.ui.Control', {\r\n\t\tMenuItem : function(id, s) {\r\n\t\t\tthis.parent(id, s);\r\n\t\t\tthis.classPrefix = 'mceMenuItem';\r\n\t\t},\r\n\r\n\t\tsetSelected : function(s) {\r\n\t\t\tthis.setState('Selected', s);\r\n\t\t\tthis.setAriaProperty('checked', !!s);\r\n\t\t\tthis.selected = s;\r\n\t\t},\r\n\r\n\t\tisSelected : function() {\r\n\t\t\treturn this.selected;\r\n\t\t},\r\n\r\n\t\tpostRender : function() {\r\n\t\t\tvar t = this;\r\n\t\t\t\r\n\t\t\tt.parent();\r\n\r\n\t\t\t// Set pending state\r\n\t\t\tif (is(t.selected))\r\n\t\t\t\tt.setSelected(t.selected);\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar is = tinymce.is, DOM = tinymce.DOM, each = tinymce.each, walk = tinymce.walk;\r\n\r\n\ttinymce.create('tinymce.ui.Menu:tinymce.ui.MenuItem', {\r\n\t\tMenu : function(id, s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.parent(id, s);\r\n\t\t\tt.items = {};\r\n\t\t\tt.collapsed = false;\r\n\t\t\tt.menuCount = 0;\r\n\t\t\tt.onAddItem = new tinymce.util.Dispatcher(this);\r\n\t\t},\r\n\r\n\t\texpand : function(d) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (d) {\r\n\t\t\t\twalk(t, function(o) {\r\n\t\t\t\t\tif (o.expand)\r\n\t\t\t\t\t\to.expand();\r\n\t\t\t\t}, 'items', t);\r\n\t\t\t}\r\n\r\n\t\t\tt.collapsed = false;\r\n\t\t},\r\n\r\n\t\tcollapse : function(d) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (d) {\r\n\t\t\t\twalk(t, function(o) {\r\n\t\t\t\t\tif (o.collapse)\r\n\t\t\t\t\t\to.collapse();\r\n\t\t\t\t}, 'items', t);\r\n\t\t\t}\r\n\r\n\t\t\tt.collapsed = true;\r\n\t\t},\r\n\r\n\t\tisCollapsed : function() {\r\n\t\t\treturn this.collapsed;\r\n\t\t},\r\n\r\n\t\tadd : function(o) {\r\n\t\t\tif (!o.settings)\r\n\t\t\t\to = new tinymce.ui.MenuItem(o.id || DOM.uniqueId(), o);\r\n\r\n\t\t\tthis.onAddItem.dispatch(this, o);\r\n\r\n\t\t\treturn this.items[o.id] = o;\r\n\t\t},\r\n\r\n\t\taddSeparator : function() {\r\n\t\t\treturn this.add({separator : true});\r\n\t\t},\r\n\r\n\t\taddMenu : function(o) {\r\n\t\t\tif (!o.collapse)\r\n\t\t\t\to = this.createMenu(o);\r\n\r\n\t\t\tthis.menuCount++;\r\n\r\n\t\t\treturn this.add(o);\r\n\t\t},\r\n\r\n\t\thasMenus : function() {\r\n\t\t\treturn this.menuCount !== 0;\r\n\t\t},\r\n\r\n\t\tremove : function(o) {\r\n\t\t\tdelete this.items[o.id];\r\n\t\t},\r\n\r\n\t\tremoveAll : function() {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\twalk(t, function(o) {\r\n\t\t\t\tif (o.removeAll)\r\n\t\t\t\t\to.removeAll();\r\n\t\t\t\telse\r\n\t\t\t\t\to.remove();\r\n\r\n\t\t\t\to.destroy();\r\n\t\t\t}, 'items', t);\r\n\r\n\t\t\tt.items = {};\r\n\t\t},\r\n\r\n\t\tcreateMenu : function(o) {\r\n\t\t\tvar m = new tinymce.ui.Menu(o.id || DOM.uniqueId(), o);\r\n\r\n\t\t\tm.onAddItem.add(this.onAddItem.dispatch, this.onAddItem);\r\n\r\n\t\t\treturn m;\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n(function(tinymce) {\r\n\tvar is = tinymce.is, DOM = tinymce.DOM, each = tinymce.each, Event = tinymce.dom.Event, Element = tinymce.dom.Element;\r\n\r\n\ttinymce.create('tinymce.ui.DropMenu:tinymce.ui.Menu', {\r\n\t\tDropMenu : function(id, s) {\r\n\t\t\ts = s || {};\r\n\t\t\ts.container = s.container || DOM.doc.body;\r\n\t\t\ts.offset_x = s.offset_x || 0;\r\n\t\t\ts.offset_y = s.offset_y || 0;\r\n\t\t\ts.vp_offset_x = s.vp_offset_x || 0;\r\n\t\t\ts.vp_offset_y = s.vp_offset_y || 0;\r\n\r\n\t\t\tif (is(s.icons) && !s.icons)\r\n\t\t\t\ts['class'] += ' mceNoIcons';\r\n\r\n\t\t\tthis.parent(id, s);\r\n\t\t\tthis.onShowMenu = new tinymce.util.Dispatcher(this);\r\n\t\t\tthis.onHideMenu = new tinymce.util.Dispatcher(this);\r\n\t\t\tthis.classPrefix = 'mceMenu';\r\n\t\t},\r\n\r\n\t\tcreateMenu : function(s) {\r\n\t\t\tvar t = this, cs = t.settings, m;\r\n\r\n\t\t\ts.container = s.container || cs.container;\r\n\t\t\ts.parent = t;\r\n\t\t\ts.constrain = s.constrain || cs.constrain;\r\n\t\t\ts['class'] = s['class'] || cs['class'];\r\n\t\t\ts.vp_offset_x = s.vp_offset_x || cs.vp_offset_x;\r\n\t\t\ts.vp_offset_y = s.vp_offset_y || cs.vp_offset_y;\r\n\t\t\ts.keyboard_focus = cs.keyboard_focus;\r\n\t\t\tm = new tinymce.ui.DropMenu(s.id || DOM.uniqueId(), s);\r\n\r\n\t\t\tm.onAddItem.add(t.onAddItem.dispatch, t.onAddItem);\r\n\r\n\t\t\treturn m;\r\n\t\t},\r\n\t\t\r\n\t\tfocus : function() {\r\n\t\t\tvar t = this;\r\n\t\t\tif (t.keyboardNav) {\r\n\t\t\t\tt.keyboardNav.focus();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tupdate : function() {\r\n\t\t\tvar t = this, s = t.settings, tb = DOM.get('menu_' + t.id + '_tbl'), co = DOM.get('menu_' + t.id + '_co'), tw, th;\r\n\r\n\t\t\ttw = s.max_width ? Math.min(tb.clientWidth, s.max_width) : tb.clientWidth;\r\n\t\t\tth = s.max_height ? Math.min(tb.clientHeight, s.max_height) : tb.clientHeight;\r\n\r\n\t\t\tif (!DOM.boxModel)\r\n\t\t\t\tt.element.setStyles({width : tw + 2, height : th + 2});\r\n\t\t\telse\r\n\t\t\t\tt.element.setStyles({width : tw, height : th});\r\n\r\n\t\t\tif (s.max_width)\r\n\t\t\t\tDOM.setStyle(co, 'width', tw);\r\n\r\n\t\t\tif (s.max_height) {\r\n\t\t\t\tDOM.setStyle(co, 'height', th);\r\n\r\n\t\t\t\tif (tb.clientHeight < s.max_height)\r\n\t\t\t\t\tDOM.setStyle(co, 'overflow', 'hidden');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tshowMenu : function(x, y, px) {\r\n\t\t\tvar t = this, s = t.settings, co, vp = DOM.getViewPort(), w, h, mx, my, ot = 2, dm, tb, cp = t.classPrefix;\r\n\r\n\t\t\tt.collapse(1);\r\n\r\n\t\t\tif (t.isMenuVisible)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!t.rendered) {\r\n\t\t\t\tco = DOM.add(t.settings.container, t.renderNode());\r\n\r\n\t\t\t\teach(t.items, function(o) {\r\n\t\t\t\t\to.postRender();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.element = new Element('menu_' + t.id, {blocker : 1, container : s.container});\r\n\t\t\t} else\r\n\t\t\t\tco = DOM.get('menu_' + t.id);\r\n\r\n\t\t\t// Move layer out of sight unless it's Opera since it scrolls to top of page due to an bug\r\n\t\t\tif (!tinymce.isOpera)\r\n\t\t\t\tDOM.setStyles(co, {left : -0xFFFF , top : -0xFFFF});\r\n\r\n\t\t\tDOM.show(co);\r\n\t\t\tt.update();\r\n\r\n\t\t\tx += s.offset_x || 0;\r\n\t\t\ty += s.offset_y || 0;\r\n\t\t\tvp.w -= 4;\r\n\t\t\tvp.h -= 4;\r\n\r\n\t\t\t// Move inside viewport if not submenu\r\n\t\t\tif (s.constrain) {\r\n\t\t\t\tw = co.clientWidth - ot;\r\n\t\t\t\th = co.clientHeight - ot;\r\n\t\t\t\tmx = vp.x + vp.w;\r\n\t\t\t\tmy = vp.y + vp.h;\r\n\r\n\t\t\t\tif ((x + s.vp_offset_x + w) > mx)\r\n\t\t\t\t\tx = px ? px - w : Math.max(0, (mx - s.vp_offset_x) - w);\r\n\r\n\t\t\t\tif ((y + s.vp_offset_y + h) > my)\r\n\t\t\t\t\ty = Math.max(0, (my - s.vp_offset_y) - h);\r\n\t\t\t}\r\n\r\n\t\t\tDOM.setStyles(co, {left : x , top : y});\r\n\t\t\tt.element.update();\r\n\r\n\t\t\tt.isMenuVisible = 1;\r\n\t\t\tt.mouseClickFunc = Event.add(co, 'click', function(e) {\r\n\t\t\t\tvar m;\r\n\r\n\t\t\t\te = e.target;\r\n\r\n\t\t\t\tif (e && (e = DOM.getParent(e, 'tr')) && !DOM.hasClass(e, cp + 'ItemSub')) {\r\n\t\t\t\t\tm = t.items[e.id];\r\n\r\n\t\t\t\t\tif (m.isDisabled())\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tdm = t;\r\n\r\n\t\t\t\t\twhile (dm) {\r\n\t\t\t\t\t\tif (dm.hideMenu)\r\n\t\t\t\t\t\t\tdm.hideMenu();\r\n\r\n\t\t\t\t\t\tdm = dm.settings.parent;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (m.settings.onclick)\r\n\t\t\t\t\t\tm.settings.onclick(e);\r\n\r\n\t\t\t\t\treturn Event.cancel(e); // Cancel to fix onbeforeunload problem\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (t.hasMenus()) {\r\n\t\t\t\tt.mouseOverFunc = Event.add(co, 'mouseover', function(e) {\r\n\t\t\t\t\tvar m, r, mi;\r\n\r\n\t\t\t\t\te = e.target;\r\n\t\t\t\t\tif (e && (e = DOM.getParent(e, 'tr'))) {\r\n\t\t\t\t\t\tm = t.items[e.id];\r\n\r\n\t\t\t\t\t\tif (t.lastMenu)\r\n\t\t\t\t\t\t\tt.lastMenu.collapse(1);\r\n\r\n\t\t\t\t\t\tif (m.isDisabled())\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tif (e && DOM.hasClass(e, cp + 'ItemSub')) {\r\n\t\t\t\t\t\t\t//p = DOM.getPos(s.container);\r\n\t\t\t\t\t\t\tr = DOM.getRect(e);\r\n\t\t\t\t\t\t\tm.showMenu((r.x + r.w - ot), r.y - ot, r.x);\r\n\t\t\t\t\t\t\tt.lastMenu = m;\r\n\t\t\t\t\t\t\tDOM.addClass(DOM.get(m.id).firstChild, cp + 'ItemActive');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tEvent.add(co, 'keydown', t._keyHandler, t);\r\n\r\n\t\t\tt.onShowMenu.dispatch(t);\r\n\r\n\t\t\tif (s.keyboard_focus) { \r\n\t\t\t\tt._setupKeyboardNav(); \r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\thideMenu : function(c) {\r\n\t\t\tvar t = this, co = DOM.get('menu_' + t.id), e;\r\n\r\n\t\t\tif (!t.isMenuVisible)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (t.keyboardNav) t.keyboardNav.destroy();\r\n\t\t\tEvent.remove(co, 'mouseover', t.mouseOverFunc);\r\n\t\t\tEvent.remove(co, 'click', t.mouseClickFunc);\r\n\t\t\tEvent.remove(co, 'keydown', t._keyHandler);\r\n\t\t\tDOM.hide(co);\r\n\t\t\tt.isMenuVisible = 0;\r\n\r\n\t\t\tif (!c)\r\n\t\t\t\tt.collapse(1);\r\n\r\n\t\t\tif (t.element)\r\n\t\t\t\tt.element.hide();\r\n\r\n\t\t\tif (e = DOM.get(t.id))\r\n\t\t\t\tDOM.removeClass(e.firstChild, t.classPrefix + 'ItemActive');\r\n\r\n\t\t\tt.onHideMenu.dispatch(t);\r\n\t\t},\r\n\r\n\t\tadd : function(o) {\r\n\t\t\tvar t = this, co;\r\n\r\n\t\t\to = t.parent(o);\r\n\r\n\t\t\tif (t.isRendered && (co = DOM.get('menu_' + t.id)))\r\n\t\t\t\tt._add(DOM.select('tbody', co)[0], o);\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\r\n\t\tcollapse : function(d) {\r\n\t\t\tthis.parent(d);\r\n\t\t\tthis.hideMenu(1);\r\n\t\t},\r\n\r\n\t\tremove : function(o) {\r\n\t\t\tDOM.remove(o.id);\r\n\t\t\tthis.destroy();\r\n\r\n\t\t\treturn this.parent(o);\r\n\t\t},\r\n\r\n\t\tdestroy : function() {\r\n\t\t\tvar t = this, co = DOM.get('menu_' + t.id);\r\n\r\n\t\t\tif (t.keyboardNav) t.keyboardNav.destroy();\r\n\t\t\tEvent.remove(co, 'mouseover', t.mouseOverFunc);\r\n\t\t\tEvent.remove(DOM.select('a', co), 'focus', t.mouseOverFunc);\r\n\t\t\tEvent.remove(co, 'click', t.mouseClickFunc);\r\n\t\t\tEvent.remove(co, 'keydown', t._keyHandler);\r\n\r\n\t\t\tif (t.element)\r\n\t\t\t\tt.element.remove();\r\n\r\n\t\t\tDOM.remove(co);\r\n\t\t},\r\n\r\n\t\trenderNode : function() {\r\n\t\t\tvar t = this, s = t.settings, n, tb, co, w;\r\n\r\n\t\t\tw = DOM.create('div', {role: 'listbox', id : 'menu_' + t.id, 'class' : s['class'], 'style' : 'position:absolute;left:0;top:0;z-index:200000;outline:0'});\r\n\t\t\tif (t.settings.parent) {\r\n\t\t\t\tDOM.setAttrib(w, 'aria-parent', 'menu_' + t.settings.parent.id);\r\n\t\t\t}\r\n\t\t\tco = DOM.add(w, 'div', {role: 'presentation', id : 'menu_' + t.id + '_co', 'class' : t.classPrefix + (s['class'] ? ' ' + s['class'] : '')});\r\n\t\t\tt.element = new Element('menu_' + t.id, {blocker : 1, container : s.container});\r\n\r\n\t\t\tif (s.menu_line)\r\n\t\t\t\tDOM.add(co, 'span', {'class' : t.classPrefix + 'Line'});\r\n\r\n//\t\t\tn = DOM.add(co, 'div', {id : 'menu_' + t.id + '_co', 'class' : 'mceMenuContainer'});\r\n\t\t\tn = DOM.add(co, 'table', {role: 'presentation', id : 'menu_' + t.id + '_tbl', border : 0, cellPadding : 0, cellSpacing : 0});\r\n\t\t\ttb = DOM.add(n, 'tbody');\r\n\r\n\t\t\teach(t.items, function(o) {\r\n\t\t\t\tt._add(tb, o);\r\n\t\t\t});\r\n\r\n\t\t\tt.rendered = true;\r\n\r\n\t\t\treturn w;\r\n\t\t},\r\n\r\n\t\t// Internal functions\r\n\t\t_setupKeyboardNav : function(){\r\n\t\t\tvar contextMenu, menuItems, t=this; \r\n\t\t\tcontextMenu = DOM.select('#menu_' + t.id)[0];\r\n\t\t\tmenuItems = DOM.select('a[role=option]', 'menu_' + t.id);\r\n\t\t\tmenuItems.splice(0,0,contextMenu);\r\n\t\t\tt.keyboardNav = new tinymce.ui.KeyboardNavigation({\r\n\t\t\t\troot: 'menu_' + t.id,\r\n\t\t\t\titems: menuItems,\r\n\t\t\t\tonCancel: function() {\r\n\t\t\t\t\tt.hideMenu();\r\n\t\t\t\t},\r\n\t\t\t\tenableUpDown: true\r\n\t\t\t});\r\n\t\t\tcontextMenu.focus();\r\n\t\t},\r\n\r\n\t\t_keyHandler : function(evt) {\r\n\t\t\tvar t = this, e;\r\n\t\t\tswitch (evt.keyCode) {\r\n\t\t\t\tcase 37: // Left\r\n\t\t\t\t\tif (t.settings.parent) {\r\n\t\t\t\t\t\tt.hideMenu();\r\n\t\t\t\t\t\tt.settings.parent.focus();\r\n\t\t\t\t\t\tEvent.cancel(evt);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 39: // Right\r\n\t\t\t\t\tif (t.mouseOverFunc)\r\n\t\t\t\t\t\tt.mouseOverFunc(evt);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_add : function(tb, o) {\r\n\t\t\tvar n, s = o.settings, a, ro, it, cp = this.classPrefix, ic;\r\n\r\n\t\t\tif (s.separator) {\r\n\t\t\t\tro = DOM.add(tb, 'tr', {id : o.id, 'class' : cp + 'ItemSeparator'});\r\n\t\t\t\tDOM.add(ro, 'td', {'class' : cp + 'ItemSeparator'});\r\n\r\n\t\t\t\tif (n = ro.previousSibling)\r\n\t\t\t\t\tDOM.addClass(n, 'mceLast');\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tn = ro = DOM.add(tb, 'tr', {id : o.id, 'class' : cp + 'Item ' + cp + 'ItemEnabled'});\r\n\t\t\tn = it = DOM.add(n, s.titleItem ? 'th' : 'td');\r\n\t\t\tn = a = DOM.add(n, 'a', {id: o.id + '_aria',  role: s.titleItem ? 'presentation' : 'option', href : 'javascript:;', onclick : \"return false;\", onmousedown : 'return false;'});\r\n\r\n\t\t\tif (s.parent) {\r\n\t\t\t\tDOM.setAttrib(a, 'aria-haspopup', 'true');\r\n\t\t\t\tDOM.setAttrib(a, 'aria-owns', 'menu_' + o.id);\r\n\t\t\t}\r\n\r\n\t\t\tDOM.addClass(it, s['class']);\r\n//\t\t\tn = DOM.add(n, 'span', {'class' : 'item'});\r\n\r\n\t\t\tic = DOM.add(n, 'span', {'class' : 'mceIcon' + (s.icon ? ' mce_' + s.icon : '')});\r\n\r\n\t\t\tif (s.icon_src)\r\n\t\t\t\tDOM.add(ic, 'img', {src : s.icon_src});\r\n\r\n\t\t\tn = DOM.add(n, s.element || 'span', {'class' : 'mceText', title : o.settings.title}, o.settings.title);\r\n\r\n\t\t\tif (o.settings.style)\r\n\t\t\t\tDOM.setAttrib(n, 'style', o.settings.style);\r\n\r\n\t\t\tif (tb.childNodes.length == 1)\r\n\t\t\t\tDOM.addClass(ro, 'mceFirst');\r\n\r\n\t\t\tif ((n = ro.previousSibling) && DOM.hasClass(n, cp + 'ItemSeparator'))\r\n\t\t\t\tDOM.addClass(ro, 'mceFirst');\r\n\r\n\t\t\tif (o.collapse)\r\n\t\t\t\tDOM.addClass(ro, cp + 'ItemSub');\r\n\r\n\t\t\tif (n = ro.previousSibling)\r\n\t\t\t\tDOM.removeClass(n, 'mceLast');\r\n\r\n\t\t\tDOM.addClass(ro, 'mceLast');\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n(function(tinymce) {\r\n\tvar DOM = tinymce.DOM;\r\n\r\n\ttinymce.create('tinymce.ui.Button:tinymce.ui.Control', {\r\n\t\tButton : function(id, s, ed) {\r\n\t\t\tthis.parent(id, s, ed);\r\n\t\t\tthis.classPrefix = 'mceButton';\r\n\t\t},\r\n\r\n\t\trenderHTML : function() {\r\n\t\t\tvar cp = this.classPrefix, s = this.settings, h, l;\r\n\r\n\t\t\tl = DOM.encode(s.label || '');\r\n\t\t\th = '<a role=\"button\" id=\"' + this.id + '\" href=\"javascript:;\" class=\"' + cp + ' ' + cp + 'Enabled ' + s['class'] + (l ? ' ' + cp + 'Labeled' : '') +'\" onmousedown=\"return false;\" onclick=\"return false;\" aria-labelledby=\"' + this.id + '_voice\" title=\"' + DOM.encode(s.title) + '\">';\r\n\t\t\tif (s.image && !(this.editor  &&this.editor.forcedHighContrastMode) )\r\n\t\t\t\th += '<img class=\"mceIcon\" src=\"' + s.image + '\" alt=\"' + DOM.encode(s.title) + '\" />' + l;\r\n\t\t\telse\r\n\t\t\t\th += '<span class=\"mceIcon ' + s['class'] + '\"></span>' + (l ? '<span class=\"' + cp + 'Label\">' + l + '</span>' : '');\r\n\r\n\t\t\th += '<span class=\"mceVoiceLabel mceIconOnly\" style=\"display: none;\" id=\"' + this.id + '_voice\">' + s.title + '</span>'; \r\n\t\t\th += '</a>';\r\n\t\t\treturn h;\r\n\t\t},\r\n\r\n\t\tpostRender : function() {\r\n\t\t\tvar t = this, s = t.settings;\r\n\r\n\t\t\ttinymce.dom.Event.add(t.id, 'click', function(e) {\r\n\t\t\t\tif (!t.isDisabled())\r\n\t\t\t\t\treturn s.onclick.call(s.scope, e);\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, each = tinymce.each, Dispatcher = tinymce.util.Dispatcher;\r\n\r\n\ttinymce.create('tinymce.ui.ListBox:tinymce.ui.Control', {\r\n\t\tListBox : function(id, s, ed) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.parent(id, s, ed);\r\n\r\n\t\t\tt.items = [];\r\n\r\n\t\t\tt.onChange = new Dispatcher(t);\r\n\r\n\t\t\tt.onPostRender = new Dispatcher(t);\r\n\r\n\t\t\tt.onAdd = new Dispatcher(t);\r\n\r\n\t\t\tt.onRenderMenu = new tinymce.util.Dispatcher(this);\r\n\r\n\t\t\tt.classPrefix = 'mceListBox';\r\n\t\t},\r\n\r\n\t\tselect : function(va) {\r\n\t\t\tvar t = this, fv, f;\r\n\r\n\t\t\tif (va == undefined)\r\n\t\t\t\treturn t.selectByIndex(-1);\r\n\r\n\t\t\t// Is string or number make function selector\r\n\t\t\tif (va && va.call)\r\n\t\t\t\tf = va;\r\n\t\t\telse {\r\n\t\t\t\tf = function(v) {\r\n\t\t\t\t\treturn v == va;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// Do we need to do something?\r\n\t\t\tif (va != t.selectedValue) {\r\n\t\t\t\t// Find item\r\n\t\t\t\teach(t.items, function(o, i) {\r\n\t\t\t\t\tif (f(o.value)) {\r\n\t\t\t\t\t\tfv = 1;\r\n\t\t\t\t\t\tt.selectByIndex(i);\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (!fv)\r\n\t\t\t\t\tt.selectByIndex(-1);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tselectByIndex : function(idx) {\r\n\t\t\tvar t = this, e, o, label;\r\n\r\n\t\t\tif (idx != t.selectedIndex) {\r\n\t\t\t\te = DOM.get(t.id + '_text');\r\n\t\t\t\tlabel = DOM.get(t.id + '_voiceDesc');\r\n\t\t\t\to = t.items[idx];\r\n\r\n\t\t\t\tif (o) {\r\n\t\t\t\t\tt.selectedValue = o.value;\r\n\t\t\t\t\tt.selectedIndex = idx;\r\n\t\t\t\t\tDOM.setHTML(e, DOM.encode(o.title));\r\n\t\t\t\t\tDOM.setHTML(label, t.settings.title + \" - \" + o.title);\r\n\t\t\t\t\tDOM.removeClass(e, 'mceTitle');\r\n\t\t\t\t\tDOM.setAttrib(t.id, 'aria-valuenow', o.title);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tDOM.setHTML(e, DOM.encode(t.settings.title));\r\n\t\t\t\t\tDOM.setHTML(label, DOM.encode(t.settings.title));\r\n\t\t\t\t\tDOM.addClass(e, 'mceTitle');\r\n\t\t\t\t\tt.selectedValue = t.selectedIndex = null;\r\n\t\t\t\t\tDOM.setAttrib(t.id, 'aria-valuenow', t.settings.title);\r\n\t\t\t\t}\r\n\t\t\t\te = 0;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tadd : function(n, v, o) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\to = o || {};\r\n\t\t\to = tinymce.extend(o, {\r\n\t\t\t\ttitle : n,\r\n\t\t\t\tvalue : v\r\n\t\t\t});\r\n\r\n\t\t\tt.items.push(o);\r\n\t\t\tt.onAdd.dispatch(t, o);\r\n\t\t},\r\n\r\n\t\tgetLength : function() {\r\n\t\t\treturn this.items.length;\r\n\t\t},\r\n\r\n\t\trenderHTML : function() {\r\n\t\t\tvar h = '', t = this, s = t.settings, cp = t.classPrefix;\r\n\r\n\t\t\th = '<span role=\"listbox\" aria-haspopup=\"true\" aria-labelledby=\"' + t.id +'_voiceDesc\" aria-describedby=\"' + t.id + '_voiceDesc\"><table role=\"presentation\" tabindex=\"0\" id=\"' + t.id + '\" cellpadding=\"0\" cellspacing=\"0\" class=\"' + cp + ' ' + cp + 'Enabled' + (s['class'] ? (' ' + s['class']) : '') + '\"><tbody><tr>';\r\n\t\t\th += '<td>' + DOM.createHTML('span', {id: t.id + '_voiceDesc', 'class': 'voiceLabel', style:'display:none;'}, t.settings.title); \r\n\t\t\th += DOM.createHTML('a', {id : t.id + '_text', tabindex : -1, href : 'javascript:;', 'class' : 'mceText', onclick : \"return false;\", onmousedown : 'return false;'}, DOM.encode(t.settings.title)) + '</td>';\r\n\t\t\th += '<td>' + DOM.createHTML('a', {id : t.id + '_open', tabindex : -1, href : 'javascript:;', 'class' : 'mceOpen', onclick : \"return false;\", onmousedown : 'return false;'}, '<span><span style=\"display:none;\" class=\"mceIconOnly\" aria-hidden=\"true\">\\u25BC</span></span>') + '</td>';\r\n\t\t\th += '</tr></tbody></table></span>';\r\n\r\n\t\t\treturn h;\r\n\t\t},\r\n\r\n\t\tshowMenu : function() {\r\n\t\t\tvar t = this, p2, e = DOM.get(this.id), m;\r\n\r\n\t\t\tif (t.isDisabled() || t.items.length == 0)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (t.menu && t.menu.isMenuVisible)\r\n\t\t\t\treturn t.hideMenu();\r\n\r\n\t\t\tif (!t.isMenuRendered) {\r\n\t\t\t\tt.renderMenu();\r\n\t\t\t\tt.isMenuRendered = true;\r\n\t\t\t}\r\n\r\n\t\t\tp2 = DOM.getPos(e);\r\n\r\n\t\t\tm = t.menu;\r\n\t\t\tm.settings.offset_x = p2.x;\r\n\t\t\tm.settings.offset_y = p2.y;\r\n\t\t\tm.settings.keyboard_focus = !tinymce.isOpera; // Opera is buggy when it comes to auto focus\r\n\r\n\t\t\t// Select in menu\r\n\t\t\tif (t.oldID)\r\n\t\t\t\tm.items[t.oldID].setSelected(0);\r\n\r\n\t\t\teach(t.items, function(o) {\r\n\t\t\t\tif (o.value === t.selectedValue) {\r\n\t\t\t\t\tm.items[o.id].setSelected(1);\r\n\t\t\t\t\tt.oldID = o.id;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tm.showMenu(0, e.clientHeight);\r\n\r\n\t\t\tEvent.add(DOM.doc, 'mousedown', t.hideMenu, t);\r\n\t\t\tDOM.addClass(t.id, t.classPrefix + 'Selected');\r\n\r\n\t\t\t//DOM.get(t.id + '_text').focus();\r\n\t\t},\r\n\r\n\t\thideMenu : function(e) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (t.menu && t.menu.isMenuVisible) {\r\n\t\t\t\tDOM.removeClass(t.id, t.classPrefix + 'Selected');\r\n\r\n\t\t\t\t// Prevent double toogles by canceling the mouse click event to the button\r\n\t\t\t\tif (e && e.type == \"mousedown\" && (e.target.id == t.id + '_text' || e.target.id == t.id + '_open'))\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tif (!e || !DOM.getParent(e.target, '.mceMenu')) {\r\n\t\t\t\t\tDOM.removeClass(t.id, t.classPrefix + 'Selected');\r\n\t\t\t\t\tEvent.remove(DOM.doc, 'mousedown', t.hideMenu, t);\r\n\t\t\t\t\tt.menu.hideMenu();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\trenderMenu : function() {\r\n\t\t\tvar t = this, m;\r\n\r\n\t\t\tm = t.settings.control_manager.createDropMenu(t.id + '_menu', {\r\n\t\t\t\tmenu_line : 1,\r\n\t\t\t\t'class' : t.classPrefix + 'Menu mceNoIcons',\r\n\t\t\t\tmax_width : 150,\r\n\t\t\t\tmax_height : 150\r\n\t\t\t});\r\n\r\n\t\t\tm.onHideMenu.add(function() {\r\n\t\t\t\tt.hideMenu();\r\n\t\t\t\tt.focus();\r\n\t\t\t});\r\n\r\n\t\t\tm.add({\r\n\t\t\t\ttitle : t.settings.title,\r\n\t\t\t\t'class' : 'mceMenuItemTitle',\r\n\t\t\t\tonclick : function() {\r\n\t\t\t\t\tif (t.settings.onselect('') !== false)\r\n\t\t\t\t\t\tt.select(''); // Must be runned after\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\teach(t.items, function(o) {\r\n\t\t\t\t// No value then treat it as a title\r\n\t\t\t\tif (o.value === undefined) {\r\n\t\t\t\t\tm.add({\r\n\t\t\t\t\t\ttitle : o.title,\r\n\t\t\t\t\t\trole : \"option\",\r\n\t\t\t\t\t\t'class' : 'mceMenuItemTitle',\r\n\t\t\t\t\t\tonclick : function() {\r\n\t\t\t\t\t\t\tif (t.settings.onselect('') !== false)\r\n\t\t\t\t\t\t\t\tt.select(''); // Must be runned after\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\to.id = DOM.uniqueId();\r\n\t\t\t\t\to.role= \"option\";\r\n\t\t\t\t\to.onclick = function() {\r\n\t\t\t\t\t\tif (t.settings.onselect(o.value) !== false)\r\n\t\t\t\t\t\t\tt.select(o.value); // Must be runned after\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tm.add(o);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tt.onRenderMenu.dispatch(t, m);\r\n\t\t\tt.menu = m;\r\n\t\t},\r\n\r\n\t\tpostRender : function() {\r\n\t\t\tvar t = this, cp = t.classPrefix;\r\n\r\n\t\t\tEvent.add(t.id, 'click', t.showMenu, t);\r\n\t\t\tEvent.add(t.id, 'keydown', function(evt) {\r\n\t\t\t\tif (evt.keyCode == 32) { // Space\r\n\t\t\t\t\tt.showMenu(evt);\r\n\t\t\t\t\tEvent.cancel(evt);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tEvent.add(t.id, 'focus', function() {\r\n\t\t\t\tif (!t._focused) {\r\n\t\t\t\t\tt.keyDownHandler = Event.add(t.id, 'keydown', function(e) {\r\n\t\t\t\t\t\tif (e.keyCode == 40) {\r\n\t\t\t\t\t\t\tt.showMenu();\r\n\t\t\t\t\t\t\tEvent.cancel(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tt.keyPressHandler = Event.add(t.id, 'keypress', function(e) {\r\n\t\t\t\t\t\tvar v;\r\n\t\t\t\t\t\tif (e.keyCode == 13) {\r\n\t\t\t\t\t\t\t// Fake select on enter\r\n\t\t\t\t\t\t\tv = t.selectedValue;\r\n\t\t\t\t\t\t\tt.selectedValue = null; // Needs to be null to fake change\r\n\t\t\t\t\t\t\tEvent.cancel(e);\r\n\t\t\t\t\t\t\tt.settings.onselect(v);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt._focused = 1;\r\n\t\t\t});\r\n\t\t\tEvent.add(t.id, 'blur', function() {\r\n\t\t\t\tEvent.remove(t.id, 'keydown', t.keyDownHandler);\r\n\t\t\t\tEvent.remove(t.id, 'keypress', t.keyPressHandler);\r\n\t\t\t\tt._focused = 0;\r\n\t\t\t});\r\n\r\n\t\t\t// Old IE doesn't have hover on all elements\r\n\t\t\tif (tinymce.isIE6 || !DOM.boxModel) {\r\n\t\t\t\tEvent.add(t.id, 'mouseover', function() {\r\n\t\t\t\t\tif (!DOM.hasClass(t.id, cp + 'Disabled'))\r\n\t\t\t\t\t\tDOM.addClass(t.id, cp + 'Hover');\r\n\t\t\t\t});\r\n\r\n\t\t\t\tEvent.add(t.id, 'mouseout', function() {\r\n\t\t\t\t\tif (!DOM.hasClass(t.id, cp + 'Disabled'))\r\n\t\t\t\t\t\tDOM.removeClass(t.id, cp + 'Hover');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tt.onPostRender.dispatch(t, DOM.get(t.id));\r\n\t\t},\r\n\r\n\t\tdestroy : function() {\r\n\t\t\tthis.parent();\r\n\r\n\t\t\tEvent.clear(this.id + '_text');\r\n\t\t\tEvent.clear(this.id + '_open');\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, each = tinymce.each, Dispatcher = tinymce.util.Dispatcher;\r\n\r\n\ttinymce.create('tinymce.ui.NativeListBox:tinymce.ui.ListBox', {\r\n\t\tNativeListBox : function(id, s) {\r\n\t\t\tthis.parent(id, s);\r\n\t\t\tthis.classPrefix = 'mceNativeListBox';\r\n\t\t},\r\n\r\n\t\tsetDisabled : function(s) {\r\n\t\t\tDOM.get(this.id).disabled = s;\r\n\t\t\tthis.setAriaProperty('disabled', s);\r\n\t\t},\r\n\r\n\t\tisDisabled : function() {\r\n\t\t\treturn DOM.get(this.id).disabled;\r\n\t\t},\r\n\r\n\t\tselect : function(va) {\r\n\t\t\tvar t = this, fv, f;\r\n\r\n\t\t\tif (va == undefined)\r\n\t\t\t\treturn t.selectByIndex(-1);\r\n\r\n\t\t\t// Is string or number make function selector\r\n\t\t\tif (va && va.call)\r\n\t\t\t\tf = va;\r\n\t\t\telse {\r\n\t\t\t\tf = function(v) {\r\n\t\t\t\t\treturn v == va;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// Do we need to do something?\r\n\t\t\tif (va != t.selectedValue) {\r\n\t\t\t\t// Find item\r\n\t\t\t\teach(t.items, function(o, i) {\r\n\t\t\t\t\tif (f(o.value)) {\r\n\t\t\t\t\t\tfv = 1;\r\n\t\t\t\t\t\tt.selectByIndex(i);\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (!fv)\r\n\t\t\t\t\tt.selectByIndex(-1);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tselectByIndex : function(idx) {\r\n\t\t\tDOM.get(this.id).selectedIndex = idx + 1;\r\n\t\t\tthis.selectedValue = this.items[idx] ? this.items[idx].value : null;\r\n\t\t},\r\n\r\n\t\tadd : function(n, v, a) {\r\n\t\t\tvar o, t = this;\r\n\r\n\t\t\ta = a || {};\r\n\t\t\ta.value = v;\r\n\r\n\t\t\tif (t.isRendered())\r\n\t\t\t\tDOM.add(DOM.get(this.id), 'option', a, n);\r\n\r\n\t\t\to = {\r\n\t\t\t\ttitle : n,\r\n\t\t\t\tvalue : v,\r\n\t\t\t\tattribs : a\r\n\t\t\t};\r\n\r\n\t\t\tt.items.push(o);\r\n\t\t\tt.onAdd.dispatch(t, o);\r\n\t\t},\r\n\r\n\t\tgetLength : function() {\r\n\t\t\treturn this.items.length;\r\n\t\t},\r\n\r\n\t\trenderHTML : function() {\r\n\t\t\tvar h, t = this;\r\n\r\n\t\t\th = DOM.createHTML('option', {value : ''}, '-- ' + t.settings.title + ' --');\r\n\r\n\t\t\teach(t.items, function(it) {\r\n\t\t\t\th += DOM.createHTML('option', {value : it.value}, it.title);\r\n\t\t\t});\r\n\r\n\t\t\th = DOM.createHTML('select', {id : t.id, 'class' : 'mceNativeListBox', 'aria-labelledby': t.id + '_aria'}, h);\r\n\t\t\th += DOM.createHTML('span', {id : t.id + '_aria', 'style': 'display: none'}, t.settings.title);\r\n\t\t\treturn h;\r\n\t\t},\r\n\r\n\t\tpostRender : function() {\r\n\t\t\tvar t = this, ch, changeListenerAdded = true;\r\n\r\n\t\t\tt.rendered = true;\r\n\r\n\t\t\tfunction onChange(e) {\r\n\t\t\t\tvar v = t.items[e.target.selectedIndex - 1];\r\n\r\n\t\t\t\tif (v && (v = v.value)) {\r\n\t\t\t\t\tt.onChange.dispatch(t, v);\r\n\r\n\t\t\t\t\tif (t.settings.onselect)\r\n\t\t\t\t\t\tt.settings.onselect(v);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tEvent.add(t.id, 'change', onChange);\r\n\r\n\t\t\t// Accessibility keyhandler\r\n\t\t\tEvent.add(t.id, 'keydown', function(e) {\r\n\t\t\t\tvar bf;\r\n\r\n\t\t\t\tEvent.remove(t.id, 'change', ch);\r\n\t\t\t\tchangeListenerAdded = false;\r\n\r\n\t\t\t\tbf = Event.add(t.id, 'blur', function() {\r\n\t\t\t\t\tif (changeListenerAdded) return;\r\n\t\t\t\t\tchangeListenerAdded = true;\r\n\t\t\t\t\tEvent.add(t.id, 'change', onChange);\r\n\t\t\t\t\tEvent.remove(t.id, 'blur', bf);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t//prevent default left and right keys on chrome - so that the keyboard navigation is used.\r\n\t\t\t\tif (tinymce.isWebKit && (e.keyCode==37 ||e.keyCode==39)) {\r\n\t\t\t\t\treturn Event.prevent(e);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (e.keyCode == 13 || e.keyCode == 32) {\r\n\t\t\t\t\tonChange(e);\r\n\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tt.onPostRender.dispatch(t, DOM.get(t.id));\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, each = tinymce.each;\r\n\r\n\ttinymce.create('tinymce.ui.MenuButton:tinymce.ui.Button', {\r\n\t\tMenuButton : function(id, s, ed) {\r\n\t\t\tthis.parent(id, s, ed);\r\n\r\n\t\t\tthis.onRenderMenu = new tinymce.util.Dispatcher(this);\r\n\r\n\t\t\ts.menu_container = s.menu_container || DOM.doc.body;\r\n\t\t},\r\n\r\n\t\tshowMenu : function() {\r\n\t\t\tvar t = this, p1, p2, e = DOM.get(t.id), m;\r\n\r\n\t\t\tif (t.isDisabled())\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!t.isMenuRendered) {\r\n\t\t\t\tt.renderMenu();\r\n\t\t\t\tt.isMenuRendered = true;\r\n\t\t\t}\r\n\r\n\t\t\tif (t.isMenuVisible)\r\n\t\t\t\treturn t.hideMenu();\r\n\r\n\t\t\tp1 = DOM.getPos(t.settings.menu_container);\r\n\t\t\tp2 = DOM.getPos(e);\r\n\r\n\t\t\tm = t.menu;\r\n\t\t\tm.settings.offset_x = p2.x;\r\n\t\t\tm.settings.offset_y = p2.y;\r\n\t\t\tm.settings.vp_offset_x = p2.x;\r\n\t\t\tm.settings.vp_offset_y = p2.y;\r\n\t\t\tm.settings.keyboard_focus = t._focused;\r\n\t\t\tm.showMenu(0, e.clientHeight);\r\n\r\n\t\t\tEvent.add(DOM.doc, 'mousedown', t.hideMenu, t);\r\n\t\t\tt.setState('Selected', 1);\r\n\r\n\t\t\tt.isMenuVisible = 1;\r\n\t\t},\r\n\r\n\t\trenderMenu : function() {\r\n\t\t\tvar t = this, m;\r\n\r\n\t\t\tm = t.settings.control_manager.createDropMenu(t.id + '_menu', {\r\n\t\t\t\tmenu_line : 1,\r\n\t\t\t\t'class' : this.classPrefix + 'Menu',\r\n\t\t\t\ticons : t.settings.icons\r\n\t\t\t});\r\n\r\n\t\t\tm.onHideMenu.add(function() {\r\n\t\t\t\tt.hideMenu();\r\n\t\t\t\tt.focus();\r\n\t\t\t});\r\n\r\n\t\t\tt.onRenderMenu.dispatch(t, m);\r\n\t\t\tt.menu = m;\r\n\t\t},\r\n\r\n\t\thideMenu : function(e) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\t// Prevent double toogles by canceling the mouse click event to the button\r\n\t\t\tif (e && e.type == \"mousedown\" && DOM.getParent(e.target, function(e) {return e.id === t.id || e.id === t.id + '_open';}))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!e || !DOM.getParent(e.target, '.mceMenu')) {\r\n\t\t\t\tt.setState('Selected', 0);\r\n\t\t\t\tEvent.remove(DOM.doc, 'mousedown', t.hideMenu, t);\r\n\t\t\t\tif (t.menu)\r\n\t\t\t\t\tt.menu.hideMenu();\r\n\t\t\t}\r\n\r\n\t\t\tt.isMenuVisible = 0;\r\n\t\t},\r\n\r\n\t\tpostRender : function() {\r\n\t\t\tvar t = this, s = t.settings;\r\n\r\n\t\t\tEvent.add(t.id, 'click', function() {\r\n\t\t\t\tif (!t.isDisabled()) {\r\n\t\t\t\t\tif (s.onclick)\r\n\t\t\t\t\t\ts.onclick(t.value);\r\n\r\n\t\t\t\t\tt.showMenu();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, each = tinymce.each;\r\n\r\n\ttinymce.create('tinymce.ui.SplitButton:tinymce.ui.MenuButton', {\r\n\t\tSplitButton : function(id, s, ed) {\r\n\t\t\tthis.parent(id, s, ed);\r\n\t\t\tthis.classPrefix = 'mceSplitButton';\r\n\t\t},\r\n\r\n\t\trenderHTML : function() {\r\n\t\t\tvar h, t = this, s = t.settings, h1;\r\n\r\n\t\t\th = '<tbody><tr>';\r\n\r\n\t\t\tif (s.image)\r\n\t\t\t\th1 = DOM.createHTML('img ', {src : s.image, role: 'presentation', 'class' : 'mceAction ' + s['class']});\r\n\t\t\telse\r\n\t\t\t\th1 = DOM.createHTML('span', {'class' : 'mceAction ' + s['class']}, '');\r\n\r\n\t\t\th1 += DOM.createHTML('span', {'class': 'mceVoiceLabel mceIconOnly', id: t.id + '_voice', style: 'display:none;'}, s.title);\r\n\t\t\th += '<td >' + DOM.createHTML('a', {role: 'button', id : t.id + '_action', tabindex: '-1', href : 'javascript:;', 'class' : 'mceAction ' + s['class'], onclick : \"return false;\", onmousedown : 'return false;', title : s.title}, h1) + '</td>';\r\n\t\r\n\t\t\th1 = DOM.createHTML('span', {'class' : 'mceOpen ' + s['class']}, '<span style=\"display:none;\" class=\"mceIconOnly\" aria-hidden=\"true\">\\u25BC</span>');\r\n\t\t\th += '<td >' + DOM.createHTML('a', {role: 'button', id : t.id + '_open', tabindex: '-1', href : 'javascript:;', 'class' : 'mceOpen ' + s['class'], onclick : \"return false;\", onmousedown : 'return false;', title : s.title}, h1) + '</td>';\r\n\r\n\t\t\th += '</tr></tbody>';\r\n\t\t\th = DOM.createHTML('table', { role: 'presentation',   'class' : 'mceSplitButton mceSplitButtonEnabled ' + s['class'], cellpadding : '0', cellspacing : '0', title : s.title}, h);\r\n\t\t\treturn DOM.createHTML('div', {id : t.id, role: 'button', tabindex: '0', 'aria-labelledby': t.id + '_voice', 'aria-haspopup': 'true'}, h);\r\n\t\t},\r\n\r\n\t\tpostRender : function() {\r\n\t\t\tvar t = this, s = t.settings, activate;\r\n\r\n\t\t\tif (s.onclick) {\r\n\t\t\t\tactivate = function(evt) {\r\n\t\t\t\t\tif (!t.isDisabled()) {\r\n\t\t\t\t\t\ts.onclick(t.value);\r\n\t\t\t\t\t\tEvent.cancel(evt);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tEvent.add(t.id + '_action', 'click', activate);\r\n\t\t\t\tEvent.add(t.id, ['click', 'keydown'], function(evt) {\r\n\t\t\t\t\tvar DOM_VK_SPACE = 32, DOM_VK_ENTER = 14, DOM_VK_RETURN = 13, DOM_VK_UP = 38, DOM_VK_DOWN = 40;\r\n\t\t\t\t\tif ((evt.keyCode === 32 || evt.keyCode === 13 || evt.keyCode === 14) && !evt.altKey && !evt.ctrlKey && !evt.metaKey) {\r\n\t\t\t\t\t\tactivate();\r\n\t\t\t\t\t\tEvent.cancel(evt);\r\n\t\t\t\t\t} else if (evt.type === 'click' || evt.keyCode === DOM_VK_DOWN) {\r\n\t\t\t\t\t\tt.showMenu();\r\n\t\t\t\t\t\tEvent.cancel(evt);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tEvent.add(t.id + '_open', 'click', function (evt) {\r\n\t\t\t\tt.showMenu();\r\n\t\t\t\tEvent.cancel(evt);\r\n\t\t\t});\r\n\t\t\tEvent.add([t.id, t.id + '_open'], 'focus', function() {t._focused = 1;});\r\n\t\t\tEvent.add([t.id, t.id + '_open'], 'blur', function() {t._focused = 0;});\r\n\r\n\t\t\t// Old IE doesn't have hover on all elements\r\n\t\t\tif (tinymce.isIE6 || !DOM.boxModel) {\r\n\t\t\t\tEvent.add(t.id, 'mouseover', function() {\r\n\t\t\t\t\tif (!DOM.hasClass(t.id, 'mceSplitButtonDisabled'))\r\n\t\t\t\t\t\tDOM.addClass(t.id, 'mceSplitButtonHover');\r\n\t\t\t\t});\r\n\r\n\t\t\t\tEvent.add(t.id, 'mouseout', function() {\r\n\t\t\t\t\tif (!DOM.hasClass(t.id, 'mceSplitButtonDisabled'))\r\n\t\t\t\t\t\tDOM.removeClass(t.id, 'mceSplitButtonHover');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdestroy : function() {\r\n\t\t\tthis.parent();\r\n\r\n\t\t\tEvent.clear(this.id + '_action');\r\n\t\t\tEvent.clear(this.id + '_open');\r\n\t\t\tEvent.clear(this.id);\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, is = tinymce.is, each = tinymce.each;\r\n\r\n\ttinymce.create('tinymce.ui.ColorSplitButton:tinymce.ui.SplitButton', {\r\n\t\tColorSplitButton : function(id, s, ed) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.parent(id, s, ed);\r\n\r\n\t\t\tt.settings = s = tinymce.extend({\r\n\t\t\t\tcolors : '000000,993300,333300,003300,003366,000080,333399,333333,800000,FF6600,808000,008000,008080,0000FF,666699,808080,FF0000,FF9900,99CC00,339966,33CCCC,3366FF,800080,999999,FF00FF,FFCC00,FFFF00,00FF00,00FFFF,00CCFF,993366,C0C0C0,FF99CC,FFCC99,FFFF99,CCFFCC,CCFFFF,99CCFF,CC99FF,FFFFFF',\r\n\t\t\t\tgrid_width : 8,\r\n\t\t\t\tdefault_color : '#888888'\r\n\t\t\t}, t.settings);\r\n\r\n\t\t\tt.onShowMenu = new tinymce.util.Dispatcher(t);\r\n\r\n\t\t\tt.onHideMenu = new tinymce.util.Dispatcher(t);\r\n\r\n\t\t\tt.value = s.default_color;\r\n\t\t},\r\n\r\n\t\tshowMenu : function() {\r\n\t\t\tvar t = this, r, p, e, p2;\r\n\r\n\t\t\tif (t.isDisabled())\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!t.isMenuRendered) {\r\n\t\t\t\tt.renderMenu();\r\n\t\t\t\tt.isMenuRendered = true;\r\n\t\t\t}\r\n\r\n\t\t\tif (t.isMenuVisible)\r\n\t\t\t\treturn t.hideMenu();\r\n\r\n\t\t\te = DOM.get(t.id);\r\n\t\t\tDOM.show(t.id + '_menu');\r\n\t\t\tDOM.addClass(e, 'mceSplitButtonSelected');\r\n\t\t\tp2 = DOM.getPos(e);\r\n\t\t\tDOM.setStyles(t.id + '_menu', {\r\n\t\t\t\tleft : p2.x,\r\n\t\t\t\ttop : p2.y + e.clientHeight,\r\n\t\t\t\tzIndex : 200000\r\n\t\t\t});\r\n\t\t\te = 0;\r\n\r\n\t\t\tEvent.add(DOM.doc, 'mousedown', t.hideMenu, t);\r\n\t\t\tt.onShowMenu.dispatch(t);\r\n\r\n\t\t\tif (t._focused) {\r\n\t\t\t\tt._keyHandler = Event.add(t.id + '_menu', 'keydown', function(e) {\r\n\t\t\t\t\tif (e.keyCode == 27)\r\n\t\t\t\t\t\tt.hideMenu();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tDOM.select('a', t.id + '_menu')[0].focus(); // Select first link\r\n\t\t\t}\r\n\r\n\t\t\tt.isMenuVisible = 1;\r\n\t\t},\r\n\r\n\t\thideMenu : function(e) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (t.isMenuVisible) {\r\n\t\t\t\t// Prevent double toogles by canceling the mouse click event to the button\r\n\t\t\t\tif (e && e.type == \"mousedown\" && DOM.getParent(e.target, function(e) {return e.id === t.id + '_open';}))\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tif (!e || !DOM.getParent(e.target, '.mceSplitButtonMenu')) {\r\n\t\t\t\t\tDOM.removeClass(t.id, 'mceSplitButtonSelected');\r\n\t\t\t\t\tEvent.remove(DOM.doc, 'mousedown', t.hideMenu, t);\r\n\t\t\t\t\tEvent.remove(t.id + '_menu', 'keydown', t._keyHandler);\r\n\t\t\t\t\tDOM.hide(t.id + '_menu');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt.isMenuVisible = 0;\r\n\t\t\t\tt.onHideMenu.dispatch();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\trenderMenu : function() {\r\n\t\t\tvar t = this, m, i = 0, s = t.settings, n, tb, tr, w, context;\r\n\r\n\t\t\tw = DOM.add(s.menu_container, 'div', {role: 'listbox', id : t.id + '_menu', 'class' : s['menu_class'] + ' ' + s['class'], style : 'position:absolute;left:0;top:-1000px;'});\r\n\t\t\tm = DOM.add(w, 'div', {'class' : s['class'] + ' mceSplitButtonMenu'});\r\n\t\t\tDOM.add(m, 'span', {'class' : 'mceMenuLine'});\r\n\r\n\t\t\tn = DOM.add(m, 'table', {role: 'presentation', 'class' : 'mceColorSplitMenu'});\r\n\t\t\ttb = DOM.add(n, 'tbody');\r\n\r\n\t\t\t// Generate color grid\r\n\t\t\ti = 0;\r\n\t\t\teach(is(s.colors, 'array') ? s.colors : s.colors.split(','), function(c) {\r\n\t\t\t\tc = c.replace(/^#/, '');\r\n\r\n\t\t\t\tif (!i--) {\r\n\t\t\t\t\ttr = DOM.add(tb, 'tr');\r\n\t\t\t\t\ti = s.grid_width - 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tn = DOM.add(tr, 'td');\r\n\t\t\t\tn = DOM.add(n, 'a', {\r\n\t\t\t\t\trole : 'option',\r\n\t\t\t\t\thref : 'javascript:;',\r\n\t\t\t\t\tstyle : {\r\n\t\t\t\t\t\tbackgroundColor : '#' + c\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'title': t.editor.getLang('colors.' + c, c),\r\n\t\t\t\t\t'data-mce-color' : '#' + c\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (t.editor.forcedHighContrastMode) {\r\n\t\t\t\t\tn = DOM.add(n, 'canvas', { width: 16, height: 16, 'aria-hidden': 'true' });\r\n\t\t\t\t\tif (n.getContext && (context = n.getContext(\"2d\"))) {\r\n\t\t\t\t\t\tcontext.fillStyle = '#' + c;\r\n\t\t\t\t\t\tcontext.fillRect(0, 0, 16, 16);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// No point leaving a canvas element around if it's not supported for drawing on anyway.\r\n\t\t\t\t\t\tDOM.remove(n);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (s.more_colors_func) {\r\n\t\t\t\tn = DOM.add(tb, 'tr');\r\n\t\t\t\tn = DOM.add(n, 'td', {colspan : s.grid_width, 'class' : 'mceMoreColors'});\r\n\t\t\t\tn = DOM.add(n, 'a', {role: 'option', id : t.id + '_more', href : 'javascript:;', onclick : 'return false;', 'class' : 'mceMoreColors'}, s.more_colors_title);\r\n\r\n\t\t\t\tEvent.add(n, 'click', function(e) {\r\n\t\t\t\t\ts.more_colors_func.call(s.more_colors_scope || this);\r\n\t\t\t\t\treturn Event.cancel(e); // Cancel to fix onbeforeunload problem\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tDOM.addClass(m, 'mceColorSplitMenu');\r\n\t\t\t\r\n\t\t\tnew tinymce.ui.KeyboardNavigation({\r\n\t\t\t\troot: t.id + '_menu',\r\n\t\t\t\titems: DOM.select('a', t.id + '_menu'),\r\n\t\t\t\tonCancel: function() {\r\n\t\t\t\t\tt.hideMenu();\r\n\t\t\t\t\tt.focus();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Prevent IE from scrolling and hindering click to occur #4019\r\n\t\t\tEvent.add(t.id + '_menu', 'mousedown', function(e) {return Event.cancel(e);});\r\n\r\n\t\t\tEvent.add(t.id + '_menu', 'click', function(e) {\r\n\t\t\t\tvar c;\r\n\r\n\t\t\t\te = DOM.getParent(e.target, 'a', tb);\r\n\r\n\t\t\t\tif (e && e.nodeName.toLowerCase() == 'a' && (c = e.getAttribute('data-mce-color')))\r\n\t\t\t\t\tt.setColor(c);\r\n\r\n\t\t\t\treturn Event.cancel(e); // Prevent IE auto save warning\r\n\t\t\t});\r\n\r\n\t\t\treturn w;\r\n\t\t},\r\n\r\n\t\tsetColor : function(c) {\r\n\t\t\tthis.displayColor(c);\r\n\t\t\tthis.hideMenu();\r\n\t\t\tthis.settings.onselect(c);\r\n\t\t},\r\n\t\t\r\n\t\tdisplayColor : function(c) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tDOM.setStyle(t.id + '_preview', 'backgroundColor', c);\r\n\r\n\t\t\tt.value = c;\r\n\t\t},\r\n\r\n\t\tpostRender : function() {\r\n\t\t\tvar t = this, id = t.id;\r\n\r\n\t\t\tt.parent();\r\n\t\t\tDOM.add(id + '_action', 'div', {id : id + '_preview', 'class' : 'mceColorPreview'});\r\n\t\t\tDOM.setStyle(t.id + '_preview', 'backgroundColor', t.value);\r\n\t\t},\r\n\r\n\t\tdestroy : function() {\r\n\t\t\tthis.parent();\r\n\r\n\t\t\tEvent.clear(this.id + '_menu');\r\n\t\t\tEvent.clear(this.id + '_more');\r\n\t\t\tDOM.remove(this.id + '_menu');\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n// Shorten class names\r\nvar dom = tinymce.DOM, each = tinymce.each, Event = tinymce.dom.Event;\r\ntinymce.create('tinymce.ui.ToolbarGroup:tinymce.ui.Container', {\r\n\trenderHTML : function() {\r\n\t\tvar t = this, h = [], controls = t.controls, each = tinymce.each, settings = t.settings;\r\n\r\n\t\th.push('<div id=\"' + t.id + '\" role=\"group\" aria-labelledby=\"' + t.id + '_voice\">');\r\n\t\t//TODO: ACC test this out - adding a role = application for getting the landmarks working well.\r\n\t\th.push(\"<span role='application'>\");\r\n\t\th.push('<span id=\"' + t.id + '_voice\" class=\"mceVoiceLabel\" style=\"display:none;\">' + dom.encode(settings.name) + '</span>');\r\n\t\teach(controls, function(toolbar) {\r\n\t\t\th.push(toolbar.renderHTML());\r\n\t\t});\r\n\t\th.push(\"</span>\");\r\n\t\th.push('</div>');\r\n\r\n\t\treturn h.join('');\r\n\t},\r\n\t\r\n\tfocus : function() {\r\n\t\tvar t = this;\r\n\t\tdom.get(t.id).focus();\r\n\t},\r\n\t\r\n\tpostRender : function() {\r\n\t\tvar t = this, items = [];\r\n\r\n\t\teach(t.controls, function(toolbar) {\r\n\t\t\teach (toolbar.controls, function(control) {\r\n\t\t\t\tif (control.id) {\r\n\t\t\t\t\titems.push(control);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tt.keyNav = new tinymce.ui.KeyboardNavigation({\r\n\t\t\troot: t.id,\r\n\t\t\titems: items,\r\n\t\t\tonCancel: function() {\r\n\t\t\t\t//Move focus if webkit so that navigation back will read the item.\r\n\t\t\t\tif (tinymce.isWebKit) {\r\n\t\t\t\t\tdom.get(t.editor.id+\"_ifr\").focus();\r\n\t\t\t\t}\r\n\t\t\t\tt.editor.focus();\r\n\t\t\t},\r\n\t\t\texcludeFromTabOrder: !t.settings.tab_focus_toolbar\r\n\t\t});\r\n\t},\r\n\t\r\n\tdestroy : function() {\r\n\t\tvar self = this;\r\n\r\n\t\tself.parent();\r\n\t\tself.keyNav.destroy();\r\n\t\tEvent.clear(self.id);\r\n\t}\r\n});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n// Shorten class names\r\nvar dom = tinymce.DOM, each = tinymce.each;\r\ntinymce.create('tinymce.ui.Toolbar:tinymce.ui.Container', {\r\n\trenderHTML : function() {\r\n\t\tvar t = this, h = '', c, co, s = t.settings, i, pr, nx, cl;\r\n\r\n\t\tcl = t.controls;\r\n\t\tfor (i=0; i<cl.length; i++) {\r\n\t\t\t// Get current control, prev control, next control and if the control is a list box or not\r\n\t\t\tco = cl[i];\r\n\t\t\tpr = cl[i - 1];\r\n\t\t\tnx = cl[i + 1];\r\n\r\n\t\t\t// Add toolbar start\r\n\t\t\tif (i === 0) {\r\n\t\t\t\tc = 'mceToolbarStart';\r\n\r\n\t\t\t\tif (co.Button)\r\n\t\t\t\t\tc += ' mceToolbarStartButton';\r\n\t\t\t\telse if (co.SplitButton)\r\n\t\t\t\t\tc += ' mceToolbarStartSplitButton';\r\n\t\t\t\telse if (co.ListBox)\r\n\t\t\t\t\tc += ' mceToolbarStartListBox';\r\n\r\n\t\t\t\th += dom.createHTML('td', {'class' : c}, dom.createHTML('span', null, '<!-- IE -->'));\r\n\t\t\t}\r\n\r\n\t\t\t// Add toolbar end before list box and after the previous button\r\n\t\t\t// This is to fix the o2k7 editor skins\r\n\t\t\tif (pr && co.ListBox) {\r\n\t\t\t\tif (pr.Button || pr.SplitButton)\r\n\t\t\t\t\th += dom.createHTML('td', {'class' : 'mceToolbarEnd'}, dom.createHTML('span', null, '<!-- IE -->'));\r\n\t\t\t}\r\n\r\n\t\t\t// Render control HTML\r\n\r\n\t\t\t// IE 8 quick fix, needed to propertly generate a hit area for anchors\r\n\t\t\tif (dom.stdMode)\r\n\t\t\t\th += '<td style=\"position: relative\">' + co.renderHTML() + '</td>';\r\n\t\t\telse\r\n\t\t\t\th += '<td>' + co.renderHTML() + '</td>';\r\n\r\n\t\t\t// Add toolbar start after list box and before the next button\r\n\t\t\t// This is to fix the o2k7 editor skins\r\n\t\t\tif (nx && co.ListBox) {\r\n\t\t\t\tif (nx.Button || nx.SplitButton)\r\n\t\t\t\t\th += dom.createHTML('td', {'class' : 'mceToolbarStart'}, dom.createHTML('span', null, '<!-- IE -->'));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tc = 'mceToolbarEnd';\r\n\r\n\t\tif (co.Button)\r\n\t\t\tc += ' mceToolbarEndButton';\r\n\t\telse if (co.SplitButton)\r\n\t\t\tc += ' mceToolbarEndSplitButton';\r\n\t\telse if (co.ListBox)\r\n\t\t\tc += ' mceToolbarEndListBox';\r\n\r\n\t\th += dom.createHTML('td', {'class' : c}, dom.createHTML('span', null, '<!-- IE -->'));\r\n\r\n\t\treturn dom.createHTML('table', {id : t.id, 'class' : 'mceToolbar' + (s['class'] ? ' ' + s['class'] : ''), cellpadding : '0', cellspacing : '0', align : t.settings.align || '', role: 'presentation', tabindex: '-1'}, '<tbody><tr>' + h + '</tr></tbody>');\r\n\t}\r\n});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar Dispatcher = tinymce.util.Dispatcher, each = tinymce.each;\r\n\r\n\ttinymce.create('tinymce.AddOnManager', {\r\n\t\tAddOnManager : function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.items = [];\r\n\t\t\tself.urls = {};\r\n\t\t\tself.lookup = {};\r\n\t\t\tself.onAdd = new Dispatcher(self);\r\n\t\t},\r\n\r\n\t\tget : function(n) {\r\n\t\t\tif (this.lookup[n]) {\r\n\t\t\t\treturn this.lookup[n].instance;\r\n\t\t\t} else {\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdependencies : function(n) {\r\n\t\t\tvar result;\r\n\t\t\tif (this.lookup[n]) {\r\n\t\t\t\tresult = this.lookup[n].dependencies;\r\n\t\t\t}\r\n\t\t\treturn result || [];\r\n\t\t},\r\n\r\n\t\trequireLangPack : function(n) {\r\n\t\t\tvar s = tinymce.settings;\r\n\r\n\t\t\tif (s && s.language && s.language_load !== false)\r\n\t\t\t\ttinymce.ScriptLoader.add(this.urls[n] + '/langs/' + s.language + '.js');\r\n\t\t},\r\n\r\n\t\tadd : function(id, o, dependencies) {\r\n\t\t\tthis.items.push(o);\r\n\t\t\tthis.lookup[id] = {instance:o, dependencies:dependencies};\r\n\t\t\tthis.onAdd.dispatch(this, id, o);\r\n\r\n\t\t\treturn o;\r\n\t\t},\r\n\t\tcreateUrl: function(baseUrl, dep) {\r\n\t\t\tif (typeof dep === \"object\") {\r\n\t\t\t\treturn dep\r\n\t\t\t} else {\r\n\t\t\t\treturn {prefix: baseUrl.prefix, resource: dep, suffix: baseUrl.suffix};\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\taddComponents: function(pluginName, scripts) {\r\n\t\t\tvar pluginUrl = this.urls[pluginName];\r\n\t\t\ttinymce.each(scripts, function(script){\r\n\t\t\t\ttinymce.ScriptLoader.add(pluginUrl+\"/\"+script);\t\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tload : function(n, u, cb, s) {\r\n\t\t\tvar t = this, url = u;\r\n\r\n\t\t\tfunction loadDependencies() {\r\n\t\t\t\tvar dependencies = t.dependencies(n);\r\n\t\t\t\ttinymce.each(dependencies, function(dep) {\r\n\t\t\t\t\tvar newUrl = t.createUrl(u, dep);\r\n\t\t\t\t\tt.load(newUrl.resource, newUrl, undefined, undefined);\r\n\t\t\t\t});\r\n\t\t\t\tif (cb) {\r\n\t\t\t\t\tif (s) {\r\n\t\t\t\t\t\tcb.call(s);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcb.call(tinymce.ScriptLoader);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (t.urls[n])\r\n\t\t\t\treturn;\r\n\t\t\tif (typeof u === \"object\")\r\n\t\t\t\turl = u.prefix + u.resource + u.suffix;\r\n\r\n\t\t\tif (url.indexOf('/') != 0 && url.indexOf('://') == -1)\r\n\t\t\t\turl = tinymce.baseURL + '/' + url;\r\n\r\n\t\t\tt.urls[n] = url.substring(0, url.lastIndexOf('/'));\r\n\r\n\t\t\tif (t.lookup[n]) {\r\n\t\t\t\tloadDependencies();\r\n\t\t\t} else {\r\n\t\t\t\ttinymce.ScriptLoader.add(url, loadDependencies, s);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t// Create plugin and theme managers\r\n\ttinymce.PluginManager = new tinymce.AddOnManager();\r\n\ttinymce.ThemeManager = new tinymce.AddOnManager();\r\n}(tinymce));\r\n\r\n(function(tinymce) {\r\n\t// Shorten names\r\n\tvar each = tinymce.each, extend = tinymce.extend,\r\n\t\tDOM = tinymce.DOM, Event = tinymce.dom.Event,\r\n\t\tThemeManager = tinymce.ThemeManager, PluginManager = tinymce.PluginManager,\r\n\t\texplode = tinymce.explode,\r\n\t\tDispatcher = tinymce.util.Dispatcher, undefined, instanceCounter = 0;\r\n\r\n\t// Setup some URLs where the editor API is located and where the document is\r\n\ttinymce.documentBaseURL = window.location.href.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\r\n\tif (!/[\\/\\\\]$/.test(tinymce.documentBaseURL))\r\n\t\ttinymce.documentBaseURL += '/';\r\n\r\n\ttinymce.baseURL = new tinymce.util.URI(tinymce.documentBaseURL).toAbsolute(tinymce.baseURL);\r\n\r\n\ttinymce.baseURI = new tinymce.util.URI(tinymce.baseURL);\r\n\r\n\t// Add before unload listener\r\n\t// This was required since IE was leaking memory if you added and removed beforeunload listeners\r\n\t// with attachEvent/detatchEvent so this only adds one listener and instances can the attach to the onBeforeUnload event\r\n\ttinymce.onBeforeUnload = new Dispatcher(tinymce);\r\n\r\n\t// Must be on window or IE will leak if the editor is placed in frame or iframe\r\n\tEvent.add(window, 'beforeunload', function(e) {\r\n\t\ttinymce.onBeforeUnload.dispatch(tinymce, e);\r\n\t});\r\n\r\n\ttinymce.onAddEditor = new Dispatcher(tinymce);\r\n\r\n\ttinymce.onRemoveEditor = new Dispatcher(tinymce);\r\n\r\n\ttinymce.EditorManager = extend(tinymce, {\r\n\t\teditors : [],\r\n\r\n\t\ti18n : {},\r\n\r\n\t\tactiveEditor : null,\r\n\r\n\t\tinit : function(s) {\r\n\t\t\tvar t = this, pl, sl = tinymce.ScriptLoader, e, el = [], ed;\r\n\r\n\t\t\tfunction execCallback(se, n, s) {\r\n\t\t\t\tvar f = se[n];\r\n\r\n\t\t\t\tif (!f)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tif (tinymce.is(f, 'string')) {\r\n\t\t\t\t\ts = f.replace(/\\.\\w+$/, '');\r\n\t\t\t\t\ts = s ? tinymce.resolve(s) : 0;\r\n\t\t\t\t\tf = tinymce.resolve(f);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn f.apply(s || this, Array.prototype.slice.call(arguments, 2));\r\n\t\t\t};\r\n\r\n\t\t\ts = extend({\r\n\t\t\t\ttheme : \"simple\",\r\n\t\t\t\tlanguage : \"en\"\r\n\t\t\t}, s);\r\n\r\n\t\t\tt.settings = s;\r\n\r\n\t\t\t// Legacy call\r\n\t\t\tEvent.add(document, 'init', function() {\r\n\t\t\t\tvar l, co;\r\n\r\n\t\t\t\texecCallback(s, 'onpageload');\r\n\r\n\t\t\t\tswitch (s.mode) {\r\n\t\t\t\t\tcase \"exact\":\r\n\t\t\t\t\t\tl = s.elements || '';\r\n\r\n\t\t\t\t\t\tif(l.length > 0) {\r\n\t\t\t\t\t\t\teach(explode(l), function(v) {\r\n\t\t\t\t\t\t\t\tif (DOM.get(v)) {\r\n\t\t\t\t\t\t\t\t\ted = new tinymce.Editor(v, s);\r\n\t\t\t\t\t\t\t\t\tel.push(ed);\r\n\t\t\t\t\t\t\t\t\ted.render(1);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\teach(document.forms, function(f) {\r\n\t\t\t\t\t\t\t\t\t\teach(f.elements, function(e) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (e.name === v) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tv = 'mce_editor_' + instanceCounter++;\r\n\t\t\t\t\t\t\t\t\t\t\t\tDOM.setAttrib(e, 'id', v);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\ted = new tinymce.Editor(v, s);\r\n\t\t\t\t\t\t\t\t\t\t\t\tel.push(ed);\r\n\t\t\t\t\t\t\t\t\t\t\t\ted.render(1);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"textareas\":\r\n\t\t\t\t\tcase \"specific_textareas\":\r\n\t\t\t\t\t\tfunction hasClass(n, c) {\r\n\t\t\t\t\t\t\treturn c.constructor === RegExp ? c.test(n.className) : DOM.hasClass(n, c);\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\teach(DOM.select('textarea'), function(v) {\r\n\t\t\t\t\t\t\tif (s.editor_deselector && hasClass(v, s.editor_deselector))\r\n\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\tif (!s.editor_selector || hasClass(v, s.editor_selector)) {\r\n\t\t\t\t\t\t\t\t// Can we use the name\r\n\t\t\t\t\t\t\t\te = DOM.get(v.name);\r\n\t\t\t\t\t\t\t\tif (!v.id && !e)\r\n\t\t\t\t\t\t\t\t\tv.id = v.name;\r\n\r\n\t\t\t\t\t\t\t\t// Generate unique name if missing or already exists\r\n\t\t\t\t\t\t\t\tif (!v.id || t.get(v.id))\r\n\t\t\t\t\t\t\t\t\tv.id = DOM.uniqueId();\r\n\r\n\t\t\t\t\t\t\t\ted = new tinymce.Editor(v.id, s);\r\n\t\t\t\t\t\t\t\tel.push(ed);\r\n\t\t\t\t\t\t\t\ted.render(1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Call onInit when all editors are initialized\r\n\t\t\t\tif (s.oninit) {\r\n\t\t\t\t\tl = co = 0;\r\n\r\n\t\t\t\t\teach(el, function(ed) {\r\n\t\t\t\t\t\tco++;\r\n\r\n\t\t\t\t\t\tif (!ed.initialized) {\r\n\t\t\t\t\t\t\t// Wait for it\r\n\t\t\t\t\t\t\ted.onInit.add(function() {\r\n\t\t\t\t\t\t\t\tl++;\r\n\r\n\t\t\t\t\t\t\t\t// All done\r\n\t\t\t\t\t\t\t\tif (l == co)\r\n\t\t\t\t\t\t\t\t\texecCallback(s, 'oninit');\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tl++;\r\n\r\n\t\t\t\t\t\t// All done\r\n\t\t\t\t\t\tif (l == co)\r\n\t\t\t\t\t\t\texecCallback(s, 'oninit');\t\t\t\t\t\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tget : function(id) {\r\n\t\t\tif (id === undefined)\r\n\t\t\t\treturn this.editors;\r\n\r\n\t\t\treturn this.editors[id];\r\n\t\t},\r\n\r\n\t\tgetInstanceById : function(id) {\r\n\t\t\treturn this.get(id);\r\n\t\t},\r\n\r\n\t\tadd : function(editor) {\r\n\t\t\tvar self = this, editors = self.editors;\r\n\r\n\t\t\t// Add named and index editor instance\r\n\t\t\teditors[editor.id] = editor;\r\n\t\t\teditors.push(editor);\r\n\r\n\t\t\tself._setActive(editor);\r\n\t\t\tself.onAddEditor.dispatch(self, editor);\r\n\r\n\r\n\t\t\treturn editor;\r\n\t\t},\r\n\r\n\t\tremove : function(editor) {\r\n\t\t\tvar t = this, i, editors = t.editors;\r\n\r\n\t\t\t// Not in the collection\r\n\t\t\tif (!editors[editor.id])\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tdelete editors[editor.id];\r\n\r\n\t\t\tfor (i = 0; i < editors.length; i++) {\r\n\t\t\t\tif (editors[i] == editor) {\r\n\t\t\t\t\teditors.splice(i, 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Select another editor since the active one was removed\r\n\t\t\tif (t.activeEditor == editor)\r\n\t\t\t\tt._setActive(editors[0]);\r\n\r\n\t\t\teditor.destroy();\r\n\t\t\tt.onRemoveEditor.dispatch(t, editor);\r\n\r\n\t\t\treturn editor;\r\n\t\t},\r\n\r\n\t\texecCommand : function(c, u, v) {\r\n\t\t\tvar t = this, ed = t.get(v), w;\r\n\r\n\t\t\t// Manager commands\r\n\t\t\tswitch (c) {\r\n\t\t\t\tcase \"mceFocus\":\r\n\t\t\t\t\ted.focus();\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\tcase \"mceAddEditor\":\r\n\t\t\t\tcase \"mceAddControl\":\r\n\t\t\t\t\tif (!t.get(v))\r\n\t\t\t\t\t\tnew tinymce.Editor(v, t.settings).render();\r\n\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\tcase \"mceAddFrameControl\":\r\n\t\t\t\t\tw = v.window;\r\n\r\n\t\t\t\t\t// Add tinyMCE global instance and tinymce namespace to specified window\r\n\t\t\t\t\tw.tinyMCE = tinyMCE;\r\n\t\t\t\t\tw.tinymce = tinymce;\r\n\r\n\t\t\t\t\ttinymce.DOM.doc = w.document;\r\n\t\t\t\t\ttinymce.DOM.win = w;\r\n\r\n\t\t\t\t\ted = new tinymce.Editor(v.element_id, v);\r\n\t\t\t\t\ted.render();\r\n\r\n\t\t\t\t\t// Fix IE memory leaks\r\n\t\t\t\t\tif (tinymce.isIE) {\r\n\t\t\t\t\t\tfunction clr() {\r\n\t\t\t\t\t\t\ted.destroy();\r\n\t\t\t\t\t\t\tw.detachEvent('onunload', clr);\r\n\t\t\t\t\t\t\tw = w.tinyMCE = w.tinymce = null; // IE leak\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tw.attachEvent('onunload', clr);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tv.page_window = null;\r\n\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\tcase \"mceRemoveEditor\":\r\n\t\t\t\tcase \"mceRemoveControl\":\r\n\t\t\t\t\tif (ed)\r\n\t\t\t\t\t\ted.remove();\r\n\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\tcase 'mceToggleEditor':\r\n\t\t\t\t\tif (!ed) {\r\n\t\t\t\t\t\tt.execCommand('mceAddControl', 0, v);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (ed.isHidden())\r\n\t\t\t\t\t\ted.show();\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\ted.hide();\r\n\r\n\t\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Run command on active editor\r\n\t\t\tif (t.activeEditor)\r\n\t\t\t\treturn t.activeEditor.execCommand(c, u, v);\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\texecInstanceCommand : function(id, c, u, v) {\r\n\t\t\tvar ed = this.get(id);\r\n\r\n\t\t\tif (ed)\r\n\t\t\t\treturn ed.execCommand(c, u, v);\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\ttriggerSave : function() {\r\n\t\t\teach(this.editors, function(e) {\r\n\t\t\t\te.save();\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\taddI18n : function(p, o) {\r\n\t\t\tvar lo, i18n = this.i18n;\r\n\r\n\t\t\tif (!tinymce.is(p, 'string')) {\r\n\t\t\t\teach(p, function(o, lc) {\r\n\t\t\t\t\teach(o, function(o, g) {\r\n\t\t\t\t\t\teach(o, function(o, k) {\r\n\t\t\t\t\t\t\tif (g === 'common')\r\n\t\t\t\t\t\t\t\ti18n[lc + '.' + k] = o;\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\ti18n[lc + '.' + g + '.' + k] = o;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\teach(o, function(o, k) {\r\n\t\t\t\t\ti18n[p + '.' + k] = o;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// Private methods\r\n\r\n\t\t_setActive : function(editor) {\r\n\t\t\tthis.selectedInstance = this.activeEditor = editor;\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\t// Shorten these names\r\n\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, extend = tinymce.extend,\r\n\t\tDispatcher = tinymce.util.Dispatcher, each = tinymce.each, isGecko = tinymce.isGecko,\r\n\t\tisIE = tinymce.isIE, isWebKit = tinymce.isWebKit, is = tinymce.is,\r\n\t\tThemeManager = tinymce.ThemeManager, PluginManager = tinymce.PluginManager,\r\n\t\tinArray = tinymce.inArray, grep = tinymce.grep, explode = tinymce.explode;\r\n\r\n\ttinymce.create('tinymce.Editor', {\r\n\t\tEditor : function(id, s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.id = t.editorId = id;\r\n\r\n\t\t\tt.execCommands = {};\r\n\t\t\tt.queryStateCommands = {};\r\n\t\t\tt.queryValueCommands = {};\r\n\r\n\t\t\tt.isNotDirty = false;\r\n\r\n\t\t\tt.plugins = {};\r\n\r\n\t\t\t// Add events to the editor\r\n\t\t\teach([\r\n\t\t\t\t'onPreInit',\r\n\r\n\t\t\t\t'onBeforeRenderUI',\r\n\r\n\t\t\t\t'onPostRender',\r\n\r\n\t\t\t\t'onInit',\r\n\r\n\t\t\t\t'onRemove',\r\n\r\n\t\t\t\t'onActivate',\r\n\r\n\t\t\t\t'onDeactivate',\r\n\r\n\t\t\t\t'onClick',\r\n\r\n\t\t\t\t'onEvent',\r\n\r\n\t\t\t\t'onMouseUp',\r\n\r\n\t\t\t\t'onMouseDown',\r\n\r\n\t\t\t\t'onDblClick',\r\n\r\n\t\t\t\t'onKeyDown',\r\n\r\n\t\t\t\t'onKeyUp',\r\n\r\n\t\t\t\t'onKeyPress',\r\n\r\n\t\t\t\t'onContextMenu',\r\n\r\n\t\t\t\t'onSubmit',\r\n\r\n\t\t\t\t'onReset',\r\n\r\n\t\t\t\t'onPaste',\r\n\r\n\t\t\t\t'onPreProcess',\r\n\r\n\t\t\t\t'onPostProcess',\r\n\r\n\t\t\t\t'onBeforeSetContent',\r\n\r\n\t\t\t\t'onBeforeGetContent',\r\n\r\n\t\t\t\t'onSetContent',\r\n\r\n\t\t\t\t'onGetContent',\r\n\r\n\t\t\t\t'onLoadContent',\r\n\r\n\t\t\t\t'onSaveContent',\r\n\r\n\t\t\t\t'onNodeChange',\r\n\r\n\t\t\t\t'onChange',\r\n\r\n\t\t\t\t'onBeforeExecCommand',\r\n\r\n\t\t\t\t'onExecCommand',\r\n\r\n\t\t\t\t'onUndo',\r\n\r\n\t\t\t\t'onRedo',\r\n\r\n\t\t\t\t'onVisualAid',\r\n\r\n\t\t\t\t'onSetProgressState'\r\n\t\t\t], function(e) {\r\n\t\t\t\tt[e] = new Dispatcher(t);\r\n\t\t\t});\r\n\r\n\t\t\tt.settings = s = extend({\r\n\t\t\t\tid : id,\r\n\t\t\t\tlanguage : 'en',\r\n\t\t\t\tdocs_language : 'en',\r\n\t\t\t\ttheme : 'simple',\r\n\t\t\t\tskin : 'default',\r\n\t\t\t\tdelta_width : 0,\r\n\t\t\t\tdelta_height : 0,\r\n\t\t\t\tpopup_css : '',\r\n\t\t\t\tplugins : '',\r\n\t\t\t\tdocument_base_url : tinymce.documentBaseURL,\r\n\t\t\t\tadd_form_submit_trigger : 1,\r\n\t\t\t\tsubmit_patch : 1,\r\n\t\t\t\tadd_unload_trigger : 1,\r\n\t\t\t\tconvert_urls : 1,\r\n\t\t\t\trelative_urls : 1,\r\n\t\t\t\tremove_script_host : 1,\r\n\t\t\t\ttable_inline_editing : 0,\r\n\t\t\t\tobject_resizing : 1,\r\n\t\t\t\tcleanup : 1,\r\n\t\t\t\taccessibility_focus : 1,\r\n\t\t\t\tcustom_shortcuts : 1,\r\n\t\t\t\tcustom_undo_redo_keyboard_shortcuts : 1,\r\n\t\t\t\tcustom_undo_redo_restore_selection : 1,\r\n\t\t\t\tcustom_undo_redo : 1,\r\n\t\t\t\tdoctype : tinymce.isIE6 ? '<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">' : '<!DOCTYPE>', // Use old doctype on IE 6 to avoid horizontal scroll\r\n\t\t\t\tvisual_table_class : 'mceItemTable',\r\n\t\t\t\tvisual : 1,\r\n\t\t\t\tfont_size_style_values : 'xx-small,x-small,small,medium,large,x-large,xx-large',\r\n\t\t\t\tfont_size_legacy_values : 'xx-small,small,medium,large,x-large,xx-large,300%', // See: http://www.w3.org/TR/CSS2/fonts.html#propdef-font-size\r\n\t\t\t\tapply_source_formatting : 1,\r\n\t\t\t\tdirectionality : 'ltr',\r\n\t\t\t\tforced_root_block : 'p',\r\n\t\t\t\thidden_input : 1,\r\n\t\t\t\tpadd_empty_editor : 1,\r\n\t\t\t\trender_ui : 1,\r\n\t\t\t\tinit_theme : 1,\r\n\t\t\t\tforce_p_newlines : 1,\r\n\t\t\t\tindentation : '30px',\r\n\t\t\t\tkeep_styles : 1,\r\n\t\t\t\tfix_table_elements : 1,\r\n\t\t\t\tinline_styles : 1,\r\n\t\t\t\tconvert_fonts_to_spans : true,\r\n\t\t\t\tindent : 'simple',\r\n\t\t\t\tindent_before : 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,li,area,table,thead,tfoot,tbody,tr',\r\n\t\t\t\tindent_after : 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,li,area,table,thead,tfoot,tbody,tr',\r\n\t\t\t\tvalidate : true,\r\n\t\t\t\tentity_encoding : 'named',\r\n\t\t\t\turl_converter : t.convertURL,\r\n\t\t\t\turl_converter_scope : t,\r\n\t\t\t\tie7_compat : true\r\n\t\t\t}, s);\r\n\r\n\t\t\tt.documentBaseURI = new tinymce.util.URI(s.document_base_url || tinymce.documentBaseURL, {\r\n\t\t\t\tbase_uri : tinyMCE.baseURI\r\n\t\t\t});\r\n\r\n\t\t\tt.baseURI = tinymce.baseURI;\r\n\r\n\t\t\tt.contentCSS = [];\r\n\r\n\t\t\t// Call setup\r\n\t\t\tt.execCallback('setup', t);\r\n\t\t},\r\n\r\n\t\trender : function(nst) {\r\n\t\t\tvar t = this, s = t.settings, id = t.id, sl = tinymce.ScriptLoader;\r\n\r\n\t\t\t// Page is not loaded yet, wait for it\r\n\t\t\tif (!Event.domLoaded) {\r\n\t\t\t\tEvent.add(document, 'init', function() {\r\n\t\t\t\t\tt.render();\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\ttinyMCE.settings = s;\r\n\r\n\t\t\t// Element not found, then skip initialization\r\n\t\t\tif (!t.getElement())\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Is a iPad/iPhone and not on iOS5, then skip initialization. We need to sniff \r\n\t\t\t// here since the browser says it has contentEditable support but there is no visible\r\n\t\t\t// caret We will remove this check ones Apple implements full contentEditable support\r\n\t\t\tif (tinymce.isIDevice && !tinymce.isIOS5)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Add hidden input for non input elements inside form elements\r\n\t\t\tif (!/TEXTAREA|INPUT/i.test(t.getElement().nodeName) && s.hidden_input && DOM.getParent(id, 'form'))\r\n\t\t\t\tDOM.insertAfter(DOM.create('input', {type : 'hidden', name : id}), id);\r\n\r\n\t\t\tif (tinymce.WindowManager)\r\n\t\t\t\tt.windowManager = new tinymce.WindowManager(t);\r\n\r\n\t\t\tif (s.encoding == 'xml') {\r\n\t\t\t\tt.onGetContent.add(function(ed, o) {\r\n\t\t\t\t\tif (o.save)\r\n\t\t\t\t\t\to.content = DOM.encode(o.content);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.add_form_submit_trigger) {\r\n\t\t\t\tt.onSubmit.addToTop(function() {\r\n\t\t\t\t\tif (t.initialized) {\r\n\t\t\t\t\t\tt.save();\r\n\t\t\t\t\t\tt.isNotDirty = 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.add_unload_trigger) {\r\n\t\t\t\tt._beforeUnload = tinyMCE.onBeforeUnload.add(function() {\r\n\t\t\t\t\tif (t.initialized && !t.destroyed && !t.isHidden())\r\n\t\t\t\t\t\tt.save({format : 'raw', no_events : true});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\ttinymce.addUnload(t.destroy, t);\r\n\r\n\t\t\tif (s.submit_patch) {\r\n\t\t\t\tt.onBeforeRenderUI.add(function() {\r\n\t\t\t\t\tvar n = t.getElement().form;\r\n\r\n\t\t\t\t\tif (!n)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t// Already patched\r\n\t\t\t\t\tif (n._mceOldSubmit)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t// Check page uses id=\"submit\" or name=\"submit\" for it's submit button\r\n\t\t\t\t\tif (!n.submit.nodeType && !n.submit.length) {\r\n\t\t\t\t\t\tt.formElement = n;\r\n\t\t\t\t\t\tn._mceOldSubmit = n.submit;\r\n\t\t\t\t\t\tn.submit = function() {\r\n\t\t\t\t\t\t\t// Save all instances\r\n\t\t\t\t\t\t\ttinymce.triggerSave();\r\n\t\t\t\t\t\t\tt.isNotDirty = 1;\r\n\r\n\t\t\t\t\t\t\treturn t.formElement._mceOldSubmit(t.formElement);\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tn = null;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Load scripts\r\n\t\t\tfunction loadScripts() {\r\n\t\t\t\tif (s.language && s.language_load !== false)\r\n\t\t\t\t\tsl.add(tinymce.baseURL + '/langs/' + s.language + '.js');\r\n\r\n\t\t\t\tif (s.theme && s.theme.charAt(0) != '-' && !ThemeManager.urls[s.theme])\r\n\t\t\t\t\tThemeManager.load(s.theme, 'themes/' + s.theme + '/editor_template' + tinymce.suffix + '.js');\r\n\r\n\t\t\t\teach(explode(s.plugins), function(p) {\r\n\t\t\t\t\tif (p &&!PluginManager.urls[p]) {\r\n\t\t\t\t\t\tif (p.charAt(0) == '-') {\r\n\t\t\t\t\t\t\tp = p.substr(1, p.length);\r\n\t\t\t\t\t\t\tvar dependencies = PluginManager.dependencies(p);\r\n\t\t\t\t\t\t\teach(dependencies, function(dep) {\r\n\t\t\t\t\t\t\t\tvar defaultSettings = {prefix:'plugins/', resource: dep, suffix:'/editor_plugin' + tinymce.suffix + '.js'};\r\n\t\t\t\t\t\t\t\tvar dep = PluginManager.createUrl(defaultSettings, dep);\r\n\t\t\t\t\t\t\t\tPluginManager.load(dep.resource, dep);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Skip safari plugin, since it is removed as of 3.3b1\r\n\t\t\t\t\t\t\tif (p == 'safari') {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tPluginManager.load(p, {prefix:'plugins/', resource: p, suffix:'/editor_plugin' + tinymce.suffix + '.js'});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Init when que is loaded\r\n\t\t\t\tsl.loadQueue(function() {\r\n\t\t\t\t\tif (!t.removed)\r\n\t\t\t\t\t\tt.init();\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tloadScripts();\r\n\t\t},\r\n\r\n\t\tinit : function() {\r\n\t\t\tvar n, t = this, s = t.settings, w, h, e = t.getElement(), o, ti, u, bi, bc, re, i, initializedPlugins = [];\r\n\r\n\t\t\ttinymce.add(t);\r\n\r\n\t\t\ts.aria_label = s.aria_label || DOM.getAttrib(e, 'aria-label', t.getLang('aria.rich_text_area'));\r\n\r\n\t\t\tif (s.theme) {\r\n\t\t\t\ts.theme = s.theme.replace(/-/, '');\r\n\t\t\t\to = ThemeManager.get(s.theme);\r\n\t\t\t\tt.theme = new o();\r\n\r\n\t\t\t\tif (t.theme.init && s.init_theme)\r\n\t\t\t\t\tt.theme.init(t, ThemeManager.urls[s.theme] || tinymce.documentBaseURL.replace(/\\/$/, ''));\r\n\t\t\t}\r\n\t\t\tfunction initPlugin(p) {\r\n\t\t\t\tvar c = PluginManager.get(p), u = PluginManager.urls[p] || tinymce.documentBaseURL.replace(/\\/$/, ''), po;\r\n\t\t\t\tif (c && tinymce.inArray(initializedPlugins,p) === -1) {\r\n\t\t\t\t\teach(PluginManager.dependencies(p), function(dep){\r\n\t\t\t\t\t\tinitPlugin(dep);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tpo = new c(t, u);\r\n\r\n\t\t\t\t\tt.plugins[p] = po;\r\n\r\n\t\t\t\t\tif (po.init) {\r\n\t\t\t\t\t\tpo.init(t, u);\r\n\t\t\t\t\t\tinitializedPlugins.push(p);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Create all plugins\r\n\t\t\teach(explode(s.plugins.replace(/\\-/g, '')), initPlugin);\r\n\r\n\t\t\t// Setup popup CSS path(s)\r\n\t\t\tif (s.popup_css !== false) {\r\n\t\t\t\tif (s.popup_css)\r\n\t\t\t\t\ts.popup_css = t.documentBaseURI.toAbsolute(s.popup_css);\r\n\t\t\t\telse\r\n\t\t\t\t\ts.popup_css = t.baseURI.toAbsolute(\"themes/\" + s.theme + \"/skins/\" + s.skin + \"/dialog.css\");\r\n\t\t\t}\r\n\r\n\t\t\tif (s.popup_css_add)\r\n\t\t\t\ts.popup_css += ',' + t.documentBaseURI.toAbsolute(s.popup_css_add);\r\n\r\n\t\t\tt.controlManager = new tinymce.ControlManager(t);\r\n\r\n\t\t\tif (s.custom_undo_redo) {\r\n\t\t\t\tt.onBeforeExecCommand.add(function(ed, cmd, ui, val, a) {\r\n\t\t\t\t\tif (cmd != 'Undo' && cmd != 'Redo' && cmd != 'mceRepaint' && (!a || !a.skip_undo))\r\n\t\t\t\t\t\tt.undoManager.beforeChange();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onExecCommand.add(function(ed, cmd, ui, val, a) {\r\n\t\t\t\t\tif (cmd != 'Undo' && cmd != 'Redo' && cmd != 'mceRepaint' && (!a || !a.skip_undo))\r\n\t\t\t\t\t\tt.undoManager.add();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tt.onExecCommand.add(function(ed, c) {\r\n\t\t\t\t// Don't refresh the select lists until caret move\r\n\t\t\t\tif (!/^(FontName|FontSize)$/.test(c))\r\n\t\t\t\t\tt.nodeChanged();\r\n\t\t\t});\r\n\r\n\t\t\t// Remove ghost selections on images and tables in Gecko\r\n\t\t\tif (isGecko) {\r\n\t\t\t\tfunction repaint(a, o) {\r\n\t\t\t\t\tif (!o || !o.initial)\r\n\t\t\t\t\t\tt.execCommand('mceRepaint');\r\n\t\t\t\t};\r\n\r\n\t\t\t\tt.onUndo.add(repaint);\r\n\t\t\t\tt.onRedo.add(repaint);\r\n\t\t\t\tt.onSetContent.add(repaint);\r\n\t\t\t}\r\n\r\n\t\t\t// Enables users to override the control factory\r\n\t\t\tt.onBeforeRenderUI.dispatch(t, t.controlManager);\r\n\r\n\t\t\t// Measure box\r\n\t\t\tif (s.render_ui) {\r\n\t\t\t\tw = s.width || e.style.width || e.offsetWidth;\r\n\t\t\t\th = s.height || e.style.height || e.offsetHeight;\r\n\t\t\t\tt.orgDisplay = e.style.display;\r\n\t\t\t\tre = /^[0-9\\.]+(|px)$/i;\r\n\r\n\t\t\t\tif (re.test('' + w))\r\n\t\t\t\t\tw = Math.max(parseInt(w) + (o.deltaWidth || 0), 100);\r\n\r\n\t\t\t\tif (re.test('' + h))\r\n\t\t\t\t\th = Math.max(parseInt(h) + (o.deltaHeight || 0), 100);\r\n\r\n\t\t\t\t// Render UI\r\n\t\t\t\to = t.theme.renderUI({\r\n\t\t\t\t\ttargetNode : e,\r\n\t\t\t\t\twidth : w,\r\n\t\t\t\t\theight : h,\r\n\t\t\t\t\tdeltaWidth : s.delta_width,\r\n\t\t\t\t\tdeltaHeight : s.delta_height\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.editorContainer = o.editorContainer;\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// User specified a document.domain value\r\n\t\t\tif (document.domain && location.hostname != document.domain)\r\n\t\t\t\ttinymce.relaxedDomain = document.domain;\r\n\r\n\t\t\t// Resize editor\r\n\t\t\tDOM.setStyles(o.sizeContainer || o.editorContainer, {\r\n\t\t\t\twidth : w,\r\n\t\t\t\theight : h\r\n\t\t\t});\r\n\r\n\t\t\t// Load specified content CSS last\r\n\t\t\tif (s.content_css) {\r\n\t\t\t\ttinymce.each(explode(s.content_css), function(u) {\r\n\t\t\t\t\tt.contentCSS.push(t.documentBaseURI.toAbsolute(u));\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\th = (o.iframeHeight || h) + (typeof(h) == 'number' ? (o.deltaHeight || 0) : '');\r\n\t\t\tif (h < 100)\r\n\t\t\t\th = 100;\r\n\r\n\t\t\tt.iframeHTML = s.doctype + '<html><head xmlns=\"http://www.w3.org/1999/xhtml\">';\r\n\r\n\t\t\t// We only need to override paths if we have to\r\n\t\t\t// IE has a bug where it remove site absolute urls to relative ones if this is specified\r\n\t\t\tif (s.document_base_url != tinymce.documentBaseURL)\r\n\t\t\t\tt.iframeHTML += '<base href=\"' + t.documentBaseURI.getURI() + '\" />';\r\n\r\n\t\t\t// IE8 doesn't support carets behind images setting ie7_compat would force IE8+ to run in IE7 compat mode.\r\n\t\t\tif (s.ie7_compat)\r\n\t\t\t\tt.iframeHTML += '<meta http-equiv=\"X-UA-Compatible\" content=\"IE=7\" />';\r\n\t\t\telse\r\n\t\t\t\tt.iframeHTML += '<meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />';\r\n\r\n\t\t\tt.iframeHTML += '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';\r\n\r\n\t\t\t// Load the CSS by injecting them into the HTML this will reduce \"flicker\"\r\n\t\t\tfor (i = 0; i < t.contentCSS.length; i++) {\r\n\t\t\t\tt.iframeHTML += '<link type=\"text/css\" rel=\"stylesheet\" href=\"' + t.contentCSS[i] + '\" />';\r\n\t\t\t}\r\n\r\n\t\t\tbi = s.body_id || 'tinymce';\r\n\t\t\tif (bi.indexOf('=') != -1) {\r\n\t\t\t\tbi = t.getParam('body_id', '', 'hash');\r\n\t\t\t\tbi = bi[t.id] || bi;\r\n\t\t\t}\r\n\r\n\t\t\tbc = s.body_class || '';\r\n\t\t\tif (bc.indexOf('=') != -1) {\r\n\t\t\t\tbc = t.getParam('body_class', '', 'hash');\r\n\t\t\t\tbc = bc[t.id] || '';\r\n\t\t\t}\r\n\r\n\t\t\tt.iframeHTML += '</head><body id=\"' + bi + '\" class=\"mceContentBody ' + bc + '\"><br></body></html>';\r\n\r\n\t\t\t// Domain relaxing enabled, then set document domain\r\n\t\t\tif (tinymce.relaxedDomain && (isIE || (tinymce.isOpera && parseFloat(opera.version()) < 11))) {\r\n\t\t\t\t// We need to write the contents here in IE since multiple writes messes up refresh button and back button\r\n\t\t\t\tu = 'javascript:(function(){document.open();document.domain=\"' + document.domain + '\";var ed = window.parent.tinyMCE.get(\"' + t.id + '\");document.write(ed.iframeHTML);document.close();ed.setupIframe();})()';\r\n\t\t\t}\r\n\r\n\t\t\t// Create iframe\r\n\t\t\t// TODO: ACC add the appropriate description on this.\r\n\t\t\tn = DOM.add(o.iframeContainer, 'iframe', { \r\n\t\t\t\tid : t.id + \"_ifr\",\r\n\t\t\t\tsrc : u || 'javascript:\"\"', // Workaround for HTTPS warning in IE6/7\r\n\t\t\t\tframeBorder : '0',\r\n\t\t\t\tallowTransparency : \"true\",\r\n\t\t\t\ttitle : s.aria_label,\r\n\t\t\t\tstyle : {\r\n\t\t\t\t\twidth : '100%',\r\n\t\t\t\t\theight : h,\r\n\t\t\t\t\tdisplay : 'block' // Important for Gecko to render the iframe correctly\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tt.contentAreaContainer = o.iframeContainer;\r\n\t\t\tDOM.get(o.editorContainer).style.display = t.orgDisplay;\r\n\t\t\tDOM.get(t.id).style.display = 'none';\r\n\t\t\tDOM.setAttrib(t.id, 'aria-hidden', true);\r\n\r\n\t\t\tif (!tinymce.relaxedDomain || !u)\r\n\t\t\t\tt.setupIframe();\r\n\r\n\t\t\te = n = o = null; // Cleanup\r\n\t\t},\r\n\r\n\t\tsetupIframe : function() {\r\n\t\t\tvar t = this, s = t.settings, e = DOM.get(t.id), d = t.getDoc(), h, b;\r\n\r\n\t\t\t// Setup iframe body\r\n\t\t\tif (!isIE || !tinymce.relaxedDomain) {\r\n\t\t\t\td.open();\r\n\t\t\t\td.write(t.iframeHTML);\r\n\t\t\t\td.close();\r\n\r\n\t\t\t\tif (tinymce.relaxedDomain)\r\n\t\t\t\t\td.domain = tinymce.relaxedDomain;\r\n\t\t\t}\r\n\r\n\t\t\t// It will not steal focus while setting contentEditable\r\n\t\t\tb = t.getBody();\r\n\t\t\tb.disabled = true;\r\n\r\n\t\t\tif (!s.readonly)\r\n\t\t\t\tb.contentEditable = true;\r\n\r\n\t\t\tb.disabled = false;\r\n\r\n\t\t\tt.schema = new tinymce.html.Schema(s);\r\n\r\n\t\t\tt.dom = new tinymce.dom.DOMUtils(t.getDoc(), {\r\n\t\t\t\tkeep_values : true,\r\n\t\t\t\turl_converter : t.convertURL,\r\n\t\t\t\turl_converter_scope : t,\r\n\t\t\t\thex_colors : s.force_hex_style_colors,\r\n\t\t\t\tclass_filter : s.class_filter,\r\n\t\t\t\tupdate_styles : 1,\r\n\t\t\t\tfix_ie_paragraphs : 1,\r\n\t\t\t\tschema : t.schema\r\n\t\t\t});\r\n\r\n\t\t\tt.parser = new tinymce.html.DomParser(s, t.schema);\r\n\r\n\t\t\t// Force anchor names closed, unless the setting \"allow_html_in_named_anchor\" is explicitly included.\r\n\t\t\tif (!t.settings.allow_html_in_named_anchor) {\r\n\t\t\t\tt.parser.addAttributeFilter('name', function(nodes, name) {\r\n\t\t\t\t\tvar i = nodes.length, sibling, prevSibling, parent, node;\r\n\t\r\n\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\t\tif (node.name === 'a' && node.firstChild) {\r\n\t\t\t\t\t\t\tparent = node.parent;\r\n\t\r\n\t\t\t\t\t\t\t// Move children after current node\r\n\t\t\t\t\t\t\tsibling = node.lastChild;\r\n\t\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\t\tprevSibling = sibling.prev;\r\n\t\t\t\t\t\t\t\tparent.insert(sibling, node);\r\n\t\t\t\t\t\t\t\tsibling = prevSibling;\r\n\t\t\t\t\t\t\t} while (sibling);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Convert src and href into data-mce-src, data-mce-href and data-mce-style\r\n\t\t\tt.parser.addAttributeFilter('src,href,style', function(nodes, name) {\r\n\t\t\t\tvar i = nodes.length, node, dom = t.dom, value, internalName;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\tvalue = node.attr(name);\r\n\t\t\t\t\tinternalName = 'data-mce-' + name;\r\n\r\n\t\t\t\t\t// Add internal attribute if we need to we don't on a refresh of the document\r\n\t\t\t\t\tif (!node.attributes.map[internalName]) {\t\r\n\t\t\t\t\t\tif (name === \"style\")\r\n\t\t\t\t\t\t\tnode.attr(internalName, dom.serializeStyle(dom.parseStyle(value), node.name));\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tnode.attr(internalName, t.convertURL(value, name, node.name));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Keep scripts from executing\r\n\t\t\tt.parser.addNodeFilter('script', function(nodes, name) {\r\n\t\t\t\tvar i = nodes.length, node;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\tnode.attr('type', 'mce-' + (node.attr('type') || 'text/javascript'));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tt.parser.addNodeFilter('#cdata', function(nodes, name) {\r\n\t\t\t\tvar i = nodes.length, node;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\tnode.type = 8;\r\n\t\t\t\t\tnode.name = '#comment';\r\n\t\t\t\t\tnode.value = '[CDATA[' + node.value + ']]';\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tt.parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div', function(nodes, name) {\r\n\t\t\t\tvar i = nodes.length, node, nonEmptyElements = t.schema.getNonEmptyElements();\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tnode = nodes[i];\r\n\r\n\t\t\t\t\tif (node.isEmpty(nonEmptyElements))\r\n\t\t\t\t\t\tnode.empty().append(new tinymce.html.Node('br', 1)).shortEnded = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tt.serializer = new tinymce.dom.Serializer(s, t.dom, t.schema);\r\n\r\n\t\t\tt.selection = new tinymce.dom.Selection(t.dom, t.getWin(), t.serializer);\r\n\r\n\t\t\tt.formatter = new tinymce.Formatter(this);\r\n\r\n\t\t\t// Register default formats\r\n\t\t\tt.formatter.register({\r\n\t\t\t\talignleft : [\r\n\t\t\t\t\t{selector : 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li', styles : {textAlign : 'left'}},\r\n\t\t\t\t\t{selector : 'img,table', collapsed : false, styles : {'float' : 'left'}}\r\n\t\t\t\t],\r\n\r\n\t\t\t\taligncenter : [\r\n\t\t\t\t\t{selector : 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li', styles : {textAlign : 'center'}},\r\n\t\t\t\t\t{selector : 'img', collapsed : false, styles : {display : 'block', marginLeft : 'auto', marginRight : 'auto'}},\r\n\t\t\t\t\t{selector : 'table', collapsed : false, styles : {marginLeft : 'auto', marginRight : 'auto'}}\r\n\t\t\t\t],\r\n\r\n\t\t\t\talignright : [\r\n\t\t\t\t\t{selector : 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li', styles : {textAlign : 'right'}},\r\n\t\t\t\t\t{selector : 'img,table', collapsed : false, styles : {'float' : 'right'}}\r\n\t\t\t\t],\r\n\r\n\t\t\t\talignfull : [\r\n\t\t\t\t\t{selector : 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li', styles : {textAlign : 'justify'}}\r\n\t\t\t\t],\r\n\r\n\t\t\t\tbold : [\r\n\t\t\t\t\t{inline : 'strong', remove : 'all'},\r\n\t\t\t\t\t{inline : 'span', styles : {fontWeight : 'bold'}},\r\n\t\t\t\t\t{inline : 'b', remove : 'all'}\r\n\t\t\t\t],\r\n\r\n\t\t\t\titalic : [\r\n\t\t\t\t\t{inline : 'em', remove : 'all'},\r\n\t\t\t\t\t{inline : 'span', styles : {fontStyle : 'italic'}},\r\n\t\t\t\t\t{inline : 'i', remove : 'all'}\r\n\t\t\t\t],\r\n\r\n\t\t\t\tunderline : [\r\n\t\t\t\t\t{inline : 'span', styles : {textDecoration : 'underline'}, exact : true},\r\n\t\t\t\t\t{inline : 'u', remove : 'all'}\r\n\t\t\t\t],\r\n\r\n\t\t\t\tstrikethrough : [\r\n\t\t\t\t\t{inline : 'span', styles : {textDecoration : 'line-through'}, exact : true},\r\n\t\t\t\t\t{inline : 'strike', remove : 'all'}\r\n\t\t\t\t],\r\n\r\n\t\t\t\tforecolor : {inline : 'span', styles : {color : '%value'}, wrap_links : false},\r\n\t\t\t\thilitecolor : {inline : 'span', styles : {backgroundColor : '%value'}, wrap_links : false},\r\n\t\t\t\tfontname : {inline : 'span', styles : {fontFamily : '%value'}},\r\n\t\t\t\tfontsize : {inline : 'span', styles : {fontSize : '%value'}},\r\n\t\t\t\tfontsize_class : {inline : 'span', attributes : {'class' : '%value'}},\r\n\t\t\t\tblockquote : {block : 'blockquote', wrapper : 1, remove : 'all'},\r\n\t\t\t\tsubscript : {inline : 'sub'},\r\n\t\t\t\tsuperscript : {inline : 'sup'},\r\n\r\n\t\t\t\tlink : {inline : 'a', selector : 'a', remove : 'all', split : true, deep : true,\r\n\t\t\t\t\tonmatch : function(node) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\tonformat : function(elm, fmt, vars) {\r\n\t\t\t\t\t\teach(vars, function(value, key) {\r\n\t\t\t\t\t\t\tt.dom.setAttrib(elm, key, value);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\tremoveformat : [\r\n\t\t\t\t\t{selector : 'b,strong,em,i,font,u,strike', remove : 'all', split : true, expand : false, block_expand : true, deep : true},\r\n\t\t\t\t\t{selector : 'span', attributes : ['style', 'class'], remove : 'empty', split : true, expand : false, deep : true},\r\n\t\t\t\t\t{selector : '*', attributes : ['style', 'class'], split : false, expand : false, deep : true}\r\n\t\t\t\t]\r\n\t\t\t});\r\n\r\n\t\t\t// Register default block formats\r\n\t\t\teach('p h1 h2 h3 h4 h5 h6 div address pre div code dt dd samp'.split(/\\s/), function(name) {\r\n\t\t\t\tt.formatter.register(name, {block : name, remove : 'all'});\r\n\t\t\t});\r\n\r\n\t\t\t// Register user defined formats\r\n\t\t\tt.formatter.register(t.settings.formats);\r\n\r\n\t\t\tt.undoManager = new tinymce.UndoManager(t);\r\n\r\n\t\t\t// Pass through\r\n\t\t\tt.undoManager.onAdd.add(function(um, l) {\r\n\t\t\t\tif (um.hasUndo())\r\n\t\t\t\t\treturn t.onChange.dispatch(t, l, um);\r\n\t\t\t});\r\n\r\n\t\t\tt.undoManager.onUndo.add(function(um, l) {\r\n\t\t\t\treturn t.onUndo.dispatch(t, l, um);\r\n\t\t\t});\r\n\r\n\t\t\tt.undoManager.onRedo.add(function(um, l) {\r\n\t\t\t\treturn t.onRedo.dispatch(t, l, um);\r\n\t\t\t});\r\n\r\n\t\t\tt.forceBlocks = new tinymce.ForceBlocks(t, {\r\n\t\t\t\tforced_root_block : s.forced_root_block\r\n\t\t\t});\r\n\r\n\t\t\tt.editorCommands = new tinymce.EditorCommands(t);\r\n\r\n\t\t\t// Pass through\r\n\t\t\tt.serializer.onPreProcess.add(function(se, o) {\r\n\t\t\t\treturn t.onPreProcess.dispatch(t, o, se);\r\n\t\t\t});\r\n\r\n\t\t\tt.serializer.onPostProcess.add(function(se, o) {\r\n\t\t\t\treturn t.onPostProcess.dispatch(t, o, se);\r\n\t\t\t});\r\n\r\n\t\t\tt.onPreInit.dispatch(t);\r\n\r\n\t\t\tif (!s.gecko_spellcheck)\r\n\t\t\t\tt.getBody().spellcheck = 0;\r\n\r\n\t\t\tif (!s.readonly)\r\n\t\t\t\tt._addEvents();\r\n\r\n\t\t\tt.controlManager.onPostRender.dispatch(t, t.controlManager);\r\n\t\t\tt.onPostRender.dispatch(t);\r\n\r\n\t\t\tt.quirks = new tinymce.util.Quirks(this);\r\n\r\n\t\t\tif (s.directionality)\r\n\t\t\t\tt.getBody().dir = s.directionality;\r\n\r\n\t\t\tif (s.nowrap)\r\n\t\t\t\tt.getBody().style.whiteSpace = \"nowrap\";\r\n\r\n\t\t\tif (s.handle_node_change_callback) {\r\n\t\t\t\tt.onNodeChange.add(function(ed, cm, n) {\r\n\t\t\t\t\tt.execCallback('handle_node_change_callback', t.id, n, -1, -1, true, t.selection.isCollapsed());\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.save_callback) {\r\n\t\t\t\tt.onSaveContent.add(function(ed, o) {\r\n\t\t\t\t\tvar h = t.execCallback('save_callback', t.id, o.content, t.getBody());\r\n\r\n\t\t\t\t\tif (h)\r\n\t\t\t\t\t\to.content = h;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.onchange_callback) {\r\n\t\t\t\tt.onChange.add(function(ed, l) {\r\n\t\t\t\t\tt.execCallback('onchange_callback', t, l);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.protect) {\r\n\t\t\t\tt.onBeforeSetContent.add(function(ed, o) {\r\n\t\t\t\t\tif (s.protect) {\r\n\t\t\t\t\t\teach(s.protect, function(pattern) {\r\n\t\t\t\t\t\t\to.content = o.content.replace(pattern, function(str) {\r\n\t\t\t\t\t\t\t\treturn '<!--mce:protected ' + escape(str) + '-->';\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.convert_newlines_to_brs) {\r\n\t\t\t\tt.onBeforeSetContent.add(function(ed, o) {\r\n\t\t\t\t\tif (o.initial)\r\n\t\t\t\t\t\to.content = o.content.replace(/\\r?\\n/g, '<br />');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.preformatted) {\r\n\t\t\t\tt.onPostProcess.add(function(ed, o) {\r\n\t\t\t\t\to.content = o.content.replace(/^\\s*<pre.*?>/, '');\r\n\t\t\t\t\to.content = o.content.replace(/<\\/pre>\\s*$/, '');\r\n\r\n\t\t\t\t\tif (o.set)\r\n\t\t\t\t\t\to.content = '<pre class=\"mceItemHidden\">' + o.content + '</pre>';\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.verify_css_classes) {\r\n\t\t\t\tt.serializer.attribValueFilter = function(n, v) {\r\n\t\t\t\t\tvar s, cl;\r\n\r\n\t\t\t\t\tif (n == 'class') {\r\n\t\t\t\t\t\t// Build regexp for classes\r\n\t\t\t\t\t\tif (!t.classesRE) {\r\n\t\t\t\t\t\t\tcl = t.dom.getClasses();\r\n\r\n\t\t\t\t\t\t\tif (cl.length > 0) {\r\n\t\t\t\t\t\t\t\ts = '';\r\n\r\n\t\t\t\t\t\t\t\teach (cl, function(o) {\r\n\t\t\t\t\t\t\t\t\ts += (s ? '|' : '') + o['class'];\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\tt.classesRE = new RegExp('(' + s + ')', 'gi');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn !t.classesRE || /(\\bmceItem\\w+\\b|\\bmceTemp\\w+\\b)/g.test(v) || t.classesRE.test(v) ? v : '';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn v;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (s.cleanup_callback) {\r\n\t\t\t\tt.onBeforeSetContent.add(function(ed, o) {\r\n\t\t\t\t\to.content = t.execCallback('cleanup_callback', 'insert_to_editor', o.content, o);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onPreProcess.add(function(ed, o) {\r\n\t\t\t\t\tif (o.set)\r\n\t\t\t\t\t\tt.execCallback('cleanup_callback', 'insert_to_editor_dom', o.node, o);\r\n\r\n\t\t\t\t\tif (o.get)\r\n\t\t\t\t\t\tt.execCallback('cleanup_callback', 'get_from_editor_dom', o.node, o);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onPostProcess.add(function(ed, o) {\r\n\t\t\t\t\tif (o.set)\r\n\t\t\t\t\t\to.content = t.execCallback('cleanup_callback', 'insert_to_editor', o.content, o);\r\n\r\n\t\t\t\t\tif (o.get)\t\t\t\t\t\t\r\n\t\t\t\t\t\to.content = t.execCallback('cleanup_callback', 'get_from_editor', o.content, o);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.save_callback) {\r\n\t\t\t\tt.onGetContent.add(function(ed, o) {\r\n\t\t\t\t\tif (o.save)\r\n\t\t\t\t\t\to.content = t.execCallback('save_callback', t.id, o.content, t.getBody());\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (s.handle_event_callback) {\r\n\t\t\t\tt.onEvent.add(function(ed, e, o) {\r\n\t\t\t\t\tif (t.execCallback('handle_event_callback', e, ed, o) === false)\r\n\t\t\t\t\t\tEvent.cancel(e);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Add visual aids when new contents is added\r\n\t\t\tt.onSetContent.add(function() {\r\n\t\t\t\tt.addVisual(t.getBody());\r\n\t\t\t});\r\n\r\n\t\t\t// Remove empty contents\r\n\t\t\tif (s.padd_empty_editor) {\r\n\t\t\t\tt.onPostProcess.add(function(ed, o) {\r\n\t\t\t\t\to.content = o.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\\s|\\u00a0|)<\\/p>[\\r\\n]*|<br \\/>[\\r\\n]*)$/, '');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (isGecko) {\r\n\t\t\t\t// Fix gecko link bug, when a link is placed at the end of block elements there is\r\n\t\t\t\t// no way to move the caret behind the link. This fix adds a bogus br element after the link\r\n\t\t\t\tfunction fixLinks(ed, o) {\r\n\t\t\t\t\teach(ed.dom.select('a'), function(n) {\r\n\t\t\t\t\t\tvar pn = n.parentNode;\r\n\r\n\t\t\t\t\t\tif (ed.dom.isBlock(pn) && pn.lastChild === n)\r\n\t\t\t\t\t\t\ted.dom.add(pn, 'br', {'data-mce-bogus' : 1});\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\r\n\t\t\t\tt.onExecCommand.add(function(ed, cmd) {\r\n\t\t\t\t\tif (cmd === 'CreateLink')\r\n\t\t\t\t\t\tfixLinks(ed);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onSetContent.add(t.selection.onSetContent.add(fixLinks));\r\n\t\t\t}\r\n\r\n\t\t\tt.load({initial : true, format : 'html'});\r\n\t\t\tt.startContent = t.getContent({format : 'raw'});\r\n\t\t\tt.undoManager.add();\r\n\t\t\tt.initialized = true;\r\n\r\n\t\t\tt.onInit.dispatch(t);\r\n\t\t\tt.execCallback('setupcontent_callback', t.id, t.getBody(), t.getDoc());\r\n\t\t\tt.execCallback('init_instance_callback', t);\r\n\t\t\tt.focus(true);\r\n\t\t\tt.nodeChanged({initial : 1});\r\n\r\n\t\t\t// Load specified content CSS last\r\n\t\t\teach(t.contentCSS, function(u) {\r\n\t\t\t\tt.dom.loadCSS(u);\r\n\t\t\t});\r\n\r\n\t\t\t// Handle auto focus\r\n\t\t\tif (s.auto_focus) {\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tvar ed = tinymce.get(s.auto_focus);\r\n\r\n\t\t\t\t\ted.selection.select(ed.getBody(), 1);\r\n\t\t\t\t\ted.selection.collapse(1);\r\n\t\t\t\t\ted.getBody().focus();\r\n\t\t\t\t\ted.getWin().focus();\r\n\t\t\t\t}, 100);\r\n\t\t\t}\r\n\r\n\t\t\te = null;\r\n\t\t},\r\n\r\n\r\n\t\tfocus : function(sf) {\r\n\t\t\tvar oed, t = this, selection = t.selection, ce = t.settings.content_editable, ieRng, controlElm, doc = t.getDoc();\r\n\r\n\t\t\tif (!sf) {\r\n\t\t\t\t// Get selected control element\r\n\t\t\t\tieRng = selection.getRng();\r\n\t\t\t\tif (ieRng.item) {\r\n\t\t\t\t\tcontrolElm = ieRng.item(0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt._refreshContentEditable();\r\n\t\t\t\tselection.normalize();\r\n\r\n\t\t\t\t// Is not content editable\r\n\t\t\t\tif (!ce)\r\n\t\t\t\t\tt.getWin().focus();\r\n\r\n\t\t\t\t// Focus the body as well since it's contentEditable\r\n\t\t\t\tif (tinymce.isGecko) {\r\n\t\t\t\t\tt.getBody().focus();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Restore selected control element\r\n\t\t\t\t// This is needed when for example an image is selected within a\r\n\t\t\t\t// layer a call to focus will then remove the control selection\r\n\t\t\t\tif (controlElm && controlElm.ownerDocument == doc) {\r\n\t\t\t\t\tieRng = doc.body.createControlRange();\r\n\t\t\t\t\tieRng.addElement(controlElm);\r\n\t\t\t\t\tieRng.select();\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (tinymce.activeEditor != t) {\r\n\t\t\t\tif ((oed = tinymce.activeEditor) != null)\r\n\t\t\t\t\toed.onDeactivate.dispatch(oed, t);\r\n\r\n\t\t\t\tt.onActivate.dispatch(t, oed);\r\n\t\t\t}\r\n\r\n\t\t\ttinymce._setActive(t);\r\n\t\t},\r\n\r\n\t\texecCallback : function(n) {\r\n\t\t\tvar t = this, f = t.settings[n], s;\r\n\r\n\t\t\tif (!f)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Look through lookup\r\n\t\t\tif (t.callbackLookup && (s = t.callbackLookup[n])) {\r\n\t\t\t\tf = s.func;\r\n\t\t\t\ts = s.scope;\r\n\t\t\t}\r\n\r\n\t\t\tif (is(f, 'string')) {\r\n\t\t\t\ts = f.replace(/\\.\\w+$/, '');\r\n\t\t\t\ts = s ? tinymce.resolve(s) : 0;\r\n\t\t\t\tf = tinymce.resolve(f);\r\n\t\t\t\tt.callbackLookup = t.callbackLookup || {};\r\n\t\t\t\tt.callbackLookup[n] = {func : f, scope : s};\r\n\t\t\t}\r\n\r\n\t\t\treturn f.apply(s || t, Array.prototype.slice.call(arguments, 1));\r\n\t\t},\r\n\r\n\t\ttranslate : function(s) {\r\n\t\t\tvar c = this.settings.language || 'en', i18n = tinymce.i18n;\r\n\r\n\t\t\tif (!s)\r\n\t\t\t\treturn '';\r\n\r\n\t\t\treturn i18n[c + '.' + s] || s.replace(/{\\#([^}]+)\\}/g, function(a, b) {\r\n\t\t\t\treturn i18n[c + '.' + b] || '{#' + b + '}';\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetLang : function(n, dv) {\r\n\t\t\treturn tinymce.i18n[(this.settings.language || 'en') + '.' + n] || (is(dv) ? dv : '{#' + n + '}');\r\n\t\t},\r\n\r\n\t\tgetParam : function(n, dv, ty) {\r\n\t\t\tvar tr = tinymce.trim, v = is(this.settings[n]) ? this.settings[n] : dv, o;\r\n\r\n\t\t\tif (ty === 'hash') {\r\n\t\t\t\to = {};\r\n\r\n\t\t\t\tif (is(v, 'string')) {\r\n\t\t\t\t\teach(v.indexOf('=') > 0 ? v.split(/[;,](?![^=;,]*(?:[;,]|$))/) : v.split(','), function(v) {\r\n\t\t\t\t\t\tv = v.split('=');\r\n\r\n\t\t\t\t\t\tif (v.length > 1)\r\n\t\t\t\t\t\t\to[tr(v[0])] = tr(v[1]);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\to[tr(v[0])] = tr(v);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else\r\n\t\t\t\t\to = v;\r\n\r\n\t\t\t\treturn o;\r\n\t\t\t}\r\n\r\n\t\t\treturn v;\r\n\t\t},\r\n\r\n\t\tnodeChanged : function(o) {\r\n\t\t\tvar t = this, s = t.selection, n = s.getStart() || t.getBody();\r\n\r\n\t\t\t// Fix for bug #1896577 it seems that this can not be fired while the editor is loading\r\n\t\t\tif (t.initialized) {\r\n\t\t\t\to = o || {};\r\n\t\t\t\tn = isIE && n.ownerDocument != t.getDoc() ? t.getBody() : n; // Fix for IE initial state\r\n\r\n\t\t\t\t// Get parents and add them to object\r\n\t\t\t\to.parents = [];\r\n\t\t\t\tt.dom.getParent(n, function(node) {\r\n\t\t\t\t\tif (node.nodeName == 'BODY')\r\n\t\t\t\t\t\treturn true;\r\n\r\n\t\t\t\t\to.parents.push(node);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onNodeChange.dispatch(\r\n\t\t\t\t\tt,\r\n\t\t\t\t\to ? o.controlManager || t.controlManager : t.controlManager,\r\n\t\t\t\t\tn,\r\n\t\t\t\t\ts.isCollapsed(),\r\n\t\t\t\t\to\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\taddButton : function(n, s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.buttons = t.buttons || {};\r\n\t\t\tt.buttons[n] = s;\r\n\t\t},\r\n\r\n\t\taddCommand : function(name, callback, scope) {\r\n\t\t\tthis.execCommands[name] = {func : callback, scope : scope || this};\r\n\t\t},\r\n\r\n\t\taddQueryStateHandler : function(name, callback, scope) {\r\n\t\t\tthis.queryStateCommands[name] = {func : callback, scope : scope || this};\r\n\t\t},\r\n\r\n\t\taddQueryValueHandler : function(name, callback, scope) {\r\n\t\t\tthis.queryValueCommands[name] = {func : callback, scope : scope || this};\r\n\t\t},\r\n\r\n\t\taddShortcut : function(pa, desc, cmd_func, sc) {\r\n\t\t\tvar t = this, c;\r\n\r\n\t\t\tif (!t.settings.custom_shortcuts)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tt.shortcuts = t.shortcuts || {};\r\n\r\n\t\t\tif (is(cmd_func, 'string')) {\r\n\t\t\t\tc = cmd_func;\r\n\r\n\t\t\t\tcmd_func = function() {\r\n\t\t\t\t\tt.execCommand(c, false, null);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (is(cmd_func, 'object')) {\r\n\t\t\t\tc = cmd_func;\r\n\r\n\t\t\t\tcmd_func = function() {\r\n\t\t\t\t\tt.execCommand(c[0], c[1], c[2]);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\teach(explode(pa), function(pa) {\r\n\t\t\t\tvar o = {\r\n\t\t\t\t\tfunc : cmd_func,\r\n\t\t\t\t\tscope : sc || this,\r\n\t\t\t\t\tdesc : desc,\r\n\t\t\t\t\talt : false,\r\n\t\t\t\t\tctrl : false,\r\n\t\t\t\t\tshift : false\r\n\t\t\t\t};\r\n\r\n\t\t\t\teach(explode(pa, '+'), function(v) {\r\n\t\t\t\t\tswitch (v) {\r\n\t\t\t\t\t\tcase 'alt':\r\n\t\t\t\t\t\tcase 'ctrl':\r\n\t\t\t\t\t\tcase 'shift':\r\n\t\t\t\t\t\t\to[v] = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\to.charCode = v.charCodeAt(0);\r\n\t\t\t\t\t\t\to.keyCode = v.toUpperCase().charCodeAt(0);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.shortcuts[(o.ctrl ? 'ctrl' : '') + ',' + (o.alt ? 'alt' : '') + ',' + (o.shift ? 'shift' : '') + ',' + o.keyCode] = o;\r\n\t\t\t});\r\n\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\texecCommand : function(cmd, ui, val, a) {\r\n\t\t\tvar t = this, s = 0, o, st;\r\n\r\n\t\t\tif (!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint|SelectAll)$/.test(cmd) && (!a || !a.skip_focus))\r\n\t\t\t\tt.focus();\r\n\r\n\t\t\to = {};\r\n\t\t\tt.onBeforeExecCommand.dispatch(t, cmd, ui, val, o);\r\n\t\t\tif (o.terminate)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t// Command callback\r\n\t\t\tif (t.execCallback('execcommand_callback', t.id, t.selection.getNode(), cmd, ui, val)) {\r\n\t\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Registred commands\r\n\t\t\tif (o = t.execCommands[cmd]) {\r\n\t\t\t\tst = o.func.call(o.scope, ui, val);\r\n\r\n\t\t\t\t// Fall through on true\r\n\t\t\t\tif (st !== true) {\r\n\t\t\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\r\n\t\t\t\t\treturn st;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Plugin commands\r\n\t\t\teach(t.plugins, function(p) {\r\n\t\t\t\tif (p.execCommand && p.execCommand(cmd, ui, val)) {\r\n\t\t\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\r\n\t\t\t\t\ts = 1;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (s)\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t// Theme commands\r\n\t\t\tif (t.theme && t.theme.execCommand && t.theme.execCommand(cmd, ui, val)) {\r\n\t\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Editor commands\r\n\t\t\tif (t.editorCommands.execCommand(cmd, ui, val)) {\r\n\t\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Browser commands\r\n\t\t\tt.getDoc().execCommand(cmd, ui, val);\r\n\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\r\n\t\t},\r\n\r\n\t\tqueryCommandState : function(cmd) {\r\n\t\t\tvar t = this, o, s;\r\n\r\n\t\t\t// Is hidden then return undefined\r\n\t\t\tif (t._isHidden())\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Registred commands\r\n\t\t\tif (o = t.queryStateCommands[cmd]) {\r\n\t\t\t\ts = o.func.call(o.scope);\r\n\r\n\t\t\t\t// Fall though on true\r\n\t\t\t\tif (s !== true)\r\n\t\t\t\t\treturn s;\r\n\t\t\t}\r\n\r\n\t\t\t// Registred commands\r\n\t\t\to = t.editorCommands.queryCommandState(cmd);\r\n\t\t\tif (o !== -1)\r\n\t\t\t\treturn o;\r\n\r\n\t\t\t// Browser commands\r\n\t\t\ttry {\r\n\t\t\t\treturn this.getDoc().queryCommandState(cmd);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Fails sometimes see bug: 1896577\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tqueryCommandValue : function(c) {\r\n\t\t\tvar t = this, o, s;\r\n\r\n\t\t\t// Is hidden then return undefined\r\n\t\t\tif (t._isHidden())\r\n\t\t\t\treturn;\r\n\r\n\t\t\t// Registred commands\r\n\t\t\tif (o = t.queryValueCommands[c]) {\r\n\t\t\t\ts = o.func.call(o.scope);\r\n\r\n\t\t\t\t// Fall though on true\r\n\t\t\t\tif (s !== true)\r\n\t\t\t\t\treturn s;\r\n\t\t\t}\r\n\r\n\t\t\t// Registred commands\r\n\t\t\to = t.editorCommands.queryCommandValue(c);\r\n\t\t\tif (is(o))\r\n\t\t\t\treturn o;\r\n\r\n\t\t\t// Browser commands\r\n\t\t\ttry {\r\n\t\t\t\treturn this.getDoc().queryCommandValue(c);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Fails sometimes see bug: 1896577\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tshow : function() {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tDOM.show(t.getContainer());\r\n\t\t\tDOM.hide(t.id);\r\n\t\t\tt.load();\r\n\t\t},\r\n\r\n\t\thide : function() {\r\n\t\t\tvar t = this, d = t.getDoc();\r\n\r\n\t\t\t// Fixed bug where IE has a blinking cursor left from the editor\r\n\t\t\tif (isIE && d)\r\n\t\t\t\td.execCommand('SelectAll');\r\n\r\n\t\t\t// We must save before we hide so Safari doesn't crash\r\n\t\t\tt.save();\r\n\t\t\tDOM.hide(t.getContainer());\r\n\t\t\tDOM.setStyle(t.id, 'display', t.orgDisplay);\r\n\t\t},\r\n\r\n\t\tisHidden : function() {\r\n\t\t\treturn !DOM.isHidden(this.id);\r\n\t\t},\r\n\r\n\t\tsetProgressState : function(b, ti, o) {\r\n\t\t\tthis.onSetProgressState.dispatch(this, b, ti, o);\r\n\r\n\t\t\treturn b;\r\n\t\t},\r\n\r\n\t\tload : function(o) {\r\n\t\t\tvar t = this, e = t.getElement(), h;\r\n\r\n\t\t\tif (e) {\r\n\t\t\t\to = o || {};\r\n\t\t\t\to.load = true;\r\n\r\n\t\t\t\t// Double encode existing entities in the value\r\n\t\t\t\th = t.setContent(is(e.value) ? e.value : e.innerHTML, o);\r\n\t\t\t\to.element = e;\r\n\r\n\t\t\t\tif (!o.no_events)\r\n\t\t\t\t\tt.onLoadContent.dispatch(t, o);\r\n\r\n\t\t\t\to.element = e = null;\r\n\r\n\t\t\t\treturn h;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tsave : function(o) {\r\n\t\t\tvar t = this, e = t.getElement(), h, f;\r\n\r\n\t\t\tif (!e || !t.initialized)\r\n\t\t\t\treturn;\r\n\r\n\t\t\to = o || {};\r\n\t\t\to.save = true;\r\n\r\n\t\t\t// Add undo level will trigger onchange event\r\n\t\t\tif (!o.no_events) {\r\n\t\t\t\tt.undoManager.typing = false;\r\n\t\t\t\tt.undoManager.add();\r\n\t\t\t}\r\n\r\n\t\t\to.element = e;\r\n\t\t\th = o.content = t.getContent(o);\r\n\r\n\t\t\tif (!o.no_events)\r\n\t\t\t\tt.onSaveContent.dispatch(t, o);\r\n\r\n\t\t\th = o.content;\r\n\r\n\t\t\tif (!/TEXTAREA|INPUT/i.test(e.nodeName)) {\r\n\t\t\t\te.innerHTML = h;\r\n\r\n\t\t\t\t// Update hidden form element\r\n\t\t\t\tif (f = DOM.getParent(t.id, 'form')) {\r\n\t\t\t\t\teach(f.elements, function(e) {\r\n\t\t\t\t\t\tif (e.name == t.id) {\r\n\t\t\t\t\t\t\te.value = h;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} else\r\n\t\t\t\te.value = h;\r\n\r\n\t\t\to.element = e = null;\r\n\r\n\t\t\treturn h;\r\n\t\t},\r\n\r\n\t\tsetContent : function(content, args) {\r\n\t\t\tvar self = this, rootNode, body = self.getBody(), forcedRootBlockName;\r\n\r\n\t\t\t// Setup args object\r\n\t\t\targs = args || {};\r\n\t\t\targs.format = args.format || 'html';\r\n\t\t\targs.set = true;\r\n\t\t\targs.content = content;\r\n\r\n\t\t\t// Do preprocessing\r\n\t\t\tif (!args.no_events)\r\n\t\t\t\tself.onBeforeSetContent.dispatch(self, args);\r\n\r\n\t\t\tcontent = args.content;\r\n\r\n\t\t\t// Padd empty content in Gecko and Safari. Commands will otherwise fail on the content\r\n\t\t\t// It will also be impossible to place the caret in the editor unless there is a BR element present\r\n\t\t\tif (!tinymce.isIE && (content.length === 0 || /^\\s+$/.test(content))) {\r\n\t\t\t\tforcedRootBlockName = self.settings.forced_root_block;\r\n\t\t\t\tif (forcedRootBlockName)\r\n\t\t\t\t\tcontent = '<' + forcedRootBlockName + '><br data-mce-bogus=\"1\"></' + forcedRootBlockName + '>';\r\n\t\t\t\telse\r\n\t\t\t\t\tcontent = '<br data-mce-bogus=\"1\">';\r\n\r\n\t\t\t\tbody.innerHTML = content;\r\n\t\t\t\tself.selection.select(body, true);\r\n\t\t\t\tself.selection.collapse(true);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Parse and serialize the html\r\n\t\t\tif (args.format !== 'raw') {\r\n\t\t\t\tcontent = new tinymce.html.Serializer({}, self.schema).serialize(\r\n\t\t\t\t\tself.parser.parse(content)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// Set the new cleaned contents to the editor\r\n\t\t\targs.content = tinymce.trim(content);\r\n\t\t\tself.dom.setHTML(body, args.content);\r\n\r\n\t\t\t// Do post processing\r\n\t\t\tif (!args.no_events)\r\n\t\t\t\tself.onSetContent.dispatch(self, args);\r\n\r\n\t\t\tself.selection.normalize();\r\n\r\n\t\t\treturn args.content;\r\n\t\t},\r\n\r\n\t\tgetContent : function(args) {\r\n\t\t\tvar self = this, content;\r\n\r\n\t\t\t// Setup args object\r\n\t\t\targs = args || {};\r\n\t\t\targs.format = args.format || 'html';\r\n\t\t\targs.get = true;\r\n\r\n\t\t\t// Do preprocessing\r\n\t\t\tif (!args.no_events)\r\n\t\t\t\tself.onBeforeGetContent.dispatch(self, args);\r\n\r\n\t\t\t// Get raw contents or by default the cleaned contents\r\n\t\t\tif (args.format == 'raw')\r\n\t\t\t\tcontent = self.getBody().innerHTML;\r\n\t\t\telse\r\n\t\t\t\tcontent = self.serializer.serialize(self.getBody(), args);\r\n\r\n\t\t\targs.content = tinymce.trim(content);\r\n\r\n\t\t\t// Do post processing\r\n\t\t\tif (!args.no_events)\r\n\t\t\t\tself.onGetContent.dispatch(self, args);\r\n\r\n\t\t\treturn args.content;\r\n\t\t},\r\n\r\n\t\tisDirty : function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\treturn tinymce.trim(self.startContent) != tinymce.trim(self.getContent({format : 'raw', no_events : 1})) && !self.isNotDirty;\r\n\t\t},\r\n\r\n\t\tgetContainer : function() {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (!t.container)\r\n\t\t\t\tt.container = DOM.get(t.editorContainer || t.id + '_parent');\r\n\r\n\t\t\treturn t.container;\r\n\t\t},\r\n\r\n\t\tgetContentAreaContainer : function() {\r\n\t\t\treturn this.contentAreaContainer;\r\n\t\t},\r\n\r\n\t\tgetElement : function() {\r\n\t\t\treturn DOM.get(this.settings.content_element || this.id);\r\n\t\t},\r\n\r\n\t\tgetWin : function() {\r\n\t\t\tvar t = this, e;\r\n\r\n\t\t\tif (!t.contentWindow) {\r\n\t\t\t\te = DOM.get(t.id + \"_ifr\");\r\n\r\n\t\t\t\tif (e)\r\n\t\t\t\t\tt.contentWindow = e.contentWindow;\r\n\t\t\t}\r\n\r\n\t\t\treturn t.contentWindow;\r\n\t\t},\r\n\r\n\t\tgetDoc : function() {\r\n\t\t\tvar t = this, w;\r\n\r\n\t\t\tif (!t.contentDocument) {\r\n\t\t\t\tw = t.getWin();\r\n\r\n\t\t\t\tif (w)\r\n\t\t\t\t\tt.contentDocument = w.document;\r\n\t\t\t}\r\n\r\n\t\t\treturn t.contentDocument;\r\n\t\t},\r\n\r\n\t\tgetBody : function() {\r\n\t\t\treturn this.bodyElement || this.getDoc().body;\r\n\t\t},\r\n\r\n\t\tconvertURL : function(u, n, e) {\r\n\t\t\tvar t = this, s = t.settings;\r\n\r\n\t\t\t// Use callback instead\r\n\t\t\tif (s.urlconverter_callback)\r\n\t\t\t\treturn t.execCallback('urlconverter_callback', u, e, true, n);\r\n\r\n\t\t\t// Don't convert link href since thats the CSS files that gets loaded into the editor also skip local file URLs\r\n\t\t\tif (!s.convert_urls || (e && e.nodeName == 'LINK') || u.indexOf('file:') === 0)\r\n\t\t\t\treturn u;\r\n\r\n\t\t\t// Convert to relative\r\n\t\t\tif (s.relative_urls)\r\n\t\t\t\treturn t.documentBaseURI.toRelative(u);\r\n\r\n\t\t\t// Convert to absolute\r\n\t\t\tu = t.documentBaseURI.toAbsolute(u, s.remove_script_host);\r\n\r\n\t\t\treturn u;\r\n\t\t},\r\n\r\n\t\taddVisual : function(e) {\r\n\t\t\tvar t = this, s = t.settings;\r\n\r\n\t\t\te = e || t.getBody();\r\n\r\n\t\t\tif (!is(t.hasVisual))\r\n\t\t\t\tt.hasVisual = s.visual;\r\n\r\n\t\t\teach(t.dom.select('table,a', e), function(e) {\r\n\t\t\t\tvar v;\r\n\r\n\t\t\t\tswitch (e.nodeName) {\r\n\t\t\t\t\tcase 'TABLE':\r\n\t\t\t\t\t\tv = t.dom.getAttrib(e, 'border');\r\n\r\n\t\t\t\t\t\tif (!v || v == '0') {\r\n\t\t\t\t\t\t\tif (t.hasVisual)\r\n\t\t\t\t\t\t\t\tt.dom.addClass(e, s.visual_table_class);\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tt.dom.removeClass(e, s.visual_table_class);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tcase 'A':\r\n\t\t\t\t\t\tv = t.dom.getAttrib(e, 'name');\r\n\r\n\t\t\t\t\t\tif (v) {\r\n\t\t\t\t\t\t\tif (t.hasVisual)\r\n\t\t\t\t\t\t\t\tt.dom.addClass(e, 'mceItemAnchor');\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tt.dom.removeClass(e, 'mceItemAnchor');\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tt.onVisualAid.dispatch(t, e, t.hasVisual);\r\n\t\t},\r\n\r\n\t\tremove : function() {\r\n\t\t\tvar t = this, e = t.getContainer();\r\n\r\n\t\t\tt.removed = 1; // Cancels post remove event execution\r\n\t\t\tt.hide();\r\n\r\n\t\t\tt.execCallback('remove_instance_callback', t);\r\n\t\t\tt.onRemove.dispatch(t);\r\n\r\n\t\t\t// Clear all execCommand listeners this is required to avoid errors if the editor was removed inside another command\r\n\t\t\tt.onExecCommand.listeners = [];\r\n\r\n\t\t\ttinymce.remove(t);\r\n\t\t\tDOM.remove(e);\r\n\t\t},\r\n\r\n\t\tdestroy : function(s) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\t// One time is enough\r\n\t\t\tif (t.destroyed)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!s) {\r\n\t\t\t\ttinymce.removeUnload(t.destroy);\r\n\t\t\t\ttinyMCE.onBeforeUnload.remove(t._beforeUnload);\r\n\r\n\t\t\t\t// Manual destroy\r\n\t\t\t\tif (t.theme && t.theme.destroy)\r\n\t\t\t\t\tt.theme.destroy();\r\n\r\n\t\t\t\t// Destroy controls, selection and dom\r\n\t\t\t\tt.controlManager.destroy();\r\n\t\t\t\tt.selection.destroy();\r\n\t\t\t\tt.dom.destroy();\r\n\r\n\t\t\t\t// Remove all events\r\n\r\n\t\t\t\t// Don't clear the window or document if content editable\r\n\t\t\t\t// is enabled since other instances might still be present\r\n\t\t\t\tif (!t.settings.content_editable) {\r\n\t\t\t\t\tEvent.clear(t.getWin());\r\n\t\t\t\t\tEvent.clear(t.getDoc());\r\n\t\t\t\t}\r\n\r\n\t\t\t\tEvent.clear(t.getBody());\r\n\t\t\t\tEvent.clear(t.formElement);\r\n\t\t\t}\r\n\r\n\t\t\tif (t.formElement) {\r\n\t\t\t\tt.formElement.submit = t.formElement._mceOldSubmit;\r\n\t\t\t\tt.formElement._mceOldSubmit = null;\r\n\t\t\t}\r\n\r\n\t\t\tt.contentAreaContainer = t.formElement = t.container = t.settings.content_element = t.bodyElement = t.contentDocument = t.contentWindow = null;\r\n\r\n\t\t\tif (t.selection)\r\n\t\t\t\tt.selection = t.selection.win = t.selection.dom = t.selection.dom.doc = null;\r\n\r\n\t\t\tt.destroyed = 1;\r\n\t\t},\r\n\r\n\t\t// Internal functions\r\n\r\n\t\t_addEvents : function() {\r\n\t\t\t// 'focus', 'blur', 'dblclick', 'beforedeactivate', submit, reset\r\n\t\t\tvar t = this, i, s = t.settings, dom = t.dom, lo = {\r\n\t\t\t\tmouseup : 'onMouseUp',\r\n\t\t\t\tmousedown : 'onMouseDown',\r\n\t\t\t\tclick : 'onClick',\r\n\t\t\t\tkeyup : 'onKeyUp',\r\n\t\t\t\tkeydown : 'onKeyDown',\r\n\t\t\t\tkeypress : 'onKeyPress',\r\n\t\t\t\tsubmit : 'onSubmit',\r\n\t\t\t\treset : 'onReset',\r\n\t\t\t\tcontextmenu : 'onContextMenu',\r\n\t\t\t\tdblclick : 'onDblClick',\r\n\t\t\t\tpaste : 'onPaste' // Doesn't work in all browsers yet\r\n\t\t\t};\r\n\r\n\t\t\tfunction eventHandler(e, o) {\r\n\t\t\t\tvar ty = e.type;\r\n\r\n\t\t\t\t// Don't fire events when it's removed\r\n\t\t\t\tif (t.removed)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t// Generic event handler\r\n\t\t\t\tif (t.onEvent.dispatch(t, e, o) !== false) {\r\n\t\t\t\t\t// Specific event handler\r\n\t\t\t\t\tt[lo[e.fakeType || e.type]].dispatch(t, e, o);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// Add DOM events\r\n\t\t\teach(lo, function(v, k) {\r\n\t\t\t\tswitch (k) {\r\n\t\t\t\t\tcase 'contextmenu':\r\n\t\t\t\t\t\tdom.bind(t.getDoc(), k, eventHandler);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'paste':\r\n\t\t\t\t\t\tdom.bind(t.getBody(), k, function(e) {\r\n\t\t\t\t\t\t\teventHandler(e);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'submit':\r\n\t\t\t\t\tcase 'reset':\r\n\t\t\t\t\t\tdom.bind(t.getElement().form || DOM.getParent(t.id, 'form'), k, eventHandler);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tdom.bind(s.content_editable ? t.getBody() : t.getDoc(), k, eventHandler);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tdom.bind(s.content_editable ? t.getBody() : (isGecko ? t.getDoc() : t.getWin()), 'focus', function(e) {\r\n\t\t\t\tt.focus(true);\r\n\t\t\t});\r\n\r\n\r\n\t\t\t// Fixes bug where a specified document_base_uri could result in broken images\r\n\t\t\t// This will also fix drag drop of images in Gecko\r\n\t\t\tif (tinymce.isGecko) {\r\n\t\t\t\tdom.bind(t.getDoc(), 'DOMNodeInserted', function(e) {\r\n\t\t\t\t\tvar v;\r\n\r\n\t\t\t\t\te = e.target;\r\n\r\n\t\t\t\t\tif (e.nodeType === 1 && e.nodeName === 'IMG' && (v = e.getAttribute('data-mce-src')))\r\n\t\t\t\t\t\te.src = t.documentBaseURI.toAbsolute(v);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Set various midas options in Gecko\r\n\t\t\tif (isGecko) {\r\n\t\t\t\tfunction setOpts() {\r\n\t\t\t\t\tvar t = this, d = t.getDoc(), s = t.settings;\r\n\r\n\t\t\t\t\tif (isGecko && !s.readonly) {\r\n\t\t\t\t\t\tt._refreshContentEditable();\r\n\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t// Try new Gecko method\r\n\t\t\t\t\t\t\td.execCommand(\"styleWithCSS\", 0, false);\r\n\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\t// Use old method\r\n\t\t\t\t\t\t\tif (!t._isHidden())\r\n\t\t\t\t\t\t\t\ttry {d.execCommand(\"useCSS\", 0, true);} catch (ex) {}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!s.table_inline_editing)\r\n\t\t\t\t\t\t\ttry {d.execCommand('enableInlineTableEditing', false, false);} catch (ex) {}\r\n\r\n\t\t\t\t\t\tif (!s.object_resizing)\r\n\t\t\t\t\t\t\ttry {d.execCommand('enableObjectResizing', false, false);} catch (ex) {}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tt.onBeforeExecCommand.add(setOpts);\r\n\t\t\t\tt.onMouseDown.add(setOpts);\r\n\t\t\t}\r\n\r\n\t\t\t// Add node change handlers\r\n\t\t\tt.onMouseUp.add(t.nodeChanged);\r\n\t\t\t//t.onClick.add(t.nodeChanged);\r\n\t\t\tt.onKeyUp.add(function(ed, e) {\r\n\t\t\t\tvar c = e.keyCode;\r\n\r\n\t\t\t\tif ((c >= 33 && c <= 36) || (c >= 37 && c <= 40) || c == 13 || c == 45 || c == 46 || c == 8 || (tinymce.isMac && (c == 91 || c == 93)) || e.ctrlKey)\r\n\t\t\t\t\tt.nodeChanged();\r\n\t\t\t});\r\n\r\n\r\n\t\t\t// Add block quote deletion handler\r\n\t\t\tt.onKeyDown.add(function(ed, e) {\r\n\t\t\t\t// Was the BACKSPACE key pressed?\r\n\t\t\t\tif (e.keyCode != 8)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tvar n = ed.selection.getRng().startContainer;\r\n\t\t\t\tvar offset = ed.selection.getRng().startOffset;\r\n\r\n\t\t\t\twhile (n && n.nodeType && n.nodeType != 1 && n.parentNode)\r\n\t\t\t\t\tn = n.parentNode;\r\n\t\t\t\t\t\r\n\t\t\t\t// Is the cursor at the beginning of a blockquote?\r\n\t\t\t\tif (n && n.parentNode && n.parentNode.tagName === 'BLOCKQUOTE' && n.parentNode.firstChild == n && offset == 0) {\r\n\t\t\t\t\t// Remove the blockquote\r\n\t\t\t\t\ted.formatter.toggle('blockquote', null, n.parentNode);\r\n\r\n\t\t\t\t\t// Move the caret to the beginning of n\r\n\t\t\t\t\tvar rng = ed.selection.getRng();\r\n\t\t\t\t\trng.setStart(n, 0);\r\n\t\t\t\t\trng.setEnd(n, 0);\r\n\t\t\t\t\ted.selection.setRng(rng);\r\n\t\t\t\t\ted.selection.collapse(false);\r\n\t\t\t\t}\r\n\t\t\t});\r\n \r\n\r\n\r\n\t\t\t// Add reset handler\r\n\t\t\tt.onReset.add(function() {\r\n\t\t\t\tt.setContent(t.startContent, {format : 'raw'});\r\n\t\t\t});\r\n\r\n\t\t\t// Add shortcuts\r\n\t\t\tif (s.custom_shortcuts) {\r\n\t\t\t\tif (s.custom_undo_redo_keyboard_shortcuts) {\r\n\t\t\t\t\tt.addShortcut('ctrl+z', t.getLang('undo_desc'), 'Undo');\r\n\t\t\t\t\tt.addShortcut('ctrl+y', t.getLang('redo_desc'), 'Redo');\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Add default shortcuts for gecko\r\n\t\t\t\tt.addShortcut('ctrl+b', t.getLang('bold_desc'), 'Bold');\r\n\t\t\t\tt.addShortcut('ctrl+i', t.getLang('italic_desc'), 'Italic');\r\n\t\t\t\tt.addShortcut('ctrl+u', t.getLang('underline_desc'), 'Underline');\r\n\r\n\t\t\t\t// BlockFormat shortcuts keys\r\n\t\t\t\tfor (i=1; i<=6; i++)\r\n\t\t\t\t\tt.addShortcut('ctrl+' + i, '', ['FormatBlock', false, 'h' + i]);\r\n\r\n\t\t\t\tt.addShortcut('ctrl+7', '', ['FormatBlock', false, 'p']);\r\n\t\t\t\tt.addShortcut('ctrl+8', '', ['FormatBlock', false, 'div']);\r\n\t\t\t\tt.addShortcut('ctrl+9', '', ['FormatBlock', false, 'address']);\r\n\r\n\t\t\t\tfunction find(e) {\r\n\t\t\t\t\tvar v = null;\r\n\r\n\t\t\t\t\tif (!e.altKey && !e.ctrlKey && !e.metaKey)\r\n\t\t\t\t\t\treturn v;\r\n\r\n\t\t\t\t\teach(t.shortcuts, function(o) {\r\n\t\t\t\t\t\tif (tinymce.isMac && o.ctrl != e.metaKey)\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\telse if (!tinymce.isMac && o.ctrl != e.ctrlKey)\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tif (o.alt != e.altKey)\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tif (o.shift != e.shiftKey)\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tif (e.keyCode == o.keyCode || (e.charCode && e.charCode == o.charCode)) {\r\n\t\t\t\t\t\t\tv = o;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn v;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tt.onKeyUp.add(function(ed, e) {\r\n\t\t\t\t\tvar o = find(e);\r\n\r\n\t\t\t\t\tif (o)\r\n\t\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onKeyPress.add(function(ed, e) {\r\n\t\t\t\t\tvar o = find(e);\r\n\r\n\t\t\t\t\tif (o)\r\n\t\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onKeyDown.add(function(ed, e) {\r\n\t\t\t\t\tvar o = find(e);\r\n\r\n\t\t\t\t\tif (o) {\r\n\t\t\t\t\t\to.func.call(o.scope);\r\n\t\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (tinymce.isIE) {\r\n\t\t\t\t// Fix so resize will only update the width and height attributes not the styles of an image\r\n\t\t\t\t// It will also block mceItemNoResize items\r\n\t\t\t\tdom.bind(t.getDoc(), 'controlselect', function(e) {\r\n\t\t\t\t\tvar re = t.resizeInfo, cb;\r\n\r\n\t\t\t\t\te = e.target;\r\n\r\n\t\t\t\t\t// Don't do this action for non image elements\r\n\t\t\t\t\tif (e.nodeName !== 'IMG')\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tif (re)\r\n\t\t\t\t\t\tdom.unbind(re.node, re.ev, re.cb);\r\n\r\n\t\t\t\t\tif (!dom.hasClass(e, 'mceItemNoResize')) {\r\n\t\t\t\t\t\tev = 'resizeend';\r\n\t\t\t\t\t\tcb = dom.bind(e, ev, function(e) {\r\n\t\t\t\t\t\t\tvar v;\r\n\r\n\t\t\t\t\t\t\te = e.target;\r\n\r\n\t\t\t\t\t\t\tif (v = dom.getStyle(e, 'width')) {\r\n\t\t\t\t\t\t\t\tdom.setAttrib(e, 'width', v.replace(/[^0-9%]+/g, ''));\r\n\t\t\t\t\t\t\t\tdom.setStyle(e, 'width', '');\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (v = dom.getStyle(e, 'height')) {\r\n\t\t\t\t\t\t\t\tdom.setAttrib(e, 'height', v.replace(/[^0-9%]+/g, ''));\r\n\t\t\t\t\t\t\t\tdom.setStyle(e, 'height', '');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tev = 'resizestart';\r\n\t\t\t\t\t\tcb = dom.bind(e, 'resizestart', Event.cancel, Event);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tre = t.resizeInfo = {\r\n\t\t\t\t\t\tnode : e,\r\n\t\t\t\t\t\tev : ev,\r\n\t\t\t\t\t\tcb : cb\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (tinymce.isOpera) {\r\n\t\t\t\tt.onClick.add(function(ed, e) {\r\n\t\t\t\t\tEvent.prevent(e);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Add custom undo/redo handlers\r\n\t\t\tif (s.custom_undo_redo) {\r\n\t\t\t\tfunction addUndo() {\r\n\t\t\t\t\tt.undoManager.typing = false;\r\n\t\t\t\t\tt.undoManager.add();\r\n\t\t\t\t};\r\n\r\n\t\t\t\tdom.bind(t.getDoc(), 'focusout', function(e) {\r\n\t\t\t\t\tif (!t.removed && t.undoManager.typing)\r\n\t\t\t\t\t\taddUndo();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Add undo level when contents is drag/dropped within the editor\r\n\t\t\t\tt.dom.bind(t.dom.getRoot(), 'dragend', function(e) {\r\n\t\t\t\t\taddUndo();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onKeyUp.add(function(ed, e) {\r\n\t\t\t\t\tvar keyCode = e.keyCode;\r\n\r\n\t\t\t\t\tif ((keyCode >= 33 && keyCode <= 36) || (keyCode >= 37 && keyCode <= 40) || keyCode == 13 || keyCode == 45 || e.ctrlKey)\r\n\t\t\t\t\t\taddUndo();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onKeyDown.add(function(ed, e) {\r\n\t\t\t\t\tvar keyCode = e.keyCode, sel;\r\n\r\n\t\t\t\t\tif (keyCode == 8) {\r\n\t\t\t\t\t\tsel = t.getDoc().selection;\r\n\r\n\t\t\t\t\t\t// Fix IE control + backspace browser bug\r\n\t\t\t\t\t\tif (sel && sel.createRange && sel.createRange().item) {\r\n\t\t\t\t\t\t\tt.undoManager.beforeChange();\r\n\t\t\t\t\t\t\ted.dom.remove(sel.createRange().item(0));\r\n\t\t\t\t\t\t\taddUndo();\r\n\r\n\t\t\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Is caracter positon keys left,right,up,down,home,end,pgdown,pgup,enter\r\n\t\t\t\t\tif ((keyCode >= 33 && keyCode <= 36) || (keyCode >= 37 && keyCode <= 40) || keyCode == 13 || keyCode == 45) {\r\n\t\t\t\t\t\t// Add position before enter key is pressed, used by IE since it still uses the default browser behavior\r\n\t\t\t\t\t\t// Todo: Remove this once we normalize enter behavior on IE\r\n\t\t\t\t\t\tif (tinymce.isIE && keyCode == 13)\r\n\t\t\t\t\t\t\tt.undoManager.beforeChange();\r\n\r\n\t\t\t\t\t\tif (t.undoManager.typing)\r\n\t\t\t\t\t\t\taddUndo();\r\n\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// If key isn't shift,ctrl,alt,capslock,metakey\r\n\t\t\t\t\tif ((keyCode < 16 || keyCode > 20) && keyCode != 224 && keyCode != 91 && !t.undoManager.typing) {\r\n\t\t\t\t\t\tt.undoManager.beforeChange();\r\n\t\t\t\t\t\tt.undoManager.typing = true;\r\n\t\t\t\t\t\tt.undoManager.add();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.onMouseDown.add(function() {\r\n\t\t\t\t\tif (t.undoManager.typing)\r\n\t\t\t\t\t\taddUndo();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Bug fix for FireFox keeping styles from end of selection instead of start.\r\n\t\t\tif (tinymce.isGecko) {\r\n\t\t\t\tfunction getAttributeApplyFunction() {\r\n\t\t\t\t\tvar template = t.dom.getAttribs(t.selection.getStart().cloneNode(false));\r\n\r\n\t\t\t\t\treturn function() {\r\n\t\t\t\t\t\tvar target = t.selection.getStart();\r\n\r\n\t\t\t\t\t\tif (target !== t.getBody()) {\r\n\t\t\t\t\t\t\tt.dom.setAttrib(target, \"style\", null);\r\n\r\n\t\t\t\t\t\t\teach(template, function(attr) {\r\n\t\t\t\t\t\t\t\ttarget.setAttributeNode(attr.cloneNode(true));\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction isSelectionAcrossElements() {\r\n\t\t\t\t\tvar s = t.selection;\r\n\r\n\t\t\t\t\treturn !s.isCollapsed() && s.getStart() != s.getEnd();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt.onKeyPress.add(function(ed, e) {\r\n\t\t\t\t\tvar applyAttributes;\r\n\r\n\t\t\t\t\tif ((e.keyCode == 8 || e.keyCode == 46) && isSelectionAcrossElements()) {\r\n\t\t\t\t\t\tapplyAttributes = getAttributeApplyFunction();\r\n\t\t\t\t\t\tt.getDoc().execCommand('delete', false, null);\r\n\t\t\t\t\t\tapplyAttributes();\r\n\r\n\t\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tt.dom.bind(t.getDoc(), 'cut', function(e) {\r\n\t\t\t\t\tvar applyAttributes;\r\n\r\n\t\t\t\t\tif (isSelectionAcrossElements()) {\r\n\t\t\t\t\t\tapplyAttributes = getAttributeApplyFunction();\r\n\t\t\t\t\t\tt.onKeyUp.addToTop(Event.cancel, Event);\r\n\r\n\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\tapplyAttributes();\r\n\t\t\t\t\t\t\tt.onKeyUp.remove(Event.cancel, Event);\r\n\t\t\t\t\t\t}, 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_refreshContentEditable : function() {\r\n\t\t\tvar self = this, body, parent;\r\n\r\n\t\t\t// Check if the editor was hidden and the re-initalize contentEditable mode by removing and adding the body again\r\n\t\t\tif (self._isHidden()) {\r\n\t\t\t\tbody = self.getBody();\r\n\t\t\t\tparent = body.parentNode;\r\n\r\n\t\t\t\tparent.removeChild(body);\r\n\t\t\t\tparent.appendChild(body);\r\n\r\n\t\t\t\tbody.focus();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_isHidden : function() {\r\n\t\t\tvar s;\r\n\r\n\t\t\tif (!isGecko)\r\n\t\t\t\treturn 0;\r\n\r\n\t\t\t// Weird, wheres that cursor selection?\r\n\t\t\ts = this.selection.getSel();\r\n\t\t\treturn (!s || !s.rangeCount || s.rangeCount == 0);\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\t// Added for compression purposes\r\n\tvar each = tinymce.each, undefined, TRUE = true, FALSE = false;\r\n\r\n\ttinymce.EditorCommands = function(editor) {\r\n\t\tvar dom = editor.dom,\r\n\t\t\tselection = editor.selection,\r\n\t\t\tcommands = {state: {}, exec : {}, value : {}},\r\n\t\t\tsettings = editor.settings,\r\n\t\t\tformatter = editor.formatter,\r\n\t\t\tbookmark;\r\n\r\n\t\tfunction execCommand(command, ui, value) {\r\n\t\t\tvar func;\r\n\r\n\t\t\tcommand = command.toLowerCase();\r\n\t\t\tif (func = commands.exec[command]) {\r\n\t\t\t\tfunc(command, ui, value);\r\n\t\t\t\treturn TRUE;\r\n\t\t\t}\r\n\r\n\t\t\treturn FALSE;\r\n\t\t};\r\n\r\n\t\tfunction queryCommandState(command) {\r\n\t\t\tvar func;\r\n\r\n\t\t\tcommand = command.toLowerCase();\r\n\t\t\tif (func = commands.state[command])\r\n\t\t\t\treturn func(command);\r\n\r\n\t\t\treturn -1;\r\n\t\t};\r\n\r\n\t\tfunction queryCommandValue(command) {\r\n\t\t\tvar func;\r\n\r\n\t\t\tcommand = command.toLowerCase();\r\n\t\t\tif (func = commands.value[command])\r\n\t\t\t\treturn func(command);\r\n\r\n\t\t\treturn FALSE;\r\n\t\t};\r\n\r\n\t\tfunction addCommands(command_list, type) {\r\n\t\t\ttype = type || 'exec';\r\n\r\n\t\t\teach(command_list, function(callback, command) {\r\n\t\t\t\teach(command.toLowerCase().split(','), function(command) {\r\n\t\t\t\t\tcommands[type][command] = callback;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Expose public methods\r\n\t\ttinymce.extend(this, {\r\n\t\t\texecCommand : execCommand,\r\n\t\t\tqueryCommandState : queryCommandState,\r\n\t\t\tqueryCommandValue : queryCommandValue,\r\n\t\t\taddCommands : addCommands\r\n\t\t});\r\n\r\n\t\t// Private methods\r\n\r\n\t\tfunction execNativeCommand(command, ui, value) {\r\n\t\t\tif (ui === undefined)\r\n\t\t\t\tui = FALSE;\r\n\r\n\t\t\tif (value === undefined)\r\n\t\t\t\tvalue = null;\r\n\r\n\t\t\treturn editor.getDoc().execCommand(command, ui, value);\r\n\t\t};\r\n\r\n\t\tfunction isFormatMatch(name) {\r\n\t\t\treturn formatter.match(name);\r\n\t\t};\r\n\r\n\t\tfunction toggleFormat(name, value) {\r\n\t\t\tformatter.toggle(name, value ? {value : value} : undefined);\r\n\t\t};\r\n\r\n\t\tfunction storeSelection(type) {\r\n\t\t\tbookmark = selection.getBookmark(type);\r\n\t\t};\r\n\r\n\t\tfunction restoreSelection() {\r\n\t\t\tselection.moveToBookmark(bookmark);\r\n\t\t};\r\n\r\n\t\t// Add execCommand overrides\r\n\t\taddCommands({\r\n\t\t\t// Ignore these, added for compatibility\r\n\t\t\t'mceResetDesignMode,mceBeginUndoLevel' : function() {},\r\n\r\n\t\t\t// Add undo manager logic\r\n\t\t\t'mceEndUndoLevel,mceAddUndoLevel' : function() {\r\n\t\t\t\teditor.undoManager.add();\r\n\t\t\t},\r\n\r\n\t\t\t'Cut,Copy,Paste' : function(command) {\r\n\t\t\t\tvar doc = editor.getDoc(), failed;\r\n\r\n\t\t\t\t// Try executing the native command\r\n\t\t\t\ttry {\r\n\t\t\t\t\texecNativeCommand(command);\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Command failed\r\n\t\t\t\t\tfailed = TRUE;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Present alert message about clipboard access not being available\r\n\t\t\t\tif (failed || !doc.queryCommandSupported(command)) {\r\n\t\t\t\t\tif (tinymce.isGecko) {\r\n\t\t\t\t\t\teditor.windowManager.confirm(editor.getLang('clipboard_msg'), function(state) {\r\n\t\t\t\t\t\t\tif (state)\r\n\t\t\t\t\t\t\t\topen('http://www.mozilla.org/editor/midasdemo/securityprefs.html', '_blank');\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\teditor.windowManager.alert(editor.getLang('clipboard_no_support'));\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// Override unlink command\r\n\t\t\tunlink : function(command) {\r\n\t\t\t\tif (selection.isCollapsed())\r\n\t\t\t\t\tselection.select(selection.getNode());\r\n\r\n\t\t\t\texecNativeCommand(command);\r\n\t\t\t\tselection.collapse(FALSE);\r\n\t\t\t},\r\n\r\n\t\t\t// Override justify commands to use the text formatter engine\r\n\t\t\t'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull' : function(command) {\r\n\t\t\t\tvar align = command.substring(7);\r\n\r\n\t\t\t\t// Remove all other alignments first\r\n\t\t\t\teach('left,center,right,full'.split(','), function(name) {\r\n\t\t\t\t\tif (align != name)\r\n\t\t\t\t\t\tformatter.remove('align' + name);\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttoggleFormat('align' + align);\r\n\t\t\t\texecCommand('mceRepaint');\r\n\t\t\t},\r\n\r\n\t\t\t// Override list commands to fix WebKit bug\r\n\t\t\t'InsertUnorderedList,InsertOrderedList' : function(command) {\r\n\t\t\t\tvar listElm, listParent;\r\n\r\n\t\t\t\texecNativeCommand(command);\r\n\r\n\t\t\t\t// WebKit produces lists within block elements so we need to split them\r\n\t\t\t\t// we will replace the native list creation logic to custom logic later on\r\n\t\t\t\t// TODO: Remove this when the list creation logic is removed\r\n\t\t\t\tlistElm = dom.getParent(selection.getNode(), 'ol,ul');\r\n\t\t\t\tif (listElm) {\r\n\t\t\t\t\tlistParent = listElm.parentNode;\r\n\r\n\t\t\t\t\t// If list is within a text block then split that block\r\n\t\t\t\t\tif (/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)) {\r\n\t\t\t\t\t\tstoreSelection();\r\n\t\t\t\t\t\tdom.split(listParent, listElm);\r\n\t\t\t\t\t\trestoreSelection();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// Override commands to use the text formatter engine\r\n\t\t\t'Bold,Italic,Underline,Strikethrough,Superscript,Subscript' : function(command) {\r\n\t\t\t\ttoggleFormat(command);\r\n\t\t\t},\r\n\r\n\t\t\t// Override commands to use the text formatter engine\r\n\t\t\t'ForeColor,HiliteColor,FontName' : function(command, ui, value) {\r\n\t\t\t\ttoggleFormat(command, value);\r\n\t\t\t},\r\n\r\n\t\t\tFontSize : function(command, ui, value) {\r\n\t\t\t\tvar fontClasses, fontSizes;\r\n\r\n\t\t\t\t// Convert font size 1-7 to styles\r\n\t\t\t\tif (value >= 1 && value <= 7) {\r\n\t\t\t\t\tfontSizes = tinymce.explode(settings.font_size_style_values);\r\n\t\t\t\t\tfontClasses = tinymce.explode(settings.font_size_classes);\r\n\r\n\t\t\t\t\tif (fontClasses)\r\n\t\t\t\t\t\tvalue = fontClasses[value - 1] || value;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tvalue = fontSizes[value - 1] || value;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttoggleFormat(command, value);\r\n\t\t\t},\r\n\r\n\t\t\tRemoveFormat : function(command) {\r\n\t\t\t\tformatter.remove(command);\r\n\t\t\t},\r\n\r\n\t\t\tmceBlockQuote : function(command) {\r\n\t\t\t\ttoggleFormat('blockquote');\r\n\t\t\t},\r\n\r\n\t\t\tFormatBlock : function(command, ui, value) {\r\n\t\t\t\treturn toggleFormat(value || 'p');\r\n\t\t\t},\r\n\r\n\t\t\tmceCleanup : function() {\r\n\t\t\t\tvar bookmark = selection.getBookmark();\r\n\r\n\t\t\t\teditor.setContent(editor.getContent({cleanup : TRUE}), {cleanup : TRUE});\r\n\r\n\t\t\t\tselection.moveToBookmark(bookmark);\r\n\t\t\t},\r\n\r\n\t\t\tmceRemoveNode : function(command, ui, value) {\r\n\t\t\t\tvar node = value || selection.getNode();\r\n\r\n\t\t\t\t// Make sure that the body node isn't removed\r\n\t\t\t\tif (node != editor.getBody()) {\r\n\t\t\t\t\tstoreSelection();\r\n\t\t\t\t\teditor.dom.remove(node, TRUE);\r\n\t\t\t\t\trestoreSelection();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tmceSelectNodeDepth : function(command, ui, value) {\r\n\t\t\t\tvar counter = 0;\r\n\r\n\t\t\t\tdom.getParent(selection.getNode(), function(node) {\r\n\t\t\t\t\tif (node.nodeType == 1 && counter++ == value) {\r\n\t\t\t\t\t\tselection.select(node);\r\n\t\t\t\t\t\treturn FALSE;\r\n\t\t\t\t\t}\r\n\t\t\t\t}, editor.getBody());\r\n\t\t\t},\r\n\r\n\t\t\tmceSelectNode : function(command, ui, value) {\r\n\t\t\t\tselection.select(value);\r\n\t\t\t},\r\n\r\n\t\t\tmceInsertContent : function(command, ui, value) {\r\n\t\t\t\tvar parser, serializer, parentNode, rootNode, fragment, args,\r\n\t\t\t\t\tmarker, nodeRect, viewPortRect, rng, node, node2, bookmarkHtml, viewportBodyElement;\r\n\r\n\t\t\t\t// Setup parser and serializer\r\n\t\t\t\tparser = editor.parser;\r\n\t\t\t\tserializer = new tinymce.html.Serializer({}, editor.schema);\r\n\t\t\t\tbookmarkHtml = '<span id=\"mce_marker\" data-mce-type=\"bookmark\">\\uFEFF</span>';\r\n\r\n\t\t\t\t// Run beforeSetContent handlers on the HTML to be inserted\r\n\t\t\t\targs = {content: value, format: 'html'};\r\n\t\t\t\tselection.onBeforeSetContent.dispatch(selection, args);\r\n\t\t\t\tvalue = args.content;\r\n\r\n\t\t\t\t// Add caret at end of contents if it's missing\r\n\t\t\t\tif (value.indexOf('{$caret}') == -1)\r\n\t\t\t\t\tvalue += '{$caret}';\r\n\r\n\t\t\t\t// Replace the caret marker with a span bookmark element\r\n\t\t\t\tvalue = value.replace(/\\{\\$caret\\}/, bookmarkHtml);\r\n\r\n\t\t\t\t// Insert node maker where we will insert the new HTML and get it's parent\r\n\t\t\t\tif (!selection.isCollapsed())\r\n\t\t\t\t\teditor.getDoc().execCommand('Delete', false, null);\r\n\r\n\t\t\t\tparentNode = selection.getNode();\r\n\r\n\t\t\t\t// Parse the fragment within the context of the parent node\r\n\t\t\t\targs = {context : parentNode.nodeName.toLowerCase()};\r\n\t\t\t\tfragment = parser.parse(value, args);\r\n\r\n\t\t\t\t// Move the caret to a more suitable location\r\n\t\t\t\tnode = fragment.lastChild;\r\n\t\t\t\tif (node.attr('id') == 'mce_marker') {\r\n\t\t\t\t\tmarker = node;\r\n\r\n\t\t\t\t\tfor (node = node.prev; node; node = node.walk(true)) {\r\n\t\t\t\t\t\tif (node.type == 3 || !dom.isBlock(node.name)) {\r\n\t\t\t\t\t\t\tnode.parent.insert(marker, node, node.name === 'br');\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If parser says valid we can insert the contents into that parent\r\n\t\t\t\tif (!args.invalid) {\r\n\t\t\t\t\tvalue = serializer.serialize(fragment);\r\n\r\n\t\t\t\t\t// Check if parent is empty or only has one BR element then set the innerHTML of that parent\r\n\t\t\t\t\tnode = parentNode.firstChild;\r\n\t\t\t\t\tnode2 = parentNode.lastChild;\r\n\t\t\t\t\tif (!node || (node === node2 && node.nodeName === 'BR'))\r\n\t\t\t\t\t\tdom.setHTML(parentNode, value);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tselection.setContent(value);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// If the fragment was invalid within that context then we need\r\n\t\t\t\t\t// to parse and process the parent it's inserted into\r\n\r\n\t\t\t\t\t// Insert bookmark node and get the parent\r\n\t\t\t\t\tselection.setContent(bookmarkHtml);\r\n\t\t\t\t\tparentNode = editor.selection.getNode();\r\n\t\t\t\t\trootNode = editor.getBody();\r\n\r\n\t\t\t\t\t// Opera will return the document node when selection is in root\r\n\t\t\t\t\tif (parentNode.nodeType == 9)\r\n\t\t\t\t\t\tparentNode = node = rootNode;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tnode = parentNode;\r\n\r\n\t\t\t\t\t// Find the ancestor just before the root element\r\n\t\t\t\t\twhile (node !== rootNode) {\r\n\t\t\t\t\t\tparentNode = node;\r\n\t\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Get the outer/inner HTML depending on if we are in the root and parser and serialize that\r\n\t\t\t\t\tvalue = parentNode == rootNode ? rootNode.innerHTML : dom.getOuterHTML(parentNode);\r\n\t\t\t\t\tvalue = serializer.serialize(\r\n\t\t\t\t\t\tparser.parse(\r\n\t\t\t\t\t\t\t// Need to replace by using a function since $ in the contents would otherwise be a problem\r\n\t\t\t\t\t\t\tvalue.replace(/<span (id=\"mce_marker\"|id=mce_marker).+?<\\/span>/i, function() {\r\n\t\t\t\t\t\t\t\treturn serializer.serialize(fragment);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t// Set the inner/outer HTML depending on if we are in the root or not\r\n\t\t\t\t\tif (parentNode == rootNode)\r\n\t\t\t\t\t\tdom.setHTML(rootNode, value);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tdom.setOuterHTML(parentNode, value);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmarker = dom.get('mce_marker');\r\n\r\n\t\t\t\t// Scroll range into view scrollIntoView on element can't be used since it will scroll the main view port as well\r\n\t\t\t\tnodeRect = dom.getRect(marker);\r\n\t\t\t\tviewPortRect = dom.getViewPort(editor.getWin());\r\n\r\n\t\t\t\t// Check if node is out side the viewport if it is then scroll to it\r\n\t\t\t\tif ((nodeRect.y + nodeRect.h > viewPortRect.y + viewPortRect.h || nodeRect.y < viewPortRect.y) ||\r\n\t\t\t\t\t(nodeRect.x > viewPortRect.x + viewPortRect.w || nodeRect.x < viewPortRect.x)) {\r\n\t\t\t\t\tviewportBodyElement = tinymce.isIE ? editor.getDoc().documentElement : editor.getBody();\r\n\t\t\t\t\tviewportBodyElement.scrollLeft = nodeRect.x;\r\n\t\t\t\t\tviewportBodyElement.scrollTop = nodeRect.y - viewPortRect.h + 25;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move selection before marker and remove it\r\n\t\t\t\trng = dom.createRng();\r\n\r\n\t\t\t\t// If previous sibling is a text node set the selection to the end of that node\r\n\t\t\t\tnode = marker.previousSibling;\r\n\t\t\t\tif (node && node.nodeType == 3) {\r\n\t\t\t\t\trng.setStart(node, node.nodeValue.length);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// If the previous sibling isn't a text node or doesn't exist set the selection before the marker node\r\n\t\t\t\t\trng.setStartBefore(marker);\r\n\t\t\t\t\trng.setEndBefore(marker);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove the marker node and set the new range\r\n\t\t\t\tdom.remove(marker);\r\n\t\t\t\tselection.setRng(rng);\r\n\r\n\t\t\t\t// Dispatch after event and add any visual elements needed\r\n\t\t\t\tselection.onSetContent.dispatch(selection, args);\r\n\t\t\t\teditor.addVisual();\r\n\t\t\t},\r\n\r\n\t\t\tmceInsertRawHTML : function(command, ui, value) {\r\n\t\t\t\tselection.setContent('tiny_mce_marker');\r\n\t\t\t\teditor.setContent(editor.getContent().replace(/tiny_mce_marker/g, function() { return value }));\r\n\t\t\t},\r\n\r\n\t\t\tmceSetContent : function(command, ui, value) {\r\n\t\t\t\teditor.setContent(value);\r\n\t\t\t},\r\n\r\n\t\t\t'Indent,Outdent' : function(command) {\r\n\t\t\t\tvar intentValue, indentUnit, value;\r\n\r\n\t\t\t\t// Setup indent level\r\n\t\t\t\tintentValue = settings.indentation;\r\n\t\t\t\tindentUnit = /[a-z%]+$/i.exec(intentValue);\r\n\t\t\t\tintentValue = parseInt(intentValue);\r\n\r\n\t\t\t\tif (!queryCommandState('InsertUnorderedList') && !queryCommandState('InsertOrderedList')) {\r\n\t\t\t\t\teach(selection.getSelectedBlocks(), function(element) {\r\n\t\t\t\t\t\tif (command == 'outdent') {\r\n\t\t\t\t\t\t\tvalue = Math.max(0, parseInt(element.style.paddingLeft || 0) - intentValue);\r\n\t\t\t\t\t\t\tdom.setStyle(element, 'paddingLeft', value ? value + indentUnit : '');\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tdom.setStyle(element, 'paddingLeft', (parseInt(element.style.paddingLeft || 0) + intentValue) + indentUnit);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else\r\n\t\t\t\t\texecNativeCommand(command);\r\n\t\t\t},\r\n\r\n\t\t\tmceRepaint : function() {\r\n\t\t\t\tvar bookmark;\r\n\r\n\t\t\t\tif (tinymce.isGecko) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tstoreSelection(TRUE);\r\n\r\n\t\t\t\t\t\tif (selection.getSel())\r\n\t\t\t\t\t\t\tselection.getSel().selectAllChildren(editor.getBody());\r\n\r\n\t\t\t\t\t\tselection.collapse(TRUE);\r\n\t\t\t\t\t\trestoreSelection();\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// Ignore\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tmceToggleFormat : function(command, ui, value) {\r\n\t\t\t\tformatter.toggle(value);\r\n\t\t\t},\r\n\r\n\t\t\tInsertHorizontalRule : function() {\r\n\t\t\t\teditor.execCommand('mceInsertContent', false, '<hr />');\r\n\t\t\t},\r\n\r\n\t\t\tmceToggleVisualAid : function() {\r\n\t\t\t\teditor.hasVisual = !editor.hasVisual;\r\n\t\t\t\teditor.addVisual();\r\n\t\t\t},\r\n\r\n\t\t\tmceReplaceContent : function(command, ui, value) {\r\n\t\t\t\teditor.execCommand('mceInsertContent', false, value.replace(/\\{\\$selection\\}/g, selection.getContent({format : 'text'})));\r\n\t\t\t},\r\n\r\n\t\t\tmceInsertLink : function(command, ui, value) {\r\n\t\t\t\tvar anchor;\r\n\r\n\t\t\t\tif (typeof(value) == 'string')\r\n\t\t\t\t\tvalue = {href : value};\r\n\r\n\t\t\t\tanchor = dom.getParent(selection.getNode(), 'a');\r\n\r\n\t\t\t\t// Spaces are never valid in URLs and it's a very common mistake for people to make so we fix it here.\r\n\t\t\t\tvalue.href = value.href.replace(' ', '%20');\r\n\r\n\t\t\t\t// Remove existing links if there could be child links or that the href isn't specified\r\n\t\t\t\tif (!anchor || !value.href) {\r\n\t\t\t\t\tformatter.remove('link');\r\n\t\t\t\t}\t\t\r\n\r\n\t\t\t\t// Apply new link to selection\r\n\t\t\t\tif (value.href) {\r\n\t\t\t\t\tformatter.apply('link', value, anchor);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tselectAll : function() {\r\n\t\t\t\tvar root = dom.getRoot(), rng = dom.createRng();\r\n\r\n\t\t\t\trng.setStart(root, 0);\r\n\t\t\t\trng.setEnd(root, root.childNodes.length);\r\n\r\n\t\t\t\teditor.selection.setRng(rng);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Add queryCommandState overrides\r\n\t\taddCommands({\r\n\t\t\t// Override justify commands\r\n\t\t\t'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull' : function(command) {\r\n\t\t\t\treturn isFormatMatch('align' + command.substring(7));\r\n\t\t\t},\r\n\r\n\t\t\t'Bold,Italic,Underline,Strikethrough,Superscript,Subscript' : function(command) {\r\n\t\t\t\treturn isFormatMatch(command);\r\n\t\t\t},\r\n\r\n\t\t\tmceBlockQuote : function() {\r\n\t\t\t\treturn isFormatMatch('blockquote');\r\n\t\t\t},\r\n\r\n\t\t\tOutdent : function() {\r\n\t\t\t\tvar node;\r\n\r\n\t\t\t\tif (settings.inline_styles) {\r\n\t\t\t\t\tif ((node = dom.getParent(selection.getStart(), dom.isBlock)) && parseInt(node.style.paddingLeft) > 0)\r\n\t\t\t\t\t\treturn TRUE;\r\n\r\n\t\t\t\t\tif ((node = dom.getParent(selection.getEnd(), dom.isBlock)) && parseInt(node.style.paddingLeft) > 0)\r\n\t\t\t\t\t\treturn TRUE;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn queryCommandState('InsertUnorderedList') || queryCommandState('InsertOrderedList') || (!settings.inline_styles && !!dom.getParent(selection.getNode(), 'BLOCKQUOTE'));\r\n\t\t\t},\r\n\r\n\t\t\t'InsertUnorderedList,InsertOrderedList' : function(command) {\r\n\t\t\t\treturn dom.getParent(selection.getNode(), command == 'insertunorderedlist' ? 'UL' : 'OL');\r\n\t\t\t}\r\n\t\t}, 'state');\r\n\r\n\t\t// Add queryCommandValue overrides\r\n\t\taddCommands({\r\n\t\t\t'FontSize,FontName' : function(command) {\r\n\t\t\t\tvar value = 0, parent;\r\n\r\n\t\t\t\tif (parent = dom.getParent(selection.getNode(), 'span')) {\r\n\t\t\t\t\tif (command == 'fontsize')\r\n\t\t\t\t\t\tvalue = parent.style.fontSize;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tvalue = parent.style.fontFamily.replace(/, /g, ',').replace(/[\\'\\\"]/g, '').toLowerCase();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}, 'value');\r\n\r\n\t\t// Add undo manager logic\r\n\t\tif (settings.custom_undo_redo) {\r\n\t\t\taddCommands({\r\n\t\t\t\tUndo : function() {\r\n\t\t\t\t\teditor.undoManager.undo();\r\n\t\t\t\t},\r\n\r\n\t\t\t\tRedo : function() {\r\n\t\t\t\t\teditor.undoManager.redo();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar Dispatcher = tinymce.util.Dispatcher;\r\n\r\n\ttinymce.UndoManager = function(editor) {\r\n\t\tvar self, index = 0, data = [], beforeBookmark;\r\n\r\n\t\tfunction getContent() {\r\n\t\t\treturn tinymce.trim(editor.getContent({format : 'raw', no_events : 1}));\r\n\t\t};\r\n\r\n\t\treturn self = {\r\n\t\t\ttyping : false,\r\n\r\n\t\t\tonAdd : new Dispatcher(self),\r\n\r\n\t\t\tonUndo : new Dispatcher(self),\r\n\r\n\t\t\tonRedo : new Dispatcher(self),\r\n\r\n\t\t\tbeforeChange : function() {\r\n\t\t\t\tbeforeBookmark = editor.selection.getBookmark(2, true);\r\n\t\t\t},\r\n\r\n\t\t\tadd : function(level) {\r\n\t\t\t\tvar i, settings = editor.settings, lastLevel;\r\n\r\n\t\t\t\tlevel = level || {};\r\n\t\t\t\tlevel.content = getContent();\r\n\r\n\t\t\t\t// Add undo level if needed\r\n\t\t\t\tlastLevel = data[index];\r\n\t\t\t\tif (lastLevel && lastLevel.content == level.content)\r\n\t\t\t\t\treturn null;\r\n\r\n\t\t\t\t// Set before bookmark on previous level\r\n\t\t\t\tif (data[index])\r\n\t\t\t\t\tdata[index].beforeBookmark = beforeBookmark;\r\n\r\n\t\t\t\t// Time to compress\r\n\t\t\t\tif (settings.custom_undo_redo_levels) {\r\n\t\t\t\t\tif (data.length > settings.custom_undo_redo_levels) {\r\n\t\t\t\t\t\tfor (i = 0; i < data.length - 1; i++)\r\n\t\t\t\t\t\t\tdata[i] = data[i + 1];\r\n\r\n\t\t\t\t\t\tdata.length--;\r\n\t\t\t\t\t\tindex = data.length;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Get a non intrusive normalized bookmark\r\n\t\t\t\tlevel.bookmark = editor.selection.getBookmark(2, true);\r\n\r\n\t\t\t\t// Crop array if needed\r\n\t\t\t\tif (index < data.length - 1)\r\n\t\t\t\t\tdata.length = index + 1;\r\n\r\n\t\t\t\tdata.push(level);\r\n\t\t\t\tindex = data.length - 1;\r\n\r\n\t\t\t\tself.onAdd.dispatch(self, level);\r\n\t\t\t\teditor.isNotDirty = 0;\r\n\r\n\t\t\t\treturn level;\r\n\t\t\t},\r\n\r\n\t\t\tundo : function() {\r\n\t\t\t\tvar level, i;\r\n\r\n\t\t\t\tif (self.typing) {\r\n\t\t\t\t\tself.add();\r\n\t\t\t\t\tself.typing = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (index > 0) {\r\n\t\t\t\t\tlevel = data[--index];\r\n\r\n\t\t\t\t\teditor.setContent(level.content, {format : 'raw'});\r\n\t\t\t\t\teditor.selection.moveToBookmark(level.beforeBookmark);\r\n\r\n\t\t\t\t\tself.onUndo.dispatch(self, level);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn level;\r\n\t\t\t},\r\n\r\n\t\t\tredo : function() {\r\n\t\t\t\tvar level;\r\n\r\n\t\t\t\tif (index < data.length - 1) {\r\n\t\t\t\t\tlevel = data[++index];\r\n\r\n\t\t\t\t\teditor.setContent(level.content, {format : 'raw'});\r\n\t\t\t\t\teditor.selection.moveToBookmark(level.bookmark);\r\n\r\n\t\t\t\t\tself.onRedo.dispatch(self, level);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn level;\r\n\t\t\t},\r\n\r\n\t\t\tclear : function() {\r\n\t\t\t\tdata = [];\r\n\t\t\t\tindex = 0;\r\n\t\t\t\tself.typing = false;\r\n\t\t\t},\r\n\r\n\t\t\thasUndo : function() {\r\n\t\t\t\treturn index > 0 || this.typing;\r\n\t\t\t},\r\n\r\n\t\t\thasRedo : function() {\r\n\t\t\t\treturn index < data.length - 1 && !this.typing;\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\t// Shorten names\r\n\tvar Event = tinymce.dom.Event,\r\n\t\tisIE = tinymce.isIE,\r\n\t\tisGecko = tinymce.isGecko,\r\n\t\tisOpera = tinymce.isOpera,\r\n\t\teach = tinymce.each,\r\n\t\textend = tinymce.extend,\r\n\t\tTRUE = true,\r\n\t\tFALSE = false;\r\n\r\n\tfunction cloneFormats(node) {\r\n\t\tvar clone, temp, inner;\r\n\r\n\t\tdo {\r\n\t\t\tif (/^(SPAN|STRONG|B|EM|I|FONT|STRIKE|U)$/.test(node.nodeName)) {\r\n\t\t\t\tif (clone) {\r\n\t\t\t\t\ttemp = node.cloneNode(false);\r\n\t\t\t\t\ttemp.appendChild(clone);\r\n\t\t\t\t\tclone = temp;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tclone = inner = node.cloneNode(false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclone.removeAttribute('id');\r\n\t\t\t}\r\n\t\t} while (node = node.parentNode);\r\n\r\n\t\tif (clone)\r\n\t\t\treturn {wrapper : clone, inner : inner};\r\n\t};\r\n\r\n\t// Checks if the selection/caret is at the end of the specified block element\r\n\tfunction isAtEnd(rng, par) {\r\n\t\tvar rng2 = par.ownerDocument.createRange();\r\n\r\n\t\trng2.setStart(rng.endContainer, rng.endOffset);\r\n\t\trng2.setEndAfter(par);\r\n\r\n\t\t// Get number of characters to the right of the cursor if it's zero then we are at the end and need to merge the next block element\r\n\t\treturn rng2.cloneContents().textContent.length == 0;\r\n\t};\r\n\r\n\tfunction splitList(selection, dom, li) {\r\n\t\tvar listBlock, block;\r\n\r\n\t\tif (dom.isEmpty(li)) {\r\n\t\t\tlistBlock = dom.getParent(li, 'ul,ol');\r\n\r\n\t\t\tif (!dom.getParent(listBlock.parentNode, 'ul,ol')) {\r\n\t\t\t\tdom.split(listBlock, li);\r\n\t\t\t\tblock = dom.create('p', 0, '<br data-mce-bogus=\"1\" />');\r\n\t\t\t\tdom.replace(block, li);\r\n\t\t\t\tselection.select(block, 1);\r\n\t\t\t}\r\n\r\n\t\t\treturn FALSE;\r\n\t\t}\r\n\r\n\t\treturn TRUE;\r\n\t};\r\n\r\n\ttinymce.create('tinymce.ForceBlocks', {\r\n\t\tForceBlocks : function(ed) {\r\n\t\t\tvar t = this, s = ed.settings, elm;\r\n\r\n\t\t\tt.editor = ed;\r\n\t\t\tt.dom = ed.dom;\r\n\t\t\telm = (s.forced_root_block || 'p').toLowerCase();\r\n\t\t\ts.element = elm.toUpperCase();\r\n\r\n\t\t\ted.onPreInit.add(t.setup, t);\r\n\t\t},\r\n\r\n\t\tsetup : function() {\r\n\t\t\tvar t = this, ed = t.editor, s = ed.settings, dom = ed.dom, selection = ed.selection, blockElements = ed.schema.getBlockElements();\r\n\r\n\t\t\t// Force root blocks\r\n\t\t\tif (s.forced_root_block) {\r\n\t\t\t\tfunction addRootBlocks() {\r\n\t\t\t\t\tvar node = selection.getStart(), rootNode = ed.getBody(), rng, startContainer, startOffset, endContainer, endOffset, rootBlockNode, tempNode, offset = -0xFFFFFF;\r\n\r\n\t\t\t\t\tif (!node || node.nodeType !== 1)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t// Check if node is wrapped in block\r\n\t\t\t\t\twhile (node != rootNode) {\r\n\t\t\t\t\t\tif (blockElements[node.nodeName])\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Get current selection\r\n\t\t\t\t\trng = selection.getRng();\r\n\t\t\t\t\tif (rng.setStart) {\r\n\t\t\t\t\t\tstartContainer = rng.startContainer;\r\n\t\t\t\t\t\tstartOffset = rng.startOffset;\r\n\t\t\t\t\t\tendContainer = rng.endContainer;\r\n\t\t\t\t\t\tendOffset = rng.endOffset;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Force control range into text range\r\n\t\t\t\t\t\tif (rng.item) {\r\n\t\t\t\t\t\t\trng = ed.getDoc().body.createTextRange();\r\n\t\t\t\t\t\t\trng.moveToElementText(rng.item(0));\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttmpRng = rng.duplicate();\r\n\t\t\t\t\t\ttmpRng.collapse(true);\r\n\t\t\t\t\t\tstartOffset = tmpRng.move('character', offset) * -1;\r\n\r\n\t\t\t\t\t\tif (!tmpRng.collapsed) {\r\n\t\t\t\t\t\t\ttmpRng = rng.duplicate();\r\n\t\t\t\t\t\t\ttmpRng.collapse(false);\r\n\t\t\t\t\t\t\tendOffset = (tmpRng.move('character', offset) * -1) - startOffset;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Wrap non block elements and text nodes\r\n\t\t\t\t\tfor (node = rootNode.firstChild; node; node) {\r\n\t\t\t\t\t\tif (node.nodeType === 3 || (node.nodeType == 1 && !blockElements[node.nodeName])) {\r\n\t\t\t\t\t\t\tif (!rootBlockNode) {\r\n\t\t\t\t\t\t\t\trootBlockNode = dom.create(s.forced_root_block);\r\n\t\t\t\t\t\t\t\tnode.parentNode.insertBefore(rootBlockNode, node);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\ttempNode = node;\r\n\t\t\t\t\t\t\tnode = node.nextSibling;\r\n\t\t\t\t\t\t\trootBlockNode.appendChild(tempNode);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trootBlockNode = null;\r\n\t\t\t\t\t\t\tnode = node.nextSibling;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (rng.setStart) {\r\n\t\t\t\t\t\trng.setStart(startContainer, startOffset);\r\n\t\t\t\t\t\trng.setEnd(endContainer, endOffset);\r\n\t\t\t\t\t\tselection.setRng(rng);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\trng = ed.getDoc().body.createTextRange();\r\n\t\t\t\t\t\t\trng.moveToElementText(rootNode);\r\n\t\t\t\t\t\t\trng.collapse(true);\r\n\t\t\t\t\t\t\trng.moveStart('character', startOffset);\r\n\r\n\t\t\t\t\t\t\tif (endOffset > 0)\r\n\t\t\t\t\t\t\t\trng.moveEnd('character', endOffset);\r\n\r\n\t\t\t\t\t\t\trng.select();\r\n\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\t// Ignore\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ted.nodeChanged();\r\n\t\t\t\t};\r\n\r\n\t\t\t\ted.onKeyUp.add(addRootBlocks);\r\n\t\t\t\ted.onClick.add(addRootBlocks);\r\n\t\t\t}\r\n\r\n\t\t\tif (s.force_br_newlines) {\r\n\t\t\t\t// Force IE to produce BRs on enter\r\n\t\t\t\tif (isIE) {\r\n\t\t\t\t\ted.onKeyPress.add(function(ed, e) {\r\n\t\t\t\t\t\tvar n;\r\n\r\n\t\t\t\t\t\tif (e.keyCode == 13 && selection.getNode().nodeName != 'LI') {\r\n\t\t\t\t\t\t\tselection.setContent('<br id=\"__\" /> ', {format : 'raw'});\r\n\t\t\t\t\t\t\tn = dom.get('__');\r\n\t\t\t\t\t\t\tn.removeAttribute('id');\r\n\t\t\t\t\t\t\tselection.select(n);\r\n\t\t\t\t\t\t\tselection.collapse();\r\n\t\t\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (s.force_p_newlines) {\r\n\t\t\t\tif (!isIE) {\r\n\t\t\t\t\ted.onKeyPress.add(function(ed, e) {\r\n\t\t\t\t\t\tif (e.keyCode == 13 && !e.shiftKey && !t.insertPara(e))\r\n\t\t\t\t\t\t\tEvent.cancel(e);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Ungly hack to for IE to preserve the formatting when you press\r\n\t\t\t\t\t// enter at the end of a block element with formatted contents\r\n\t\t\t\t\t// This logic overrides the browsers default logic with\r\n\t\t\t\t\t// custom logic that enables us to control the output\r\n\t\t\t\t\ttinymce.addUnload(function() {\r\n\t\t\t\t\t\tt._previousFormats = 0; // Fix IE leak\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\ted.onKeyPress.add(function(ed, e) {\r\n\t\t\t\t\t\tt._previousFormats = 0;\r\n\r\n\t\t\t\t\t\t// Clone the current formats, this will later be applied to the new block contents\r\n\t\t\t\t\t\tif (e.keyCode == 13 && !e.shiftKey && ed.selection.isCollapsed() && s.keep_styles)\r\n\t\t\t\t\t\t\tt._previousFormats = cloneFormats(ed.selection.getStart());\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\ted.onKeyUp.add(function(ed, e) {\r\n\t\t\t\t\t\t// Let IE break the element and the wrap the new caret location in the previous formats\r\n\t\t\t\t\t\tif (e.keyCode == 13 && !e.shiftKey) {\r\n\t\t\t\t\t\t\tvar parent = ed.selection.getStart(), fmt = t._previousFormats;\r\n\r\n\t\t\t\t\t\t\t// Parent is an empty block\r\n\t\t\t\t\t\t\tif (!parent.hasChildNodes() && fmt) {\r\n\t\t\t\t\t\t\t\tparent = dom.getParent(parent, dom.isBlock);\r\n\r\n\t\t\t\t\t\t\t\tif (parent && parent.nodeName != 'LI') {\r\n\t\t\t\t\t\t\t\t\tparent.innerHTML = '';\r\n\r\n\t\t\t\t\t\t\t\t\tif (t._previousFormats) {\r\n\t\t\t\t\t\t\t\t\t\tparent.appendChild(fmt.wrapper);\r\n\t\t\t\t\t\t\t\t\t\tfmt.inner.innerHTML = '\\uFEFF';\r\n\t\t\t\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\t\t\t\tparent.innerHTML = '\\uFEFF';\r\n\r\n\t\t\t\t\t\t\t\t\tselection.select(parent, 1);\r\n\t\t\t\t\t\t\t\t\tselection.collapse(true);\r\n\t\t\t\t\t\t\t\t\ted.getDoc().execCommand('Delete', false, null);\r\n\t\t\t\t\t\t\t\t\tt._previousFormats = 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (isGecko) {\r\n\t\t\t\t\ted.onKeyDown.add(function(ed, e) {\r\n\t\t\t\t\t\tif ((e.keyCode == 8 || e.keyCode == 46) && !e.shiftKey)\r\n\t\t\t\t\t\t\tt.backspaceDelete(e, e.keyCode == 8);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Workaround for missing shift+enter support, http://bugs.webkit.org/show_bug.cgi?id=16973\r\n\t\t\tif (tinymce.isWebKit) {\r\n\t\t\t\tfunction insertBr(ed) {\r\n\t\t\t\t\tvar rng = selection.getRng(), br, div = dom.create('div', null, ' '), divYPos, vpHeight = dom.getViewPort(ed.getWin()).h;\r\n\r\n\t\t\t\t\t// Insert BR element\r\n\t\t\t\t\trng.insertNode(br = dom.create('br'));\r\n\r\n\t\t\t\t\t// Place caret after BR\r\n\t\t\t\t\trng.setStartAfter(br);\r\n\t\t\t\t\trng.setEndAfter(br);\r\n\t\t\t\t\tselection.setRng(rng);\r\n\r\n\t\t\t\t\t// Could not place caret after BR then insert an nbsp entity and move the caret\r\n\t\t\t\t\tif (selection.getSel().focusNode == br.previousSibling) {\r\n\t\t\t\t\t\tselection.select(dom.insertAfter(dom.doc.createTextNode('\\u00a0'), br));\r\n\t\t\t\t\t\tselection.collapse(TRUE);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Create a temporary DIV after the BR and get the position as it\r\n\t\t\t\t\t// seems like getPos() returns 0 for text nodes and BR elements.\r\n\t\t\t\t\tdom.insertAfter(div, br);\r\n\t\t\t\t\tdivYPos = dom.getPos(div).y;\r\n\t\t\t\t\tdom.remove(div);\r\n\r\n\t\t\t\t\t// Scroll to new position, scrollIntoView can't be used due to bug: http://bugs.webkit.org/show_bug.cgi?id=16117\r\n\t\t\t\t\tif (divYPos > vpHeight) // It is not necessary to scroll if the DIV is inside the view port.\r\n\t\t\t\t\t\ted.getWin().scrollTo(0, divYPos);\r\n\t\t\t\t};\r\n\r\n\t\t\t\ted.onKeyPress.add(function(ed, e) {\r\n\t\t\t\t\tif (e.keyCode == 13 && (e.shiftKey || (s.force_br_newlines && !dom.getParent(selection.getNode(), 'h1,h2,h3,h4,h5,h6,ol,ul')))) {\r\n\t\t\t\t\t\tinsertBr(ed);\r\n\t\t\t\t\t\tEvent.cancel(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// IE specific fixes\r\n\t\t\tif (isIE) {\r\n\t\t\t\t// Replaces IE:s auto generated paragraphs with the specified element name\r\n\t\t\t\tif (s.element != 'P') {\r\n\t\t\t\t\ted.onKeyPress.add(function(ed, e) {\r\n\t\t\t\t\t\tt.lastElm = selection.getNode().nodeName;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\ted.onKeyUp.add(function(ed, e) {\r\n\t\t\t\t\t\tvar bl, n = selection.getNode(), b = ed.getBody();\r\n\r\n\t\t\t\t\t\tif (b.childNodes.length === 1 && n.nodeName == 'P') {\r\n\t\t\t\t\t\t\tn = dom.rename(n, s.element);\r\n\t\t\t\t\t\t\tselection.select(n);\r\n\t\t\t\t\t\t\tselection.collapse();\r\n\t\t\t\t\t\t\ted.nodeChanged();\r\n\t\t\t\t\t\t} else if (e.keyCode == 13 && !e.shiftKey && t.lastElm != 'P') {\r\n\t\t\t\t\t\t\tbl = dom.getParent(n, 'p');\r\n\r\n\t\t\t\t\t\t\tif (bl) {\r\n\t\t\t\t\t\t\t\tdom.rename(bl, s.element);\r\n\t\t\t\t\t\t\t\ted.nodeChanged();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetParentBlock : function(n) {\r\n\t\t\tvar d = this.dom;\r\n\r\n\t\t\treturn d.getParent(n, d.isBlock);\r\n\t\t},\r\n\r\n\t\tinsertPara : function(e) {\r\n\t\t\tvar t = this, ed = t.editor, dom = ed.dom, d = ed.getDoc(), se = ed.settings, s = ed.selection.getSel(), r = s.getRangeAt(0), b = d.body;\r\n\t\t\tvar rb, ra, dir, sn, so, en, eo, sb, eb, bn, bef, aft, sc, ec, n, vp = dom.getViewPort(ed.getWin()), y, ch, car;\r\n\r\n\t\t\ted.undoManager.beforeChange();\r\n\r\n\t\t\t// If root blocks are forced then use Operas default behavior since it's really good\r\n// Removed due to bug: #1853816\r\n//\t\t\tif (se.forced_root_block && isOpera)\r\n//\t\t\t\treturn TRUE;\r\n\r\n\t\t\t// Setup before range\r\n\t\t\trb = d.createRange();\r\n\r\n\t\t\t// If is before the first block element and in body, then move it into first block element\r\n\t\t\trb.setStart(s.anchorNode, s.anchorOffset);\r\n\t\t\trb.collapse(TRUE);\r\n\r\n\t\t\t// Setup after range\r\n\t\t\tra = d.createRange();\r\n\r\n\t\t\t// If is before the first block element and in body, then move it into first block element\r\n\t\t\tra.setStart(s.focusNode, s.focusOffset);\r\n\t\t\tra.collapse(TRUE);\r\n\r\n\t\t\t// Setup start/end points\r\n\t\t\tdir = rb.compareBoundaryPoints(rb.START_TO_END, ra) < 0;\r\n\t\t\tsn = dir ? s.anchorNode : s.focusNode;\r\n\t\t\tso = dir ? s.anchorOffset : s.focusOffset;\r\n\t\t\ten = dir ? s.focusNode : s.anchorNode;\r\n\t\t\teo = dir ? s.focusOffset : s.anchorOffset;\r\n\r\n\t\t\t// If selection is in empty table cell\r\n\t\t\tif (sn === en && /^(TD|TH)$/.test(sn.nodeName)) {\r\n\t\t\t\tif (sn.firstChild.nodeName == 'BR')\r\n\t\t\t\t\tdom.remove(sn.firstChild); // Remove BR\r\n\r\n\t\t\t\t// Create two new block elements\r\n\t\t\t\tif (sn.childNodes.length == 0) {\r\n\t\t\t\t\ted.dom.add(sn, se.element, null, '<br />');\r\n\t\t\t\t\taft = ed.dom.add(sn, se.element, null, '<br />');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tn = sn.innerHTML;\r\n\t\t\t\t\tsn.innerHTML = '';\r\n\t\t\t\t\ted.dom.add(sn, se.element, null, n);\r\n\t\t\t\t\taft = ed.dom.add(sn, se.element, null, '<br />');\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move caret into the last one\r\n\t\t\t\tr = d.createRange();\r\n\t\t\t\tr.selectNodeContents(aft);\r\n\t\t\t\tr.collapse(1);\r\n\t\t\t\ted.selection.setRng(r);\r\n\r\n\t\t\t\treturn FALSE;\r\n\t\t\t}\r\n\r\n\t\t\t// If the caret is in an invalid location in FF we need to move it into the first block\r\n\t\t\tif (sn == b && en == b && b.firstChild && ed.dom.isBlock(b.firstChild)) {\r\n\t\t\t\tsn = en = sn.firstChild;\r\n\t\t\t\tso = eo = 0;\r\n\t\t\t\trb = d.createRange();\r\n\t\t\t\trb.setStart(sn, 0);\r\n\t\t\t\tra = d.createRange();\r\n\t\t\t\tra.setStart(en, 0);\r\n\t\t\t}\r\n\r\n\t\t\t// If the body is totally empty add a BR element this might happen on webkit\r\n\t\t\tif (!d.body.hasChildNodes()) {\r\n\t\t\t\td.body.appendChild(dom.create('br'));\r\n\t\t\t}\r\n\r\n\t\t\t// Never use body as start or end node\r\n\t\t\tsn = sn.nodeName == \"HTML\" ? d.body : sn; // Fix for Opera bug: https://bugs.opera.com/show_bug.cgi?id=273224&comments=yes\r\n\t\t\tsn = sn.nodeName == \"BODY\" ? sn.firstChild : sn;\r\n\t\t\ten = en.nodeName == \"HTML\" ? d.body : en; // Fix for Opera bug: https://bugs.opera.com/show_bug.cgi?id=273224&comments=yes\r\n\t\t\ten = en.nodeName == \"BODY\" ? en.firstChild : en;\r\n\r\n\t\t\t// Get start and end blocks\r\n\t\t\tsb = t.getParentBlock(sn);\r\n\t\t\teb = t.getParentBlock(en);\r\n\t\t\tbn = sb ? sb.nodeName : se.element; // Get block name to create\r\n\r\n\t\t\t// Return inside list use default browser behavior\r\n\t\t\tif (n = t.dom.getParent(sb, 'li,pre')) {\r\n\t\t\t\tif (n.nodeName == 'LI')\r\n\t\t\t\t\treturn splitList(ed.selection, t.dom, n);\r\n\r\n\t\t\t\treturn TRUE;\r\n\t\t\t}\r\n\r\n\t\t\t// If caption or absolute layers then always generate new blocks within\r\n\t\t\tif (sb && (sb.nodeName == 'CAPTION' || /absolute|relative|fixed/gi.test(dom.getStyle(sb, 'position', 1)))) {\r\n\t\t\t\tbn = se.element;\r\n\t\t\t\tsb = null;\r\n\t\t\t}\r\n\r\n\t\t\t// If caption or absolute layers then always generate new blocks within\r\n\t\t\tif (eb && (eb.nodeName == 'CAPTION' || /absolute|relative|fixed/gi.test(dom.getStyle(sb, 'position', 1)))) {\r\n\t\t\t\tbn = se.element;\r\n\t\t\t\teb = null;\r\n\t\t\t}\r\n\r\n\t\t\t// Use P instead\r\n\t\t\tif (/(TD|TABLE|TH|CAPTION)/.test(bn) || (sb && bn == \"DIV\" && /left|right/gi.test(dom.getStyle(sb, 'float', 1)))) {\r\n\t\t\t\tbn = se.element;\r\n\t\t\t\tsb = eb = null;\r\n\t\t\t}\r\n\r\n\t\t\t// Setup new before and after blocks\r\n\t\t\tbef = (sb && sb.nodeName == bn) ? sb.cloneNode(0) : ed.dom.create(bn);\r\n\t\t\taft = (eb && eb.nodeName == bn) ? eb.cloneNode(0) : ed.dom.create(bn);\r\n\r\n\t\t\t// Remove id from after clone\r\n\t\t\taft.removeAttribute('id');\r\n\r\n\t\t\t// Is header and cursor is at the end, then force paragraph under\r\n\t\t\tif (/^(H[1-6])$/.test(bn) && isAtEnd(r, sb))\r\n\t\t\t\taft = ed.dom.create(se.element);\r\n\r\n\t\t\t// Find start chop node\r\n\t\t\tn = sc = sn;\r\n\t\t\tdo {\r\n\t\t\t\tif (n == b || n.nodeType == 9 || t.dom.isBlock(n) || /(TD|TABLE|TH|CAPTION)/.test(n.nodeName))\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tsc = n;\r\n\t\t\t} while ((n = n.previousSibling ? n.previousSibling : n.parentNode));\r\n\r\n\t\t\t// Find end chop node\r\n\t\t\tn = ec = en;\r\n\t\t\tdo {\r\n\t\t\t\tif (n == b || n.nodeType == 9 || t.dom.isBlock(n) || /(TD|TABLE|TH|CAPTION)/.test(n.nodeName))\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tec = n;\r\n\t\t\t} while ((n = n.nextSibling ? n.nextSibling : n.parentNode));\r\n\r\n\t\t\t// Place first chop part into before block element\r\n\t\t\tif (sc.nodeName == bn)\r\n\t\t\t\trb.setStart(sc, 0);\r\n\t\t\telse\r\n\t\t\t\trb.setStartBefore(sc);\r\n\r\n\t\t\trb.setEnd(sn, so);\r\n\t\t\tbef.appendChild(rb.cloneContents() || d.createTextNode('')); // Empty text node needed for Safari\r\n\r\n\t\t\t// Place secnd chop part within new block element\r\n\t\t\ttry {\r\n\t\t\t\tra.setEndAfter(ec);\r\n\t\t\t} catch(ex) {\r\n\t\t\t\t//console.debug(s.focusNode, s.focusOffset);\r\n\t\t\t}\r\n\r\n\t\t\tra.setStart(en, eo);\r\n\t\t\taft.appendChild(ra.cloneContents() || d.createTextNode('')); // Empty text node needed for Safari\r\n\r\n\t\t\t// Create range around everything\r\n\t\t\tr = d.createRange();\r\n\t\t\tif (!sc.previousSibling && sc.parentNode.nodeName == bn) {\r\n\t\t\t\tr.setStartBefore(sc.parentNode);\r\n\t\t\t} else {\r\n\t\t\t\tif (rb.startContainer.nodeName == bn && rb.startOffset == 0)\r\n\t\t\t\t\tr.setStartBefore(rb.startContainer);\r\n\t\t\t\telse\r\n\t\t\t\t\tr.setStart(rb.startContainer, rb.startOffset);\r\n\t\t\t}\r\n\r\n\t\t\tif (!ec.nextSibling && ec.parentNode.nodeName == bn)\r\n\t\t\t\tr.setEndAfter(ec.parentNode);\r\n\t\t\telse\r\n\t\t\t\tr.setEnd(ra.endContainer, ra.endOffset);\r\n\r\n\t\t\t// Delete and replace it with new block elements\r\n\t\t\tr.deleteContents();\r\n\r\n\t\t\tif (isOpera)\r\n\t\t\t\ted.getWin().scrollTo(0, vp.y);\r\n\r\n\t\t\t// Never wrap blocks in blocks\r\n\t\t\tif (bef.firstChild && bef.firstChild.nodeName == bn)\r\n\t\t\t\tbef.innerHTML = bef.firstChild.innerHTML;\r\n\r\n\t\t\tif (aft.firstChild && aft.firstChild.nodeName == bn)\r\n\t\t\t\taft.innerHTML = aft.firstChild.innerHTML;\r\n\r\n\t\t\tfunction appendStyles(e, en) {\r\n\t\t\t\tvar nl = [], nn, n, i;\r\n\r\n\t\t\t\te.innerHTML = '';\r\n\r\n\t\t\t\t// Make clones of style elements\r\n\t\t\t\tif (se.keep_styles) {\r\n\t\t\t\t\tn = en;\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\t// We only want style specific elements\r\n\t\t\t\t\t\tif (/^(SPAN|STRONG|B|EM|I|FONT|STRIKE|U)$/.test(n.nodeName)) {\r\n\t\t\t\t\t\t\tnn = n.cloneNode(FALSE);\r\n\t\t\t\t\t\t\tdom.setAttrib(nn, 'id', ''); // Remove ID since it needs to be unique\r\n\t\t\t\t\t\t\tnl.push(nn);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} while (n = n.parentNode);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Append style elements to aft\r\n\t\t\t\tif (nl.length > 0) {\r\n\t\t\t\t\tfor (i = nl.length - 1, nn = e; i >= 0; i--)\r\n\t\t\t\t\t\tnn = nn.appendChild(nl[i]);\r\n\r\n\t\t\t\t\t// Padd most inner style element\r\n\t\t\t\t\tnl[0].innerHTML = isOpera ? '\\u00a0' : '<br />'; // Extra space for Opera so that the caret can move there\r\n\t\t\t\t\treturn nl[0]; // Move caret to most inner element\r\n\t\t\t\t} else\r\n\t\t\t\t\te.innerHTML = isOpera ? '\\u00a0' : '<br />'; // Extra space for Opera so that the caret can move there\r\n\t\t\t};\r\n\t\t\t\t\r\n\t\t\t// Padd empty blocks\r\n\t\t\tif (dom.isEmpty(bef))\r\n\t\t\t\tappendStyles(bef, sn);\r\n\r\n\t\t\t// Fill empty afterblook with current style\r\n\t\t\tif (dom.isEmpty(aft))\r\n\t\t\t\tcar = appendStyles(aft, en);\r\n\r\n\t\t\t// Opera needs this one backwards for older versions\r\n\t\t\tif (isOpera && parseFloat(opera.version()) < 9.5) {\r\n\t\t\t\tr.insertNode(bef);\r\n\t\t\t\tr.insertNode(aft);\r\n\t\t\t} else {\r\n\t\t\t\tr.insertNode(aft);\r\n\t\t\t\tr.insertNode(bef);\r\n\t\t\t}\r\n\r\n\t\t\t// Normalize\r\n\t\t\taft.normalize();\r\n\t\t\tbef.normalize();\r\n\r\n\t\t\t// Move cursor and scroll into view\r\n\t\t\ted.selection.select(aft, true);\r\n\t\t\ted.selection.collapse(true);\r\n\r\n\t\t\t// scrollIntoView seems to scroll the parent window in most browsers now including FF 3.0b4 so it's time to stop using it and do it our selfs\r\n\t\t\ty = ed.dom.getPos(aft).y;\r\n\t\t\t//ch = aft.clientHeight;\r\n\r\n\t\t\t// Is element within viewport\r\n\t\t\tif (y < vp.y || y + 25 > vp.y + vp.h) {\r\n\t\t\t\ted.getWin().scrollTo(0, y < vp.y ? y : y - vp.h + 25); // Needs to be hardcoded to roughly one line of text if a huge text block is broken into two blocks\r\n\r\n\t\t\t\t/*console.debug(\r\n\t\t\t\t\t'Element: y=' + y + ', h=' + ch + ', ' +\r\n\t\t\t\t\t'Viewport: y=' + vp.y + \", h=\" + vp.h + ', bottom=' + (vp.y + vp.h)\r\n\t\t\t\t);*/\r\n\t\t\t}\r\n\r\n\t\t\ted.undoManager.add();\r\n\r\n\t\t\treturn FALSE;\r\n\t\t},\r\n\r\n\t\tbackspaceDelete : function(e, bs) {\r\n\t\t\tvar t = this, ed = t.editor, b = ed.getBody(), dom = ed.dom, n, se = ed.selection, r = se.getRng(), sc = r.startContainer, n, w, tn, walker;\r\n\r\n\t\t\t// Delete when caret is behind a element doesn't work correctly on Gecko see #3011651\r\n\t\t\tif (!bs && r.collapsed && sc.nodeType == 1 && r.startOffset == sc.childNodes.length) {\r\n\t\t\t\twalker = new tinymce.dom.TreeWalker(sc.lastChild, sc);\r\n\r\n\t\t\t\t// Walk the dom backwards until we find a text node\r\n\t\t\t\tfor (n = sc.lastChild; n; n = walker.prev()) {\r\n\t\t\t\t\tif (n.nodeType == 3) {\r\n\t\t\t\t\t\tr.setStart(n, n.nodeValue.length);\r\n\t\t\t\t\t\tr.collapse(true);\r\n\t\t\t\t\t\tse.setRng(r);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// The caret sometimes gets stuck in Gecko if you delete empty paragraphs\r\n\t\t\t// This workaround removes the element by hand and moves the caret to the previous element\r\n\t\t\tif (sc && ed.dom.isBlock(sc) && !/^(TD|TH)$/.test(sc.nodeName) && bs) {\r\n\t\t\t\tif (sc.childNodes.length == 0 || (sc.childNodes.length == 1 && sc.firstChild.nodeName == 'BR')) {\r\n\t\t\t\t\t// Find previous block element\r\n\t\t\t\t\tn = sc;\r\n\t\t\t\t\twhile ((n = n.previousSibling) && !ed.dom.isBlock(n)) ;\r\n\r\n\t\t\t\t\tif (n) {\r\n\t\t\t\t\t\tif (sc != b.firstChild) {\r\n\t\t\t\t\t\t\t// Find last text node\r\n\t\t\t\t\t\t\tw = ed.dom.doc.createTreeWalker(n, NodeFilter.SHOW_TEXT, null, FALSE);\r\n\t\t\t\t\t\t\twhile (tn = w.nextNode())\r\n\t\t\t\t\t\t\t\tn = tn;\r\n\r\n\t\t\t\t\t\t\t// Place caret at the end of last text node\r\n\t\t\t\t\t\t\tr = ed.getDoc().createRange();\r\n\t\t\t\t\t\t\tr.setStart(n, n.nodeValue ? n.nodeValue.length : 0);\r\n\t\t\t\t\t\t\tr.setEnd(n, n.nodeValue ? n.nodeValue.length : 0);\r\n\t\t\t\t\t\t\tse.setRng(r);\r\n\r\n\t\t\t\t\t\t\t// Remove the target container\r\n\t\t\t\t\t\t\ted.dom.remove(sc);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn Event.cancel(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\t// Shorten names\r\n\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, each = tinymce.each, extend = tinymce.extend;\r\n\r\n\ttinymce.create('tinymce.ControlManager', {\r\n\t\tControlManager : function(ed, s) {\r\n\t\t\tvar t = this, i;\r\n\r\n\t\t\ts = s || {};\r\n\t\t\tt.editor = ed;\r\n\t\t\tt.controls = {};\r\n\t\t\tt.onAdd = new tinymce.util.Dispatcher(t);\r\n\t\t\tt.onPostRender = new tinymce.util.Dispatcher(t);\r\n\t\t\tt.prefix = s.prefix || ed.id + '_';\r\n\t\t\tt._cls = {};\r\n\r\n\t\t\tt.onPostRender.add(function() {\r\n\t\t\t\teach(t.controls, function(c) {\r\n\t\t\t\t\tc.postRender();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tget : function(id) {\r\n\t\t\treturn this.controls[this.prefix + id] || this.controls[id];\r\n\t\t},\r\n\r\n\t\tsetActive : function(id, s) {\r\n\t\t\tvar c = null;\r\n\r\n\t\t\tif (c = this.get(id))\r\n\t\t\t\tc.setActive(s);\r\n\r\n\t\t\treturn c;\r\n\t\t},\r\n\r\n\t\tsetDisabled : function(id, s) {\r\n\t\t\tvar c = null;\r\n\r\n\t\t\tif (c = this.get(id))\r\n\t\t\t\tc.setDisabled(s);\r\n\r\n\t\t\treturn c;\r\n\t\t},\r\n\r\n\t\tadd : function(c) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tif (c) {\r\n\t\t\t\tt.controls[c.id] = c;\r\n\t\t\t\tt.onAdd.dispatch(c, t);\r\n\t\t\t}\r\n\r\n\t\t\treturn c;\r\n\t\t},\r\n\r\n\t\tcreateControl : function(n) {\r\n\t\t\tvar c, t = this, ed = t.editor;\r\n\r\n\t\t\teach(ed.plugins, function(p) {\r\n\t\t\t\tif (p.createControl) {\r\n\t\t\t\t\tc = p.createControl(n, t);\r\n\r\n\t\t\t\t\tif (c)\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tswitch (n) {\r\n\t\t\t\tcase \"|\":\r\n\t\t\t\tcase \"separator\":\r\n\t\t\t\t\treturn t.createSeparator();\r\n\t\t\t}\r\n\r\n\t\t\tif (!c && ed.buttons && (c = ed.buttons[n]))\r\n\t\t\t\treturn t.createButton(n, c);\r\n\r\n\t\t\treturn t.add(c);\r\n\t\t},\r\n\r\n\t\tcreateDropMenu : function(id, s, cc) {\r\n\t\t\tvar t = this, ed = t.editor, c, bm, v, cls;\r\n\r\n\t\t\ts = extend({\r\n\t\t\t\t'class' : 'mceDropDown',\r\n\t\t\t\tconstrain : ed.settings.constrain_menus\r\n\t\t\t}, s);\r\n\r\n\t\t\ts['class'] = s['class'] + ' ' + ed.getParam('skin') + 'Skin';\r\n\t\t\tif (v = ed.getParam('skin_variant'))\r\n\t\t\t\ts['class'] += ' ' + ed.getParam('skin') + 'Skin' + v.substring(0, 1).toUpperCase() + v.substring(1);\r\n\r\n\t\t\tid = t.prefix + id;\r\n\t\t\tcls = cc || t._cls.dropmenu || tinymce.ui.DropMenu;\r\n\t\t\tc = t.controls[id] = new cls(id, s);\r\n\t\t\tc.onAddItem.add(function(c, o) {\r\n\t\t\t\tvar s = o.settings;\r\n\r\n\t\t\t\ts.title = ed.getLang(s.title, s.title);\r\n\r\n\t\t\t\tif (!s.onclick) {\r\n\t\t\t\t\ts.onclick = function(v) {\r\n\t\t\t\t\t\tif (s.cmd)\r\n\t\t\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, s.value);\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\ted.onRemove.add(function() {\r\n\t\t\t\tc.destroy();\r\n\t\t\t});\r\n\r\n\t\t\t// Fix for bug #1897785, #1898007\r\n\t\t\tif (tinymce.isIE) {\r\n\t\t\t\tc.onShowMenu.add(function() {\r\n\t\t\t\t\t// IE 8 needs focus in order to store away a range with the current collapsed caret location\r\n\t\t\t\t\ted.focus();\r\n\r\n\t\t\t\t\tbm = ed.selection.getBookmark(1);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tc.onHideMenu.add(function() {\r\n\t\t\t\t\tif (bm) {\r\n\t\t\t\t\t\ted.selection.moveToBookmark(bm);\r\n\t\t\t\t\t\tbm = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn t.add(c);\r\n\t\t},\r\n\r\n\t\tcreateListBox : function(id, s, cc) {\r\n\t\t\tvar t = this, ed = t.editor, cmd, c, cls;\r\n\r\n\t\t\tif (t.get(id))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\ts.title = ed.translate(s.title);\r\n\t\t\ts.scope = s.scope || ed;\r\n\r\n\t\t\tif (!s.onselect) {\r\n\t\t\t\ts.onselect = function(v) {\r\n\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, v || s.value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\ts = extend({\r\n\t\t\t\ttitle : s.title,\r\n\t\t\t\t'class' : 'mce_' + id,\r\n\t\t\t\tscope : s.scope,\r\n\t\t\t\tcontrol_manager : t\r\n\t\t\t}, s);\r\n\r\n\t\t\tid = t.prefix + id;\r\n\r\n\r\n\t\t\tfunction useNativeListForAccessibility(ed) {\r\n\t\t\t\treturn ed.settings.use_accessible_selects && !tinymce.isGecko\r\n\t\t\t}\r\n\r\n\t\t\tif (ed.settings.use_native_selects || useNativeListForAccessibility(ed))\r\n\t\t\t\tc = new tinymce.ui.NativeListBox(id, s);\r\n\t\t\telse {\r\n\t\t\t\tcls = cc || t._cls.listbox || tinymce.ui.ListBox;\r\n\t\t\t\tc = new cls(id, s, ed);\r\n\t\t\t}\r\n\r\n\t\t\tt.controls[id] = c;\r\n\r\n\t\t\t// Fix focus problem in Safari\r\n\t\t\tif (tinymce.isWebKit) {\r\n\t\t\t\tc.onPostRender.add(function(c, n) {\r\n\t\t\t\t\t// Store bookmark on mousedown\r\n\t\t\t\t\tEvent.add(n, 'mousedown', function() {\r\n\t\t\t\t\t\ted.bookmark = ed.selection.getBookmark(1);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Restore on focus, since it might be lost\r\n\t\t\t\t\tEvent.add(n, 'focus', function() {\r\n\t\t\t\t\t\ted.selection.moveToBookmark(ed.bookmark);\r\n\t\t\t\t\t\ted.bookmark = null;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (c.hideMenu)\r\n\t\t\t\ted.onMouseDown.add(c.hideMenu, c);\r\n\r\n\t\t\treturn t.add(c);\r\n\t\t},\r\n\r\n\t\tcreateButton : function(id, s, cc) {\r\n\t\t\tvar t = this, ed = t.editor, o, c, cls;\r\n\r\n\t\t\tif (t.get(id))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\ts.title = ed.translate(s.title);\r\n\t\t\ts.label = ed.translate(s.label);\r\n\t\t\ts.scope = s.scope || ed;\r\n\r\n\t\t\tif (!s.onclick && !s.menu_button) {\r\n\t\t\t\ts.onclick = function() {\r\n\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, s.value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\ts = extend({\r\n\t\t\t\ttitle : s.title,\r\n\t\t\t\t'class' : 'mce_' + id,\r\n\t\t\t\tunavailable_prefix : ed.getLang('unavailable', ''),\r\n\t\t\t\tscope : s.scope,\r\n\t\t\t\tcontrol_manager : t\r\n\t\t\t}, s);\r\n\r\n\t\t\tid = t.prefix + id;\r\n\r\n\t\t\tif (s.menu_button) {\r\n\t\t\t\tcls = cc || t._cls.menubutton || tinymce.ui.MenuButton;\r\n\t\t\t\tc = new cls(id, s, ed);\r\n\t\t\t\ted.onMouseDown.add(c.hideMenu, c);\r\n\t\t\t} else {\r\n\t\t\t\tcls = t._cls.button || tinymce.ui.Button;\r\n\t\t\t\tc = new cls(id, s, ed);\r\n\t\t\t}\r\n\r\n\t\t\treturn t.add(c);\r\n\t\t},\r\n\r\n\t\tcreateMenuButton : function(id, s, cc) {\r\n\t\t\ts = s || {};\r\n\t\t\ts.menu_button = 1;\r\n\r\n\t\t\treturn this.createButton(id, s, cc);\r\n\t\t},\r\n\r\n\t\tcreateSplitButton : function(id, s, cc) {\r\n\t\t\tvar t = this, ed = t.editor, cmd, c, cls;\r\n\r\n\t\t\tif (t.get(id))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\ts.title = ed.translate(s.title);\r\n\t\t\ts.scope = s.scope || ed;\r\n\r\n\t\t\tif (!s.onclick) {\r\n\t\t\t\ts.onclick = function(v) {\r\n\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, v || s.value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (!s.onselect) {\r\n\t\t\t\ts.onselect = function(v) {\r\n\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, v || s.value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\ts = extend({\r\n\t\t\t\ttitle : s.title,\r\n\t\t\t\t'class' : 'mce_' + id,\r\n\t\t\t\tscope : s.scope,\r\n\t\t\t\tcontrol_manager : t\r\n\t\t\t}, s);\r\n\r\n\t\t\tid = t.prefix + id;\r\n\t\t\tcls = cc || t._cls.splitbutton || tinymce.ui.SplitButton;\r\n\t\t\tc = t.add(new cls(id, s, ed));\r\n\t\t\ted.onMouseDown.add(c.hideMenu, c);\r\n\r\n\t\t\treturn c;\r\n\t\t},\r\n\r\n\t\tcreateColorSplitButton : function(id, s, cc) {\r\n\t\t\tvar t = this, ed = t.editor, cmd, c, cls, bm;\r\n\r\n\t\t\tif (t.get(id))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\ts.title = ed.translate(s.title);\r\n\t\t\ts.scope = s.scope || ed;\r\n\r\n\t\t\tif (!s.onclick) {\r\n\t\t\t\ts.onclick = function(v) {\r\n\t\t\t\t\tif (tinymce.isIE)\r\n\t\t\t\t\t\tbm = ed.selection.getBookmark(1);\r\n\r\n\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, v || s.value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (!s.onselect) {\r\n\t\t\t\ts.onselect = function(v) {\r\n\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, v || s.value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\ts = extend({\r\n\t\t\t\ttitle : s.title,\r\n\t\t\t\t'class' : 'mce_' + id,\r\n\t\t\t\t'menu_class' : ed.getParam('skin') + 'Skin',\r\n\t\t\t\tscope : s.scope,\r\n\t\t\t\tmore_colors_title : ed.getLang('more_colors')\r\n\t\t\t}, s);\r\n\r\n\t\t\tid = t.prefix + id;\r\n\t\t\tcls = cc || t._cls.colorsplitbutton || tinymce.ui.ColorSplitButton;\r\n\t\t\tc = new cls(id, s, ed);\r\n\t\t\ted.onMouseDown.add(c.hideMenu, c);\r\n\r\n\t\t\t// Remove the menu element when the editor is removed\r\n\t\t\ted.onRemove.add(function() {\r\n\t\t\t\tc.destroy();\r\n\t\t\t});\r\n\r\n\t\t\t// Fix for bug #1897785, #1898007\r\n\t\t\tif (tinymce.isIE) {\r\n\t\t\t\tc.onShowMenu.add(function() {\r\n\t\t\t\t\t// IE 8 needs focus in order to store away a range with the current collapsed caret location\r\n\t\t\t\t\ted.focus();\r\n\t\t\t\t\tbm = ed.selection.getBookmark(1);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tc.onHideMenu.add(function() {\r\n\t\t\t\t\tif (bm) {\r\n\t\t\t\t\t\ted.selection.moveToBookmark(bm);\r\n\t\t\t\t\t\tbm = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn t.add(c);\r\n\t\t},\r\n\r\n\t\tcreateToolbar : function(id, s, cc) {\r\n\t\t\tvar c, t = this, cls;\r\n\r\n\t\t\tid = t.prefix + id;\r\n\t\t\tcls = cc || t._cls.toolbar || tinymce.ui.Toolbar;\r\n\t\t\tc = new cls(id, s, t.editor);\r\n\r\n\t\t\tif (t.get(id))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\treturn t.add(c);\r\n\t\t},\r\n\t\t\r\n\t\tcreateToolbarGroup : function(id, s, cc) {\r\n\t\t\tvar c, t = this, cls;\r\n\t\t\tid = t.prefix + id;\r\n\t\t\tcls = cc || this._cls.toolbarGroup || tinymce.ui.ToolbarGroup;\r\n\t\t\tc = new cls(id, s, t.editor);\r\n\t\t\t\r\n\t\t\tif (t.get(id))\r\n\t\t\t\treturn null;\r\n\t\t\t\r\n\t\t\treturn t.add(c);\r\n\t\t},\r\n\r\n\t\tcreateSeparator : function(cc) {\r\n\t\t\tvar cls = cc || this._cls.separator || tinymce.ui.Separator;\r\n\r\n\t\t\treturn new cls();\r\n\t\t},\r\n\r\n\t\tsetControlType : function(n, c) {\r\n\t\t\treturn this._cls[n.toLowerCase()] = c;\r\n\t\t},\r\n\t\r\n\t\tdestroy : function() {\r\n\t\t\teach(this.controls, function(c) {\r\n\t\t\t\tc.destroy();\r\n\t\t\t});\r\n\r\n\t\t\tthis.controls = null;\r\n\t\t}\r\n\t});\r\n})(tinymce);\r\n\r\n(function(tinymce) {\r\n\tvar Dispatcher = tinymce.util.Dispatcher, each = tinymce.each, isIE = tinymce.isIE, isOpera = tinymce.isOpera;\r\n\r\n\ttinymce.create('tinymce.WindowManager', {\r\n\t\tWindowManager : function(ed) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tt.editor = ed;\r\n\t\t\tt.onOpen = new Dispatcher(t);\r\n\t\t\tt.onClose = new Dispatcher(t);\r\n\t\t\tt.params = {};\r\n\t\t\tt.features = {};\r\n\t\t},\r\n\r\n\t\topen : function(s, p) {\r\n\t\t\tvar t = this, f = '', x, y, mo = t.editor.settings.dialog_type == 'modal', w, sw, sh, vp = tinymce.DOM.getViewPort(), u;\r\n\r\n\t\t\t// Default some options\r\n\t\t\ts = s || {};\r\n\t\t\tp = p || {};\r\n\t\t\tsw = isOpera ? vp.w : screen.width; // Opera uses windows inside the Opera window\r\n\t\t\tsh = isOpera ? vp.h : screen.height;\r\n\t\t\ts.name = s.name || 'mc_' + new Date().getTime();\r\n\t\t\ts.width = parseInt(s.width || 320);\r\n\t\t\ts.height = parseInt(s.height || 240);\r\n\t\t\ts.resizable = true;\r\n\t\t\ts.left = s.left || parseInt(sw / 2.0) - (s.width / 2.0);\r\n\t\t\ts.top = s.top || parseInt(sh / 2.0) - (s.height / 2.0);\r\n\t\t\tp.inline = false;\r\n\t\t\tp.mce_width = s.width;\r\n\t\t\tp.mce_height = s.height;\r\n\t\t\tp.mce_auto_focus = s.auto_focus;\r\n\r\n\t\t\tif (mo) {\r\n\t\t\t\tif (isIE) {\r\n\t\t\t\t\ts.center = true;\r\n\t\t\t\t\ts.help = false;\r\n\t\t\t\t\ts.dialogWidth = s.width + 'px';\r\n\t\t\t\t\ts.dialogHeight = s.height + 'px';\r\n\t\t\t\t\ts.scroll = s.scrollbars || false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Build features string\r\n\t\t\teach(s, function(v, k) {\r\n\t\t\t\tif (tinymce.is(v, 'boolean'))\r\n\t\t\t\t\tv = v ? 'yes' : 'no';\r\n\r\n\t\t\t\tif (!/^(name|url)$/.test(k)) {\r\n\t\t\t\t\tif (isIE && mo)\r\n\t\t\t\t\t\tf += (f ? ';' : '') + k + ':' + v;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tf += (f ? ',' : '') + k + '=' + v;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tt.features = s;\r\n\t\t\tt.params = p;\r\n\t\t\tt.onOpen.dispatch(t, s, p);\r\n\r\n\t\t\tu = s.url || s.file;\r\n\t\t\tu = tinymce._addVer(u);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tif (isIE && mo) {\r\n\t\t\t\t\tw = 1;\r\n\t\t\t\t\twindow.showModalDialog(u, window, f);\r\n\t\t\t\t} else\r\n\t\t\t\t\tw = window.open(u, s.name, f);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Ignore\r\n\t\t\t}\r\n\r\n\t\t\tif (!w)\r\n\t\t\t\talert(t.editor.getLang('popup_blocked'));\r\n\t\t},\r\n\r\n\t\tclose : function(w) {\r\n\t\t\tw.close();\r\n\t\t\tthis.onClose.dispatch(this);\r\n\t\t},\r\n\r\n\t\tcreateInstance : function(cl, a, b, c, d, e) {\r\n\t\t\tvar f = tinymce.resolve(cl);\r\n\r\n\t\t\treturn new f(a, b, c, d, e);\r\n\t\t},\r\n\r\n\t\tconfirm : function(t, cb, s, w) {\r\n\t\t\tw = w || window;\r\n\r\n\t\t\tcb.call(s || this, w.confirm(this._decode(this.editor.getLang(t, t))));\r\n\t\t},\r\n\r\n\t\talert : function(tx, cb, s, w) {\r\n\t\t\tvar t = this;\r\n\r\n\t\t\tw = w || window;\r\n\t\t\tw.alert(t._decode(t.editor.getLang(tx, tx)));\r\n\r\n\t\t\tif (cb)\r\n\t\t\t\tcb.call(s || t);\r\n\t\t},\r\n\r\n\t\tresizeBy : function(dw, dh, win) {\r\n\t\t\twin.resizeBy(dw, dh);\r\n\t\t},\r\n\r\n\t\t// Internal functions\r\n\r\n\t\t_decode : function(s) {\r\n\t\t\treturn tinymce.DOM.decode(s).replace(/\\\\n/g, '\\n');\r\n\t\t}\r\n\t});\r\n}(tinymce));\r\n(function(tinymce) {\r\n\ttinymce.Formatter = function(ed) {\r\n\t\tvar formats = {},\r\n\t\t\teach = tinymce.each,\r\n\t\t\tdom = ed.dom,\r\n\t\t\tselection = ed.selection,\r\n\t\t\tTreeWalker = tinymce.dom.TreeWalker,\r\n\t\t\trangeUtils = new tinymce.dom.RangeUtils(dom),\r\n\t\t\tisValid = ed.schema.isValidChild,\r\n\t\t\tisBlock = dom.isBlock,\r\n\t\t\tforcedRootBlock = ed.settings.forced_root_block,\r\n\t\t\tnodeIndex = dom.nodeIndex,\r\n\t\t\tINVISIBLE_CHAR = '\\uFEFF',\r\n\t\t\tMCE_ATTR_RE = /^(src|href|style)$/,\r\n\t\t\tFALSE = false,\r\n\t\t\tTRUE = true,\r\n\t\t\tundefined;\r\n\r\n\t\tfunction isArray(obj) {\r\n\t\t\treturn obj instanceof Array;\r\n\t\t};\r\n\r\n\t\tfunction getParents(node, selector) {\r\n\t\t\treturn dom.getParents(node, selector, dom.getRoot());\r\n\t\t};\r\n\r\n\t\tfunction isCaretNode(node) {\r\n\t\t\treturn node.nodeType === 1 && (node.face === 'mceinline' || node.style.fontFamily === 'mceinline');\r\n\t\t};\r\n\r\n\t\t// Public functions\r\n\r\n\t\tfunction get(name) {\r\n\t\t\treturn name ? formats[name] : formats;\r\n\t\t};\r\n\r\n\t\tfunction register(name, format) {\r\n\t\t\tif (name) {\r\n\t\t\t\tif (typeof(name) !== 'string') {\r\n\t\t\t\t\teach(name, function(format, name) {\r\n\t\t\t\t\t\tregister(name, format);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Force format into array and add it to internal collection\r\n\t\t\t\t\tformat = format.length ? format : [format];\r\n\r\n\t\t\t\t\teach(format, function(format) {\r\n\t\t\t\t\t\t// Set deep to false by default on selector formats this to avoid removing\r\n\t\t\t\t\t\t// alignment on images inside paragraphs when alignment is changed on paragraphs\r\n\t\t\t\t\t\tif (format.deep === undefined)\r\n\t\t\t\t\t\t\tformat.deep = !format.selector;\r\n\r\n\t\t\t\t\t\t// Default to true\r\n\t\t\t\t\t\tif (format.split === undefined)\r\n\t\t\t\t\t\t\tformat.split = !format.selector || format.inline;\r\n\r\n\t\t\t\t\t\t// Default to true\r\n\t\t\t\t\t\tif (format.remove === undefined && format.selector && !format.inline)\r\n\t\t\t\t\t\t\tformat.remove = 'none';\r\n\r\n\t\t\t\t\t\t// Mark format as a mixed format inline + block level\r\n\t\t\t\t\t\tif (format.selector && format.inline) {\r\n\t\t\t\t\t\t\tformat.mixed = true;\r\n\t\t\t\t\t\t\tformat.block_expand = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Split classes if needed\r\n\t\t\t\t\t\tif (typeof(format.classes) === 'string')\r\n\t\t\t\t\t\t\tformat.classes = format.classes.split(/\\s+/);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tformats[name] = format;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar getTextDecoration = function(node) {\r\n\t\t\tvar decoration;\r\n\r\n\t\t\ted.dom.getParent(node, function(n) {\r\n\t\t\t\tdecoration = ed.dom.getStyle(n, 'text-decoration');\r\n\t\t\t\treturn decoration && decoration !== 'none';\r\n\t\t\t});\r\n\r\n\t\t\treturn decoration;\r\n\t\t};\r\n\r\n\t\tvar processUnderlineAndColor = function(node) {\r\n\t\t\tvar textDecoration;\r\n\t\t\tif (node.nodeType === 1 && node.parentNode && node.parentNode.nodeType === 1) {\r\n\t\t\t\ttextDecoration = getTextDecoration(node.parentNode);\r\n\t\t\t\tif (ed.dom.getStyle(node, 'color') && textDecoration) {\r\n\t\t\t\t\ted.dom.setStyle(node, 'text-decoration', textDecoration);\r\n\t\t\t\t} else if (ed.dom.getStyle(node, 'textdecoration') === textDecoration) {\r\n\t\t\t\t\ted.dom.setStyle(node, 'text-decoration', null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction apply(name, vars, node) {\r\n\t\t\tvar formatList = get(name), format = formatList[0], bookmark, rng, i, isCollapsed = selection.isCollapsed();\r\n\r\n\t\t\tfunction moveStart(rng) {\r\n\t\t\t\tvar container = rng.startContainer,\r\n\t\t\t\t\toffset = rng.startOffset,\r\n\t\t\t\t\twalker, node;\r\n\r\n\t\t\t\t// Move startContainer/startOffset in to a suitable node\r\n\t\t\t\tif (container.nodeType == 1 || container.nodeValue === \"\") {\r\n\t\t\t\t\tcontainer = container.nodeType == 1 ? container.childNodes[offset] : container;\r\n\r\n\t\t\t\t\t// Might fail if the offset is behind the last element in it's container\r\n\t\t\t\t\tif (container) {\r\n\t\t\t\t\t\twalker = new TreeWalker(container, container.parentNode);\r\n\t\t\t\t\t\tfor (node = walker.current(); node; node = walker.next()) {\r\n\t\t\t\t\t\t\tif (node.nodeType == 3 && !isWhiteSpaceNode(node)) {\r\n\t\t\t\t\t\t\t\trng.setStart(node, 0);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn rng;\r\n\t\t\t};\r\n\r\n\t\t\tfunction setElementFormat(elm, fmt) {\r\n\t\t\t\tfmt = fmt || format;\r\n\r\n\t\t\t\tif (elm) {\r\n\t\t\t\t\tif (fmt.onformat) {\r\n\t\t\t\t\t\tfmt.onformat(elm, fmt, vars, node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\teach(fmt.styles, function(value, name) {\r\n\t\t\t\t\t\tdom.setStyle(elm, name, replaceVars(value, vars));\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\teach(fmt.attributes, function(value, name) {\r\n\t\t\t\t\t\tdom.setAttrib(elm, name, replaceVars(value, vars));\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\teach(fmt.classes, function(value) {\r\n\t\t\t\t\t\tvalue = replaceVars(value, vars);\r\n\r\n\t\t\t\t\t\tif (!dom.hasClass(elm, value))\r\n\t\t\t\t\t\t\tdom.addClass(elm, value);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tfunction adjustSelectionToVisibleSelection() {\r\n\t\t\t\tfunction findSelectionEnd(start, end) {\r\n\t\t\t\t\tvar walker = new TreeWalker(end);\r\n\t\t\t\t\tfor (node = walker.current(); node; node = walker.prev()) {\r\n\t\t\t\t\t\tif (node.childNodes.length > 1 || node == start) {\r\n\t\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Adjust selection so that a end container with a end offset of zero is not included in the selection\r\n\t\t\t\t// as this isn't visible to the user.\r\n\t\t\t\tvar rng = ed.selection.getRng();\r\n\t\t\t\tvar start = rng.startContainer;\r\n\t\t\t\tvar end = rng.endContainer;\r\n\r\n\t\t\t\tif (start != end && rng.endOffset == 0) {\r\n\t\t\t\t\tvar newEnd = findSelectionEnd(start, end);\r\n\t\t\t\t\tvar endOffset = newEnd.nodeType == 3 ? newEnd.length : newEnd.childNodes.length;\r\n\r\n\t\t\t\t\trng.setEnd(newEnd, endOffset);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn rng;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfunction applyStyleToList(node, bookmark, wrapElm, newWrappers, process){\r\n\t\t\t\tvar nodes = [], listIndex = -1, list, startIndex = -1, endIndex = -1, currentWrapElm;\r\n\t\t\t\t\r\n\t\t\t\t// find the index of the first child list.\r\n\t\t\t\teach(node.childNodes, function(n, index) {\r\n\t\t\t\t\tif (n.nodeName === \"UL\" || n.nodeName === \"OL\") {\r\n\t\t\t\t\t\tlistIndex = index;\r\n\t\t\t\t\t\tlist = n;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t// get the index of the bookmarks\r\n\t\t\t\teach(node.childNodes, function(n, index) {\r\n\t\t\t\t\tif (n.nodeName === \"SPAN\" && dom.getAttrib(n, \"data-mce-type\") == \"bookmark\") {\r\n\t\t\t\t\t\tif (n.id == bookmark.id + \"_start\") {\r\n\t\t\t\t\t\t\tstartIndex = index;\r\n\t\t\t\t\t\t} else if (n.id == bookmark.id + \"_end\") {\r\n\t\t\t\t\t\t\tendIndex = index;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t// if the selection spans across an embedded list, or there isn't an embedded list - handle processing normally\r\n\t\t\t\tif (listIndex <= 0 || (startIndex < listIndex && endIndex > listIndex)) {\r\n\t\t\t\t\teach(tinymce.grep(node.childNodes), process);\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcurrentWrapElm = wrapElm.cloneNode(FALSE);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// create a list of the nodes on the same side of the list as the selection\r\n\t\t\t\t\teach(tinymce.grep(node.childNodes), function(n, index) {\r\n\t\t\t\t\t\tif ((startIndex < listIndex && index < listIndex) || (startIndex > listIndex && index > listIndex)) {\r\n\t\t\t\t\t\t\tnodes.push(n); \r\n\t\t\t\t\t\t\tn.parentNode.removeChild(n);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\t// insert the wrapping element either before or after the list.\r\n\t\t\t\t\tif (startIndex < listIndex) {\r\n\t\t\t\t\t\tnode.insertBefore(currentWrapElm, list);\r\n\t\t\t\t\t} else if (startIndex > listIndex) {\r\n\t\t\t\t\t\tnode.insertBefore(currentWrapElm, list.nextSibling);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// add the new nodes to the list.\r\n\t\t\t\t\tnewWrappers.push(currentWrapElm);\r\n\r\n\t\t\t\t\teach(nodes, function(node) {\r\n\t\t\t\t\t\tcurrentWrapElm.appendChild(node);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn currentWrapElm;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tfunction applyRngStyle(rng, bookmark, node_specific) {\r\n\t\t\t\tvar newWrappers = [], wrapName, wrapElm;\r\n\r\n\t\t\t\t// Setup wrapper element\r\n\t\t\t\twrapName = format.inline || format.block;\r\n\t\t\t\twrapElm = dom.create(wrapName);\r\n\t\t\t\tsetElementFormat(wrapElm);\r\n\r\n\t\t\t\trangeUtils.walk(rng, function(nodes) {\r\n\t\t\t\t\tvar currentWrapElm;\r\n\r\n\t\t\t\t\tfunction process(node) {\r\n\t\t\t\t\t\tvar nodeName = node.nodeName.toLowerCase(), parentName = node.parentNode.nodeName.toLowerCase(), found;\r\n\r\n\t\t\t\t\t\t// Stop wrapping on br elements\r\n\t\t\t\t\t\tif (isEq(nodeName, 'br')) {\r\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\r\n\t\t\t\t\t\t\t// Remove any br elements when we wrap things\r\n\t\t\t\t\t\t\tif (format.block)\r\n\t\t\t\t\t\t\t\tdom.remove(node);\r\n\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// If node is wrapper type\r\n\t\t\t\t\t\tif (format.wrapper && matchNode(node, name, vars)) {\r\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Can we rename the block\r\n\t\t\t\t\t\tif (format.block && !format.wrapper && isTextBlock(nodeName)) {\r\n\t\t\t\t\t\t\tnode = dom.rename(node, wrapName);\r\n\t\t\t\t\t\t\tsetElementFormat(node);\r\n\t\t\t\t\t\t\tnewWrappers.push(node);\r\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Handle selector patterns\r\n\t\t\t\t\t\tif (format.selector) {\r\n\t\t\t\t\t\t\t// Look for matching formats\r\n\t\t\t\t\t\t\teach(formatList, function(format) {\r\n\t\t\t\t\t\t\t\t// Check collapsed state if it exists\r\n\t\t\t\t\t\t\t\tif ('collapsed' in format && format.collapsed !== isCollapsed) {\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (dom.is(node, format.selector) && !isCaretNode(node)) {\r\n\t\t\t\t\t\t\t\t\tsetElementFormat(node, format);\r\n\t\t\t\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t// Continue processing if a selector match wasn't found and a inline element is defined\r\n\t\t\t\t\t\t\tif (!format.inline || found) {\r\n\t\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Is it valid to wrap this item\r\n\t\t\t\t\t\tif (isValid(wrapName, nodeName) && isValid(parentName, wrapName) &&\r\n\t\t\t\t\t\t\t\t!(!node_specific && node.nodeType === 3 && node.nodeValue.length === 1 && node.nodeValue.charCodeAt(0) === 65279) && node.id !== '_mce_caret') {\r\n\t\t\t\t\t\t\t// Start wrapping\r\n\t\t\t\t\t\t\tif (!currentWrapElm) {\r\n\t\t\t\t\t\t\t\t// Wrap the node\r\n\t\t\t\t\t\t\t\tcurrentWrapElm = wrapElm.cloneNode(FALSE);\r\n\t\t\t\t\t\t\t\tnode.parentNode.insertBefore(currentWrapElm, node);\r\n\t\t\t\t\t\t\t\tnewWrappers.push(currentWrapElm);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tcurrentWrapElm.appendChild(node);\r\n\t\t\t\t\t\t} else if (nodeName == 'li' && bookmark) {\r\n\t\t\t\t\t\t\t// Start wrapping - if we are in a list node and have a bookmark, then we will always begin by wrapping in a new element.\r\n\t\t\t\t\t\t\tcurrentWrapElm = applyStyleToList(node, bookmark, wrapElm, newWrappers, process);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Start a new wrapper for possible children\r\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\r\n\t\t\t\t\t\t\teach(tinymce.grep(node.childNodes), process);\r\n\r\n\t\t\t\t\t\t\t// End the last wrapper\r\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// Process siblings from range\r\n\t\t\t\t\teach(nodes, process);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Wrap links inside as well, for example color inside a link when the wrapper is around the link\r\n\t\t\t\tif (format.wrap_links === false) {\r\n\t\t\t\t\teach(newWrappers, function(node) {\r\n\t\t\t\t\t\tfunction process(node) {\r\n\t\t\t\t\t\t\tvar i, currentWrapElm, children;\r\n\r\n\t\t\t\t\t\t\tif (node.nodeName === 'A') {\r\n\t\t\t\t\t\t\t\tcurrentWrapElm = wrapElm.cloneNode(FALSE);\r\n\t\t\t\t\t\t\t\tnewWrappers.push(currentWrapElm);\r\n\r\n\t\t\t\t\t\t\t\tchildren = tinymce.grep(node.childNodes);\r\n\t\t\t\t\t\t\t\tfor (i = 0; i < children.length; i++)\r\n\t\t\t\t\t\t\t\t\tcurrentWrapElm.appendChild(children[i]);\r\n\r\n\t\t\t\t\t\t\t\tnode.appendChild(currentWrapElm);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\teach(tinymce.grep(node.childNodes), process);\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tprocess(node);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Cleanup\r\n\t\t\t\teach(newWrappers, function(node) {\r\n\t\t\t\t\tvar childCount;\r\n\r\n\t\t\t\t\tfunction getChildCount(node) {\r\n\t\t\t\t\t\tvar count = 0;\r\n\r\n\t\t\t\t\t\teach(node.childNodes, function(node) {\r\n\t\t\t\t\t\t\tif (!isWhiteSpaceNode(node) && !isBookmarkNode(node))\r\n\t\t\t\t\t\t\t\tcount++;\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\treturn count;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tfunction mergeStyles(node) {\r\n\t\t\t\t\t\tvar child, clone;\r\n\r\n\t\t\t\t\t\teach(node.childNodes, function(node) {\r\n\t\t\t\t\t\t\tif (node.nodeType == 1 && !isBookmarkNode(node) && !isCaretNode(node)) {\r\n\t\t\t\t\t\t\t\tchild = node;\r\n\t\t\t\t\t\t\t\treturn FALSE; // break loop\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// If child was found and of the same type as the current node\r\n\t\t\t\t\t\tif (child && matchName(child, format)) {\r\n\t\t\t\t\t\t\tclone = child.cloneNode(FALSE);\r\n\t\t\t\t\t\t\tsetElementFormat(clone);\r\n\r\n\t\t\t\t\t\t\tdom.replace(clone, node, TRUE);\r\n\t\t\t\t\t\t\tdom.remove(child, 1);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn clone || node;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tchildCount = getChildCount(node);\r\n\r\n\t\t\t\t\t// Remove empty nodes but only if there is multiple wrappers and they are not block\r\n\t\t\t\t\t// elements so never remove single <h1></h1> since that would remove the current empty block element where the caret is at\r\n\t\t\t\t\tif ((newWrappers.length > 1 || !isBlock(node)) && childCount === 0) {\r\n\t\t\t\t\t\tdom.remove(node, 1);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (format.inline || format.wrapper) {\r\n\t\t\t\t\t\t// Merges the current node with it's children of similar type to reduce the number of elements\r\n\t\t\t\t\t\tif (!format.exact && childCount === 1)\r\n\t\t\t\t\t\t\tnode = mergeStyles(node);\r\n\r\n\t\t\t\t\t\t// Remove/merge children\r\n\t\t\t\t\t\teach(formatList, function(format) {\r\n\t\t\t\t\t\t\t// Merge all children of similar type will move styles from child to parent\r\n\t\t\t\t\t\t\t// this: <span style=\"color:red\"><b><span style=\"color:red; font-size:10px\">text</span></b></span>\r\n\t\t\t\t\t\t\t// will become: <span style=\"color:red\"><b><span style=\"font-size:10px\">text</span></b></span>\r\n\t\t\t\t\t\t\teach(dom.select(format.inline, node), function(child) {\r\n\t\t\t\t\t\t\t\tvar parent;\r\n\r\n\t\t\t\t\t\t\t\t// When wrap_links is set to false we don't want\r\n\t\t\t\t\t\t\t\t// to remove the format on children within links\r\n\t\t\t\t\t\t\t\tif (format.wrap_links === false) {\r\n\t\t\t\t\t\t\t\t\tparent = child.parentNode;\r\n\r\n\t\t\t\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\t\t\t\tif (parent.nodeName === 'A')\r\n\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t} while (parent = parent.parentNode);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tremoveFormat(format, vars, child, format.exact ? child : null);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Remove child if direct parent is of same type\r\n\t\t\t\t\t\tif (matchNode(node.parentNode, name, vars)) {\r\n\t\t\t\t\t\t\tdom.remove(node, 1);\r\n\t\t\t\t\t\t\tnode = 0;\r\n\t\t\t\t\t\t\treturn TRUE;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Look for parent with similar style format\r\n\t\t\t\t\t\tif (format.merge_with_parents) {\r\n\t\t\t\t\t\t\tdom.getParent(node.parentNode, function(parent) {\r\n\t\t\t\t\t\t\t\tif (matchNode(parent, name, vars)) {\r\n\t\t\t\t\t\t\t\t\tdom.remove(node, 1);\r\n\t\t\t\t\t\t\t\t\tnode = 0;\r\n\t\t\t\t\t\t\t\t\treturn TRUE;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Merge next and previous siblings if they are similar <b>text</b><b>text</b> becomes <b>texttext</b>\r\n\t\t\t\t\t\tif (node && format.merge_siblings !== false) {\r\n\t\t\t\t\t\t\tnode = mergeSiblings(getNonWhiteSpaceSibling(node), node);\r\n\t\t\t\t\t\t\tnode = mergeSiblings(node, getNonWhiteSpaceSibling(node, TRUE));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tif (format) {\r\n\t\t\t\tif (node) {\r\n\t\t\t\t\tif (node.nodeType) {\r\n\t\t\t\t\t\trng = dom.createRng();\r\n\t\t\t\t\t\trng.setStartBefore(node);\r\n\t\t\t\t\t\trng.setEndAfter(node);\r\n\t\t\t\t\t\tapplyRngStyle(expandRng(rng, formatList), null, true);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapplyRngStyle(node, null, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!isCollapsed || !format.inline || dom.select('td.mceSelected,th.mceSelected').length) {\r\n\t\t\t\t\t\t// Obtain selection node before selection is unselected by applyRngStyle()\r\n\t\t\t\t\t\tvar curSelNode = ed.selection.getNode();\r\n\r\n\t\t\t\t\t\t// Apply formatting to selection\r\n\t\t\t\t\t\ted.selection.setRng(adjustSelectionToVisibleSelection());\r\n\t\t\t\t\t\tbookmark = selection.getBookmark();\r\n\t\t\t\t\t\tapplyRngStyle(expandRng(selection.getRng(TRUE), formatList), bookmark);\r\n\r\n\t\t\t\t\t\t// Colored nodes should be underlined so that the color of the underline matches the text color.\r\n\t\t\t\t\t\tif (format.styles && (format.styles.color || format.styles.textDecoration)) {\r\n\t\t\t\t\t\t\ttinymce.walk(curSelNode, processUnderlineAndColor, 'childNodes');\r\n\t\t\t\t\t\t\tprocessUnderlineAndColor(curSelNode);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tselection.moveToBookmark(bookmark);\r\n\t\t\t\t\t\tselection.setRng(moveStart(selection.getRng(TRUE)));\r\n\t\t\t\t\t\ted.nodeChanged();\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tperformCaretAction('apply', name, vars);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction remove(name, vars, node) {\r\n\t\t\tvar formatList = get(name), format = formatList[0], bookmark, i, rng;\r\n\t\t\tfunction moveStart(rng) {\r\n\t\t\t\tvar container = rng.startContainer,\r\n\t\t\t\t\toffset = rng.startOffset,\r\n\t\t\t\t\twalker, node, nodes, tmpNode;\r\n\r\n\t\t\t\t// Convert text node into index if possible\r\n\t\t\t\tif (container.nodeType == 3 && offset >= container.nodeValue.length - 1) {\r\n\t\t\t\t\tcontainer = container.parentNode;\r\n\t\t\t\t\toffset = nodeIndex(container) + 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move startContainer/startOffset in to a suitable node\r\n\t\t\t\tif (container.nodeType == 1) {\r\n\t\t\t\t\tnodes = container.childNodes;\r\n\t\t\t\t\tcontainer = nodes[Math.min(offset, nodes.length - 1)];\r\n\t\t\t\t\twalker = new TreeWalker(container);\r\n\r\n\t\t\t\t\t// If offset is at end of the parent node walk to the next one\r\n\t\t\t\t\tif (offset > nodes.length - 1)\r\n\t\t\t\t\t\twalker.next();\r\n\r\n\t\t\t\t\tfor (node = walker.current(); node; node = walker.next()) {\r\n\t\t\t\t\t\tif (node.nodeType == 3 && !isWhiteSpaceNode(node)) {\r\n\t\t\t\t\t\t\t// IE has a \"neat\" feature where it moves the start node into the closest element\r\n\t\t\t\t\t\t\t// we can avoid this by inserting an element before it and then remove it after we set the selection\r\n\t\t\t\t\t\t\ttmpNode = dom.create('a', null, INVISIBLE_CHAR);\r\n\t\t\t\t\t\t\tnode.parentNode.insertBefore(tmpNode, node);\r\n\r\n\t\t\t\t\t\t\t// Set selection and remove tmpNode\r\n\t\t\t\t\t\t\trng.setStart(node, 0);\r\n\t\t\t\t\t\t\tselection.setRng(rng);\r\n\t\t\t\t\t\t\tdom.remove(tmpNode);\r\n\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// Merges the styles for each node\r\n\t\t\tfunction process(node) {\r\n\t\t\t\tvar children, i, l;\r\n\r\n\t\t\t\t// Grab the children first since the nodelist might be changed\r\n\t\t\t\tchildren = tinymce.grep(node.childNodes);\r\n\r\n\t\t\t\t// Process current node\r\n\t\t\t\tfor (i = 0, l = formatList.length; i < l; i++) {\r\n\t\t\t\t\tif (removeFormat(formatList[i], vars, node, node))\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Process the children\r\n\t\t\t\tif (format.deep) {\r\n\t\t\t\t\tfor (i = 0, l = children.length; i < l; i++)\r\n\t\t\t\t\t\tprocess(children[i]);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tfunction findFormatRoot(container) {\r\n\t\t\t\tvar formatRoot;\r\n\r\n\t\t\t\t// Find format root\r\n\t\t\t\teach(getParents(container.parentNode).reverse(), function(parent) {\r\n\t\t\t\t\tvar format;\r\n\r\n\t\t\t\t\t// Find format root element\r\n\t\t\t\t\tif (!formatRoot && parent.id != '_start' && parent.id != '_end') {\r\n\t\t\t\t\t\t// Is the node matching the format we are looking for\r\n\t\t\t\t\t\tformat = matchNode(parent, name, vars);\r\n\t\t\t\t\t\tif (format && format.split !== false)\r\n\t\t\t\t\t\t\tformatRoot = parent;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn formatRoot;\r\n\t\t\t};\r\n\r\n\t\t\tfunction wrapAndSplit(format_root, container, target, split) {\r\n\t\t\t\tvar parent, clone, lastClone, firstClone, i, formatRootParent;\r\n\r\n\t\t\t\t// Format root found then clone formats and split it\r\n\t\t\t\tif (format_root) {\r\n\t\t\t\t\tformatRootParent = format_root.parentNode;\r\n\r\n\t\t\t\t\tfor (parent = container.parentNode; parent && parent != formatRootParent; parent = parent.parentNode) {\r\n\t\t\t\t\t\tclone = parent.cloneNode(FALSE);\r\n\r\n\t\t\t\t\t\tfor (i = 0; i < formatList.length; i++) {\r\n\t\t\t\t\t\t\tif (removeFormat(formatList[i], vars, clone, clone)) {\r\n\t\t\t\t\t\t\t\tclone = 0;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Build wrapper node\r\n\t\t\t\t\t\tif (clone) {\r\n\t\t\t\t\t\t\tif (lastClone)\r\n\t\t\t\t\t\t\t\tclone.appendChild(lastClone);\r\n\r\n\t\t\t\t\t\t\tif (!firstClone)\r\n\t\t\t\t\t\t\t\tfirstClone = clone;\r\n\r\n\t\t\t\t\t\t\tlastClone = clone;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Never split block elements if the format is mixed\r\n\t\t\t\t\tif (split && (!format.mixed || !isBlock(format_root)))\r\n\t\t\t\t\t\tcontainer = dom.split(format_root, container);\r\n\r\n\t\t\t\t\t// Wrap container in cloned formats\r\n\t\t\t\t\tif (lastClone) {\r\n\t\t\t\t\t\ttarget.parentNode.insertBefore(lastClone, target);\r\n\t\t\t\t\t\tfirstClone.appendChild(target);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn container;\r\n\t\t\t};\r\n\r\n\t\t\tfunction splitToFormatRoot(container) {\r\n\t\t\t\treturn wrapAndSplit(findFormatRoot(container), container, container, true);\r\n\t\t\t};\r\n\r\n\t\t\tfunction unwrap(start) {\r\n\t\t\t\tvar node = dom.get(start ? '_start' : '_end'),\r\n\t\t\t\t\tout = node[start ? 'firstChild' : 'lastChild'];\r\n\r\n\t\t\t\t// If the end is placed within the start the result will be removed\r\n\t\t\t\t// So this checks if the out node is a bookmark node if it is it\r\n\t\t\t\t// checks for another more suitable node\r\n\t\t\t\tif (isBookmarkNode(out))\r\n\t\t\t\t\tout = out[start ? 'firstChild' : 'lastChild'];\r\n\r\n\t\t\t\tdom.remove(node, true);\r\n\r\n\t\t\t\treturn out;\r\n\t\t\t};\r\n\r\n\t\t\tfunction removeRngStyle(rng) {\r\n\t\t\t\tvar startContainer, endContainer;\r\n\r\n\t\t\t\trng = expandRng(rng, formatList, TRUE);\r\n\r\n\t\t\t\tif (format.split) {\r\n\t\t\t\t\tstartContainer = getContainer(rng, TRUE);\r\n\t\t\t\t\tendContainer = getContainer(rng);\r\n\r\n\t\t\t\t\tif (startContainer != endContainer) {\r\n\t\t\t\t\t\t// Wrap start/end nodes in span element since these might be cloned/moved\r\n\t\t\t\t\t\tstartContainer = wrap(startContainer, 'span', {id : '_start', 'data-mce-type' : 'bookmark'});\r\n\t\t\t\t\t\tendContainer = wrap(endContainer, 'span', {id : '_end', 'data-mce-type' : 'bookmark'});\r\n\r\n\t\t\t\t\t\t// Split start/end\r\n\t\t\t\t\t\tsplitToFormatRoot(startContainer);\r\n\t\t\t\t\t\tsplitToFormatRoot(endContainer);\r\n\r\n\t\t\t\t\t\t// Unwrap start/end to get real elements again\r\n\t\t\t\t\t\tstartContainer = unwrap(TRUE);\r\n\t\t\t\t\t\tendContainer = unwrap();\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tstartContainer = endContainer = splitToFormatRoot(startContainer);\r\n\r\n\t\t\t\t\t// Update range positions since they might have changed after the split operations\r\n\t\t\t\t\trng.startContainer = startContainer.parentNode;\r\n\t\t\t\t\trng.startOffset = nodeIndex(startContainer);\r\n\t\t\t\t\trng.endContainer = endContainer.parentNode;\r\n\t\t\t\t\trng.endOffset = nodeIndex(endContainer) + 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove items between start/end\r\n\t\t\t\trangeUtils.walk(rng, function(nodes) {\r\n\t\t\t\t\teach(nodes, function(node) {\r\n\t\t\t\t\t\tprocess(node);\r\n\r\n\t\t\t\t\t\t// Remove parent span if it only contains text-decoration: underline, yet a parent node is also underlined.\r\n\t\t\t\t\t\tif (node.nodeType === 1 && ed.dom.getStyle(node, 'text-decoration') === 'underline' && node.parentNode && getTextDecoration(node.parentNode) === 'underline') {\r\n\t\t\t\t\t\t\tremoveFormat({'deep': false, 'exact': true, 'inline': 'span', 'styles': {'textDecoration' : 'underline'}}, null, node);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\t// Handle node\r\n\t\t\tif (node) {\r\n\t\t\t\tif (node.nodeType) {\r\n\t\t\t\t\trng = dom.createRng();\r\n\t\t\t\t\trng.setStartBefore(node);\r\n\t\t\t\t\trng.setEndAfter(node);\r\n\t\t\t\t\tremoveRngStyle(rng);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tremoveRngStyle(node);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!selection.isCollapsed() || !format.inline || dom.select('td.mceSelected,th.mceSelected').length) {\r\n\t\t\t\tbookmark = selection.getBookmark();\r\n\t\t\t\tremoveRngStyle(selection.getRng(TRUE));\r\n\t\t\t\tselection.moveToBookmark(bookmark);\r\n\r\n\t\t\t\t// Check if start element still has formatting then we are at: \"<b>text|</b>text\" and need to move the start into the next text node\r\n\t\t\t\tif (format.inline && match(name, vars, selection.getStart())) {\r\n\t\t\t\t\tmoveStart(selection.getRng(true));\r\n\t\t\t\t}\r\n\r\n\t\t\t\ted.nodeChanged();\r\n\t\t\t} else\r\n\t\t\t\tperformCaretAction('remove', name, vars);\r\n\r\n\t\t\t// When you remove formatting from a table cell in WebKit (cell, not the contents of a cell) there is a rendering issue with column width\r\n\t\t\tif (tinymce.isWebKit) {\r\n\t\t\t\ted.execCommand('mceCleanup');\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction toggle(name, vars, node) {\r\n\t\t\tvar fmt = get(name);\r\n\r\n\t\t\tif (match(name, vars, node) && (!('toggle' in fmt[0]) || fmt[0]['toggle']))\r\n\t\t\t\tremove(name, vars, node);\r\n\t\t\telse\r\n\t\t\t\tapply(name, vars, node);\r\n\t\t};\r\n\r\n\t\tfunction matchNode(node, name, vars, similar) {\r\n\t\t\tvar formatList = get(name), format, i, classes;\r\n\r\n\t\t\tfunction matchItems(node, format, item_name) {\r\n\t\t\t\tvar key, value, items = format[item_name], i;\r\n\r\n\t\t\t\t// Custom match\r\n\t\t\t\tif (format.onmatch) {\r\n\t\t\t\t\treturn format.onmatch(node, format, item_name);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check all items\r\n\t\t\t\tif (items) {\r\n\t\t\t\t\t// Non indexed object\r\n\t\t\t\t\tif (items.length === undefined) {\r\n\t\t\t\t\t\tfor (key in items) {\r\n\t\t\t\t\t\t\tif (items.hasOwnProperty(key)) {\r\n\t\t\t\t\t\t\t\tif (item_name === 'attributes')\r\n\t\t\t\t\t\t\t\t\tvalue = dom.getAttrib(node, key);\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tvalue = getStyle(node, key);\r\n\r\n\t\t\t\t\t\t\t\tif (similar && !value && !format.exact)\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\tif ((!similar || format.exact) && !isEq(value, replaceVars(items[key], vars)))\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Only one match needed for indexed arrays\r\n\t\t\t\t\t\tfor (i = 0; i < items.length; i++) {\r\n\t\t\t\t\t\t\tif (item_name === 'attributes' ? dom.getAttrib(node, items[i]) : getStyle(node, items[i]))\r\n\t\t\t\t\t\t\t\treturn format;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn format;\r\n\t\t\t};\r\n\r\n\t\t\tif (formatList && node) {\r\n\t\t\t\t// Check each format in list\r\n\t\t\t\tfor (i = 0; i < formatList.length; i++) {\r\n\t\t\t\t\tformat = formatList[i];\r\n\r\n\t\t\t\t\t// Name name, attributes, styles and classes\r\n\t\t\t\t\tif (matchName(node, format) && matchItems(node, format, 'attributes') && matchItems(node, format, 'styles')) {\r\n\t\t\t\t\t\t// Match classes\r\n\t\t\t\t\t\tif (classes = format.classes) {\r\n\t\t\t\t\t\t\tfor (i = 0; i < classes.length; i++) {\r\n\t\t\t\t\t\t\t\tif (!dom.hasClass(node, classes[i]))\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn format;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction match(name, vars, node) {\r\n\t\t\tvar startNode;\r\n\r\n\t\t\tfunction matchParents(node) {\r\n\t\t\t\t// Find first node with similar format settings\r\n\t\t\t\tnode = dom.getParent(node, function(node) {\r\n\t\t\t\t\treturn !!matchNode(node, name, vars, true);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Do an exact check on the similar format element\r\n\t\t\t\treturn matchNode(node, name, vars);\r\n\t\t\t};\r\n\r\n\t\t\t// Check specified node\r\n\t\t\tif (node)\r\n\t\t\t\treturn matchParents(node);\r\n\r\n\t\t\t// Check selected node\r\n\t\t\tnode = selection.getNode();\r\n\t\t\tif (matchParents(node))\r\n\t\t\t\treturn TRUE;\r\n\r\n\t\t\t// Check start node if it's different\r\n\t\t\tstartNode = selection.getStart();\r\n\t\t\tif (startNode != node) {\r\n\t\t\t\tif (matchParents(startNode))\r\n\t\t\t\t\treturn TRUE;\r\n\t\t\t}\r\n\r\n\t\t\treturn FALSE;\r\n\t\t};\r\n\r\n\t\tfunction matchAll(names, vars) {\r\n\t\t\tvar startElement, matchedFormatNames = [], checkedMap = {}, i, ni, name;\r\n\r\n\t\t\t// Check start of selection for formats\r\n\t\t\tstartElement = selection.getStart();\r\n\t\t\tdom.getParent(startElement, function(node) {\r\n\t\t\t\tvar i, name;\r\n\r\n\t\t\t\tfor (i = 0; i < names.length; i++) {\r\n\t\t\t\t\tname = names[i];\r\n\r\n\t\t\t\t\tif (!checkedMap[name] && matchNode(node, name, vars)) {\r\n\t\t\t\t\t\tcheckedMap[name] = true;\r\n\t\t\t\t\t\tmatchedFormatNames.push(name);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn matchedFormatNames;\r\n\t\t};\r\n\r\n\t\tfunction canApply(name) {\r\n\t\t\tvar formatList = get(name), startNode, parents, i, x, selector;\r\n\r\n\t\t\tif (formatList) {\r\n\t\t\t\tstartNode = selection.getStart();\r\n\t\t\t\tparents = getParents(startNode);\r\n\r\n\t\t\t\tfor (x = formatList.length - 1; x >= 0; x--) {\r\n\t\t\t\t\tselector = formatList[x].selector;\r\n\r\n\t\t\t\t\t// Format is not selector based, then always return TRUE\r\n\t\t\t\t\tif (!selector)\r\n\t\t\t\t\t\treturn TRUE;\r\n\r\n\t\t\t\t\tfor (i = parents.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\tif (dom.is(parents[i], selector))\r\n\t\t\t\t\t\t\treturn TRUE;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn FALSE;\r\n\t\t};\r\n\r\n\t\t// Expose to public\r\n\t\ttinymce.extend(this, {\r\n\t\t\tget : get,\r\n\t\t\tregister : register,\r\n\t\t\tapply : apply,\r\n\t\t\tremove : remove,\r\n\t\t\ttoggle : toggle,\r\n\t\t\tmatch : match,\r\n\t\t\tmatchAll : matchAll,\r\n\t\t\tmatchNode : matchNode,\r\n\t\t\tcanApply : canApply\r\n\t\t});\r\n\r\n\t\t// Private functions\r\n\r\n\t\tfunction matchName(node, format) {\r\n\t\t\t// Check for inline match\r\n\t\t\tif (isEq(node, format.inline))\r\n\t\t\t\treturn TRUE;\r\n\r\n\t\t\t// Check for block match\r\n\t\t\tif (isEq(node, format.block))\r\n\t\t\t\treturn TRUE;\r\n\r\n\t\t\t// Check for selector match\r\n\t\t\tif (format.selector)\r\n\t\t\t\treturn dom.is(node, format.selector);\r\n\t\t};\r\n\r\n\t\tfunction isEq(str1, str2) {\r\n\t\t\tstr1 = str1 || '';\r\n\t\t\tstr2 = str2 || '';\r\n\r\n\t\t\tstr1 = '' + (str1.nodeName || str1);\r\n\t\t\tstr2 = '' + (str2.nodeName || str2);\r\n\r\n\t\t\treturn str1.toLowerCase() == str2.toLowerCase();\r\n\t\t};\r\n\r\n\t\tfunction getStyle(node, name) {\r\n\t\t\tvar styleVal = dom.getStyle(node, name);\r\n\r\n\t\t\t// Force the format to hex\r\n\t\t\tif (name == 'color' || name == 'backgroundColor')\r\n\t\t\t\tstyleVal = dom.toHex(styleVal);\r\n\r\n\t\t\t// Opera will return bold as 700\r\n\t\t\tif (name == 'fontWeight' && styleVal == 700)\r\n\t\t\t\tstyleVal = 'bold';\r\n\r\n\t\t\treturn '' + styleVal;\r\n\t\t};\r\n\r\n\t\tfunction replaceVars(value, vars) {\r\n\t\t\tif (typeof(value) != \"string\")\r\n\t\t\t\tvalue = value(vars);\r\n\t\t\telse if (vars) {\r\n\t\t\t\tvalue = value.replace(/%(\\w+)/g, function(str, name) {\r\n\t\t\t\t\treturn vars[name] || str;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn value;\r\n\t\t};\r\n\r\n\t\tfunction isWhiteSpaceNode(node) {\r\n\t\t\treturn node && node.nodeType === 3 && /^([\\t \\r\\n]+|)$/.test(node.nodeValue);\r\n\t\t};\r\n\r\n\t\tfunction wrap(node, name, attrs) {\r\n\t\t\tvar wrapper = dom.create(name, attrs);\r\n\r\n\t\t\tnode.parentNode.insertBefore(wrapper, node);\r\n\t\t\twrapper.appendChild(node);\r\n\r\n\t\t\treturn wrapper;\r\n\t\t};\r\n\r\n\t\tfunction expandRng(rng, format, remove) {\r\n\t\t\tvar startContainer = rng.startContainer,\r\n\t\t\t\tstartOffset = rng.startOffset,\r\n\t\t\t\tendContainer = rng.endContainer,\r\n\t\t\t\tendOffset = rng.endOffset, sibling, lastIdx, leaf, endPoint;\r\n\r\n\t\t\t// This function walks up the tree if there is no siblings before/after the node\r\n\t\t\tfunction findParentContainer(start) {\r\n\t\t\t\tvar container, parent, child, sibling, siblingName;\r\n\r\n\t\t\t\tcontainer = parent = start ? startContainer : endContainer;\r\n\t\t\t\tsiblingName = start ? 'previousSibling' : 'nextSibling';\r\n\t\t\t\troot = dom.getRoot();\r\n\r\n\t\t\t\t// If it's a text node and the offset is inside the text\r\n\t\t\t\tif (container.nodeType == 3 && !isWhiteSpaceNode(container)) {\r\n\t\t\t\t\tif (start ? startOffset > 0 : endOffset < container.nodeValue.length) {\r\n\t\t\t\t\t\treturn container;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (;;) {\r\n\t\t\t\t\t// Stop expanding on block elements or root depending on format\r\n\t\t\t\t\tif (parent == root || (!format[0].block_expand && isBlock(parent)))\r\n\t\t\t\t\t\treturn parent;\r\n\r\n\t\t\t\t\t// Walk left/right\r\n\t\t\t\t\tfor (sibling = parent[siblingName]; sibling; sibling = sibling[siblingName]) {\r\n\t\t\t\t\t\tif (!isBookmarkNode(sibling) && !isWhiteSpaceNode(sibling)) {\r\n\t\t\t\t\t\t\treturn parent;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if we can move up are we at root level or body level\r\n\t\t\t\t\tparent = parent.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn container;\r\n\t\t\t};\r\n\r\n\t\t\t// This function walks down the tree to find the leaf at the selection.\r\n\t\t\t// The offset is also returned as if node initially a leaf, the offset may be in the middle of the text node.\r\n\t\t\tfunction findLeaf(node, offset) {\r\n\t\t\t\tif (offset === undefined)\r\n\t\t\t\t\toffset = node.nodeType === 3 ? node.length : node.childNodes.length;\r\n\t\t\t\twhile (node && node.hasChildNodes()) {\r\n\t\t\t\t\tnode = node.childNodes[offset];\r\n\t\t\t\t\tif (node)\r\n\t\t\t\t\t\toffset = node.nodeType === 3 ? node.length : node.childNodes.length;\r\n\t\t\t\t}\r\n\t\t\t\treturn { node: node, offset: offset };\r\n\t\t\t}\r\n\r\n\t\t\t// If index based start position then resolve it\r\n\t\t\tif (startContainer.nodeType == 1 && startContainer.hasChildNodes()) {\r\n\t\t\t\tlastIdx = startContainer.childNodes.length - 1;\r\n\t\t\t\tstartContainer = startContainer.childNodes[startOffset > lastIdx ? lastIdx : startOffset];\r\n\r\n\t\t\t\tif (startContainer.nodeType == 3)\r\n\t\t\t\t\tstartOffset = 0;\r\n\t\t\t}\r\n\r\n\t\t\t// If index based end position then resolve it\r\n\t\t\tif (endContainer.nodeType == 1 && endContainer.hasChildNodes()) {\r\n\t\t\t\tlastIdx = endContainer.childNodes.length - 1;\r\n\t\t\t\tendContainer = endContainer.childNodes[endOffset > lastIdx ? lastIdx : endOffset - 1];\r\n\r\n\t\t\t\tif (endContainer.nodeType == 3)\r\n\t\t\t\t\tendOffset = endContainer.nodeValue.length;\r\n\t\t\t}\r\n\r\n\t\t\t// Exclude bookmark nodes if possible\r\n\t\t\tif (isBookmarkNode(startContainer.parentNode) || isBookmarkNode(startContainer)) {\r\n\t\t\t\tstartContainer = isBookmarkNode(startContainer) ? startContainer : startContainer.parentNode;\r\n\t\t\t\tstartContainer = startContainer.nextSibling || startContainer;\r\n\r\n\t\t\t\tif (startContainer.nodeType == 3)\r\n\t\t\t\t\tstartOffset = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (isBookmarkNode(endContainer.parentNode) || isBookmarkNode(endContainer)) {\r\n\t\t\t\tendContainer = isBookmarkNode(endContainer) ? endContainer : endContainer.parentNode;\r\n\t\t\t\tendContainer = endContainer.previousSibling || endContainer;\r\n\r\n\t\t\t\tif (endContainer.nodeType == 3)\r\n\t\t\t\t\tendOffset = endContainer.length;\r\n\t\t\t}\r\n\r\n\t\t\tif (format[0].inline) {\r\n\t\t\t\tif (rng.collapsed) {\r\n\t\t\t\t\tfunction findWordEndPoint(container, offset, start) {\r\n\t\t\t\t\t\tvar walker, node, pos, lastTextNode;\r\n\r\n\t\t\t\t\t\tfunction findSpace(node, offset) {\r\n\t\t\t\t\t\t\tvar pos, pos2, str = node.nodeValue;\r\n\r\n\t\t\t\t\t\t\tif (typeof(offset) == \"undefined\") {\r\n\t\t\t\t\t\t\t\toffset = start ? str.length : 0;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (start) {\r\n\t\t\t\t\t\t\t\tpos = str.lastIndexOf(' ', offset);\r\n\t\t\t\t\t\t\t\tpos2 = str.lastIndexOf('\\u00a0', offset);\r\n\t\t\t\t\t\t\t\tpos = pos > pos2 ? pos : pos2;\r\n\r\n\t\t\t\t\t\t\t\t// Include the space on remove to avoid tag soup\r\n\t\t\t\t\t\t\t\tif (pos !== -1 && !remove) {\r\n\t\t\t\t\t\t\t\t\tpos++;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tpos = str.indexOf(' ', offset);\r\n\t\t\t\t\t\t\t\tpos2 = str.indexOf('\\u00a0', offset);\r\n\t\t\t\t\t\t\t\tpos = pos !== -1 && (pos2 === -1 || pos < pos2) ? pos : pos2;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn pos;\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tif (container.nodeType === 3) {\r\n\t\t\t\t\t\t\tpos = findSpace(container, offset);\r\n\r\n\t\t\t\t\t\t\tif (pos !== -1) {\r\n\t\t\t\t\t\t\t\treturn {container : container, offset : pos};\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlastTextNode = container;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Walk the nodes inside the block\r\n\t\t\t\t\t\twalker = new TreeWalker(container, dom.getParent(container, isBlock) || ed.getBody());\r\n\t\t\t\t\t\twhile (node = walker[start ? 'prev' : 'next']()) {\r\n\t\t\t\t\t\t\tif (node.nodeType === 3) {\r\n\t\t\t\t\t\t\t\tlastTextNode = node;\r\n\t\t\t\t\t\t\t\tpos = findSpace(node);\r\n\r\n\t\t\t\t\t\t\t\tif (pos !== -1) {\r\n\t\t\t\t\t\t\t\t\treturn {container : node, offset : pos};\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (isBlock(node)) {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (lastTextNode) {\r\n\t\t\t\t\t\t\tif (start) {\r\n\t\t\t\t\t\t\t\toffset = 0;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\toffset = lastTextNode.length;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn {container: lastTextNode, offset: offset};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Expand left to closest word boundery\r\n\t\t\t\t\tendPoint = findWordEndPoint(startContainer, startOffset, true);\r\n\t\t\t\t\tif (endPoint) {\r\n\t\t\t\t\t\tstartContainer = endPoint.container;\r\n\t\t\t\t\t\tstartOffset = endPoint.offset;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Expand right to closest word boundery\r\n\t\t\t\t\tendPoint = findWordEndPoint(endContainer, endOffset);\r\n\t\t\t\t\tif (endPoint) {\r\n\t\t\t\t\t\tendContainer = endPoint.container;\r\n\t\t\t\t\t\tendOffset = endPoint.offset;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Avoid applying formatting to a trailing space.\r\n\t\t\t\tleaf = findLeaf(endContainer, endOffset);\r\n\t\t\t\tif (leaf.node) {\r\n\t\t\t\t\twhile (leaf.node && leaf.offset === 0 && leaf.node.previousSibling)\r\n\t\t\t\t\t\tleaf = findLeaf(leaf.node.previousSibling);\r\n\r\n\t\t\t\t\tif (leaf.node && leaf.offset > 0 && leaf.node.nodeType === 3 &&\r\n\t\t\t\t\t\t\tleaf.node.nodeValue.charAt(leaf.offset - 1) === ' ') {\r\n\r\n\t\t\t\t\t\tif (leaf.offset > 1) {\r\n\t\t\t\t\t\t\tendContainer = leaf.node;\r\n\t\t\t\t\t\t\tendContainer.splitText(leaf.offset - 1);\r\n\t\t\t\t\t\t} else if (leaf.node.previousSibling) {\r\n\t\t\t\t\t\t\t// TODO: Figure out why this is in here\r\n\t\t\t\t\t\t\t//endContainer = leaf.node.previousSibling;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Move start/end point up the tree if the leaves are sharp and if we are in different containers\r\n\t\t\t// Example * becomes !: !<p><b><i>*text</i><i>text*</i></b></p>!\r\n\t\t\t// This will reduce the number of wrapper elements that needs to be created\r\n\t\t\t// Move start point up the tree\r\n\t\t\tif (format[0].inline || format[0].block_expand) {\r\n\t\t\t\tif (!format[0].inline || (startContainer.nodeType != 3 || startOffset === 0)) {\r\n\t\t\t\t\tstartContainer = findParentContainer(true);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!format[0].inline || (endContainer.nodeType != 3 || endOffset === endContainer.nodeValue.length)) {\r\n\t\t\t\t\tendContainer = findParentContainer();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Expand start/end container to matching selector\r\n\t\t\tif (format[0].selector && format[0].expand !== FALSE && !format[0].inline) {\r\n\t\t\t\tfunction findSelectorEndPoint(container, sibling_name) {\r\n\t\t\t\t\tvar parents, i, y, curFormat;\r\n\r\n\t\t\t\t\tif (container.nodeType == 3 && container.nodeValue.length == 0 && container[sibling_name])\r\n\t\t\t\t\t\tcontainer = container[sibling_name];\r\n\r\n\t\t\t\t\tparents = getParents(container);\r\n\t\t\t\t\tfor (i = 0; i < parents.length; i++) {\r\n\t\t\t\t\t\tfor (y = 0; y < format.length; y++) {\r\n\t\t\t\t\t\t\tcurFormat = format[y];\r\n\r\n\t\t\t\t\t\t\t// If collapsed state is set then skip formats that doesn't match that\r\n\t\t\t\t\t\t\tif (\"collapsed\" in curFormat && curFormat.collapsed !== rng.collapsed)\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\t\tif (dom.is(parents[i], curFormat.selector))\r\n\t\t\t\t\t\t\t\treturn parents[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn container;\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Find new startContainer/endContainer if there is better one\r\n\t\t\t\tstartContainer = findSelectorEndPoint(startContainer, 'previousSibling');\r\n\t\t\t\tendContainer = findSelectorEndPoint(endContainer, 'nextSibling');\r\n\t\t\t}\r\n\r\n\t\t\t// Expand start/end container to matching block element or text node\r\n\t\t\tif (format[0].block || format[0].selector) {\r\n\t\t\t\tfunction findBlockEndPoint(container, sibling_name, sibling_name2) {\r\n\t\t\t\t\tvar node;\r\n\r\n\t\t\t\t\t// Expand to block of similar type\r\n\t\t\t\t\tif (!format[0].wrapper)\r\n\t\t\t\t\t\tnode = dom.getParent(container, format[0].block);\r\n\r\n\t\t\t\t\t// Expand to first wrappable block element or any block element\r\n\t\t\t\t\tif (!node)\r\n\t\t\t\t\t\tnode = dom.getParent(container.nodeType == 3 ? container.parentNode : container, isBlock);\r\n\r\n\t\t\t\t\t// Exclude inner lists from wrapping\r\n\t\t\t\t\tif (node && format[0].wrapper)\r\n\t\t\t\t\t\tnode = getParents(node, 'ul,ol').reverse()[0] || node;\r\n\r\n\t\t\t\t\t// Didn't find a block element look for first/last wrappable element\r\n\t\t\t\t\tif (!node) {\r\n\t\t\t\t\t\tnode = container;\r\n\r\n\t\t\t\t\t\twhile (node[sibling_name] && !isBlock(node[sibling_name])) {\r\n\t\t\t\t\t\t\tnode = node[sibling_name];\r\n\r\n\t\t\t\t\t\t\t// Break on BR but include it will be removed later on\r\n\t\t\t\t\t\t\t// we can't remove it now since we need to check if it can be wrapped\r\n\t\t\t\t\t\t\tif (isEq(node, 'br'))\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn node || container;\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Find new startContainer/endContainer if there is better one\r\n\t\t\t\tstartContainer = findBlockEndPoint(startContainer, 'previousSibling');\r\n\t\t\t\tendContainer = findBlockEndPoint(endContainer, 'nextSibling');\r\n\r\n\t\t\t\t// Non block element then try to expand up the leaf\r\n\t\t\t\tif (format[0].block) {\r\n\t\t\t\t\tif (!isBlock(startContainer))\r\n\t\t\t\t\t\tstartContainer = findParentContainer(true);\r\n\r\n\t\t\t\t\tif (!isBlock(endContainer))\r\n\t\t\t\t\t\tendContainer = findParentContainer();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Setup index for startContainer\r\n\t\t\tif (startContainer.nodeType == 1) {\r\n\t\t\t\tstartOffset = nodeIndex(startContainer);\r\n\t\t\t\tstartContainer = startContainer.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\t// Setup index for endContainer\r\n\t\t\tif (endContainer.nodeType == 1) {\r\n\t\t\t\tendOffset = nodeIndex(endContainer) + 1;\r\n\t\t\t\tendContainer = endContainer.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\t// Return new range like object\r\n\t\t\treturn {\r\n\t\t\t\tstartContainer : startContainer,\r\n\t\t\t\tstartOffset : startOffset,\r\n\t\t\t\tendContainer : endContainer,\r\n\t\t\t\tendOffset : endOffset\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction removeFormat(format, vars, node, compare_node) {\r\n\t\t\tvar i, attrs, stylesModified;\r\n\r\n\t\t\t// Check if node matches format\r\n\t\t\tif (!matchName(node, format))\r\n\t\t\t\treturn FALSE;\r\n\r\n\t\t\t// Should we compare with format attribs and styles\r\n\t\t\tif (format.remove != 'all') {\r\n\t\t\t\t// Remove styles\r\n\t\t\t\teach(format.styles, function(value, name) {\r\n\t\t\t\t\tvalue = replaceVars(value, vars);\r\n\r\n\t\t\t\t\t// Indexed array\r\n\t\t\t\t\tif (typeof(name) === 'number') {\r\n\t\t\t\t\t\tname = value;\r\n\t\t\t\t\t\tcompare_node = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!compare_node || isEq(getStyle(compare_node, name), value))\r\n\t\t\t\t\t\tdom.setStyle(node, name, '');\r\n\r\n\t\t\t\t\tstylesModified = 1;\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Remove style attribute if it's empty\r\n\t\t\t\tif (stylesModified && dom.getAttrib(node, 'style') == '') {\r\n\t\t\t\t\tnode.removeAttribute('style');\r\n\t\t\t\t\tnode.removeAttribute('data-mce-style');\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove attributes\r\n\t\t\t\teach(format.attributes, function(value, name) {\r\n\t\t\t\t\tvar valueOut;\r\n\r\n\t\t\t\t\tvalue = replaceVars(value, vars);\r\n\r\n\t\t\t\t\t// Indexed array\r\n\t\t\t\t\tif (typeof(name) === 'number') {\r\n\t\t\t\t\t\tname = value;\r\n\t\t\t\t\t\tcompare_node = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!compare_node || isEq(dom.getAttrib(compare_node, name), value)) {\r\n\t\t\t\t\t\t// Keep internal classes\r\n\t\t\t\t\t\tif (name == 'class') {\r\n\t\t\t\t\t\t\tvalue = dom.getAttrib(node, name);\r\n\t\t\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\t\t\t// Build new class value where everything is removed except the internal prefixed classes\r\n\t\t\t\t\t\t\t\tvalueOut = '';\r\n\t\t\t\t\t\t\t\teach(value.split(/\\s+/), function(cls) {\r\n\t\t\t\t\t\t\t\t\tif (/mce\\w+/.test(cls))\r\n\t\t\t\t\t\t\t\t\t\tvalueOut += (valueOut ? ' ' : '') + cls;\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t// We got some internal classes left\r\n\t\t\t\t\t\t\t\tif (valueOut) {\r\n\t\t\t\t\t\t\t\t\tdom.setAttrib(node, name, valueOut);\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// IE6 has a bug where the attribute doesn't get removed correctly\r\n\t\t\t\t\t\tif (name == \"class\")\r\n\t\t\t\t\t\t\tnode.removeAttribute('className');\r\n\r\n\t\t\t\t\t\t// Remove mce prefixed attributes\r\n\t\t\t\t\t\tif (MCE_ATTR_RE.test(name))\r\n\t\t\t\t\t\t\tnode.removeAttribute('data-mce-' + name);\r\n\r\n\t\t\t\t\t\tnode.removeAttribute(name);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Remove classes\r\n\t\t\t\teach(format.classes, function(value) {\r\n\t\t\t\t\tvalue = replaceVars(value, vars);\r\n\r\n\t\t\t\t\tif (!compare_node || dom.hasClass(compare_node, value))\r\n\t\t\t\t\t\tdom.removeClass(node, value);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Check for non internal attributes\r\n\t\t\t\tattrs = dom.getAttribs(node);\r\n\t\t\t\tfor (i = 0; i < attrs.length; i++) {\r\n\t\t\t\t\tif (attrs[i].nodeName.indexOf('_') !== 0)\r\n\t\t\t\t\t\treturn FALSE;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remove the inline child if it's empty for example <b> or <span>\r\n\t\t\tif (format.remove != 'none') {\r\n\t\t\t\tremoveNode(node, format);\r\n\t\t\t\treturn TRUE;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction removeNode(node, format) {\r\n\t\t\tvar parentNode = node.parentNode, rootBlockElm;\r\n\r\n\t\t\tif (format.block) {\r\n\t\t\t\tif (!forcedRootBlock) {\r\n\t\t\t\t\tfunction find(node, next, inc) {\r\n\t\t\t\t\t\tnode = getNonWhiteSpaceSibling(node, next, inc);\r\n\r\n\t\t\t\t\t\treturn !node || (node.nodeName == 'BR' || isBlock(node));\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// Append BR elements if needed before we remove the block\r\n\t\t\t\t\tif (isBlock(node) && !isBlock(parentNode)) {\r\n\t\t\t\t\t\tif (!find(node, FALSE) && !find(node.firstChild, TRUE, 1))\r\n\t\t\t\t\t\t\tnode.insertBefore(dom.create('br'), node.firstChild);\r\n\r\n\t\t\t\t\t\tif (!find(node, TRUE) && !find(node.lastChild, FALSE, 1))\r\n\t\t\t\t\t\t\tnode.appendChild(dom.create('br'));\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Wrap the block in a forcedRootBlock if we are at the root of document\r\n\t\t\t\t\tif (parentNode == dom.getRoot()) {\r\n\t\t\t\t\t\tif (!format.list_block || !isEq(node, format.list_block)) {\r\n\t\t\t\t\t\t\teach(tinymce.grep(node.childNodes), function(node) {\r\n\t\t\t\t\t\t\t\tif (isValid(forcedRootBlock, node.nodeName.toLowerCase())) {\r\n\t\t\t\t\t\t\t\t\tif (!rootBlockElm)\r\n\t\t\t\t\t\t\t\t\t\trootBlockElm = wrap(node, forcedRootBlock);\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\trootBlockElm.appendChild(node);\r\n\t\t\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\t\t\trootBlockElm = 0;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Never remove nodes that isn't the specified inline element if a selector is specified too\r\n\t\t\tif (format.selector && format.inline && !isEq(format.inline, node))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tdom.remove(node, 1);\r\n\t\t};\r\n\r\n\t\tfunction getNonWhiteSpaceSibling(node, next, inc) {\r\n\t\t\tif (node) {\r\n\t\t\t\tnext = next ? 'nextSibling' : 'previousSibling';\r\n\r\n\t\t\t\tfor (node = inc ? node : node[next]; node; node = node[next]) {\r\n\t\t\t\t\tif (node.nodeType == 1 || !isWhiteSpaceNode(node))\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction isBookmarkNode(node) {\r\n\t\t\treturn node && node.nodeType == 1 && node.getAttribute('data-mce-type') == 'bookmark';\r\n\t\t};\r\n\r\n\t\tfunction mergeSiblings(prev, next) {\r\n\t\t\tvar marker, sibling, tmpSibling;\r\n\r\n\t\t\tfunction compareElements(node1, node2) {\r\n\t\t\t\t// Not the same name\r\n\t\t\t\tif (node1.nodeName != node2.nodeName)\r\n\t\t\t\t\treturn FALSE;\r\n\r\n\t\t\t\tfunction getAttribs(node) {\r\n\t\t\t\t\tvar attribs = {};\r\n\r\n\t\t\t\t\teach(dom.getAttribs(node), function(attr) {\r\n\t\t\t\t\t\tvar name = attr.nodeName.toLowerCase();\r\n\r\n\t\t\t\t\t\t// Don't compare internal attributes or style\r\n\t\t\t\t\t\tif (name.indexOf('_') !== 0 && name !== 'style')\r\n\t\t\t\t\t\t\tattribs[name] = dom.getAttrib(node, name);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn attribs;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tfunction compareObjects(obj1, obj2) {\r\n\t\t\t\t\tvar value, name;\r\n\r\n\t\t\t\t\tfor (name in obj1) {\r\n\t\t\t\t\t\t// Obj1 has item obj2 doesn't have\r\n\t\t\t\t\t\tif (obj1.hasOwnProperty(name)) {\r\n\t\t\t\t\t\t\tvalue = obj2[name];\r\n\r\n\t\t\t\t\t\t\t// Obj2 doesn't have obj1 item\r\n\t\t\t\t\t\t\tif (value === undefined)\r\n\t\t\t\t\t\t\t\treturn FALSE;\r\n\r\n\t\t\t\t\t\t\t// Obj2 item has a different value\r\n\t\t\t\t\t\t\tif (obj1[name] != value)\r\n\t\t\t\t\t\t\t\treturn FALSE;\r\n\r\n\t\t\t\t\t\t\t// Delete similar value\r\n\t\t\t\t\t\t\tdelete obj2[name];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if obj 2 has something obj 1 doesn't have\r\n\t\t\t\t\tfor (name in obj2) {\r\n\t\t\t\t\t\t// Obj2 has item obj1 doesn't have\r\n\t\t\t\t\t\tif (obj2.hasOwnProperty(name))\r\n\t\t\t\t\t\t\treturn FALSE;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn TRUE;\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Attribs are not the same\r\n\t\t\t\tif (!compareObjects(getAttribs(node1), getAttribs(node2)))\r\n\t\t\t\t\treturn FALSE;\r\n\r\n\t\t\t\t// Styles are not the same\r\n\t\t\t\tif (!compareObjects(dom.parseStyle(dom.getAttrib(node1, 'style')), dom.parseStyle(dom.getAttrib(node2, 'style'))))\r\n\t\t\t\t\treturn FALSE;\r\n\r\n\t\t\t\treturn TRUE;\r\n\t\t\t};\r\n\r\n\t\t\t// Check if next/prev exists and that they are elements\r\n\t\t\tif (prev && next) {\r\n\t\t\t\tfunction findElementSibling(node, sibling_name) {\r\n\t\t\t\t\tfor (sibling = node; sibling; sibling = sibling[sibling_name]) {\r\n\t\t\t\t\t\tif (sibling.nodeType == 3 && sibling.nodeValue.length !== 0)\r\n\t\t\t\t\t\t\treturn node;\r\n\r\n\t\t\t\t\t\tif (sibling.nodeType == 1 && !isBookmarkNode(sibling))\r\n\t\t\t\t\t\t\treturn sibling;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn node;\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// If previous sibling is empty then jump over it\r\n\t\t\t\tprev = findElementSibling(prev, 'previousSibling');\r\n\t\t\t\tnext = findElementSibling(next, 'nextSibling');\r\n\r\n\t\t\t\t// Compare next and previous nodes\r\n\t\t\t\tif (compareElements(prev, next)) {\r\n\t\t\t\t\t// Append nodes between\r\n\t\t\t\t\tfor (sibling = prev.nextSibling; sibling && sibling != next;) {\r\n\t\t\t\t\t\ttmpSibling = sibling;\r\n\t\t\t\t\t\tsibling = sibling.nextSibling;\r\n\t\t\t\t\t\tprev.appendChild(tmpSibling);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Remove next node\r\n\t\t\t\t\tdom.remove(next);\r\n\r\n\t\t\t\t\t// Move children into prev node\r\n\t\t\t\t\teach(tinymce.grep(next.childNodes), function(node) {\r\n\t\t\t\t\t\tprev.appendChild(node);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn prev;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn next;\r\n\t\t};\r\n\r\n\t\tfunction isTextBlock(name) {\r\n\t\t\treturn /^(h[1-6]|p|div|pre|address|dl|dt|dd)$/.test(name);\r\n\t\t};\r\n\r\n\t\tfunction getContainer(rng, start) {\r\n\t\t\tvar container, offset, lastIdx, walker;\r\n\r\n\t\t\tcontainer = rng[start ? 'startContainer' : 'endContainer'];\r\n\t\t\toffset = rng[start ? 'startOffset' : 'endOffset'];\r\n\r\n\t\t\tif (container.nodeType == 1) {\r\n\t\t\t\tlastIdx = container.childNodes.length - 1;\r\n\r\n\t\t\t\tif (!start && offset)\r\n\t\t\t\t\toffset--;\r\n\r\n\t\t\t\tcontainer = container.childNodes[offset > lastIdx ? lastIdx : offset];\r\n\t\t\t}\r\n\r\n\t\t\t// If start text node is excluded then walk to the next node\r\n\t\t\tif (container.nodeType === 3 && start && offset >= container.nodeValue.length) {\r\n\t\t\t\tcontainer = new TreeWalker(container, ed.getBody()).next() || container;\r\n\t\t\t}\r\n\r\n\t\t\t// If end text node is excluded then walk to the previous node\r\n\t\t\tif (container.nodeType === 3 && !start && offset == 0) {\r\n\t\t\t\tcontainer = new TreeWalker(container, ed.getBody()).prev() || container;\r\n\t\t\t}\r\n\r\n\t\t\treturn container;\r\n\t\t};\r\n\r\n\t\tfunction performCaretAction(type, name, vars) {\r\n\t\t\tvar invisibleChar, caretContainerId = '_mce_caret', debug = ed.settings.caret_debug;\r\n\r\n\t\t\t// Setup invisible character use zero width space on Gecko since it doesn't change the heigt of the container\r\n\t\t\tinvisibleChar = tinymce.isGecko ? '\\u200B' : INVISIBLE_CHAR;\r\n\r\n\t\t\t// Creates a caret container bogus element\r\n\t\t\tfunction createCaretContainer(fill) {\r\n\t\t\t\tvar caretContainer = dom.create('span', {id: caretContainerId, 'data-mce-bogus': true, style: debug ? 'color:red' : ''});\r\n\r\n\t\t\t\tif (fill) {\r\n\t\t\t\t\tcaretContainer.appendChild(ed.getDoc().createTextNode(invisibleChar));\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn caretContainer;\r\n\t\t\t};\r\n\r\n\t\t\tfunction isCaretContainerEmpty(node, nodes) {\r\n\t\t\t\twhile (node) {\r\n\t\t\t\t\tif ((node.nodeType === 3 && node.nodeValue !== invisibleChar) || node.childNodes.length > 1) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Collect nodes\r\n\t\t\t\t\tif (nodes && node.nodeType === 1) {\r\n\t\t\t\t\t\tnodes.push(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode = node.firstChild;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t// Returns any parent caret container element\r\n\t\t\tfunction getParentCaretContainer(node) {\r\n\t\t\t\twhile (node) {\r\n\t\t\t\t\tif (node.id === caretContainerId) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// Finds the first text node in the specified node\r\n\t\t\tfunction findFirstTextNode(node) {\r\n\t\t\t\tvar walker;\r\n\r\n\t\t\t\tif (node) {\r\n\t\t\t\t\twalker = new TreeWalker(node, node);\r\n\r\n\t\t\t\t\tfor (node = walker.current(); node; node = walker.next()) {\r\n\t\t\t\t\t\tif (node.nodeType === 3) {\r\n\t\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// Removes the caret container for the specified node or all on the current document\r\n\t\t\tfunction removeCaretContainer(node, move_caret) {\r\n\t\t\t\tvar child, rng;\r\n\r\n\t\t\t\tif (!node) {\r\n\t\t\t\t\tnode = getParentCaretContainer(selection.getStart());\r\n\r\n\t\t\t\t\tif (!node) {\r\n\t\t\t\t\t\twhile (node = dom.get(caretContainerId)) {\r\n\t\t\t\t\t\t\tremoveCaretContainer(node, false);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\trng = selection.getRng(true);\r\n\r\n\t\t\t\t\tif (isCaretContainerEmpty(node)) {\r\n\t\t\t\t\t\tif (move_caret !== false) {\r\n\t\t\t\t\t\t\trng.setStartBefore(node);\r\n\t\t\t\t\t\t\trng.setEndBefore(node);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdom.remove(node);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tchild = findFirstTextNode(node);\r\n\t\t\t\t\t\tchild = child.deleteData(0, 1);\r\n\t\t\t\t\t\tdom.remove(node, 1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tselection.setRng(rng);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t// Applies formatting to the caret position\r\n\t\t\tfunction applyCaretFormat() {\r\n\t\t\t\tvar rng, caretContainer, textNode, offset, bookmark, container, text;\r\n\r\n\t\t\t\trng = selection.getRng(true);\r\n\t\t\t\toffset = rng.startOffset;\r\n\t\t\t\tcontainer = rng.startContainer;\r\n\t\t\t\ttext = container.nodeValue;\r\n\r\n\t\t\t\tcaretContainer = getParentCaretContainer(selection.getStart());\r\n\t\t\t\tif (caretContainer) {\r\n\t\t\t\t\ttextNode = findFirstTextNode(caretContainer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Expand to word is caret is in the middle of a text node and the char before/after is a alpha numeric character\r\n\t\t\t\tif (text && offset > 0 && offset < text.length && /\\w/.test(text.charAt(offset)) && /\\w/.test(text.charAt(offset - 1))) {\r\n\t\t\t\t\t// Get bookmark of caret position\r\n\t\t\t\t\tbookmark = selection.getBookmark();\r\n\r\n\t\t\t\t\t// Collapse bookmark range (WebKit)\r\n\t\t\t\t\trng.collapse(true);\r\n\r\n\t\t\t\t\t// Expand the range to the closest word and split it at those points\r\n\t\t\t\t\trng = expandRng(rng, get(name));\r\n\t\t\t\t\trng = rangeUtils.split(rng);\r\n\r\n\t\t\t\t\t// Apply the format to the range\r\n\t\t\t\t\tapply(name, vars, rng);\r\n\r\n\t\t\t\t\t// Move selection back to caret position\r\n\t\t\t\t\tselection.moveToBookmark(bookmark);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!caretContainer || textNode.nodeValue !== invisibleChar) {\r\n\t\t\t\t\t\tcaretContainer = createCaretContainer(true);\r\n\t\t\t\t\t\ttextNode = caretContainer.firstChild;\r\n\r\n\t\t\t\t\t\trng.insertNode(caretContainer);\r\n\t\t\t\t\t\toffset = 1;\r\n\r\n\t\t\t\t\t\tapply(name, vars, caretContainer);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapply(name, vars, caretContainer);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Move selection to text node\r\n\t\t\t\t\tselection.setCursorLocation(textNode, offset);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tfunction removeCaretFormat() {\r\n\t\t\t\tvar rng = selection.getRng(true), container, offset, bookmark,\r\n\t\t\t\t\thasContentAfter, node, formatNode, parents = [], i, caretContainer;\r\n\r\n\t\t\t\tcontainer = rng.startContainer;\r\n\t\t\t\toffset = rng.startOffset;\r\n\t\t\t\tnode = container;\r\n\r\n\t\t\t\tif (container.nodeType == 3) {\r\n\t\t\t\t\tif (offset != container.nodeValue.length || container.nodeValue === invisibleChar) {\r\n\t\t\t\t\t\thasContentAfter = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\twhile (node) {\r\n\t\t\t\t\tif (matchNode(node, name, vars)) {\r\n\t\t\t\t\t\tformatNode = node;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (node.nextSibling) {\r\n\t\t\t\t\t\thasContentAfter = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tparents.push(node);\r\n\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Node doesn't have the specified format\r\n\t\t\t\tif (!formatNode) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Is there contents after the caret then remove the format on the element\r\n\t\t\t\tif (hasContentAfter) {\r\n\t\t\t\t\t// Get bookmark of caret position\r\n\t\t\t\t\tbookmark = selection.getBookmark();\r\n\r\n\t\t\t\t\t// Collapse bookmark range (WebKit)\r\n\t\t\t\t\trng.collapse(true);\r\n\r\n\t\t\t\t\t// Expand the range to the closest word and split it at those points\r\n\t\t\t\t\trng = expandRng(rng, get(name), true);\r\n\t\t\t\t\trng = rangeUtils.split(rng);\r\n\r\n\t\t\t\t\t// Remove the format from the range\r\n\t\t\t\t\tremove(name, vars, rng);\r\n\r\n\t\t\t\t\t// Move selection back to caret position\r\n\t\t\t\t\tselection.moveToBookmark(bookmark);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcaretContainer = createCaretContainer();\r\n\r\n\t\t\t\t\tnode = caretContainer;\r\n\t\t\t\t\tfor (i = parents.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\tnode.appendChild(parents[i].cloneNode(false));\r\n\t\t\t\t\t\tnode = node.firstChild;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Insert invisible character into inner most format element\r\n\t\t\t\t\tnode.appendChild(dom.doc.createTextNode(invisibleChar));\r\n\t\t\t\t\tnode = node.firstChild;\r\n\r\n\t\t\t\t\t// Insert caret container after the formatted node\r\n\t\t\t\t\tdom.insertAfter(caretContainer, formatNode);\r\n\r\n\t\t\t\t\t// Move selection to text node\r\n\t\t\t\t\tselection.setCursorLocation(node, 1);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// Mark current caret container elements as bogus when getting the contents so we don't end up with empty elements\r\n\t\t\ted.onBeforeGetContent.addToTop(function() {\r\n\t\t\t\tvar nodes = [], i;\r\n\r\n\t\t\t\tif (isCaretContainerEmpty(getParentCaretContainer(selection.getStart()), nodes)) {\r\n\t\t\t\t\t// Mark children\r\n\t\t\t\t\ti = nodes.length;\r\n\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\tdom.setAttrib(nodes[i], 'data-mce-bogus', '1');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Remove caret container on mouse up and on key up\r\n\t\t\ttinymce.each('onMouseUp onKeyUp'.split(' '), function(name) {\r\n\t\t\t\ted[name].addToTop(function() {\r\n\t\t\t\t\tremoveCaretContainer();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Remove caret container on keydown and it's a backspace, enter or left/right arrow keys\r\n\t\t\ted.onKeyDown.addToTop(function(ed, e) {\r\n\t\t\t\tvar keyCode = e.keyCode;\r\n\r\n\t\t\t\tif (keyCode == 8 || keyCode == 37 || keyCode == 39) {\r\n\t\t\t\t\tremoveCaretContainer(getParentCaretContainer(selection.getStart()));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Do apply or remove caret format\r\n\t\t\tif (type == \"apply\") {\r\n\t\t\t\tapplyCaretFormat();\r\n\t\t\t} else {\r\n\t\t\t\tremoveCaretFormat();\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n})(tinymce);\r\n\r\ntinymce.onAddEditor.add(function(tinymce, ed) {\r\n\tvar filters, fontSizes, dom, settings = ed.settings;\r\n\r\n\tif (settings.inline_styles) {\r\n\t\tfontSizes = tinymce.explode(settings.font_size_legacy_values);\r\n\r\n\t\tfunction replaceWithSpan(node, styles) {\r\n\t\t\ttinymce.each(styles, function(value, name) {\r\n\t\t\t\tif (value)\r\n\t\t\t\t\tdom.setStyle(node, name, value);\r\n\t\t\t});\r\n\r\n\t\t\tdom.rename(node, 'span');\r\n\t\t};\r\n\r\n\t\tfilters = {\r\n\t\t\tfont : function(dom, node) {\r\n\t\t\t\treplaceWithSpan(node, {\r\n\t\t\t\t\tbackgroundColor : node.style.backgroundColor,\r\n\t\t\t\t\tcolor : node.color,\r\n\t\t\t\t\tfontFamily : node.face,\r\n\t\t\t\t\tfontSize : fontSizes[parseInt(node.size) - 1]\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tu : function(dom, node) {\r\n\t\t\t\treplaceWithSpan(node, {\r\n\t\t\t\t\ttextDecoration : 'underline'\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tstrike : function(dom, node) {\r\n\t\t\t\treplaceWithSpan(node, {\r\n\t\t\t\t\ttextDecoration : 'line-through'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction convert(editor, params) {\r\n\t\t\tdom = editor.dom;\r\n\r\n\t\t\tif (settings.convert_fonts_to_spans) {\r\n\t\t\t\ttinymce.each(dom.select('font,u,strike', params.node), function(node) {\r\n\t\t\t\t\tfilters[node.nodeName.toLowerCase()](ed.dom, node);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\ted.onPreProcess.add(convert);\r\n\t\ted.onSetContent.add(convert);\r\n\r\n\t\ted.onInit.add(function() {\r\n\t\t\ted.selection.onSetContent.add(convert);\r\n\t\t});\r\n\t}\r\n});\r\n\r\n"}
}});
